# 提示词格式化工具使用说明

## 功能说明

这个工具可以将纯文本文件转换为可以直接贴入角色卡的 `system_prompt` 或 `post_history_prompt` 字段的格式。

## 使用方法

### 基本用法

```bash
# 格式化文本文件
python format_prompt_text.py input.txt output.txt

# 只提供输入文件，自动生成输出文件名
python format_prompt_text.py input.txt

# 指定目标字段
python format_prompt_text.py input.txt output.txt --field post_history_prompt
```

### 高级用法

```bash
# 只输出 JSON 格式
python format_prompt_text.py input.txt output.txt --format json

# 只输出字段赋值格式
python format_prompt_text.py input.txt output.txt --format field

# 只输出直接粘贴格式
python format_prompt_text.py input.txt output.txt --format paste

# 指定文件编码
python format_prompt_text.py input.txt output.txt --encoding gbk
```

## 输出格式说明

### 格式 1: JSON 字符串

完整的 JSON 字符串格式，可以直接用于 JSON 文件：

```json
"# 系统核心指令\n\n## 角色定位\n\n你是一个专业的文字冒险游戏AI..."
```

**用途**: 直接复制到 JSON 文件的字段值中

### 格式 2: 字段赋值格式

包含字段名的完整赋值格式：

```json
"system_prompt": "# 系统核心指令\n\n## 角色定位\n\n你是一个专业的文字冒险游戏AI..."
```

**用途**: 直接复制到角色卡 JSON 的对应字段

### 格式 3: 直接粘贴格式

保持换行符，转义引号，适合在编辑器中直接粘贴：

```
# 系统核心指令

## 角色定位

你是一个专业的文字冒险游戏AI...
```

**用途**: 在支持多行文本的编辑器中直接粘贴

## 参数说明

| 参数 | 说明 | 默认值 |
|------|------|--------|
| `input_file` | 输入文本文件路径 | 必需 |
| `output_file` | 输出文件路径 | 自动生成 |
| `--field` | 目标字段名称 | `system_prompt` |
| `--format` | 输出格式 | `all` |
| `--encoding` | 文件编码 | `utf-8` |

## 使用示例

### 示例 1: 格式化 system_prompt

```bash
python format_prompt_text.py system_prompt.txt formatted.txt --field system_prompt
```

**输入文件** (`system_prompt.txt`):
```
# 系统核心指令

## 角色定位

你是一个专业的文字冒险游戏AI...
```

**输出** (格式 2):
```json
"system_prompt": "# 系统核心指令\n\n## 角色定位\n\n你是一个专业的文字冒险游戏AI..."
```

### 示例 2: 格式化 post_history_prompt

```bash
python format_prompt_text.py post_history.txt formatted.txt --field post_history_prompt
```

### 示例 3: 只输出 JSON 格式

```bash
python format_prompt_text.py input.txt output.json --format json
```

## 常见问题

### Q: 如何处理包含特殊字符的文本？

A: 脚本会自动转义所有特殊字符，包括：
- 引号 (`"` → `\"`)
- 反斜杠 (`\` → `\\`)
- 换行符 (`\n`)
- 制表符 (`\t`)

### Q: 文件编码问题？

A: 如果遇到编码错误，使用 `--encoding` 参数：

```bash
# Windows 中文文件
python format_prompt_text.py input.txt output.txt --encoding gbk

# 带 BOM 的 UTF-8 文件
python format_prompt_text.py input.txt output.txt --encoding utf-8-sig
```

### Q: 如何直接粘贴到角色卡 JSON？

A: 使用格式 2（字段赋值格式），直接复制整个字符串，包括字段名和值。

### Q: 输出文件包含所有格式吗？

A: 默认情况下（`--format all`），输出文件包含所有三种格式。如果指定了特定格式，则只输出该格式。

## 注意事项

1. **备份原始文件**: 转换前请备份原始文本文件
2. **检查输出**: 转换后请检查输出是否正确
3. **编码问题**: 如果文本包含中文，确保使用正确的编码
4. **JSON 验证**: 粘贴到 JSON 文件后，请验证 JSON 格式是否正确

## 快速开始

1. 准备您的提示词文本文件（`.txt` 格式）
2. 运行脚本：
   ```bash
   python format_prompt_text.py your_prompt.txt
   ```
3. 查看生成的输出文件
4. 复制对应格式的内容到角色卡 JSON

## 技术说明

脚本使用 Python 的 `json.dumps()` 函数进行 JSON 转义，确保：
- 所有特殊字符正确转义
- Unicode 字符正确处理
- 输出符合 JSON 标准
