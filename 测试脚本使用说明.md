# 测试脚本使用说明

## 📋 使用方法

### 方法1：直接复制粘贴（推荐）

1. 打开浏览器开发者工具（按 `F12`）
2. 切换到 **Console** 标签
3. 打开文件 `测试脚本_控制台执行.js`
4. 复制全部内容
5. 粘贴到控制台中
6. 按 `Enter` 执行

### 方法2：使用浏览器控制台

1. 打开浏览器开发者工具（按 `F12`）
2. 切换到 **Console** 标签
3. 输入以下命令加载脚本：

```javascript
// 如果脚本在本地文件系统中
fetch('file:///C:/Users/38331/Downloads/tavern_helper_template-main/测试脚本_控制台执行.js')
  .then(r => r.text())
  .then(eval);
```

**注意**：由于浏览器安全限制，方法2可能无法直接加载本地文件。推荐使用方法1。

## 📊 测试内容

测试脚本会检查以下内容：

1. ✅ **基础检查**：`window.detentionSystem` 是否存在
2. ✅ **核心属性**：版本、初始化状态、模块、事件等
3. ✅ **ping 方法**：核心系统响应测试
4. ✅ **版本信息**：脚本版本号
5. ✅ **模块注册**：已注册的模块列表
6. ✅ **事件系统**：事件监听和触发功能
7. ✅ **核心模块**：eventSystem、npcSystem、statusPanel、worldbook
8. ✅ **事件系统功能**：时间推进、当前天数获取
9. ✅ **NPC 系统功能**：NPC 生成功能
10. ✅ **状态栏系统**：状态获取功能
11. ✅ **知识库加载器**：知识库加载功能
12. ✅ **初始化状态**：系统是否已初始化
13. ✅ **全局别名**：`window.DS` 是否可用
14. ✅ **记忆增强插件**：插件集成检查（可选）

## 📈 测试结果

测试完成后会显示：

- ✅ **通过的测试**：功能正常
- ❌ **失败的测试**：功能异常，需要修复
- ⚠️ **警告**：可能的问题（如可选模块未加载）

### 结果示例

```
═══════════════════════════════════════════════════
📊 测试结果汇总
═══════════════════════════════════════════════════
✅ 通过: 12 项
❌ 失败: 0 项
⚠️  警告: 2 项
📈 总计: 14 项
📊 通过率: 100.0%

🎉 所有测试通过！脚本功能正常！
═══════════════════════════════════════════════════
```

## 🔍 问题诊断

### 如果 `window.detentionSystem` 不存在

测试脚本会立即停止并提示：

```
❌ window.detentionSystem 不存在
💡 提示: 请检查脚本是否正确导入，路径是否正确
💡 提示: 请检查 Network 标签中是否有 detention-system.js 的请求
💡 提示: 请检查控制台是否有脚本相关的错误信息
```

**解决方法**：
1. 检查脚本路径是否正确
2. 检查 Network 标签中是否有脚本请求
3. 检查控制台是否有错误信息
4. 确认 HTTP 服务器运行在 8080 端口

### 如果某些模块未注册

会显示警告，例如：

```
⚠️  模块 eventSystem 未注册 - 可能未加载或未初始化
```

**可能原因**：
- 模块加载失败
- 模块初始化失败
- 模块未正确注册

**解决方法**：
- 检查控制台是否有模块相关的错误信息
- 检查模块文件是否存在
- 重新构建项目

## 💡 高级用法

### 保存测试结果

测试脚本会返回一个结果对象，可以保存用于进一步分析：

```javascript
const testResult = // ... 执行测试脚本 ...

// 保存结果
console.log('测试结果:', testResult);

// 访问详细信息
console.log('通过的测试:', testResult.details.passed);
console.log('失败的测试:', testResult.details.failed);
console.log('警告:', testResult.details.warnings);
```

### 单独测试某个功能

如果需要单独测试某个功能，可以在控制台中执行：

```javascript
// 测试 ping 方法
window.detentionSystem?.ping();

// 测试事件系统
const eventSystem = window.detentionSystem?.getModule('eventSystem');
eventSystem?.getCurrentDay();

// 测试 NPC 生成
const npcSystem = window.detentionSystem?.getModule('npcSystem');
npcSystem?.generateNPC(1);
```

## 📝 注意事项

1. **执行时机**：建议在页面完全加载后再执行测试脚本
2. **脚本加载**：确保脚本已经加载完成（检查 `window.detentionSystem` 是否存在）
3. **浏览器兼容性**：测试脚本使用现代 JavaScript 语法，需要支持 ES6+ 的浏览器
4. **控制台输出**：测试过程中会有大量控制台输出，这是正常的

## 🎯 快速诊断

如果测试失败，可以快速检查：

```javascript
// 1. 检查脚本是否加载
console.log('window.detentionSystem:', typeof window.detentionSystem);

// 2. 检查 ping 方法
window.detentionSystem?.ping();

// 3. 检查模块
console.log('模块:', window.detentionSystem?.modules);

// 4. 检查版本
console.log('版本:', window.detentionSystem?.version);
```
