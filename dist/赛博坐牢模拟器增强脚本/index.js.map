{"version":3,"file":"index.js","mappings":"aA0JA,MAAMA,EAA4B,CAChCC,eAAgB,IAChBC,kBAAmB,IACnBC,YAAa,EACbC,oBAAqB,EACrBC,eAAgB,KAChBC,eAAgB,GAChBC,eAAgB,GAChBC,mBAAoB,EACpBC,gBAAiB,IACjBC,WAAW,GAGPC,EAAgB,CACpBC,GAAI,IACJC,KAAM,IACNC,OAAQ,KAGV,IAAIC,EAA0B,CAC5BC,KAAM,GACNC,IAAK,EACLC,MAAO,GACPC,OAAQ,GACRC,OAAQ,GACRC,SAAU,GACVC,aAAc,GACdC,WAAY,CACVC,OAAQ,EACRC,OAAQ,EACRC,KAAM,GACNC,UAAW,IAEbC,SAAU,CACRC,IAAK,GACLC,OAAQ,GACRC,UAAW,GACXC,WAAY,GACZC,MAAO,GACPC,MAAO,GACPC,WAAY,IACZC,YAAa,MAEfC,YAAa,GACbC,eAAgB,GAChBC,aAAc,GACdC,KAAM,EACNC,MAAO,OACPC,SAAU,OACVC,QAAS,CACPxB,OAAQ,GACRC,OAAQ,GACRC,SAAU,GACVC,aAAc,IAEhBsB,YAAa,CACXzB,OAAQ,EACRC,OAAQ,EACRC,SAAU,EACVC,aAAc,GAEhBuB,WAAYC,KAAKC,MACjBC,MAAO,CACLC,aAAc,EACdC,iBAAkB,EAClBC,aAAc,EACdC,cAAe,IAKfC,GAAa,EACbC,EAA4C,KAC5CC,EAA4D,KAIhE,SAASC,KAAYC,GACfzD,EAAOU,WACTgD,QAAQC,IAAI,WAAYF,EAE5B,CAEA,SAASG,EAAeC,GACtB,MAAMC,EAAUC,KAAKC,MAAMH,EAAK,KAC1BI,EAAUF,KAAKC,MAAMF,EAAU,IAC/BI,EAAQH,KAAKC,MAAMC,EAAU,IAC7BzB,EAAOuB,KAAKC,MAAME,EAAQ,IAEhC,OAAI1B,EAAO,EAAU,GAAGA,KAAQ0B,EAAQ,OACpCA,EAAQ,EAAU,GAAGA,MAAUD,EAAU,OACzCA,EAAU,EAAU,GAAGA,MAAYH,EAAU,MAC1C,GAAGA,IACZ,CAIA,SAASK,EAAaC,EAAiCC,GAChDtD,EAAM4B,QAAQyB,KACjBrD,EAAM4B,QAAQyB,GAAO,IAGvBrD,EAAM4B,QAAQyB,GAAKE,KAAK,CACtBC,MAAOF,EACPG,UAAW1B,KAAKC,QAGdhC,EAAM4B,QAAQyB,GAAKK,OAASzE,EAAOG,aACrCY,EAAM4B,QAAQyB,GAAKM,QAGrBlB,EAAS,SAASY,KAAOC,EAAQ,EAAI,IAAM,KAAKA,IAClD,CAEA,SAASM,EAAeP,GACtB,IAAKrD,EAAM4B,QAAQyB,IAAsC,IAA9BrD,EAAM4B,QAAQyB,GAAKK,OAC5C,MAAO,SAGT,MAAMG,EAAM7D,EAAM4B,QAAQyB,GAAKS,OAAO,CAACC,EAAKC,IAAWD,EAAMC,EAAOR,MAAO,GAE3E,OAAIK,EAAM,EAAU,KAChBA,GAAO,EAAU,OACd,QACT,CA4BA,SAASI,EAAYC,GACnB,GAAI5B,EACFK,QAAQwB,KAAK,yBADf,CAKA7B,GAAa,EAEb,IASE,GARAG,EAAS,UAAWyB,GAEpBlE,EAAMiC,MAAMC,oBAEMkC,IAAdF,EAAKjE,OAAoBD,EAAMC,KAAOiE,EAAKjE,WAC9BmE,IAAbF,EAAKhE,MAAmBF,EAAME,IAAMgE,EAAKhE,UAC1BkE,IAAfF,EAAK/D,QAAqBH,EAAMG,MAAQ+D,EAAK/D,YAE7BiE,IAAhBF,EAAK9D,OAAsB,CAC7B,MAAMkD,EAAQY,EAAK9D,OAASJ,EAAMI,OAClC,GAAI4C,KAAKqB,IAAIf,IAAUrE,EAAOI,oBAC5BW,EAAMI,OAAS8D,EAAK9D,OACpBgD,EAAa,SAAUE,GACvBb,EAAS,WAAWzC,EAAMI,eAAekD,WAIzC,GAFAtD,EAAM6B,YAAYzB,QAAUkD,EAC5Bb,EAAS,WAAWzC,EAAM6B,YAAYzB,UAClC4C,KAAKqB,IAAIrE,EAAM6B,YAAYzB,SAAWnB,EAAOI,oBAAqB,CACpE,MAAM2E,EAAShB,KAAKC,MAAMjD,EAAM6B,YAAYzB,QAC5CJ,EAAMI,QAAU4D,EAChBhE,EAAM6B,YAAYzB,QAAU4D,EAC5BZ,EAAa,SAAUY,GACvBvB,EAAS,WAAWzC,EAAMI,eAAe4D,KAC3C,CAEJ,CAEA,QAAoBI,IAAhBF,EAAK7D,OAAsB,CAC7B,MAAMiD,EAAQY,EAAK7D,OAASL,EAAMK,OAClC,GAAI2C,KAAKqB,IAAIf,IAAUrE,EAAOI,oBAC5BW,EAAMK,OAAS6D,EAAK7D,OACpB+C,EAAa,SAAUE,GACvBb,EAAS,WAAWzC,EAAMK,eAAeiD,WAIzC,GAFAtD,EAAM6B,YAAYxB,QAAUiD,EAC5Bb,EAAS,WAAWzC,EAAM6B,YAAYxB,UAClC2C,KAAKqB,IAAIrE,EAAM6B,YAAYxB,SAAWpB,EAAOI,oBAAqB,CACpE,MAAM2E,EAAShB,KAAKC,MAAMjD,EAAM6B,YAAYxB,QAC5CL,EAAMK,QAAU2D,EAChBhE,EAAM6B,YAAYxB,QAAU2D,EAC5BZ,EAAa,SAAUY,GACvBvB,EAAS,WAAWzC,EAAMK,eAAe2D,KAC3C,CAEJ,CAEA,QAAsBI,IAAlBF,EAAK5D,SAAwB,CAC/B,MAAMgD,EAAQY,EAAK5D,SAAWN,EAAMM,SACpC,GAAI0C,KAAKqB,IAAIf,IAAUrE,EAAOI,oBAC5BW,EAAMM,SAAW4D,EAAK5D,SACtB8C,EAAa,WAAYE,GACzBb,EAAS,WAAWzC,EAAMM,iBAAiBgD,WAI3C,GAFAtD,EAAM6B,YAAYvB,UAAYgD,EAC9Bb,EAAS,WAAWzC,EAAM6B,YAAYvB,YAClC0C,KAAKqB,IAAIrE,EAAM6B,YAAYvB,WAAarB,EAAOI,oBAAqB,CACtE,MAAM2E,EAAShB,KAAKC,MAAMjD,EAAM6B,YAAYvB,UAC5CN,EAAMM,UAAY0D,EAClBhE,EAAM6B,YAAYvB,UAAY0D,EAC9BZ,EAAa,WAAYY,GACzBvB,EAAS,WAAWzC,EAAMM,iBAAiB0D,KAC7C,CAEJ,CAEA,QAA0BI,IAAtBF,EAAK3D,aAA4B,CACnC,MAAM+C,EAAQY,EAAK3D,aAAeP,EAAMO,aACxC,GAAIyC,KAAKqB,IAAIf,IAAUrE,EAAOI,oBAC5BW,EAAMO,aAAe2D,EAAK3D,aAC1B6C,EAAa,eAAgBE,GAC7Bb,EAAS,WAAWzC,EAAMO,qBAAqB+C,WAI/C,GAFAtD,EAAM6B,YAAYtB,cAAgB+C,EAClCb,EAAS,WAAWzC,EAAM6B,YAAYtB,gBAClCyC,KAAKqB,IAAIrE,EAAM6B,YAAYtB,eAAiBtB,EAAOI,oBAAqB,CAC1E,MAAM2E,EAAShB,KAAKC,MAAMjD,EAAM6B,YAAYtB,cAC5CP,EAAMO,cAAgByD,EACtBhE,EAAM6B,YAAYtB,cAAgByD,EAClCZ,EAAa,eAAgBY,GAC7BvB,EAAS,WAAWzC,EAAMO,qBAAqByD,KACjD,CAEJ,CAEIE,EAAK1D,kBACwB4D,IAA3BF,EAAK1D,WAAWC,SAAsBT,EAAMQ,WAAWC,OAASyD,EAAK1D,WAAWC,aACrD2D,IAA3BF,EAAK1D,WAAWE,SAAsBV,EAAMQ,WAAWE,OAASwD,EAAK1D,WAAWE,aACvD0D,IAAzBF,EAAK1D,WAAWG,OAAoBX,EAAMQ,WAAWG,KAAOuD,EAAK1D,WAAWG,WAC9CyD,IAA9BF,EAAK1D,WAAWI,YAAyBZ,EAAMQ,WAAWI,UAAYsD,EAAK1D,WAAWI,YAGxFsD,EAAKrD,gBACmBuD,IAAtBF,EAAKrD,SAASC,MAAmBd,EAAMa,SAASC,IAAMoD,EAAKrD,SAASC,UAC3CsD,IAAzBF,EAAKrD,SAASE,SAAsBf,EAAMa,SAASE,OAASmD,EAAKrD,SAASE,aAC9CqD,IAA5BF,EAAKrD,SAASG,YAAyBhB,EAAMa,SAASG,UAAYkD,EAAKrD,SAASG,gBACnDoD,IAA7BF,EAAKrD,SAASI,aAA0BjB,EAAMa,SAASI,WAAaiD,EAAKrD,SAASI,iBAC1DmD,IAAxBF,EAAKrD,SAASK,QAAqBlB,EAAMa,SAASK,MAAQgD,EAAKrD,SAASK,YAChDkD,IAAxBF,EAAKrD,SAASM,QAAqBnB,EAAMa,SAASM,MAAQ+C,EAAKrD,SAASM,YAC3CiD,IAA7BF,EAAKrD,SAASO,aAA0BpB,EAAMa,SAASO,WAAa8C,EAAKrD,SAASO,iBACpDgD,IAA9BF,EAAKrD,SAASQ,cAA2BrB,EAAMa,SAASQ,YAAc6C,EAAKrD,SAASQ,mBAGjE+C,IAArBF,EAAK5C,cAA2BtB,EAAMsB,YAAc4C,EAAK5C,kBACjC8C,IAAxBF,EAAK3C,iBAA8BvB,EAAMuB,eAAiB2C,EAAK3C,qBACzC6C,IAAtBF,EAAK1C,eAA4BxB,EAAMwB,aAAe0C,EAAK1C,mBAE7C4C,IAAdF,EAAKzC,OAAoBzB,EAAMyB,KAAOyC,EAAKzC,WAC5B2C,IAAfF,EAAKxC,QAAqB1B,EAAM0B,MAAQwC,EAAKxC,YAC3B0C,IAAlBF,EAAKvC,WAAwB3B,EAAM2B,SAAWuC,EAAKvC,UAEvD3B,EAAM8B,WAAaC,KAAKC,MAExBS,EAAS,UAET6B,GACF,CAAE,MAAOC,GACP5B,QAAQ4B,MAAM,gBAAiBA,EACjC,C,QACEjC,GAAa,CACf,CA5HA,CA6HF,CAIA,SAASkC,EAAiBC,GACxB,GAAKA,GAAQA,EAAKC,WAAaC,KAAKC,aAIpC,IACE,IAAIC,EAAWJ,EAAiBK,WAAcL,EAAiBM,aAAe,GAG9E,GAFAF,EAAUA,EAAQG,QAEbH,EACH,OAKF,GAFApC,EAAS,WAAYoC,EAAQI,UAAU,EAAG,MAAQJ,EAAQnB,OAAS,IAAM,MAAQ,KAE7EmB,EAAQK,WAAW,kBAAmB,CACxC,MAAMC,EAAUN,EAAQI,UAAU,IAAyBD,OAC3DvC,EAAS,aAAc0C,EAAQF,UAAU,EAAG,MAAQE,EAAQzB,OAAS,IAAM,MAAQ,KACnF0B,EAAkBD,EACpB,CACF,CAAE,MAAOZ,GACP5B,QAAQ4B,MAAM,kBAAmBA,EACnC,CACF,CAEA,SAASa,EAAkBD,EAAiBE,EAAU,GACpD,IAGEF,GADAA,GADAA,EAAUA,EAAQH,QACAM,QAAQ,eAAgB,OACxBA,QAAQ,YAAa,IAEvC7C,EAAS,cAAc4C,OAAcF,EAAQF,UAAU,EAAG,MAAQE,EAAQzB,OAAS,IAAM,MAAQ,KAEjG,MAAMQ,EAAOqB,KAAKC,MAAML,GACxBxC,QAAQC,IAAI,oBAAqBsB,GAEjClE,EAAMiC,MAAME,mBACZnC,EAAMiC,MAAMI,cAAgBN,KAAKC,MAEjCiC,EAAYC,GAEZ,MAAMuB,EAAKC,OAAOC,gBAKlB,OAJIF,GAAMA,EAAGG,QACXH,EAAGG,OAAOC,KAAK,gBAAiB3B,IAG3B,CACT,CAAE,MAAOK,GACP,MAAMuB,EAAevB,aAAiBwB,MAAQxB,EAAMyB,QAAUC,OAAO1B,GAMrE,GALA5B,QAAQ4B,MAAM,oBAAoBc,KAAWpG,EAAOQ,uBAAwBqG,GAC5EnD,QAAQ4B,MAAM,gBAAiBY,GAE/BnF,EAAMiC,MAAMG,eAERiD,EAAUpG,EAAOQ,mBAKnB,OAJAkD,QAAQC,IAAI,YAAY3D,EAAOS,4BAC/BwG,WAAW,KACTd,EAAkBD,EAASE,EAAU,IACpCpG,EAAOS,kBACH,EACF,CACLiD,QAAQ4B,MAAM,0BAEd,MAAMkB,EAAKC,OAAOC,gBASlB,OARIF,GAAMA,EAAGG,QACXH,EAAGG,OAAOC,KAAK,aAAc,CAC3BV,UACAZ,MAAOuB,EACPK,SAAUd,KAIP,CACT,CACF,CACF,CAEA,SAASe,EAAqBC,GAC5B,GAAKA,GAAWA,EAAQ3B,WAAaC,KAAK2B,aAI1C,IACE,MAAMC,EAASC,SAASC,iBAAiBJ,EAASK,WAAWC,aAAc,MAAM,GAEjF,IAAIlC,EACAmC,EAAQ,EACZ,KAAQnC,EAAO8B,EAAOM,YACpBD,IACApC,EAAiBC,GAGfmC,EAAQ,GACVnE,EAAS,sBAAsBmE,UAEnC,CAAE,MAAOrC,GACP5B,QAAQ4B,MAAM,yBAA0BA,EAC1C,CACF,CAIA,SAASuC,EAAcC,EAAYvD,GACjC,MAAM6C,EAAUG,SAASQ,eAAeD,GACpCV,GAAWA,EAAQtB,cAAgBvB,IACrC6C,EAAQtB,YAAcvB,EAEtB6C,EAAQY,UAAUC,OAAO,WACzBhB,WAAW,KACTG,EAAQY,UAAUE,IAAI,YACrB,IAEHjB,WAAW,KACTG,EAAQY,UAAUC,OAAO,YACxB,KAEP,CAEA,SAASE,EAAW/D,EAAwDG,GAC1EA,EAAQR,KAAKqE,IAAI,EAAGrE,KAAKsE,IAAI,IAAK9D,IAElC,MAAM+D,EAAef,SAASQ,eAAe,GAAG3D,WAC5CkE,IACFA,EAAaxC,YAAc/B,KAAKwE,MAAMhE,GAAOiE,YAG/C,MAAMC,EAAalB,SAASQ,eAAe,GAAG3D,SAC9C,GAAIqE,EAAY,CACdA,EAAWC,MAAMC,MAAQ,GAAGpE,KAE5B,MAAMqE,EAAUH,EAAWI,QAAQ,aAC/BD,IACFA,EAAQZ,UAAUC,OAAO,WACzBhB,WAAW,KACT2B,EAAQZ,UAAUE,IAAI,YACrB,IAEHjB,WAAW,KACT2B,EAAQZ,UAAUC,OAAO,YACxB,KAEP,CAEA,MAAMa,EAAQnE,EAAeP,GACvB2E,EAAexB,SAASQ,eAAe,GAAG3D,WAC5C2E,IACFA,EAAajD,YAAcnF,EAAcmI,GACzCC,EAAaL,MAAMM,MAAkB,OAAVF,EAAiB,UAAsB,SAAVA,EAAmB,UAAY,OAE3F,CAEA,SAASzD,IAGP,IACEwC,EAAc,cAAe9G,EAAMC,MAAQ,OAC3C6G,EAAc,aAAc9G,EAAME,IAAM,GAAGF,EAAME,OAAS,OAC1D4G,EAAc,eAAgB9G,EAAMG,OAAS,OAC7C2G,EAAc,cAAe,GAAG9G,EAAMyB,SACtCqF,EAAc,eAAgB9G,EAAM0B,OACpCoF,EAAc,cAAe9G,EAAM2B,UAEnCyF,EAAW,SAAUpH,EAAMI,QAC3BgH,EAAW,SAAUpH,EAAMK,QAC3B+G,EAAW,WAAYpH,EAAMM,UAC7B8G,EAAW,eAAgBpH,EAAMO,cAEjCuG,EAAc,gBAAiB9G,EAAMQ,WAAWC,OAAS,GAAGT,EAAMQ,WAAWC,WAAa,OAC1FqG,EAAc,gBAAiB9G,EAAMQ,WAAWE,OAAS,GAAGV,EAAMQ,WAAWE,WAAa,OAC1FoG,EAAc,cAAe9G,EAAMQ,WAAWG,MAAQ,OACtDmG,EAAc,mBAAoB9G,EAAMQ,WAAWI,WAAa,OAEhEkG,EAAc,aAAc9G,EAAMa,SAASC,KAAO,OAClDgG,EAAc,gBAAiB9G,EAAMa,SAASE,QAAU,OACxD+F,EAAc,mBAAoB9G,EAAMa,SAASG,WAAa,OAC9D8F,EAAc,oBAAqB9G,EAAMa,SAASI,YAAc,OAChE6F,EAAc,eAAgB9G,EAAMa,SAASK,OAAS,OACtD4F,EAAc,eAAgB9G,EAAMa,SAASM,OAAS,OACtD2F,EAAc,oBAAqB9G,EAAMa,SAASO,YAAc,KAChE0F,EAAc,qBAAsB9G,EAAMa,SAASQ,aAAe,MAElEyF,EAAc,cAAe9G,EAAMsB,aAAe,KAClDwF,EAAc,iBAAkB9G,EAAMuB,gBAAkB,KACxDuF,EAAc,eAAgB9G,EAAMwB,cAAgB,IACtD,CAAE,MAAO+C,GACP5B,QAAQ4B,MAAM,gBAAiBA,EACjC,CACF,CAqQA,SAAS2D,IACP,GAAI1B,SAASQ,eAAe,0BAE1B,YADArE,QAAQC,IAAI,qBAId,MAAMuF,EAAQ3B,SAAS4B,cAAc,OACrCD,EAAMpB,GAAK,yBACXoB,EAAME,UAAY,22NA3QpB,WACE,GAAI7B,SAASQ,eAAe,2BAC1B,OAGF,MAAMW,EAAQnB,SAAS4B,cAAc,SACrCT,EAAMZ,GAAK,0BACXY,EAAM5C,YAAc,2zKAyPpByB,SAAS8B,KAAKC,YAAYZ,EAC5B,CAkMEa,GAEAhC,SAASiC,KAAKF,YAAYJ,GAE1B,MAAMO,EAAYP,EAAMQ,cAAc,kBAChC9D,EAAUsD,EAAMQ,cAAc,mBAChCD,GAAa7D,GACf6D,EAAUE,iBAAiB,QAAS,KAClC,MAAMC,EAAwC,SAA1BhE,EAAQ8C,MAAMmB,QAClCjE,EAAQ8C,MAAMmB,QAAUD,EAAc,QAAU,OAChDH,EAAU3D,YAAc8D,EAAc,IAAM,MAIhD,MAAME,EAAWZ,EAAMQ,cAAc,qBAC/BK,EAAeb,EAAMQ,cAAc,eACrCI,GAAYC,GACdD,EAASH,iBAAiB,QAAS,KACjC,MAAMK,EAA0C,SAA/BD,EAAarB,MAAMmB,QACpCE,EAAarB,MAAMmB,QAAUG,EAAW,QAAU,OAQxD,WACEnC,EAAc,sBAAuB9G,EAAMiC,MAAMC,aAAauF,YAC9DX,EAAc,uBAAwB9G,EAAMiC,MAAME,iBAAiBsF,YACnEX,EAAc,sBAAuB9G,EAAMiC,MAAMG,aAAaqF,YAI9DX,EAAc,oBADZ9G,EAAMiC,MAAMI,cAAgB,EAAI,IAAIN,KAAK/B,EAAMiC,MAAMI,eAAe6G,mBAAmB,SAAW,MAIpGpC,EAAc,wBADSvE,EAAmB,MAAQ,MAEpD,CAlBM4G,KAIJxG,QAAQC,IAAI,eACd,CA2DA,SAASwG,IACH7G,IACFA,EAAiB8G,aACjB9G,EAAmB,KACnBI,QAAQC,IAAI,qBAEhB,CAEA,SAAS0G,IACH9G,GACF+G,cAAc/G,GAGhBA,EAAqBgH,YAAY,KAC/BlF,IAj4BJ,WACE,MAAMmF,GAAexK,EAAOM,eAAiBS,EAAMI,QAAUnB,EAAOK,eACpE,GAAI0D,KAAKqB,IAAIoF,GAAe,MAC1BzJ,EAAM6B,YAAYzB,QAAUqJ,EACxBzG,KAAKqB,IAAIrE,EAAM6B,YAAYzB,SAAWnB,EAAOI,qBAAqB,CACpE,MAAM2E,EAAShB,KAAKC,MAAMjD,EAAM6B,YAAYzB,QAC5CJ,EAAMI,QAAU4D,EAChBhE,EAAM6B,YAAYzB,QAAU4D,EAC5BZ,EAAa,SAAUY,GACvBvB,EAAS,SAASuB,IACpB,CAGF,MAAM0F,GAAezK,EAAOO,eAAiBQ,EAAMK,QAAUpB,EAAOK,eACpE,GAAI0D,KAAKqB,IAAIqF,GAAe,MAC1B1J,EAAM6B,YAAYxB,QAAUqJ,EACxB1G,KAAKqB,IAAIrE,EAAM6B,YAAYxB,SAAWpB,EAAOI,qBAAqB,CACpE,MAAM2E,EAAShB,KAAKC,MAAMjD,EAAM6B,YAAYxB,QAC5CL,EAAMK,QAAU2D,EAChBhE,EAAM6B,YAAYxB,QAAU2D,EAC5BZ,EAAa,SAAUY,GACvBvB,EAAS,SAASuB,IACpB,CAEJ,CA02BI2F,IACC1K,EAAOC,gBAEVuD,EAAS,UACX,CAEA,SAASmH,IACHpH,IACF+G,cAAc/G,GACdA,EAAqB,KACrBC,EAAS,WAEb,CAIA,MAAMoH,EAGF,CACFC,QAAS,QAET9J,QAEA,UAAA+J,GACEpH,QAAQC,IAAI,yBAEZsF,IACAoB,IApFE/G,GACFA,EAAiB8G,aAGnB1G,QAAQC,IAAI,uBAEZL,EAAmB,IAAIyH,iBAAiBC,IACtC,IAAK,MAAMC,KAAYD,EAAW,CAChC,GAAsB,cAAlBC,EAASC,KACX,IAAK,MAAM1F,KAAQyF,EAASE,WACtB3F,EAAKC,WAAaC,KAAKC,aACzBJ,EAAiBC,GACRA,EAAKC,WAAaC,KAAK2B,cAChCF,EAAqB3B,GAKL,kBAAlByF,EAASC,MACPD,EAASG,OAAO3F,WAAaC,KAAKC,cACpCJ,EAAiB0F,EAASG,OAGhC,IAGF9H,EAAiB+H,QAAQ9D,SAASiC,KAAM,CACtC8B,WAAW,EACXC,SAAS,EACTC,eAAe,EACfC,uBAAuB,IAGzB/H,QAAQC,IAAI,mBACZsD,WAAW,KACTE,EAAqBI,SAASiC,OAC7B,KAEH9F,QAAQC,IAAI,qBAiDV,MAAM6C,EAAKC,OAAOC,gBACdF,GAAMA,EAAGG,SACXH,EAAGG,OAAO+E,GAAG,eAAiBzG,IAC5BzB,EAAS,UAAWyB,GAChBA,GAAwB,iBAATA,GACjBD,EAAYC,KAIhBuB,EAAGG,OAAO+E,GAAG,cAAgBzG,IAE3B,GADAzB,EAAS,UAAWyB,GAChBA,GAAwB,iBAATA,EAAmB,CACpC,MAAM0G,EAAI1G,OACKE,IAAXwG,EAAEnJ,OAAoBzB,EAAMyB,KAAOmJ,EAAEnJ,WACzB2C,IAAZwG,EAAElJ,QAAqB1B,EAAM0B,MAAQkJ,EAAElJ,YACxB0C,IAAfwG,EAAEjJ,WAAwB3B,EAAM2B,SAAWiJ,EAAEjJ,UACjD2C,GACF,KAIJ3B,QAAQC,IAAI,eACZD,QAAQC,IAAI,cAAe3D,EAAOU,UAAY,KAAO,KACvD,EAEA,OAAAkL,GACElI,QAAQC,IAAI,iBAEZwG,IACAQ,IAEA,MAAMzB,EAAQ3B,SAASQ,eAAe,0BAClCmB,IACFA,EAAMjB,SACNvE,QAAQC,IAAI,gBAGd,MAAMkI,EAAStE,SAASQ,eAAe,2BACnC8D,IACFA,EAAO5D,SACPvE,QAAQC,IAAI,gBAGd,MAAM6C,EAAKC,OAAOC,gBACdF,GAAMA,EAAGG,SACXH,EAAGG,OAAOmF,IAAI,eAAgB,QAC9BtF,EAAGG,OAAOmF,IAAI,cAAe,SAG/BpI,QAAQC,IAAI,aACd,EAEAoI,SAAQ,KACC,CACL/K,KAAMD,EAAMC,KACZC,IAAKF,EAAME,IACXC,MAAOH,EAAMG,MACbC,OAAQJ,EAAMI,OACdC,OAAQL,EAAMK,OACdC,SAAUN,EAAMM,SAChBC,aAAcP,EAAMO,aACpBC,WAAY,IAAKR,EAAMQ,YACvBK,SAAU,IAAKb,EAAMa,UACrBS,YAAatB,EAAMsB,YACnBC,eAAgBvB,EAAMuB,eACtBC,aAAcxB,EAAMwB,aACpBC,KAAMzB,EAAMyB,KACZC,MAAO1B,EAAM0B,MACbC,SAAU3B,EAAM2B,WAIpB,WAAAsJ,CAAY5H,EAAaC,EAAe4H,EAAS,IAC/C,QAAgD9G,IAA3CpE,EAAkCqD,GAErC,YADAV,QAAQ4B,MAAM,iBAAiBlB,KAIjC,MAAM8H,EAAYnL,EAAiCqD,GAC7C+H,EAAWpI,KAAKqE,IAAI,EAAGrE,KAAKsE,IAAI,IAAK6D,EAAW7H,IAEtD,GAAI8H,IAAaD,EAAU,CACxBnL,EAAiCqD,GAAO+H,EACzChI,EAAaC,EAAmCC,GAEhDX,QAAQC,IACN,SAASS,SAAW8H,OAAcC,MAAa9H,EAAQ,EAAI,IAAM,KAAKA,MAAU4H,EAAS,OAAOA,IAAW,MAG7G,MAAMzF,EAAKC,OAAOC,gBACdF,GAAMA,EAAGG,QACXH,EAAGG,OAAOC,KAAK,eAAgB,CAC7BxC,MACA8H,WACAC,WACA9H,QACA4H,WAIJ5G,GACF,CACF,EAEA+G,iBAAgB,KACP,CACLjL,OAAQ,CACNoD,MAAOxD,EAAMI,OACb2H,MAAOnE,EAAe,UACtBhC,QAAS5B,EAAM4B,QAAQxB,QAAU,IAEnCC,OAAQ,CACNmD,MAAOxD,EAAMK,OACb0H,MAAOnE,EAAe,UACtBhC,QAAS5B,EAAM4B,QAAQvB,QAAU,IAEnCC,SAAU,CACRkD,MAAOxD,EAAMM,SACbyH,MAAOnE,EAAe,YACtBhC,QAAS5B,EAAM4B,QAAQtB,UAAY,IAErCC,aAAc,CACZiD,MAAOxD,EAAMO,aACbwH,MAAOnE,EAAe,gBACtBhC,QAAS5B,EAAM4B,QAAQrB,cAAgB,MAK7C+K,gBAAe,KACN,CACL7J,KAAMzB,EAAMyB,KACZC,MAAO1B,EAAM0B,MACbC,SAAU3B,EAAM2B,WAIpByD,oBAEA,KAAAmG,GACEvL,EAAQ,CACNC,KAAM,GACNC,IAAK,EACLC,MAAO,GACPC,OAAQ,GACRC,OAAQ,GACRC,SAAU,GACVC,aAAc,GACdC,WAAY,CACVC,OAAQ,EACRC,OAAQ,EACRC,KAAM,GACNC,UAAW,IAEbC,SAAU,CACRC,IAAK,GACLC,OAAQ,GACRC,UAAW,GACXC,WAAY,GACZC,MAAO,GACPC,MAAO,GACPC,WAAY,IACZC,YAAa,MAEfC,YAAa,GACbC,eAAgB,GAChBC,aAAc,GACdC,KAAM,EACNC,MAAO,OACPC,SAAU,OACVC,QAAS,CACPxB,OAAQ,GACRC,OAAQ,GACRC,SAAU,GACVC,aAAc,IAEhBsB,YAAa,CACXzB,OAAQ,EACRC,OAAQ,EACRC,SAAU,EACVC,aAAc,GAEhBuB,WAAYC,KAAKC,MACjBC,MAAO,CACLC,aAAc,EACdC,iBAAkB,EAClBC,aAAc,EACdC,cAAe,IAInBiC,IACA3B,QAAQC,IAAI,cACd,EAEA4I,WAAU,KACD,CACL1B,QAAS,QACTrG,UAAW1B,KAAKC,MAChBhC,MAAOuF,KAAKC,MAAMD,KAAKkG,UAAUzL,MAIrC,UAAA0L,CAAWxH,GACT,IAAKA,IAASA,EAAKlE,MAEjB,OADA2C,QAAQ4B,MAAM,kBACP,EAGT,IAsCE,OArCIL,EAAK4F,SAA4B,UAAjB5F,EAAK4F,SACvBnH,QAAQwB,KAAK,kBAAkBD,EAAK4F,oBAGtC9J,EAAQkE,EAAKlE,MAERA,EAAM4B,UACT5B,EAAM4B,QAAU,CACdxB,OAAQ,GACRC,OAAQ,GACRC,SAAU,GACVC,aAAc,KAIbP,EAAM6B,cACT7B,EAAM6B,YAAc,CAClBzB,OAAQ,EACRC,OAAQ,EACRC,SAAU,EACVC,aAAc,IAIbP,EAAMiC,QACTjC,EAAMiC,MAAQ,CACZC,aAAc,EACdC,iBAAkB,EAClBC,aAAc,EACdC,cAAe,IAInBrC,EAAM8B,WAAaC,KAAKC,MAExBsC,IACA3B,QAAQC,IAAI,iBACL,CACT,CAAE,MAAO2B,GAEP,OADA5B,QAAQ4B,MAAM,gBAAiBA,IACxB,CACT,CACF,GA2FAsF,EAQA8B,MAAQ,CACRC,gBA/FF,WACEjJ,QAAQC,IAAI,yBAEZ,MAAM2D,EAASC,SAASC,iBAAiBD,SAASiC,KAAM/B,WAAWC,aAAc,MAAM,GAEjFkF,EAAqG,GAC3G,IAAIpH,EACJ,KAAQA,EAAO8B,EAAOM,YAAa,CACjC,MAAMhC,GAAYJ,EAAiBK,WAAcL,EAAiBM,aAAe,IAAIC,OACrF6G,EAAStI,KAAK,CACZsB,QAASA,EAAQI,UAAU,EAAG,MAAQJ,EAAQnB,OAAS,IAAM,MAAQ,IACrEoI,YAAajH,EACbkH,eAAgBlH,EAAQK,WAAW,kBACnCxB,OAAQmB,EAAQnB,SAGdmB,EAAQK,WAAW,oBACrBvC,QAAQC,IAAI,oBAAqBiC,EAAQI,UAAU,EAAG,MACtDT,EAAiBC,GAErB,CAMA,OAJA9B,QAAQC,IAAI,kBAAkBiJ,EAASnI,cACvCf,QAAQC,IAAI,kBAAmBiJ,EAASG,OAAOC,GAAKA,EAAEF,gBAAgBrI,QACtEf,QAAQuJ,MAAML,GAEPA,CACT,EAqEEM,eAnEF,WAeE,MAAMC,EAAc,CAClBtC,QAAS,QACTrG,WAAW,IAAI1B,MAAOsK,eAAe,SACrCC,SAAU,CACRC,OAA6B,OAArBhK,EACRiK,OAAQjK,EAAmB,MAAQ,OAErCvC,MAAO,CACL8B,WAAY,IAAIC,KAAK/B,EAAM8B,YAAYuK,eAAe,SACtDI,gBAAiB1K,KAAKC,MAAQhC,EAAM8B,WACpC4K,yBAA0B7J,EAAed,KAAKC,MAAQhC,EAAM8B,aAE9DG,MAAO,CACLC,aAAclC,EAAMiC,MAAMC,aAC1BC,iBAAkBnC,EAAMiC,MAAME,iBAC9BC,aAAcpC,EAAMiC,MAAMG,aAC1BuK,YACE3M,EAAMiC,MAAMC,aAAe,EACvB,IAAKlC,EAAMiC,MAAME,iBAAmBnC,EAAMiC,MAAMC,aAAgB,KAAK0K,QAAQ,MAC7E,MACNvK,cACErC,EAAMiC,MAAMI,cAAgB,EAAI,IAAIN,KAAK/B,EAAMiC,MAAMI,eAAegK,eAAe,SAAW,MAElGQ,aAAchD,EAAYmB,WAC1B8B,OAAQ7N,GAaV,OAVA0D,QAAQC,IAAI,mBACZD,QAAQC,IAAI,MAAOwJ,EAAYtC,SAC/BnH,QAAQC,IAAI,MAAOwJ,EAAY3I,WAC/Bd,QAAQC,IAAI,SAAUwJ,EAAYE,SAASE,QAC3C7J,QAAQC,IAAI,QAASwJ,EAAYpM,MAAM8B,YACvCa,QAAQC,IAAI,UAAWwJ,EAAYpM,MAAM0M,0BACzC/J,QAAQC,IAAI,QAASwJ,EAAYnK,OACjCU,QAAQC,IAAI,QAASwJ,EAAYS,cACjClK,QAAQC,IAAI,0BAELwJ,CACT,EAeE5H,mBACA4B,wBAKF2G,EAAE,KACApK,QAAQqK,KAAK,uBAEb,MAAMvH,EAAKC,OAAOC,gBACbF,GAOHA,EAOAuF,SAAW,IAAMnB,EAAYmB,WAC9BvF,EAAiGwF,YAAc,CAC9G5H,EACAC,EACA4H,IACGrB,EAAYoB,YAAY5H,EAAKC,EAAO4H,GACxCzF,EAAoE4F,iBAAmB,IACtFxB,EAAYwB,mBAEZ5F,EAGA6F,gBAAkB,IAAMzB,EAAYyB,kBACrC7F,EAA8EL,kBAC7ED,GACG0E,EAAYzE,kBAAkBD,GAGnCM,EAAGwH,eAAe,cAAepD,GAGhCnE,OAAOC,gBAAwEuH,YAAcrD,EAG9FpE,EAAGG,OAAO+E,GAAG,cAAe,KAC1BhI,QAAQqK,KAAK,2BACb9G,WAAW,KACT,IACE2D,EAAYE,aACZpH,QAAQqK,KAAK,mBACf,CAAE,MAAOzI,GACP5B,QAAQ4B,MAAM,oBAAqBA,EACrC,GACC,OAIDkB,EAAG0H,aACLjH,WAAW,KACT,IACE2D,EAAYE,aACZpH,QAAQqK,KAAK,mBACf,CAAE,MAAOzI,GACP5B,QAAQ4B,MAAM,oBAAqBA,EACrC,GACC,KAGL5B,QAAQqK,KAAK,wBA7DXrK,QAAQ4B,MAAM,mBAiElBwI,EAAErH,QAAQiF,GAAG,WAAY,KACvBhI,QAAQC,IAAI,wBACZwG,IACAQ,K,GCzmDEwD,EAA2B,CAAC,ECKhCC,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,YACVxH,QAAS,eACT9B,KAAM,CACJT,UAAW1B,KAAKC,MAChByL,sBAAyC,oBAAX/H,aAAqE,IAAnCA,OAAeC,iBAEjFlC,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGTlL,QAAQqK,KAAK,kBAyDb,MAAMc,EACalI,OAAS,IAAImI,IAE9B,EAAApD,CAAGqD,EAAeC,GACXC,KAAKtI,OAAOuI,IAAIH,IACnBE,KAAKtI,OAAOwI,IAAIJ,EAAO,IAEzBE,KAAKtI,OAAOyI,IAAIL,GAAQzK,KAAK0K,EAC/B,CAEA,GAAAlD,CAAIiD,EAAeC,GACjB,MAAMK,EAAYJ,KAAKtI,OAAOyI,IAAIL,GAClC,IAAKM,EAAW,OAChB,MAAMC,EAAQD,EAAUE,QAAQP,GAC5BM,GAAS,GAAGD,EAAUG,OAAOF,EAAO,EAC1C,CAEA,IAAA1I,CAAKmI,EAAe9J,GAClB,MAAMoK,EAAYJ,KAAKtI,OAAOyI,IAAIL,GAC7BM,GACLA,EAAUI,QAAQC,IAChB,IACEA,EAAGzK,EACL,CAAE,MAAOK,GACP5B,QAAQ4B,MAAM,aAAayJ,UAAezJ,EAC5C,GAEJ,CAEA,IAAAqK,CAAKZ,EAAeC,GAClB,MAAMY,EAAW3K,IACf+J,EAAS/J,GACTgK,KAAKnD,IAAIiD,EAAOa,IAElBX,KAAKvD,GAAGqD,EAAOa,EACjB,EA6BF,MAAMC,EAA+C,IAAIf,IACzD,IAAIgB,EA0CJ,SAASC,IACP,MAGMC,EAA0B,CAC9BnF,QAAS,QACTqD,aAAa,EACb+B,QAAS,CAAC,EACVpC,OAAQ,CACNqC,YAAa,IACbC,eAAgB,IAChBC,mBAAoB,GACpBC,YAAa,IACbC,oBAAqB,IACrBC,mBAAoB,KAEtBxP,MAAO,CACLyP,KAAM,YACNC,UAAW,EACXC,gBAAiB,EACjBC,OAAQ,IAEVhK,OArBa,IAAIkI,EAsBjB+B,aA9DK,CACL,GAAAzB,CAAO/K,EAAaG,EAAUsM,GAC5B,MAAMC,EAASD,EAAM/N,KAAKC,MAAc,IAAN8N,EAAa,KAC/ChB,EAAWV,IAAI/K,EAAK,CAAEG,QAAOuM,UAC/B,EACA,GAAA1B,CAAOhL,GACL,MAAM2M,EAAOlB,EAAWT,IAAIhL,GAC5B,OAAK2M,EACe,OAAhBA,EAAKD,QAAmBhO,KAAKC,MAAQgO,EAAKD,QAC5CjB,EAAWmB,OAAO5M,GACX,MAEF2M,EAAKxM,MALM,IAMpB,EACA,GAAA2K,CAAI9K,GACF,OAAyB,OAAlB6K,KAAKG,IAAIhL,EAClB,EACA,OAAOA,GACLyL,EAAWmB,OAAO5M,EACpB,EACA,KAAA6M,GACEpB,EAAWoB,OACb,EACA,OAAAC,GACE,MAAMnO,EAAMD,KAAKC,MACjB,IAAK,MAAOqB,EAAK2M,KAASlB,EAAWsB,UACf,OAAhBJ,EAAKD,QAAmB/N,EAAMgO,EAAKD,QACrCjB,EAAWmB,OAAO5M,EAGxB,GAiCAyK,eAEAuC,KAAI,KACFpB,EAAOjP,MAAM2P,gBAAkB5N,KAAKC,OAC7B,GAGT,gBAAAsO,GACE,MAAMC,EAA8B,aAAtBtB,EAAOjP,MAAMyP,KAAsBR,EAAOnC,OAAOqC,YAAcF,EAAOnC,OAAOsC,eACrFoB,EAAOvB,EAAOjP,MAAM0P,UACpBe,EAAcD,EAAOD,EAAS,IAE9B/D,EAAuBiE,EAAa,GAAK,WAAaA,EAAa,GAAK,UAAY,SAE1F,MAAO,CACLD,OACAD,QACAE,WAAYA,EAAW7D,QAAQ,GAC/B8D,UAAWH,EAAQC,EACnBhE,SAEJ,EAEA,gBAAAmE,CAAiBC,GACf3B,EAAOjP,MAAM0P,WAAakB,EAC1B,MAAMC,EAAS5B,EAAOqB,mBAUtB,MARsB,YAAlBO,EAAOrE,QACT7J,QAAQwB,KAAK,qBAAqB0M,EAAOJ,eACzCxB,EAAOrJ,OAAOC,KAAK,gBAAiBgL,IACT,aAAlBA,EAAOrE,SAChB7J,QAAQ4B,MAAM,qBAAqBsM,EAAOJ,eAC1CxB,EAAOrJ,OAAOC,KAAK,iBAAkBgL,IAGhCA,CACT,EAEA,eAAAC,CAAgBjM,EAAkBkM,EAAyB,MACzD,MAAMC,EAA0B,iBAAZnM,EAAuBA,EAAUU,KAAKkG,UAAU5G,GAC9DoM,EAAgBF,GAAW9B,EAAOnC,OAAOuC,mBAE/C,IAAI6B,EAAaF,EACd1L,QAAQ,OAAQ,KAChBA,QAAQ,WAAY,MACpBN,OAECiM,EAAgB,KAClBC,EAAaA,EAAW5L,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAAKA,QAAQ,KAAM,KAAKA,QAAQ,KAAM,MAGjG,MAAM6L,EAAeH,EAAKtN,OACpB0N,EAAiBF,EAAWxN,OAC5B2N,GAA+C,KAArC,EAAID,EAAiBD,IAAqBvE,QAAQ,GAIlE,OAFAjK,QAAQqK,KAAK,cAAcmE,YAAuBC,SAAsBC,OAEjEH,CACT,EAEA,cAAAjE,CAAehN,EAAcqR,GACvBrC,EAAOC,QAAQjP,IACjB0C,QAAQwB,KAAK,aAAalE,cAE5BgP,EAAOC,QAAQjP,GAAQqR,EACvB3O,QAAQqK,KAAK,aAAa/M,SAC1BgP,EAAOrJ,OAAOC,KAAK,oBAAqB,CAAE5F,OAAMqR,UAClD,EAEAC,UAAuBtR,GACdgP,EAAOC,QAAQjP,GAGxB,WAAAuR,CAAYjN,EAAgBkN,EAAkB,WAC5C,MAAMC,EAvGZ,SAAwBnN,GACtB,OAAIA,aAAiBwB,MAAcxB,EAC5B,IAAIwB,MAAuB,iBAAVxB,EAAqBA,EAAQgB,KAAKkG,UAAUlH,GACtE,CAoGyBoN,CAAepN,GAC5BqN,EAAgC,CACpC5L,QAAS0L,EAAW1L,QACpByL,UACAhO,UAAW1B,KAAKC,MAChB6P,MAAOH,EAAWG,OAGpB5C,EAAOjP,MAAM4P,OAAOrM,KAAKqO,GACzBjP,QAAQ4B,MAAM,cAAckN,MAAaC,GACzCzC,EAAOrJ,OAAOC,KAAK,QAAS+L,GAExB3C,EAAOjP,MAAM4P,OAAOlM,OAAS,KAC/BuL,EAAOjP,MAAM4P,OAAOjM,OAExB,EAEA,iBAAAmO,GACE,MAAMC,EAAuB,CAC3BC,eAAe,EACflI,QAAS,KACTmI,WAAW,EACXC,cAAe,KACfC,cAAc,IAGsC,oBAAhBC,aACRrF,EAAE,kBAAkBrJ,OAAS,KACzDqO,EAAIC,eAAgB,EACY,mBAArBK,mBACTN,EAAIjI,QAAUuI,oBAAsB,OAIF,mBAA3BC,yBACTP,EAAIE,WAAY,EAChBF,EAAIG,cAAgBI,0BAA4B,MAGlD,MAAMC,EAAkB7M,OAQxB,MAJyC,mBAA9B6M,EAAgBC,WAAiE,mBAA9BD,EAAgBE,YAC5EV,EAAII,cAAe,GAGdJ,CACT,EAEA,UAAAhI,GACE,GAAIkF,EAAO9B,YAET,YADAxK,QAAQwB,KAAK,mBAIfxB,QAAQqK,KAAK,mBAEb,MAAM+E,EAAM9C,EAAO6C,oBACnBnP,QAAQqK,KAAK,eAAgB+E,GAExBA,EAAIC,eACPrP,QAAQwB,KAAK,4BAGf8K,EAAOjP,MAAMyP,KAAO,WACpBR,EAAO9B,aAAc,EAErBxK,QAAQqK,KAAK,gBACbrK,QAAQqK,KAAK,cAAciC,EAAOnF,WAClCnH,QAAQqK,KAAK,cAAciC,EAAOjP,MAAMyP,QACxC9M,QAAQqK,KAAK,mBAAmBiC,EAAOnC,OAAOqC,eAE9CF,EAAOrJ,OAAOC,KAAK,cAAe,CAAEkM,MAAK/R,MAAOiP,EAAOjP,OACzD,GAGF,OAAOiP,CACT,CAgBKvJ,OAAOC,kBACVD,OAAOC,gBAAkBqJ,IACzBrM,QAAQqK,KAAK,2BACbrK,QAAQqK,KAAK,2CAA4CtH,OAAOC,iBAChEhD,QAAQqK,KAAK,mCAAoCtH,OAAOC,kBAG1DoH,EAAE,KACApK,QAAQqK,KAAK,gCAGRtH,OAAOC,kBACVhD,QAAQwB,KAAK,0CACbuB,OAAOC,gBAAkBqJ,IACzBrM,QAAQqK,KAAK,qCAGf,MAAMiC,EAASvJ,OAAOC,gBACtBhD,QAAQqK,KAAK,mBAAoB,CAC/B0F,SAAUzD,EACVnF,QAASmF,EAAOnF,QAChBqD,YAAa8B,EAAO9B,cAnCxB,SAA4B8B,GACrBF,IACHA,EAAoBvF,YAAY,IAAMyF,EAAOY,aAAaM,UAAW,KAEzE,CAkCEwC,CAAmB1D,GAEnB/I,WAAW,KACT,IACE+I,EAAOlF,YACT,CAAE,MAAOxF,GACP0K,EAAOuC,YAAYjN,EAAO,aAC5B,GACC,OAGLwI,EAAErH,QAAQiF,GAAG,WAAY,KA1CnBoE,IACFxF,cAAcwF,GACdA,OAAoB3K,KA4CxBzB,QAAQqK,KAAK,iBACbrK,QAAQqK,KAAK,oCAAqC,CAChD0F,YAA0C,IAA3BhN,OAAOC,gBACtBwE,YAAazE,OAAOC,gBACpBnC,MAAOkC,OAAOC,gBAAkB,SAAW,cAE7ChD,QAAQqK,KAAK,oCAAqC,CAChD0F,YAA0C,IAA3BhN,OAAOC,gBACtBwE,YAAazE,OAAOC,gBACpBnC,MAAOkC,OAAOC,gBAAkB,SAAW,eDxa7C,SAASiN,EAAoBC,GAE5B,IAAIC,EAAe1F,EAAyByF,GAC5C,QAAqBzO,IAAjB0O,EACH,OAAOA,EAAaC,QAGrB,IAAIzB,EAASlE,EAAyByF,GAAY,CAGjDE,QAAS,CAAC,GAOX,OAHAC,EAAoBH,GAAUvB,EAAQA,EAAOyB,QAASH,GAG/CtB,EAAOyB,OACf,E,MEkIApQ,QAAQqK,KAAK,kBAGbK,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,sBACVxH,QAAS,WACT9B,KAAM,CAAE+O,qBAAsBvN,OAAOC,gBAAiBuN,2BAA4BxN,OAAOC,iBACzFlC,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGT,MAAMpI,EAAKC,OAAOC,gBAClB,GAAKF,EAiBE,CAEL4H,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,sBACVxH,QAAS,UACT9B,KAAM,CACJ4F,QAASrE,EAAGqE,QACZqD,YAAa1H,EAAG0H,YAChBgG,YAAa1N,EAAGG,OAChBwN,YAAaC,OAAOC,KAAK7N,EAAGyJ,SAAW,CAAC,GAAGxL,QAE7CD,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGT,MAAM0F,EAA+B,CACnCC,WAAY,EACZC,aAAc,EACdC,aAAc,GACdC,cAAe,CACbC,UAAW,EACXC,YAAa,KACbC,eAAgB,KAChBC,cAAe,KACfC,gBAAiB,KACjBC,eAAgB,KAChBC,gBAAiB,KACjBC,YAAa,KACbC,aAAc,MAEhBC,aAAc,YACd1S,SAAU,aAGV2S,eAAgB,SAChBC,qBAAsB,EAGtBC,cAAe,CACbC,cAAe,EACfC,YAAa,EACbC,YAAa,EACbC,aAAc,EACdC,oBAAqB,GAIvBC,gBAAgB,EAGhBC,mBAAoB,EAGpBC,SAAU,CACRC,MAAO,EACPC,UAAW,EACXC,OAAQ,EACRC,MAAO,GAITC,YAAa,CACXC,SAAU,CACRrV,KAAM,OACNsV,OAAQ,GACRC,OAAQ,GACR9T,MAAO,WACP+T,YAAa,YACbC,UAAW,iBAEbC,cAAe,CACb1V,KAAM,OACN2V,SAAU,CAAC,GAAI,KACflU,MAAO,gBACP+T,YAAa,WACbC,UAAW,eAEbG,YAAa,CACX5V,KAAM,OACN2V,SAAU,CAAC,GAAI,IACflU,MAAO,cACP+T,YAAa,UACbC,UAAW,UAEbI,WAAY,CACV7V,KAAM,OACN2V,SAAU,CAAC,GAAI,IACflU,MAAO,SACP+T,YAAa,SACbC,UAAW,gBAEbK,aAAc,CACZ9V,KAAM,OACN2V,SAAU,CAAC,EAAG,IACdlU,MAAO,eACP+T,YAAa,SACbC,UAAW,UAEbM,OAAQ,CACN/V,KAAM,MACN2V,SAAU,CAAC,GAAI,IACflU,MAAO,SACP+T,YAAa,SACbC,UAAW,UAEbO,YAAa,CACXhW,KAAM,OACN2V,SAAU,CAAC,GAAI,IACflU,MAAO,SACP+T,YAAa,SACbC,UAAW,gBAEbQ,aAAc,CACZjW,KAAM,OACN2V,SAAU,CAAC,EAAG,IACdlU,MAAO,eACP+T,YAAa,SACbC,UAAW,YAEbS,SAAU,CACRlW,KAAM,OACN2V,SAAU,CAAC,GAAI,IACflU,MAAO,WACP+T,YAAa,SACbC,UAAW,OAEbU,YAAa,CACXnW,KAAM,OACN2V,SAAU,CAAC,IAAK,KAChBlU,MAAO,cACP+T,YAAa,WACbC,UAAW,aAEbW,UAAW,CACTpW,KAAM,OACN2V,SAAU,CAAC,EAAG,GACdlU,MAAO,YACP+T,YAAa,OACbC,UAAW,QAKfY,gBAAiB,CACf,CACEvP,GAAI,mBACJ9G,KAAM,OACNW,UAAYZ,GAA4BA,EAAMK,OAAS,GACvDK,OAAQ,IACR+U,YAAa,kBACbc,aAAa,GAEf,CACExP,GAAI,gBACJ9G,KAAM,OACNW,UAAYZ,GAA4BA,EAAMI,OAAS,GACvDM,OAAQ,IACR+U,YAAa,kBACbc,aAAa,GAEf,CACExP,GAAI,cACJ9G,KAAM,OACNW,UAAW,CAAC4V,EAA0BvH,IAChCA,EAAOuE,aAAevE,EAAO8F,oBAC1B/R,KAAKyT,SAAW,IAEzB/V,OAAQ,IACR+U,YAAa,WACbiB,iBAAiB,GAEnB,CACE3P,GAAI,oBACJ9G,KAAM,OACNW,UAAW,CAAC4V,EAA0BvH,IAChCA,EAAOuE,aAAevE,EAAO8F,oBAC1B/R,KAAKyT,SAAW,GAEzB/V,OAAQ,IACR+U,YAAa,aACbiB,iBAAiB,GAEnB,CACE3P,GAAI,gBACJ9G,KAAM,KACNW,UAAW,CAAC4V,EAA0BvH,KACpC,GAA4B,kBAAxBA,EAAOoF,aAAkC,OAAO,EAEpD,MAAMsC,EAAoB1H,EAAO0E,cAAcE,YAC3C5E,EAAOuE,WAAavE,EAAO0E,cAAcE,YACzC,EAEJ,IAAI+C,EAAkB,IAGpBA,EADED,EAAoB,GACJ,IACTA,EAAoB,GACX,IAEA,IAGpB,MACME,EAAmBD,EADL5T,KAAK8T,IAAI,GAAK7H,EAAOuF,cAAcC,eAGvD,OAAOzR,KAAKyT,SAAWI,GAEzBnW,OAAQ,IACR+U,YAAa,WACbsB,SAAU,cAEZ,CACEhQ,GAAI,eACJ9G,KAAM,OACNW,UAAW,CAAC4V,EAA0BvH,KACpC,IAAI2H,EAAkB,IAOtB,GALsB3H,EAAOuE,WAAavE,EAAO0E,cAAcC,WAC1C,KACnBgD,EAAkB,KAGhB3H,EAAO0E,cAAcI,cAAe,CACtC,MAAMiD,EAAc/H,EAAO0E,cAAcI,cAAgB9E,EAAOuE,WAC5DwD,EAAc,GAAKA,GAAe,IACpCJ,EAAkB,GAEtB,CAEA,GAAI3H,EAAO0E,cAAcM,eAAgB,CACvC,MAAMgD,EAAehI,EAAO0E,cAAcM,eAAiBhF,EAAOuE,WAC9DyD,EAAe,GAAKA,GAAgB,IACtCL,EAAkB,IAEtB,CAEA,OAAO5T,KAAKyT,SAAWG,GAEzBlW,OAAQ,GACR+U,YAAa,SACbsB,SAAU,cAEZ,CACEhQ,GAAI,eACJ9G,KAAM,OACNW,UAAW,CAAC4V,EAA0BvH,KACpC,IAAKA,EAAO0E,cAAcK,gBAAiB,OAAO,EAElD,IAAI4C,EAAkB,IAElB3H,EAAO6F,iBACT8B,EAAkB,IAGpB,MAAMM,EAAYjI,EAAOyE,aACtB1H,OAAOmL,GAAc,iBAATA,EAAEpQ,IACdqQ,KAAK,CAACC,EAAGC,KAAOA,EAAEC,KAAO,IAAMF,EAAEE,KAAO,IAAI,GAE/C,QAAIL,GAAajI,EAAOuE,YAAc0D,EAAUK,KAAO,GAAK,KAIrDvU,KAAKyT,SAAWG,GAEzBlW,OAAQ,GACR+U,YAAa,SACbsB,SAAU,cAEZ,CACEhQ,GAAI,gBACJ9G,KAAM,OACNW,UAAW,CAACZ,EAAyBiP,KACnC,GAAIjP,EAAMI,QAAU,GAAI,OAAO,EAE/B,IAAIoX,EAAc,EAEhBA,EADExX,EAAMI,OAAS,GACH,GACLJ,EAAMI,OAAS,GACV,IACLJ,EAAMI,OAAS,GACV,IAEA,IAGhB,MAAMqX,EAAcxI,EAAOyE,aACxB1H,OAAOmL,GAAc,kBAATA,EAAEpQ,IACdqQ,KAAK,CAACC,EAAGC,KAAOA,EAAEC,KAAO,IAAMF,EAAEE,KAAO,IAAI,GAE/C,QAAIE,GAAexI,EAAOuE,YAAciE,EAAYF,KAAO,GAAK,IAIzDvU,KAAKyT,SAAWe,GAEzB9W,OAAQ,GACR+U,YAAa,eACbsB,SAAU,cAEZ,CACEhQ,GAAI,uBACJ9G,KAAM,OACNW,UAAW,CAAC4V,EAA0BvH,KACpC,GAA4B,kBAAxBA,EAAOoF,aAAkC,OAAO,EACpD,GAAIpF,EAAOuF,cAAcK,oBAAsB,EAAG,OAAO,EAEzD,MAAM8B,EAAoB1H,EAAO0E,cAAcE,YAC3C5E,EAAOuE,WAAavE,EAAO0E,cAAcE,YACzC,EAEJ,GAAI8C,EAAoB,IAAMA,EAAoB,IAChD,OAAO,EAGT,MAEMe,EAAgBzI,EAAO0I,iBAAmB1I,EAAO0I,mBAAqB,GAItEd,EAHW,CAAC,KAAM,MAAO,KAAM,KAAM,MACfe,KAAKC,GAAMH,EAAcI,SAASD,IAExBjB,IANd,IAQxB,OAAO5T,KAAKyT,SAAWI,GAEzBnW,OAAQ,GACR+U,YAAa,eACbsB,SAAU,aACVgB,cAAc,IAKlBC,aAAc,CACZC,SAAU,CACR,CAAElR,GAAI,oBAAqB9G,KAAM,OAAQS,OAAQ,IACjD,CAAEqG,GAAI,cAAe9G,KAAM,OAAQS,OAAQ,IAC3C,CAAEqG,GAAI,eAAgB9G,KAAM,OAAQS,OAAQ,IAC5C,CAAEqG,GAAI,mBAAoB9G,KAAM,OAAQS,OAAQ,IAChD,CAAEqG,GAAI,UAAW9G,KAAM,OAAQS,OAAQ,KAEzCwX,QAAS,CACP,CAAEnR,GAAI,WAAY9G,KAAM,QAASS,OAAQ,IACzC,CAAEqG,GAAI,iBAAkB9G,KAAM,SAAUS,OAAQ,IAChD,CAAEqG,GAAI,kBAAmB9G,KAAM,QAASS,OAAQ,IAChD,CAAEqG,GAAI,SAAU9G,KAAM,OAAQS,OAAQ,IACtC,CAAEqG,GAAI,gBAAiB9G,KAAM,OAAQS,OAAQ,IAC7C,CAAEqG,GAAI,eAAgB9G,KAAM,OAAQS,OAAQ,KAE9CyX,UAAW,CACT,CAAEpR,GAAI,kBAAmB9G,KAAM,SAAUS,OAAQ,IACjD,CAAEqG,GAAI,WAAY9G,KAAM,OAAQS,OAAQ,IACxC,CAAEqG,GAAI,gBAAiB9G,KAAM,QAASS,OAAQ,IAC9C,CAAEqG,GAAI,WAAY9G,KAAM,QAASS,OAAQ,IACzC,CAAEqG,GAAI,iBAAkB9G,KAAM,OAAQS,OAAQ,IAC9C,CAAEqG,GAAI,uBAAwB9G,KAAM,OAAQS,OAAQ,IACpD,CAAEqG,GAAI,UAAW9G,KAAM,OAAQS,OAAQ,IAEzC0X,SAAU,CACR,CAAErR,GAAI,mBAAoB9G,KAAM,OAAQS,OAAQ,IAChD,CAAEqG,GAAI,kBAAmB9G,KAAM,OAAQS,OAAQ,IAC/C,CAAEqG,GAAI,gBAAiB9G,KAAM,OAAQS,OAAQ,IAC7C,CAAEqG,GAAI,kBAAmB9G,KAAM,OAAQS,OAAQ,IAC/C,CAAEqG,GAAI,oBAAqB9G,KAAM,OAAQS,OAAQ,MAKrD2X,gBAAiB,CACf,CAAEtR,GAAI,qBAAsBiK,KAAM,kBAAmBtQ,OAAQ,IAC7D,CAAEqG,GAAI,cAAeiK,KAAM,mBAAoBtQ,OAAQ,IACvD,CAAEqG,GAAI,cAAeiK,KAAM,iBAAkBtQ,OAAQ,IACrD,CAAEqG,GAAI,eAAgBiK,KAAM,iBAAkBtQ,OAAQ,IACtD,CAAEqG,GAAI,kBAAmBiK,KAAM,kBAAmBtQ,OAAQ,IAC1D,CAAEqG,GAAI,oBAAqBiK,KAAM,eAAgBtQ,OAAQ,IACzD,CAAEqG,GAAI,uBAAwBiK,KAAM,cAAetQ,OAAQ,IAC3D,CAAEqG,GAAI,kBAAmBiK,KAAM,iBAAkBtQ,OAAQ,IACzD,CAAEqG,GAAI,aAAciK,KAAM,iBAAkBtQ,OAAQ,IACpD,CAAEqG,GAAI,kBAAmBiK,KAAM,gBAAiBtQ,OAAQ,IACxD,CAAEqG,GAAI,gBAAiBiK,KAAM,iBAAkBtQ,OAAQ,IACvD,CAAEqG,GAAI,qBAAsBiK,KAAM,uBAAwBtQ,OAAQ,IAClE,CAAEqG,GAAI,QAASiK,KAAM,iBAAkBtQ,OAAQ,GAC/C,CAAEqG,GAAI,QAASiK,KAAM,qBAAsBtQ,OAAQ,GACnD,CAAEqG,GAAI,aAAciK,KAAM,iBAAkBtQ,OAAQ,GACpD,CAAEqG,GAAI,kBAAmBiK,KAAM,aAActQ,OAAQ,GACrD,CAAEqG,GAAI,gBAAiBiK,KAAM,eAAgBtQ,OAAQ,GACrD,CAAEqG,GAAI,YAAaiK,KAAM,gBAAiBtQ,OAAQ,KAIpD,UAAAqJ,CAAWuO,EAAW,GACpBpK,KAAKsF,WAAa8E,EAClBpK,KAAKyF,cAAcC,UAAY0E,EAC/BpK,KAAKmG,aAAe,YACpBnG,KAAKvM,SAAW,aAChBuM,KAAKoG,eAAiB,SACtBpG,KAAKqG,qBAAuB,EAC5BrG,KAAK4G,gBAAiB,EACtB5G,KAAK6G,mBAAqBuD,EAC1BpK,KAAKuF,aAAe6E,EAEpB,IAAK,MAAMjV,KAAOgQ,OAAOC,KAAKpF,KAAKsG,eACjCtG,KAAKsG,cAAcnR,GAAO,EAG5BV,QAAQqK,KAAK,gBACbrK,QAAQqK,KAAK,iBAAiBsL,MAE9B7S,EAAGG,OAAOC,KAAK,2BAA4B,CACzC0R,IAAKrJ,KAAKsF,WACV9R,MAAOwM,KAAKmG,cAEhB,EAEA,iBAAAkE,CAAkBC,GAChB,MAAMC,EAA4C,CAChDC,OAAQ,GACRC,OAAQ,EACRC,QAAS,IACTC,aAAc,KAGZL,KAAcC,GAChBvK,KAAKoG,eAAiBkE,EACtBtK,KAAKqG,qBAAuBkE,EAAkBD,GAE9C7V,QAAQqK,KAAK,oBAAoBwL,YAAqBtK,KAAKqG,yBAE3D9O,EAAGG,OAAOC,KAAK,qBAAsB,CACnC2S,WAAYtK,KAAKoG,eACjBwE,WAAY5K,KAAKqG,wBAGnB5R,QAAQwB,KAAK,kBAAkBqU,IAEnC,EAEA,yBAAAO,GACM7K,KAAKsF,WAAa,IAAO,GAE7B/N,EAAGG,OAAOC,KAAK,gCAAiC,CAC9C0R,IAAKrJ,KAAKsF,WACV9R,MAAOwM,KAAKmG,aACZX,aAAcxF,KAAKwF,cAEvB,EAEA,eAAAsF,CAAgBC,EAAoB/N,EAAS,QAC3CvI,QAAQqK,KAAK,kBAAkBkB,KAAKmG,mBAAmB4E,KACvDtW,QAAQqK,KAAK,gBAAgB9B,KAE7B,MAAMgO,EAAsB,CAC1B,YACA,WACA,gBACA,cACA,SACA,eACA,SACA,SACA,eACA,WACA,aAGIC,EAAcD,EAAW1K,QAAQyK,GACjCG,EAAeF,EAAW1K,QAAQN,KAAKmG,cAE7C,IAAqB,IAAjB8E,GAAsBA,GAAeC,EAEvC,OADAzW,QAAQwB,KAAK,wBACN,EAGT,MAAMkV,EAAuD,CAC3D/D,SAAU,cACVK,cAAe,cACfE,YAAa,iBACbyD,OAAQ,gBACRvD,aAAc,kBACdC,OAAQ,kBACRuD,OAAQ,iBACRrD,aAAc,kBACdC,SAAU,cACVE,UAAW,gBAGb,IAAK,IAAImD,EAAIL,EAAc,EAAGK,EAAIN,EAAWxV,OAAQ8V,IAAK,CACxD,MACMnW,EAAMgW,EADEH,EAAWM,IAErBnW,GAAO6K,KAAKyF,cAActQ,KAC5B6K,KAAKyF,cAActQ,GAAO,KAE9B,CAyBA,OAvBA6K,KAAKmG,aAAe4E,EAEhBE,GAAeD,EAAW1K,QAAQ,mBACpCN,KAAKvM,SAAW,YAGlBuM,KAAKwF,aAAanQ,KAAK,CACrBwD,GAAI,qBACJ9G,KAAM,OACNkK,KAAM,QACNoN,IAAKrJ,KAAKsF,WACViG,KAAMP,EAAWE,GACjBM,GAAIT,EACJ/N,WAGFzF,EAAGG,OAAOC,KAAK,qBAAsB,CACnC4T,KAAMP,EAAWE,GACjBM,GAAIT,EACJ/N,SACAqM,IAAKrJ,KAAKsF,cAGL,CACT,EAEA,kBAAAmG,CAAmBC,GACjB,MAAMC,EAAmB,CACvB,CAAEC,QAAS,2BAA4BpY,MAAO,MAC9C,CAAEoY,QAAS,eAAgBpY,MAAO,MAClC,CAAEoY,QAAS,eAAgBpY,MAAO,OAGpC,IAAK,MAAMqY,KAAQF,EAAkB,CACnC,MAAMG,EAAQJ,EAAMI,MAAMD,EAAKD,SAC/B,GAAIE,EAAO,CACT,IAAIf,EAA4B,KAYhC,GAVIe,EAAM,GAAGlC,SAAS,MACpBmB,EAAc,gBACLe,EAAM,GAAGlC,SAAS,QAC3BmB,EAAc,cACLe,EAAM,GAAGlC,SAAS,MAC3BmB,EAAc,SACLe,EAAM,GAAGlC,SAAS,QAC3BmB,EAAc,UAGZA,EACF,OAAO/K,KAAK8K,gBAAgBC,EAAa,OAE7C,CACF,CAEA,OAAO,CACT,EAEA,UAAAgB,CAAWxY,EAAO,GAChB,MAAMmE,EAAwB,GAE9B,IAAK,IAAI4T,EAAI,EAAGA,EAAI/X,EAAM+X,IAAK,CAC7BtL,KAAKsF,aACLtF,KAAKuF,aAAevF,KAAKsF,WAEzBtF,KAAK6K,4BAEL,MAAMmB,EAAWhM,KAAKiM,iBAEtB,GAAID,IACFtU,EAAOrC,KAAK2W,GAEZhM,KAAKwF,aAAanQ,KAAK,IAClB2W,EACH3C,IAAKrJ,KAAKsF,aAGRH,OAAO+G,UAAUC,eAAeC,KAAKpM,KAAKsG,cAAe0F,EAASnT,MACpEmH,KAAKsG,cAAc0F,EAASnT,KAAOmH,KAAKsG,cAAc0F,EAASnT,KAAO,GAAK,IAGxEmT,EAASK,UAAYrM,KAAK8G,SAASI,QAAUlH,KAAK8G,SAASG,QAG9D,OAFAxS,QAAQqK,KAAK,WAAWkB,KAAKsF,oBAAoB0G,EAASja,QAC1DwF,EAAGG,OAAOC,KAAK,kBAAmBqU,GAC3B,CACLM,aAAa,EACbhH,WAAYtF,KAAKsF,WACjBxF,MAAOkM,EACPO,kBAAmB7U,EAI3B,CAEA,MAAO,CACL4U,aAAa,EACbhH,WAAYtF,KAAKsF,WACjBiH,kBAAmB7U,EAEvB,EAEA,cAAAuU,GACE,MAAMO,EAAaxM,KAAKyM,kBACxB,GAAID,EACF,MAAO,IACFA,EACHH,SAAUrM,KAAK8G,SAASC,MACxBsC,IAAKrJ,KAAKsF,YAId,MAAMoH,EAAiB1M,KAAK2M,sBAC5B,GAAID,EACF,MAAO,IACFA,EACHL,SAAUrM,KAAK8G,SAASE,UACxBqC,IAAKrJ,KAAKsF,YAId,GAAIxQ,KAAKyT,SAAW,GAAK,CACvB,MAAMqE,EAAc5M,KAAK6M,sBACzB,GAAID,EACF,MAAO,IACFA,EACHP,SAAUrM,KAAK8G,SAASG,OACxBoC,IAAKrJ,KAAKsF,WAGhB,CAEA,GAAIxQ,KAAKyT,SAAW,IAAM,CACxB,MAAMuE,EAAY9M,KAAK+M,yBACvB,GAAID,EACF,MAAO,IACFA,EACHT,SAAUrM,KAAK8G,SAASI,MACxBmC,IAAKrJ,KAAKsF,WAGhB,CAEA,MAAO,CACLzM,GAAI,gBACJ9G,KAAM,OACNkK,KAAM,QACNoQ,SAAUrM,KAAK8G,SAASI,MACxBmC,IAAKrJ,KAAKsF,WACViC,YAAa,QAEjB,EAEA,eAAAkF,GACE,MAAMO,EAAgBhN,KAAKsF,WAAatF,KAAKyF,cAAcC,UACrDuH,EAAcjN,KAAKmG,aAEzB,IAAKnG,KAAKyF,cAAcE,YAAa,CACnC,MAAMuH,EAAUpY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAC/B8G,EAAUrY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAErC,GAAI2G,GAAiBE,GAAWF,GAAiBG,GAC3CrY,KAAKyT,SAAW,GAIlB,OAHAvI,KAAKyF,cAAcE,YAAc3F,KAAKsF,WACtCtF,KAAKmG,aAAe,gBACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WACxB,CACLzM,GAAI,WACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,WACP+T,YAAa,cACbgE,KAAM0B,EACNzB,GAAI,gBAIZ,CAEA,GAAIxL,KAAKyF,cAAcE,cAAgB3F,KAAKyF,cAAcG,eAAgB,CACxE,MAAM6C,EAAoBzI,KAAKsF,WAAatF,KAAKyF,cAAcE,YACzDuH,EAAUpY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAC/B8G,EAAUrY,KAAKC,MAAM,IAAMiL,KAAKqG,sBAEtC,GAAIoC,GAAqByE,GAAWzE,GAAqB0E,GAAWrY,KAAKyT,SAAW,IAIlF,OAHAvI,KAAKyF,cAAcG,eAAiB5F,KAAKsF,WACzCtF,KAAKmG,aAAe,cACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WACxB,CACLzM,GAAI,cACJ9G,KAAM,QACNkK,KAAM,QACNzI,MAAO,cACP+T,YAAa,aACbgE,KAAM0B,EACNzB,GAAI,cAGV,CAEA,GAAIxL,KAAKyF,cAAcG,iBAAmB5F,KAAKyF,cAAcI,cAAe,CAC1E,MAAMuH,EAAuBpN,KAAKsF,WAAatF,KAAKyF,cAAcG,eAC5DsH,EAAUpY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAC/B8G,EAAUrY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAErC,GAAI+G,GAAwBF,GAAWE,GAAwBD,GAAWrY,KAAKyT,SAAW,IAcxF,OAbAvI,KAAKyF,cAAcI,cAAgB7F,KAAKsF,WACxCtF,KAAKmG,aAAe,SACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAET,eAAlBtF,KAAKvM,WACPuM,KAAKvM,SAAW,WAChB8D,EAAGG,OAAOC,KAAK,gBAAiB,CAC9B4T,KAAM,aACNC,GAAI,WACJxO,OAAQ,UAIL,CACLnE,GAAI,cACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,SACP+T,YAAa,WACbgE,KAAM0B,EACNzB,GAAI,SAGV,CAEA,GAAIxL,KAAKyF,cAAcI,gBAAkB7F,KAAKyF,cAAcK,gBAAiB,CAC3E,MAAMuH,EAAiBrN,KAAKsF,WAAatF,KAAKyF,cAAcI,cACtDqH,EAAUpY,KAAKC,MAAM,EAAIiL,KAAKqG,sBAC9B8G,EAAUrY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAErC,GAAIgH,GAAkBH,GAAWG,GAAkBF,GAAWrY,KAAKyT,SAAW,GAY5E,OAXAvI,KAAKyF,cAAcK,gBAAkB9F,KAAKsF,WAC1CtF,KAAKmG,aAAe,SACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAE/BtF,KAAKvM,SAAW,YAChB8D,EAAGG,OAAOC,KAAK,gBAAiB,CAC9B4T,KAAM,WACNC,GAAI,YACJxO,OAAQ,WAGH,CACLnE,GAAI,gBACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,eACP+T,YAAa,WACbgE,KAAM0B,EACNzB,GAAI,SAGV,CAEA,GACExL,KAAKyF,cAAcK,kBAClB9F,KAAKyF,cAAcM,iBACnB/F,KAAKyF,cAAcO,gBACpB,CAGA,GAAyB,KAFAhG,KAAKsF,WAAatF,KAAKyF,cAAcK,gBAG5D,OAAIhR,KAAKyT,SAAW,IAClBvI,KAAKyF,cAAcM,eAAiB/F,KAAKsF,WACzCtF,KAAKmG,aAAe,SACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAExB,CACLzM,GAAI,eACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,SACP+T,YAAa,YACbgE,KAAM0B,EACNzB,GAAI,YAGNxL,KAAKyF,cAAcO,gBAAkBhG,KAAKsF,WAC1CtF,KAAKmG,aAAe,WACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAExB,CACLzM,GAAI,gBACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,eACP+T,YAAa,aACbgE,KAAM0B,EACNzB,GAAI,YAIZ,CAEA,GAAIxL,KAAKyF,cAAcM,iBAAmB/F,KAAKyF,cAAcO,gBAAiB,CAC5E,MAAMsH,EAAkBtN,KAAKsF,WAAatF,KAAKyF,cAAcM,eACvDmH,EAAUpY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAC/B8G,EAAUrY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAErC,GAAIiH,GAAmBJ,GAAWI,GAAmBH,GAAWrY,KAAKyT,SAAW,IAK9E,OAJAvI,KAAKyF,cAAcO,gBAAkBhG,KAAKsF,WAC1CtF,KAAKmG,aAAe,WACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAExB,CACLzM,GAAI,gBACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,eACP+T,YAAa,aACbgE,KAAM0B,EACNzB,GAAI,WAGV,CAEA,GAAIxL,KAAKyF,cAAcO,kBAAoBhG,KAAKyF,cAAcQ,cAAgBjG,KAAK4G,eAAgB,CACjG,MAAM2G,EAAmBvN,KAAKsF,WAAatF,KAAKyF,cAAcO,gBACxDkH,EAAUpY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAC/B8G,EAAUrY,KAAKC,MAAM,GAAKiL,KAAKqG,sBAErC,GAAIkH,GAAoBL,GAAWK,GAAoBJ,GAAWrY,KAAKyT,SAAW,IAKhF,OAJAvI,KAAKyF,cAAcQ,YAAcjG,KAAKsF,WACtCtF,KAAKmG,aAAe,MACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAExB,CACLzM,GAAI,kBACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,WACP+T,YAAa,WACbiG,UAAU,EACVC,WAAY,SACZlC,KAAM0B,EACNzB,GAAI,MAGV,CAEA,GAAIxL,KAAKyF,cAAcO,iBAAmBhG,KAAK4G,iBAAmB5G,KAAKyF,cAAcS,aAAc,CACjG,MAAMqH,EAAmBvN,KAAKsF,WAAatF,KAAKyF,cAAcO,gBAI9D,GAAIuH,GAHY,KAGmBA,GAFnB,KAEkDzY,KAAKyT,SAAW,KAKhF,OAJAvI,KAAKyF,cAAcS,aAAelG,KAAKsF,WAAa,EACpDtF,KAAKmG,aAAe,YACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAExB,CACLzM,GAAI,wBACJ9G,KAAM,SACNkK,KAAM,QACNzI,MAAO,cACP+T,YAAa,iBACbgE,KAAM0B,EACNzB,GAAI,YAGV,CAEA,OAAIxL,KAAKyF,cAAcS,cAAgBlG,KAAKsF,YAActF,KAAKyF,cAAcS,cAC3ElG,KAAKmG,aAAe,MACpBnG,KAAK6G,mBAAqB7G,KAAKsF,WAExB,CACLzM,GAAI,YACJ9G,KAAM,OACNkK,KAAM,QACNzI,MAAO,YACP+T,YAAa,OACbiG,UAAU,EACVC,WAAY,QACZlC,KAAM0B,EACNzB,GAAI,QAID,IACT,EAEA,mBAAAmB,GACE,MAAM7a,EAAQkO,KAAK0N,sBAEnB,IAAK,MAAM5N,KAASE,KAAKoI,gBACvB,KAAItI,EAAM0I,iBAAmBxI,KAAKsF,aAAetF,KAAK6G,sBAIlD/G,EAAMuI,cAAgBvI,EAAM0I,kBAC1B1I,EAAMpN,UAAUZ,EAAOkO,OACL,IAAhBlL,KAAKyT,SAAiBzI,EAAMtN,OAC9B,MAAO,CACLqG,GAAIiH,EAAMjH,GACV9G,KAAM+N,EAAM/N,KACZkK,KAAM6D,EAAM+I,UAAY,YACxBtB,YAAazH,EAAMyH,YACnBsC,aAAc/J,EAAM+J,eAAgB,GAO9C,OAAO,IACT,EAEA,mBAAAgD,GACE,MAAMc,EAAQ,CAAC,WAAY,UAAW,YAAa,YAI7CC,EAAYD,EADA3N,KAAK6N,eAAeF,EAAMnY,OAF5B,CAAC,GAAI,GAAI,GAAI,MAIvBsY,EAAY9N,KAAK8J,aAAa8D,GAE9BG,EAAeD,EAAUE,IAAI/E,GAAKA,EAAEzW,QAEpCsN,EAAQgO,EADK9N,KAAK6N,eAAeC,EAAUtY,OAAQuY,IAGzD,MAAO,CACLlV,GAAIiH,EAAMjH,GACV9G,KAAM+N,EAAM/N,KACZkK,KAAM2R,EACN/E,SAAU,SACVtB,YAAa,SAASzH,EAAM/N,OAEhC,EAEA,sBAAAgb,GACE,MAAMkB,EAAUjO,KAAKmK,gBAAgB6D,IAAIE,GAAKA,EAAE1b,QAC1C6N,EAAQL,KAAK6N,eAAe7N,KAAKmK,gBAAgB3U,OAAQyY,GACzDnB,EAAY9M,KAAKmK,gBAAgB9J,GAEvC,MAAO,CACLxH,GAAIiU,EAAUjU,GACd9G,KAAM,OACNkK,KAAM,YACN4M,SAAU,QACVtB,YAAauF,EAAUhK,KACvBA,KAAMgK,EAAUhK,KAEpB,EAEA,cAAA+K,CAAenV,EAAeuV,GAC5B,MAAME,EAAcF,EAAQrY,OAAO,CAACD,EAAKyY,IAAMzY,EAAMyY,EAAG,GACxD,IAAI7F,EAASzT,KAAKyT,SAAW4F,EAE7B,IAAK,IAAI7C,EAAI,EAAGA,EAAI5S,EAAO4S,IAEzB,GADA/C,GAAU0F,EAAQ3C,GACd/C,GAAU,EACZ,OAAO+C,EAIX,OAAO5S,EAAQ,CACjB,EAEA,mBAAAgV,GACE,MAAM1O,EAAczH,EAAG8L,UAAiD,eACxE,OAAIrE,GAAeA,EAAYlC,SACtBkC,EAAYlC,WAGd,CACL5K,OAAQ,GACRC,OAAQ,GACRC,SAAU,GACVC,aAAc,GAElB,EAEA,gBAAAoX,GACE,GAAI4E,MAAMC,QAAQ9W,OAAO+W,MAAO,CAE9B,OADuB/W,OAAO+W,KAAKC,OAAO,GACpBR,IAAIE,GAAKA,EAAEO,KAAO,IAAIC,KAAK,IACnD,CACA,MAAO,EACT,EAEA,iBAAAC,GACE,MAAM3B,EAAgBhN,KAAKsF,WAAatF,KAAKyF,cAAcC,UAE3D,MAAsB,eAAlB1F,KAAKvM,UAA6BuZ,GAAiB,GAAKA,GAAiB,IACvElY,KAAKyT,SAAW,KAClBvI,KAAKvM,SAAW,WAChB8D,EAAGG,OAAOC,KAAK,gBAAiB,CAC9B4T,KAAM,aACNC,GAAI,WACJxO,OAAQ,QACRqM,IAAKrJ,KAAKsF,cAEL,EAKb,EAEA,eAAAsJ,CAAgBhI,GACd5G,KAAK4G,eAAiBA,EACtBnS,QAAQqK,KAAK,mBAAmB8H,KAEhCrP,EAAGG,OAAOC,KAAK,+BAAgC,CAC7CiP,eAAgB5G,KAAK4G,eACrByC,IAAKrJ,KAAKsF,YAEd,EAEA,mBAAAuJ,GACE,MAAO,CACLxF,IAAKrJ,KAAKsF,WACV9R,MAAOwM,KAAKmG,aACZ1S,SAAUuM,KAAKvM,SACfuZ,cAAehN,KAAKsF,WAAatF,KAAKyF,cAAcC,UACpDoJ,SAAU,IAAK9O,KAAKyF,eACpB6E,WAAYtK,KAAKoG,eACjBC,qBAAsBrG,KAAKqG,qBAC3BO,eAAgB5G,KAAK4G,eACrBN,cAAe,IAAKtG,KAAKsG,eAE7B,EAEA,kBAAAyI,GACE,MAAMhb,EAKF,CACFib,YAAahP,KAAKwF,aAAahQ,OAC/ByZ,OAAQ,CAAC,EACTC,WAAY,CAAC,EACbC,aAAcnP,KAAKwF,aAAagJ,OAAO,KAWzC,OARAxO,KAAKwF,aAAahF,QAASV,IACzB,MAAM7D,EAAO6D,EAAM7D,MAAQ,UAC3BlI,EAAMkb,OAAOhT,IAASlI,EAAMkb,OAAOhT,IAAS,GAAK,EAEjD,MAAMoQ,EAAWvM,EAAMuM,UAAY,EACnCtY,EAAMmb,WAAW7C,IAAatY,EAAMmb,WAAW7C,IAAa,GAAK,IAG5DtY,CACT,EAEA,cAAAqb,GACE,MAAO,CACL9J,WAAYtF,KAAKsF,WACjBa,aAAcnG,KAAKmG,aACnB1S,SAAUuM,KAAKvM,SACfqb,SAAU,IAAK9O,KAAKyF,eACpB6E,WAAYtK,KAAKoG,eACjBQ,eAAgB5G,KAAK4G,eACrBN,cAAe,IAAKtG,KAAKsG,eACzBd,aAAc,IAAIxF,KAAKwF,cACvBqB,mBAAoB7G,KAAK6G,mBAE7B,EAEA,cAAAwI,CAAerZ,GACb,IAAKA,EAAM,OAAO,EAElB,IAYE,OAXAgK,KAAKsF,WAAatP,EAAKsP,YAAc,EACrCtF,KAAKmG,aAAgBnQ,EAAKmQ,cAA0B,YACpDnG,KAAKvM,SAAWuC,EAAKvC,UAAY,aACjCuM,KAAKyF,cAAiBzP,EAAK8Y,UAA0B,CAAC,EACtD9O,KAAKoG,eAAiBpQ,EAAKsU,YAAc,SACzCtK,KAAK4G,eAAiB0I,QAAQtZ,EAAK4Q,gBACnC5G,KAAKsG,cAAgBtQ,EAAKsQ,eAAiB,CAAC,EAC5CtG,KAAKwF,aAAexP,EAAKwP,cAAgB,GACzCxF,KAAK6G,mBAAqB7Q,EAAK6Q,oBAAsB,EAErDpS,QAAQqK,KAAK,mBACN,CACT,CAAE,MAAOzI,GAEP,OADA5B,QAAQ4B,MAAM,kBAAmBA,IAC1B,CACT,CACF,GAIFkB,EAAGsV,oBAAuB0C,GAAuBlK,EAAYwH,sBAC7DtV,EAAGwU,WAAcxY,GAAkB8R,EAAY0G,WAAWxY,GAC1DgE,EAAG6F,gBAAkB,IAAMiI,EAAYwJ,sBACvCtX,EAAGoX,kBAAoB,IAAMtJ,EAAYsJ,oBACzCpX,EAAG8S,kBAAqBC,GACtBjF,EAAYgF,kBAAkBC,GAChC/S,EAAGuT,gBAAkB,CAACtX,EAAcwJ,IAAoBqI,EAAYyF,gBAAgBtX,EAAOwJ,GAC3FzF,EAAGqX,gBAAmBhI,GAA4BvB,EAAYuJ,gBAAgBhI,GAC9ErP,EAAGwX,mBAAqB,IAAM1J,EAAY0J,qBAC1CxX,EAAG6X,eAAiB,IAAM/J,EAAY+J,iBACtC7X,EAAG8X,eAAkBrZ,GAAkBqP,EAAYgK,eAAerZ,GAElEuB,EAAGwH,eAAe,cAAesG,GAGjC9N,EAAGG,OAAO+E,GAAG,aAAezG,IAE1BmJ,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,uBACVxH,QAAS,WACT9B,KAAM,CACJwZ,UAAWxZ,EACXyZ,gBAAiBzZ,EACjB0Z,WAC4D,iBAAlD1Z,GAAyC8M,KAC5C9M,EAA2B8M,MAAMtN,OAClC,GAERD,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAET,MAAMmD,EACsD,iBAAlD9M,GAAyC8M,KAAqB9M,EAA2B8M,UAAO5M,EACtG4M,IAEF3D,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,uBACVxH,QAAS,SACT9B,KAAM,CAAE8M,KAAMA,EAAK/L,UAAU,EAAG,KAChCxB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAET0F,EAAYoG,mBAAmB3I,MAKnCvL,EAAGG,OAAO+E,GAAG,cAAe,KAE1B0C,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,uBACVxH,QAAS,cACT9B,KAAM,CAAEsP,WAAYD,EAAYC,WAAYa,aAAcd,EAAYc,cACtE5Q,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAET,IACE0F,EAAYxJ,WAAW,GAEvBsD,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,uBACVxH,QAAS,YACT9B,KAAM,CAAEsP,WAAYD,EAAYC,WAAYa,aAAcd,EAAYc,cACtE5Q,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,OAEX,CAAE,MAAOtJ,GAEP8I,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,uBACVxH,QAAS,YACT9B,KAAM,CACJK,MAAOA,aAAiBwB,MAAQxB,EAAMyB,QAAUC,OAAO1B,GACvDsN,MAAOtN,aAAiBwB,MAAQxB,EAAMsN,WAAQzN,GAEhDX,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAETlL,QAAQ4B,MAAM,gBAAiBA,EACjC,IAGF5B,QAAQqK,KAAK,uBACf,MAvsCErK,QAAQ4B,MAAM,kBAEd8I,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,sBACVxH,QAAS,YACT9B,KAAM,CAAE2Z,WAAYxK,OAAOC,KAAK5N,QAAQsG,OAAO8R,GAAKA,EAAEhG,SAAS,cAAgBgG,EAAEhG,SAAS,eAC1FrU,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QC1DX,MAAM,EAAKnI,OAAOC,gBAElB,GAAK,EAEE,CACLhD,QAAQqK,KAAK,mBAGb,MAAM+Q,EAAgB,CACpBC,SAAU,CACRC,MAAO,CACLC,MAAO,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KACrDxd,OAAQ,IAEVyd,MAAO,CACLD,MAAO,CACL,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KAEFxd,OAAQ,IAEV0d,MAAO,CACLF,MAAO,CACL,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KAEFxd,OAAQ,IAEV2d,MAAO,CACLH,MAAO,CACL,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KAEFxd,OAAQ,IAEV4d,MAAO,CACLJ,MAAO,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,KAAM,KAAM,MAClFxd,OAAQ,IAGZ6d,WAAY,CACVC,QAAS,CACPC,OAAQ,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC/EC,OAAQ,CACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,MAERhe,OAAQ,IAEVie,QAAS,CACPF,OAAQ,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC/EC,OAAQ,CACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,MAERhe,OAAQ,IAEVke,OAAQ,CACNH,OAAQ,CACN,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,IACA,KAEFC,OAAQ,CACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,MAERhe,OAAQ,IAEVme,aAAc,CACZJ,OAAQ,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC/EC,OAAQ,CACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,KACN,CAAC,IAAK,MAERhe,OAAQ,KAGZoe,SAAU,CACR,MACA,KACA,MACA,KACA,MACA,MACA,MACA,MACA,KACA,KACA,KACA,OAEFC,SAAU,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAElE,QAAAC,CAASC,GACP,IAAI9Y,EAAW,EAEf,KAAOA,EADa,IACW,CAC7BA,IACA,MAEM+Y,EAFUhR,KAAKiR,gBACHjR,KAAKkR,gBAAgBH,GAEvC,GAAI/Q,KAAKmR,YAAYH,GAAW,OAAOA,CACzC,CACA,MAAO,IAAMhR,KAAKqQ,WAAWI,QAAQF,OAAO,EAC9C,EAEA,aAAAU,GACE,MAAMG,EAAQjM,OAAOkM,OAAOrR,KAAK8P,UAC3B3B,EAAciD,EAAMxb,OAAO,CAACD,EAAK2b,IAAS3b,EAAM2b,EAAK9e,OAAQ,GACnE,IAAI+V,EAASzT,KAAKyT,SAAW4F,EAC7B,IAAK,MAAMmD,KAAQF,EAEjB,GADA7I,GAAU+I,EAAK9e,OACX+V,GAAU,EACZ,OAAO+I,EAAKtB,MAAMlb,KAAKC,MAAMD,KAAKyT,SAAW+I,EAAKtB,MAAMxa,SAG5D,OAAOwK,KAAK8P,SAASC,MAAMC,MAAM,EACnC,EAEA,eAAAkB,CAAgBH,GACd,MACM/e,GADc,IAAI6B,MAAO0d,cACLR,EACpBtX,EAAQzH,GAAO,GAAK,UAAYA,GAAO,GAAK,UAAYA,GAAO,GAAK,SAAW,eAC/Ewf,EAAYxR,KAAKqQ,WAAW5W,GAElC,GADkB3E,KAAKyT,SAAW,IACjBiJ,EAAUhB,OAAOhb,OAAS,EAAG,CAC5C,MAAMic,EAAOD,EAAUhB,OAAO1b,KAAKC,MAAMD,KAAKyT,SAAWiJ,EAAUhB,OAAOhb,SAC1E,OAAOic,EAAK,GAAKA,EAAK,EACxB,CACA,OAAOD,EAAUjB,OAAOzb,KAAKC,MAAMD,KAAKyT,SAAWiJ,EAAUjB,OAAO/a,QACtE,EAEA,WAAA2b,CAAYpf,GACV,OAAIiO,KAAK4Q,SAAShH,SAAS7X,KACnBiO,KAAK6Q,SAASnH,KAAKgI,GAAQ3f,EAAK6X,SAAS8H,GACnD,GAIIC,EAAiB,CACrBC,oBAAqB,CACnB,QACA,MACA,MACA,QACA,QACA,QACA,QACA,QACA,QACA,QACA,MACA,QACA,QACA,QACA,MACA,MACA,QACA,QACA,UACA,YACA,cACA,SAEFC,OAAQ,CACNC,QAAS,CACP9B,MAAO,CAAC,QAAS,QAAS,MAAO,MAAO,QAAS,SACjDxd,OAAQ,GACRuf,cAAe,CAAC,EAAG,KAErBC,SAAU,CACRhC,MAAO,CACL,MACA,MACA,MACA,QACA,QACA,QACA,MACA,MACA,aAEFxd,OAAQ,GACRuf,cAAe,CAAC,EAAG,KAErBE,KAAM,CACJjC,MAAO,CACL,QACA,QACA,QACA,QACA,UACA,UACA,WAEFxd,OAAQ,GACRuf,cAAe,CAAC,EAAG,KAErBG,SAAU,CACRlC,MAAO,CAAC,YAAa,QAAS,QAAS,SAAU,MAAO,QAAS,OACjExd,OAAQ,GACRuf,cAAe,CAAC,EAAG,KAErBI,OAAQ,CACNnC,MAAO,CACL,QACA,QACA,QACA,QACA,UACA,QACA,eAEFxd,OAAQ,GACRuf,cAAe,CAAC,EAAG,IAErBK,MAAO,CACLpC,MAAO,CAAC,QAAS,QAAS,YAAa,QAAS,QAAS,OACzDxd,OAAQ,EACRuf,cAAe,CAAC,EAAG,KAIvB,QAAAjB,GACE,GAAIhc,KAAKyT,SAAW,GAAK,CACvB,MAAMtW,EAAQ+N,KAAK4R,oBAAoB9c,KAAKC,MAAMD,KAAKyT,SAAWvI,KAAK4R,oBAAoBpc,SACrFqT,EAAW7I,KAAKqS,oBAAoBpgB,GAE1C,MAAO,CAAEA,QAAOqgB,SADCtS,KAAKuS,iBAAiB1J,EAAWA,EAASkJ,cAAgB,CAAC,EAAG,KACrDlJ,SAAUA,GAAY7I,KAAK6R,OAAOG,SAC9D,CAEA,MAAMQ,EAAarN,OAAOkM,OAAOrR,KAAK6R,QAChC1D,EAAcqE,EAAW5c,OAAO,CAACD,EAAK8c,IAAQ9c,EAAM8c,EAAIjgB,OAAQ,GACtE,IAAI+V,EAASzT,KAAKyT,SAAW4F,EAC7B,IAAK,MAAMtF,KAAY2J,EAErB,GADAjK,GAAUM,EAASrW,OACf+V,GAAU,EAAG,CAGf,MAAO,CAAEtW,MAFK4W,EAASmH,MAAMlb,KAAKC,MAAMD,KAAKyT,SAAWM,EAASmH,MAAMxa,SAEvD8c,SADCtS,KAAKuS,iBAAiB1J,EAASkJ,eACtBlJ,WAC5B,CAGF,MAAO,CAAE5W,MAAO,MAAOqgB,SAAU,EAAGzJ,SAAU7I,KAAK6R,OAAOG,SAC5D,EAEA,mBAAAK,CAAoBK,GAClB,IAAK,MAAMvd,KAAOgQ,OAAOC,KAAKpF,KAAK6R,QAAS,CAC1C,MAAMhJ,EAAW7I,KAAK6R,OAAO1c,GAC7B,GAAI0T,EAASmH,MAAMpG,SAAS8I,GAAY,OAAO7J,CACjD,CACA,OAAO,IACT,EAEA,gBAAA0J,CAAiBI,GACf,MAAOvZ,EAAKD,GAAOwZ,EACnB,OAAO7d,KAAKC,MAAMD,KAAKyT,UAAYpP,EAAMC,EAAM,IAAMA,CACvD,GAIIwZ,EAAe,CACnBC,YAAa,GACbC,gBAAiB,GAEjB,QAAAhC,CAASpY,EAAQ,EAAG6K,EAAmC,CAAC,GACtD,MAAMwP,EAAc,GACpB,IAAK,IAAIzH,EAAI,EAAGA,EAAI5S,EAAO4S,IAAK,CAC9B,MAAM0H,EAAMhT,KAAKiT,eAAe1P,GAChCwP,EAAK1d,KAAK2d,GACVhT,KAAK6S,YAAYxd,KAAK2d,EACxB,CACA,OAAOD,CACT,EAEA,cAAAE,CAAe1P,EAAmC,CAAC,GACjD,MAAM2P,EAAc,EAAG7P,UAA6B,eAC9C8P,EAAYD,GAAarE,oBAAsBqE,EAAYrE,sBAAwB,CAAC,EAEpF7c,EAAMgO,KAAKoT,cACXrC,GAAY,IAAIld,MAAO0d,cAAgBvf,EACvCD,EAAO8d,EAAciB,SAASC,GAC9BsC,EAAY1B,EAAeb,WAC3Bxe,EAAa0N,KAAKsT,mBAAmBthB,GACrCuhB,EAAcvT,KAAKwT,sBACnBC,EAAazT,KAAK0T,mBAAmB1hB,EAAKqhB,GAC1CM,EAAe3T,KAAK4T,uBAEpBngB,EAC2B,iBAAxB0f,GAAW1f,SAAwB0f,EAAU1f,SAAY8P,EAAQ9P,UAAuB,aACjGuM,KAAK6T,iBAAiBN,EAAaI,EAAclgB,GAkBjD,MAhBiB,CACfoF,GAAImH,KAAK8T,aACT/hB,OACAgiB,OAAQ,SACR/hB,MACAC,MAAOohB,EAAUphB,MACjBqgB,SAAUe,EAAUf,SACpBhgB,aACAihB,cACAE,aACAE,eACAlgB,WACAuZ,cAAelY,KAAKC,MAAsB,IAAhBD,KAAKyT,UAAkB,GACjDjK,OAAQ,SACR0V,UAAWngB,KAAKC,MAGpB,EAEA,WAAAsf,GACE,MAAM7K,EAASzT,KAAKyT,SACpB,OAAIA,EAAS,IAAazT,KAAKC,MAAsB,EAAhBD,KAAKyT,UAAgB,GACtDA,EAAS,IAAazT,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvDA,EAAS,IAAazT,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvDA,EAAS,GAAYzT,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACtDA,EAAS,IAAazT,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACpDzT,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,EAC1C,EAEA,kBAAA+K,CAAmBthB,GACjB,MAAMiiB,EAAU,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,KACpChG,EAAU,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,IAGnCiG,EACJliB,EAAM,GACF,CAAC,KAAM,OAAQ,OAAQ,QACvB,CAAC,KAAM,KAAM,KAAM,MAAO,MAAO,KAAM,MACvCmiB,EAAY,CAAC,KAAM,KAAM,KAAM,KAAM,MACrCC,EAAW,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MACtD,MAAO,CACL7hB,OATa0hB,EAAQnf,KAAKC,MAAMD,KAAKyT,SAAW0L,EAAQze,SAUxDhD,OATayb,EAAQnZ,KAAKC,MAAMD,KAAKyT,SAAW0F,EAAQzY,SAUxD/C,KAAMyhB,EAAWpf,KAAKC,MAAMD,KAAKyT,SAAW2L,EAAW1e,SACvD6e,KAAM,KACNC,KAAMH,EAAUrf,KAAKC,MAAMD,KAAKyT,SAAW4L,EAAU3e,SACrD4e,SAAUA,EAAStf,KAAKC,MAAMD,KAAKyT,SAAW6L,EAAS5e,SAE3D,EAEA,mBAAAge,GACE,MAAMe,EAAoB,CACxBC,WAAY1f,KAAKC,MAAsB,IAAhBD,KAAKyT,UAC5BkM,YAAa3f,KAAKC,MAAsB,IAAhBD,KAAKyT,UAC7BlW,aAAcyC,KAAKC,MAAsB,IAAhBD,KAAKyT,UAC9B0B,UAAWnV,KAAKC,MAAsB,IAAhBD,KAAKyT,UAC3BmM,UAAW5f,KAAKC,MAAsB,IAAhBD,KAAKyT,UAC3BoM,SAAU7f,KAAKC,MAAsB,IAAhBD,KAAKyT,WAEtBqM,EAAiB,GAWvB,OAVIL,EAAOC,WAAa,IAAII,EAAKvf,KAAK,QAClCkf,EAAOE,YAAc,IAAIG,EAAKvf,KAAK,QACnCkf,EAAOliB,aAAe,IAAIuiB,EAAKvf,KAAK,MACpCkf,EAAOtK,UAAY,IAAI2K,EAAKvf,KAAK,OACjCkf,EAAOG,UAAY,IAAIE,EAAKvf,KAAK,MACjCkf,EAAOI,SAAW,IAAIC,EAAKvf,KAAK,MAChCkf,EAAOC,WAAa,IAAII,EAAKvf,KAAK,MAClCkf,EAAOE,YAAc,IAAIG,EAAKvf,KAAK,MACnCkf,EAAOtK,UAAY,IAAI2K,EAAKvf,KAAK,MACjCkf,EAAOG,UAAY,IAAIE,EAAKvf,KAAK,MAC9B,CAAEkf,SAAQK,OACnB,EAEA,kBAAAlB,CACE1hB,EACA6iB,GAEA,MAAMC,EAAa,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,OAElDC,EAAiB/U,KAAK6N,eAAeiH,EAAWtf,OAD7B,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,IAE3Cwf,EAAkB,CAAC,KAAM,KAAM,KAAM,MACrCC,EAAiBjjB,EAAM,GAAK,CAAC,GAAI,GAAI,EAAG,GAAKA,EAAM,GAAK,CAAC,GAAI,GAAI,GAAI,GAAK,CAAC,GAAI,GAAI,GAAI,IACvFkjB,EAAelV,KAAK6N,eAAemH,EAAgBxf,OAAQyf,GAC3DE,EAAgD,OAAlCH,EAAgBE,IAA0BpgB,KAAKyT,SAAW,GACxE6M,EAAgBD,EAAcrgB,KAAKC,MAAsB,EAAhBD,KAAKyT,UAAgB,EAAI,EACxE,MAAO,CACL8M,UAAWP,EAAWC,GACtBO,cAAeN,EAAgBE,GAC/BC,cACAC,gBACAG,SAAUvV,KAAKwV,mBACfC,iBAAkB3gB,KAAKyT,SAAW,GAAMzT,KAAKC,MAAsB,EAAhBD,KAAKyT,UAAgB,EAAI,EAEhF,EAEA,gBAAAiN,GACE,MAAME,EAAY,CAChB,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MACA,KACA,KACA,KACA,KACA,MAEF,OAAOA,EAAU5gB,KAAKC,MAAMD,KAAKyT,SAAWmN,EAAUlgB,QACxD,EAEAoe,qBAAoB,KACX,CACL+B,cAAe,GACfC,QAAS,KACTC,OAAQ,GACRC,QAAS,GACTC,UAAWjhB,KAAKC,MAAsB,IAAhBD,KAAKyT,YAI/B,gBAAAsL,CAAiBN,EAA6BI,EAA+BlgB,GAC1D,eAAbA,GACF8f,EAAYgB,OAAOtK,WAAa,GAChC0J,EAAaoC,WAAa,IACJ,aAAbtiB,GACT8f,EAAYgB,OAAOtK,WAAa,GAChCsJ,EAAYgB,OAAOC,YAAc,GACX,cAAb/gB,IACT8f,EAAYgB,OAAOtK,WAAa,GAChCsJ,EAAYgB,OAAOC,YAAc,GACjCb,EAAaoC,WAAa,IAE3B5Q,OAAOC,KAAKmO,EAAYgB,QAAmC/T,QAAQrL,IAClEoe,EAAYgB,OAAOpf,GAAOL,KAAKqE,IAAI,EAAGrE,KAAKsE,IAAI,IAAKma,EAAYgB,OAAOpf,OAEzEwe,EAAaoC,UAAYjhB,KAAKqE,IAAI,EAAGrE,KAAKsE,IAAI,IAAKua,EAAaoC,WAClE,EAEA,cAAAlI,CAAenV,EAAeuV,GAC5B,MAAME,EAAcF,EAAQrY,OAAO,CAACD,EAAKyY,IAAMzY,EAAMyY,EAAG,GACxD,IAAI7F,EAASzT,KAAKyT,SAAW4F,EAC7B,IAAK,IAAI7C,EAAI,EAAGA,EAAI5S,EAAO4S,IAEzB,GADA/C,GAAU0F,EAAQ3C,GACd/C,GAAU,EAAG,OAAO+C,EAE1B,OAAO5S,EAAQ,CACjB,EAEAob,WAAU,IACD,OAASjgB,KAAKC,MAAQ,IAAMgB,KAAKyT,SAAShP,SAAS,IAAIiV,MAAM,EAAG,IAGzE,gBAAAwH,CAAiBpI,GACf,MAAkB,kBAAdA,EAAsC5N,KAAKiW,iBAC7B,iBAAdrI,EAAqC5N,KAAKkW,iBAC5B,iBAAdtI,EAAqC5N,KAAKmW,iBAC5B,kBAAdvI,EAAsC5N,KAAKoW,iBAC7B,yBAAdxI,EACK,CAAEyI,OAAQrW,KAAKiW,iBAAkBK,UAAWtW,KAAK8Q,SAAS,EAAG,CAAE7U,KAAM,aAEvE+D,KAAKiT,eAAe,CAAErF,aAC/B,EAEA,cAAAqI,GACE,MAAMjkB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCwI,GAAY,IAAIld,MAAO0d,cAAgBvf,EACvCD,EAAO8d,EAAciB,SAASC,GAC9BwF,EAAQ,CAAC,KAAM,KAAM,MAAO,MAC5BC,EAAOD,EAAMzhB,KAAKC,MAAMD,KAAKyT,SAAWgO,EAAM/gB,SA8BpD,MA7BiB,CACfqD,GAAImH,KAAK8T,aACT/hB,OACAgiB,OAAQ,SACR/hB,MACAykB,KAAM,SACND,OACAlkB,WAAY0N,KAAKsT,mBAAmBthB,GACpCuhB,YAAa,CACXgB,OAAQ,CACNC,WAAY1f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC7CkM,YAAa3f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC9ClW,aAAcyC,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC/C0B,UAAWnV,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CmM,UAAW5f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CoM,SAAU7f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,IAE7CqM,KAAM,CAAC,KAAM,OAEf8B,SAAU5hB,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC3CtW,MAAO,KACPqgB,SAAU,EACVmB,WAAYzT,KAAK0T,mBAAmB1hB,EAAK,CAAEC,MAAO,GAAIqgB,SAAU,EAAGzJ,SAAU,CAAEkJ,cAAe,CAAC,EAAG,MAClG4B,aAAc3T,KAAK4T,uBACnBngB,SAAU,QACVuZ,cAAe,EACf1O,OAAQ,SACR0V,UAAWngB,KAAKC,MAGpB,EAEA,cAAAoiB,GACE,MAAMlkB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCwI,GAAY,IAAIld,MAAO0d,cAAgBvf,EACvC2kB,EAAW7hB,KAAKyT,SAAW,GAC3BxW,EAAO8d,EAAciB,SAASC,GAC9BpD,EAAQ,CAAC,SAAU,OAAQ,QAE3BiJ,EAAY5W,KAAK6N,eAAeF,EAAMnY,OADxB,CAAC,GAAI,GAAI,KAgC7B,MA9BiB,CACfqD,GAAImH,KAAK8T,aACT/hB,OACAgiB,OAAQ4C,EAAW,SAAW,OAC9B3kB,MACAykB,KAAM,SACNxa,KAAM0R,EAAMiJ,GACZtkB,WAAY0N,KAAKsT,mBAAmBthB,GACpCuhB,YAAa,CACXgB,OAAQ,CACNC,WAAY1f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC7CkM,YAAa3f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC9ClW,aAAcyC,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC/C0B,UAAWnV,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CmM,UAAW5f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CoM,SAAU7f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,IAE7CqM,KAAM,CAAC,KAAM,OAEfiC,WAAY/hB,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,EAC7C9J,YAAa3J,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC9CtW,MAAO,KACPqgB,SAAU,EACVmB,WAAYzT,KAAK0T,mBAAmB1hB,EAAK,CAAEC,MAAO,GAAIqgB,SAAU,EAAGzJ,SAAU,CAAEkJ,cAAe,CAAC,EAAG,MAClG4B,aAAc3T,KAAK4T,uBACnBngB,SAAU,WACVuZ,cAAe,EACf1O,OAAQ,SACR0V,UAAWngB,KAAKC,MAGpB,EAEA,cAAAqiB,GACE,MAAMW,EAAgB,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAG3DC,EAAWD,EADK9W,KAAK6N,eAAeiJ,EAActhB,OADxC,CAAC,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,EAAG,KAG5C,IAAIxD,EAAM,GACN2kB,GAAW,EACE,OAAbI,GACF/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCoO,GAAW,GACW,OAAbI,GACT/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCoO,GAAW,GACW,OAAbI,GACT/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCoO,GAAW,GACW,OAAbI,GACT/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCoO,GAAW,GACW,OAAbI,GAAkC,OAAbA,GAC9B/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCoO,GAAW,GACW,OAAbI,GACT/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,EACvCoO,GAAW,GACW,OAAbI,IACT/kB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,EACvCoO,GAAW,GAEb,MAAM5F,GAAY,IAAIld,MAAO0d,cAAgBvf,EACvCD,EAAO8d,EAAciB,SAASC,GA8BpC,MA7BiB,CACflY,GAAImH,KAAK8T,aACT/hB,OACAgiB,OAAQ4C,EAAW,SAAW,OAC9B3kB,MACAykB,KAAM,SACNM,WACAzkB,WAAY0N,KAAKsT,mBAAmBthB,GACpCuhB,YAAa,CACXgB,OAAQ,CACNC,WAAY1f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC7CkM,YAAa3f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC9ClW,aAAcyC,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC/C0B,UAAWnV,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CmM,UAAW5f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CoM,SAAU7f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,IAE7CqM,KAAM,CAAC,KAAM,OAEfoC,aAAcliB,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC/CtW,MAAO,KACPqgB,SAAU,EACVmB,WAAYzT,KAAK0T,mBAAmB1hB,EAAK,CAAEC,MAAO,GAAIqgB,SAAU,EAAGzJ,SAAU,CAAEkJ,cAAe,CAAC,EAAG,MAClG4B,aAAc3T,KAAK4T,uBACnBngB,SAAU,WACVuZ,cAAe,EACf1O,OAAQ,SACR0V,UAAWngB,KAAKC,MAGpB,EAEA,cAAAsiB,GACE,MAAMpkB,EAAM8C,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GACvCwI,GAAY,IAAIld,MAAO0d,cAAgBvf,EACvCD,EAAO8d,EAAciB,SAASC,GAC9BkG,EAAc,CAAC,KAAM,KAAM,MAAO,KAAM,OACxCC,EAAYD,EAAYniB,KAAKC,MAAMD,KAAKyT,SAAW0O,EAAYzhB,SA8BrE,MA7BiB,CACfqD,GAAImH,KAAK8T,aACT/hB,OACAgiB,OAAQ,SACR/hB,MACAykB,KAAM,SACNS,YACA5kB,WAAY0N,KAAKsT,mBAAmBthB,GACpCuhB,YAAa,CACXgB,OAAQ,CACNC,WAAY1f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC7CkM,YAAa3f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC9ClW,aAAcyC,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC/C0B,UAAWnV,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CmM,UAAW5f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,GAC5CoM,SAAU7f,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,IAE7CqM,KAAM,CAAC,KAAM,OAEfiC,WAAY/hB,KAAKC,MAAsB,GAAhBD,KAAKyT,UAAiB,EAC7CtW,MAAO,KACPqgB,SAAU,EACVmB,WAAYzT,KAAK0T,mBAAmB1hB,EAAK,CAAEC,MAAO,GAAIqgB,SAAU,EAAGzJ,SAAU,CAAEkJ,cAAe,CAAC,EAAG,MAClG4B,aAAc3T,KAAK4T,uBACnBngB,SAAU,WACVuZ,cAAe,EACf1O,OAAQ,SACR0V,UAAWngB,KAAKC,MAGpB,EAEA,kBAAAqjB,GACE,OAAOnX,KAAK8S,eACd,EAEA,kBAAAsE,CAAmBrE,GACjB/S,KAAK8S,gBAAkBC,EACvB,EAAGrb,OAAOC,KAAK,oBAAqB,CAAEob,QACxC,EAEA,YAAAsE,CAAarE,GACXhT,KAAK8S,gBAAgBzd,KAAK2d,GAC1B,EAAGtb,OAAOC,KAAK,kBAAmB,CAAEqb,OACtC,EAEA,iBAAAsE,CAAkBC,GAChB,MAAMlX,EAAQL,KAAK8S,gBAAgB0E,UAAUC,GAAKA,EAAE5e,KAAO0e,GAC3D,IAAe,IAAXlX,EAAc,CAChB,MAAM2S,EAAMhT,KAAK8S,gBAAgBvS,OAAOF,EAAO,GAAG,GAElD,OADA,EAAG3I,OAAOC,KAAK,gBAAiB,CAAEqb,QAC3BA,CACT,CACA,OAAO,IACT,EAEA,WAAA0E,CAAYH,GACV,OAAOvX,KAAK6S,YAAY8E,KAAKF,GAAKA,EAAE5e,KAAO0e,IAAUvX,KAAK8S,gBAAgB6E,KAAKF,GAAKA,EAAE5e,KAAO0e,EAC/F,EAEA,kBAAAK,CAAmBL,EAAeniB,GAChC,MAAM4d,EAAMhT,KAAK0X,YAAYH,GACzBvE,GAAOA,EAAIW,eACbX,EAAIW,aAAagC,cAAgB7gB,KAAKqE,IAAI,EAAGrE,KAAKsE,IAAI,IAAK4Z,EAAIW,aAAagC,cAAgBvgB,IAC5F,EAAGsC,OAAOC,KAAK,uBAAwB,CACrC4f,QACAM,QAAS7E,EAAIjhB,KACbuD,MAAO0d,EAAIW,aAAagC,cACxBvgB,UAGN,EAEA,UAAAkI,GACE,MAAO,CACLwa,SAAU9X,KAAK6S,YACfkF,YAAa/X,KAAK8S,gBAEtB,EAEA,UAAAtV,CAAWxH,GACT,IAAKA,EAAM,OAAO,EAClB,IAIE,OAHAgK,KAAK6S,YAAc7c,EAAK8hB,UAAY,GACpC9X,KAAK8S,gBAAkB9c,EAAK+hB,aAAe,GAC3CtjB,QAAQqK,KAAK,mBACN,CACT,CAAE,MAAOzI,GAEP,OADA5B,QAAQ4B,MAAM,kBAAmBA,IAC1B,CACT,CACF,EAEA,SAAA2hB,GACEhY,KAAK6S,YAAc,GACnB7S,KAAK8S,gBAAkB,GACvBre,QAAQqK,KAAK,gBACf,GAIF,EAAGmZ,YAAc,CAACvf,EAAgB6K,IAAsCqP,EAAa9B,SAASpY,EAAO6K,GAAW,CAAC,GACjH,EAAG2U,oBAAuBtK,GAAsBgF,EAAaoD,iBAAiBpI,GAC9E,EAAGuJ,mBAAqB,IAAMvE,EAAauE,qBAC3C,EAAGC,mBAAsBrE,GAAgBH,EAAawE,mBAAmBrE,GACzE,EAAGsE,aAAgBrE,GAAaJ,EAAayE,aAAarE,GAC1D,EAAGsE,kBAAqBC,GAAkB3E,EAAa0E,kBAAkBC,GACzE,EAAGY,QAAWZ,GAAkB3E,EAAa8E,YAAYH,GACzD,EAAGa,sBAAwB,CAACb,EAAeniB,IAAkBwd,EAAagF,mBAAmBL,EAAOniB,GACpG,EAAGijB,cAAgB,IAAMzF,EAAatV,aACtC,EAAGgb,cAAiBtiB,GAAqD4c,EAAapV,WAAWxH,GAEjG,EAAG+I,eAAe,YAAa6T,GAG/B,EAAGlb,OAAO+E,GAAG,kBAAoBqD,IAC/B,MAAMyY,EACwD,iBAApDzY,GAA6CjH,GAChDiH,EAAgCjH,QACjC3C,EACN,GAAKqiB,GACD,CAAC,gBAAiB,eAAgB,eAAgB,gBAAiB,wBAAwB3O,SAAS2O,GAAU,CAChH,MAAMvF,EAAMJ,EAAaoD,iBAAiBuC,GAC1C,EAAG7gB,OAAOC,KAAK,sBAAuB,CAAEmI,QAAOkT,OACjD,IAIF,EAAGtb,OAAO+E,GAAG,gBAAkBzG,IAC7B,MAAMwV,EAAMxV,GAA0CwV,GAChDgN,EAA4B,iBAAPhN,EAAkBA,EAAK,aAC5CiN,EAAW3jB,KAAKC,MAAsB,EAAhBD,KAAKyT,UAAgB,EAC3CmQ,EAAU9F,EAAa9B,SAAS2H,EAAU,CAAEhlB,SAAU+kB,IAC5D5F,EAAawE,mBAAmBsB,GAChCjkB,QAAQqK,KAAK,kBAAkB2Z,gBAGjChkB,QAAQqK,KAAK,2BACf,MAj5BErK,QAAQ4B,MAAM,mBCxDhB,MAAMsiB,EAA8C,CAClDC,gBAAiB,CACf7mB,KAAM,kBACN8mB,YAAa,QACbtR,YAAa,2BACb8E,SAAU,GACVyM,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,QACA,OACA,KACA,KACA,KACA,KACA,KACA,MAEFC,UAAU,EACVC,SAAU,cACVC,MAAO,EACPC,gBAAiB,IAEnBC,0BAA2B,CACzBpnB,KAAM,4BACN8mB,YAAa,QACbtR,YAAa,4BACb8E,SAAU,EACVyM,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEFC,UAAU,EACVC,SAAU,aACVC,MAAO,EACPC,gBAAiB,IAEnBE,qBAAsB,CACpBrnB,KAAM,uBACN8mB,YAAa,QACbtR,YACE,+DACF8E,SAAU,EACVyM,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,KACA,KACA,KACA,OACA,OACA,QACA,MACA,OACA,MACA,KACA,KACA,MACA,KACA,KACA,MAEFC,UAAU,EACVC,SAAU,cACVC,MAAO,EACPC,gBAAiB,IAEnBG,gBAAiB,CACftnB,KAAM,kBACN8mB,YAAa,QACbtR,YAAa,mBACb8E,SAAU,EACVyM,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,QAEFC,UAAU,EACVC,SAAU,aACVC,MAAO,EACPC,gBAAiB,IAEnBI,yBAA0B,CACxBvnB,KAAM,2BACN8mB,YAAa,QACbtR,YAAa,uCACb8E,SAAU,EACVyM,SAAU,CACR,KACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,OACA,KACA,OACA,OACA,KACA,KACA,KACA,MACA,KACA,KACA,MACA,MACA,MACA,KACA,MAEFC,UAAU,EACVC,SAAU,cACVC,MAAO,EACPC,gBAAiB,IAEnBK,uBAAwB,CACtBxnB,KAAM,yBACN8mB,YAAa,QACbtR,YAAa,qBACb8E,SAAU,EACVyM,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEFC,UAAU,EACVC,SAAU,aACVC,MAAO,EACPC,gBAAiB,KAwBrBzkB,QAAQqK,KAAK,yBAGbK,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,aACT9B,KAAM,CAAE+O,qBAAsBvN,OAAOC,gBAAiBuN,2BAA4BxN,OAAOC,iBACzFlC,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGT,MAAM,EAAKnI,OAAOC,gBAElB,GAAK,EAiBE,CAEL0H,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,UACT9B,KAAM,CACJ4F,QAAS,EAAGA,QACZqD,YAAa,EAAGA,YAChBgG,YAAa,EAAGvN,OAChBwN,YAAaC,OAAOC,KAAK,EAAGpE,SAAW,CAAC,GAAGxL,QAE7CD,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGR,EAAkD6Z,YAAc,mBACjE/kB,QAAQqK,KAAK,sBAGb,MAAM2a,EAAuC,CAC3CC,OAAQ,IAAI7Z,IACZ8Z,QAAS,IAAI9Z,IACbZ,aAAa,EACb2a,cAAc,EACdC,qBAAsB,KAKtB,4BAAMC,GACJrlB,QAAQqK,KAAK,yBAEb,IACE,MAAMib,EAAiBC,sBAAsB,WAC7C,OAAID,EAAeE,SACjBxlB,QAAQqK,KAAK,wBAAwBib,EAAeE,WACpDja,KAAK6Z,qBAAuBE,EAAeE,QACpCF,EAAeE,SAGpBF,EAAeG,WAAW1kB,OAAS,GACrCf,QAAQqK,KAAK,yBAAyBib,EAAeG,WAAW,MAChEla,KAAK6Z,qBAAuBE,EAAeG,WAAW,GAC/CH,EAAeG,WAAW,KAGnCzlB,QAAQwB,KAAK,yBACN,KACT,CAAE,MAAOI,GAEP,OADA5B,QAAQ4B,MAAM,sBAAuBA,GAC9B,IACT,CACF,EAKA,mBAAM8jB,CAAcC,GAClB,MAAMxb,EAAS+Z,EAAWyB,GAC1B,IAAKxb,EACH,MAAM,IAAI/G,MAAM,WAAWuiB,KAI7B,GAAIpa,KAAK0Z,OAAOzZ,IAAIma,GAElB,OADA3lB,QAAQqK,KAAK,YAAYF,EAAOia,sBACzB7Y,KAAK0Z,OAAOvZ,IAAIia,GAIzB,GAAIpa,KAAK2Z,QAAQ1Z,IAAIma,GAEnB,OADA3lB,QAAQqK,KAAK,YAAYF,EAAOia,gCACnB7Y,KAAK2Z,QAAQxZ,IAAIia,GAIhC,MAAMC,EAAcra,KAAKsa,uBAAuBF,EAAUxb,GAC1DoB,KAAK2Z,QAAQzZ,IAAIka,EAAUC,GAE3B,IACE,MAAME,QAAeF,EAErB,OADAra,KAAK0Z,OAAOxZ,IAAIka,EAAUG,GACnBA,CACT,C,QACEva,KAAK2Z,QAAQ5X,OAAOqY,EACtB,CACF,EAKA,4BAAME,CAAuBF,EAAkBxb,GAC7CnK,QAAQqK,KAAK,kBAAkBF,EAAOia,gBAAgBuB,MAGtDjb,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,UACT9B,KAAM,CAAEokB,WAAUvB,YAAaja,EAAOia,YAAaxM,SAAUzN,EAAOyN,UACpE9W,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGT,IAEE,MAAM6a,EAAoBC,oBAE1Btb,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,YACT9B,KAAM,CACJ0C,MAAO8hB,EAAkBhlB,OACzBwa,MAAOwK,EAAkBhM,MAAM,EAAG,IAClCkM,kBAAmB9b,EAAOia,YAC1B8B,WAAY/b,EAAO7M,MAErBwD,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAIT,IAAIib,EAAqC,KAGzC,MAAMC,EAAoBL,EAAkB7C,KAAK5lB,GAAQA,IAAS6M,EAAOia,aACzE,GAAIgC,EACFD,EAAsBC,EACtBpmB,QAAQqK,KAAK,yBAAyBF,EAAOia,qBACxC,GAAI2B,EAAkB5Q,SAAShL,EAAO7M,MAE3C6oB,EAAsBhc,EAAO7M,KAC7B0C,QAAQqK,KAAK,yBAAyBF,EAAO7M,aACxC,CAEL,MAAM+oB,EAAaN,EAAkB7C,KACnC5lB,GACEA,EAAK6X,SAAShL,EAAOia,cACrBja,EAAOia,YAAYjP,SAAS7X,IAC5BA,EAAK6X,SAAShL,EAAO7M,OACrB6M,EAAO7M,KAAK6X,SAAS7X,IAErB+oB,IACFF,EAAsBE,EACtBrmB,QAAQqK,KAAK,qBAAqBgc,MAEtC,CAEA,IAAKF,EAAqB,CACxB,MAAMG,EAAiBP,EAAkB9L,KAAK,MAqB9C,MAnBAvP,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,UACT9B,KAAM,CACJokB,WACAvB,YAAaja,EAAOia,YACpBmC,eAAgBR,EAAkBhlB,OAClCylB,eAAgBT,GAElBjlB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAEH,IAAI9H,MACR,WAAW+G,EAAOia,gBAAgBuB,eACrBW,6CAGjB,CAEA5b,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,UACT9B,KAAM,CAAEokB,WAAUQ,sBAAqB/B,YAAaja,EAAOia,aAC3DtjB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAIT,MAAMuC,QAAgBgZ,aAAaN,GAEnC,GAAuB,IAAnB1Y,EAAQ1M,OACV,MAAM,IAAIqC,MAAM,SAIlB,MAAMkiB,EAAiBC,sBAAsB,WAW7C,OAVKD,EAAeG,WAAWtQ,SAASgR,WAChCO,qBAAqB,UAAW,CACpClB,QAASF,EAAeE,QACxBC,WAAY,IAAIH,EAAeG,WAAYU,KAE7CnmB,QAAQqK,KAAK,uBAAuB8b,MAGtCnmB,QAAQqK,KAAK,cAAcF,EAAOia,qBAAqB3W,EAAQ1M,cAExD,CACLzD,KAAMqoB,EACNvB,YAAaja,EAAOia,YACpB3W,QAASA,EACTkZ,UAAU,EACVC,SAAUxnB,KAAKC,MAEnB,CAAE,MAAOuC,GACP,MAAMuB,EAAevB,aAAiBwB,MAAQxB,EAAMyB,QAAUC,OAAO1B,GAIrE,GAHA5B,QAAQwB,KAAK,cAAc2I,EAAOia,oBAAqBjhB,GAGnDgH,EAAOsa,iBAAmBta,EAAOsa,gBAAgB1jB,OAAS,EAI5D,OAHAf,QAAQqK,KAAK,cAAcF,EAAOia,uBAAuBja,EAAOsa,gBAAgB1jB,cAChFwK,KAAK4Z,cAAe,EAEb,CACL7nB,KAAMqoB,EACNvB,YAAaja,EAAOia,YACpB3W,QAAStD,EAAOsa,gBAChBkC,UAAU,EACV/kB,MAAOuB,EACPyjB,SAAUxnB,KAAKC,OAInB,MAAMuC,CACR,CACF,EAKA,qBAAMilB,CAAgB/X,GACpB,IAAKA,GAA8B,iBAAZA,EACrB,OAGF9O,QAAQqK,KAAK,uBAEb,MAAMyc,EAAmG,GAEzG,IAAK,MAAMnB,KAAYzB,EAAY,CACjC,MAAM/Z,EAAS+Z,EAAWyB,GAE1B,GAAIpa,KAAK0Z,OAAOzZ,IAAIma,GAClB,SAGF,IAAIoB,EAAa,EACbC,EAAgB,EAGpB,IAAK,MAAMC,KAAW9c,EAAOka,SAC3B,GAAIvV,EAAQqG,SAAS8R,GAAU,CAC7BF,IAGAC,GADsBC,EAAQlmB,QAAU,EAAI,EAAI,EAI5CoJ,EAAO2I,aAAe3I,EAAO2I,YAAYqC,SAAS8R,KACpDD,GAAiB,EAErB,CAIF,GAAI7c,EAAO2I,YAAa,CACtB,MAAMoU,EAAe/c,EAAO2I,YAAYuE,MAAM,yBAA2B,GACzE,IAAK,MAAM8P,KAAUD,EACfpY,EAAQqG,SAASgS,IAAWA,EAAOpmB,QAAU,IAC/CimB,GAAiB,GAGvB,CAEA,GAAID,EAAa,EAAG,CAElB,MAAMK,EAA+B,GAAlBjd,EAAOyN,SAAgBoP,EAE1CF,EAAYlmB,KAAK,CACf+kB,WACA0B,MAAON,EACPnP,SAAUzN,EAAOyN,SACjBoP,cAAeI,GAEnB,CACF,CAGAN,EAAYrS,KAAK,CAACC,EAAGC,IACftU,KAAKqB,IAAIiT,EAAEqS,cAAgBtS,EAAEsS,eAAiB,EACzCrS,EAAEqS,cAAgBtS,EAAEsS,cAEzBrS,EAAEiD,WAAalD,EAAEkD,SACZjD,EAAEiD,SAAWlD,EAAEkD,SAEjBjD,EAAE0S,MAAQ3S,EAAE2S,OAGrBrnB,QAAQqK,KAAK,mBAAmByc,EAAY/lB,eAG5C,MAAMumB,EAASR,EAAYzd,OAAOke,GAAKA,EAAEP,cAAgB,IAAIjN,MAAM,EAAG,GAEtE,GAAsB,IAAlBuN,EAAOvmB,OAKX,IAAK,MAAMymB,KAAQF,EAAQ,CACzBtnB,QAAQqK,KACN,mBAAmB6Z,EAAWsD,EAAK7B,UAAUvB,uBAChCoD,EAAKH,gBAAgBG,EAAKR,cAAc/c,QAAQ,OAG/D,UACQsB,KAAKma,cAAc8B,EAAK7B,SAChC,CAAE,MAAO/jB,GACP5B,QAAQwB,KAAK,qBAAqBgmB,EAAK7B,WAAY/jB,EACrD,CACF,MAfE5B,QAAQqK,KAAK,+BAgBjB,EAKA,kBAAAod,CAAmB3Y,EAAiB4Y,EAAqB,GACvD,IAAK5Y,GAA8B,iBAAZA,EACrB,MAAO,GAGT,MAAM6Y,EAAqG,GAE3Gpc,KAAK0Z,OAAOlZ,QAAQ,CAAC6b,EAAUjC,KAC7B,GAAIiC,EAASna,SAAWmM,MAAMC,QAAQ+N,EAASna,SAC7C,IAAK,MAAMoa,KAASD,EAASna,QAC3Bka,EAAW/mB,KAAK,CACdinB,QACAlC,SAAUA,EACVmC,gBAAiBF,EAASxD,YAC1BxM,SAAUsM,EAAWyB,IAAW/N,UAAY,MAMpD,MAAMmQ,EAAgBJ,EAAWpO,IAAIlM,IACnC,IAAIga,EAAQ,EACZ,MAAMQ,EAAQxa,EAAKwa,MAOblX,EAAOkX,EAAMlX,MAAQkX,EAAMnnB,KAAO,GAGxC,IAAK,MAAMA,KAAOiQ,EAChB,GAAI7B,EAAQqG,SAASzU,GAAM,CAEzB2mB,GADkB3mB,EAAIK,QAAU,EAAI,GAAK,GAIrC8mB,EAAMvqB,MAAQuqB,EAAMvqB,KAAK6X,SAASzU,KACpC2mB,GAAS,EAEb,CASF,GALIQ,EAAMvqB,MAAQwR,EAAQqG,SAAS0S,EAAMvqB,QACvC+pB,GAAS,IAIPQ,EAAM3lB,QAAS,CACjB,MAAM8lB,EAAeH,EAAM3lB,QAAQI,UAAU,EAAG,KAC5CwM,EAAQqG,SAAS6S,EAAa1lB,UAAU,EAAG,OAC7C+kB,GAAS,EAEb,CAUA,OAPAA,GAASha,EAAKuK,UAAY,EAGtBiQ,EAAMI,WACRZ,GAAS,IAGJ,CACLQ,MAAOxa,EAAKwa,MACZR,QACA1B,SAAUtY,EAAKsY,SACfmC,gBAAiBza,EAAKya,mBAK1BC,EAActT,KAAK,CAACC,EAAGC,KACrB,GAAItU,KAAKqB,IAAIiT,EAAE0S,MAAQ3S,EAAE2S,OAAS,EAChC,OAAO1S,EAAE0S,MAAQ3S,EAAE2S,MAGrB,MAAMa,EAAYhE,EAAWxP,EAAEiR,WAAW/N,UAAY,EAEtD,OADkBsM,EAAWvP,EAAEgR,WAAW/N,UAAY,GACnCsQ,IAGrB,MAAMC,EAAWJ,EACd1e,OAAOgE,GAAQA,EAAKga,MAAQ,GAC5BtN,MAAM,EAAG2N,GACTnO,IAAIlM,GAAQA,EAAKwa,OASpB,OAPIM,EAASpnB,OAAS,GACpBf,QAAQqK,KACN,eAAe8d,EAASpnB,sBACbgnB,EAAc,IAAIV,OAAS,UAAUU,EAAc,IAAID,iBAAmB,SAIlFK,CACT,EAKA,iBAAMC,CAAYC,GAChB,IAAKA,GAAkC,iBAAdA,GAA0BA,EAAUtnB,OAAS,EACpE,OAGFf,QAAQqK,KAAK,sBAEb,MAAMie,EAMD,GAEL,IAAK,MAAM3C,KAAYzB,EAAY,CACjC,MAAM/Z,EAAS+Z,EAAWyB,GAE1B,GAAIpa,KAAK0Z,OAAOzZ,IAAIma,GAClB,SAGF,IAAI4C,EAAa,EACbC,EAAc,GACdC,EAAmB,EAGvB,IAAK,MAAMxB,KAAW9c,EAAOka,SACvBgE,EAAUlT,SAAS8R,KACrBsB,IACItB,EAAQlmB,OAAS0nB,IACnBA,EAAmBxB,EAAQlmB,OAC3BynB,EAAcvB,IAMpB,GAAIsB,EAAa,EAAG,CAElB,MAAMlB,EAA0B,GAAlBld,EAAOyN,SAA6B,EAAb2Q,EAAiBE,EAEtDH,EAAS1nB,KAAK,CACZ+kB,WACAsB,QAASuB,EACT5Q,SAAUzN,EAAOyN,SACjB2Q,aACAlB,SAEJ,CACF,CAEA,GAAwB,IAApBiB,EAASvnB,OAEX,YADAf,QAAQqK,KAAK,oBAKfie,EAAS7T,KAAK,CAACC,EAAGC,IACZtU,KAAKqB,IAAIiT,EAAE0S,MAAQ3S,EAAE2S,OAAS,EACzB1S,EAAE0S,MAAQ3S,EAAE2S,MAEd1S,EAAEiD,SAAWlD,EAAEkD,UAGxB5X,QAAQqK,KAAK,eAAeie,EAASvnB,oBAGrC,MAAMumB,EAASgB,EAASvO,MAAM,EAAG,GAEjC,IAAK,MAAM2O,KAAWpB,EAAQ,CAC5BtnB,QAAQqK,KACN,kBAAkB6Z,EAAWwE,EAAQ/C,UAAUvB,qBACpCsE,EAAQzB,iBAAiByB,EAAQH,mBAAmBG,EAAQrB,UAGzE,UACQ9b,KAAKma,cAAcgD,EAAQ/C,SACnC,CAAE,MAAO/jB,GACP5B,QAAQwB,KAAK,oBAAoBknB,EAAQ/C,WAAY/jB,EACvD,CACF,CACF,EAKA,SAAA+mB,GACE,MAAM9e,EAA0B,CAC9BW,YAAae,KAAKf,YAClB2a,aAAc5Z,KAAK4Z,aACnByD,mBAAoBrd,KAAK6Z,qBACzBH,OAAQ,GACRC,QAAS,GACT2D,UAAW,IAGbtd,KAAK0Z,OAAOlZ,QAAQ,CAACxK,EAAMjE,KACzBuM,EAAOob,OAAOrkB,KAAK,CACjBtD,KAAMA,EACN8mB,YAAa7iB,EAAK6iB,YAClB3W,QAASlM,EAAKkM,QAAQ1M,OACtB4lB,SAAUplB,EAAKolB,SACf/kB,MAAOL,EAAKK,MACZglB,SAAU,IAAIxnB,KAAKmC,EAAKqlB,UAAUrgB,yBAItCgF,KAAK2Z,QAAQnZ,QAAQ,CAAC+c,EAAUxrB,KAC9BuM,EAAOqb,QAAQtkB,KAAK,CAClBtD,KAAMA,EACN8mB,YAAaF,EAAW5mB,IAAO8mB,aAAe9mB,MAIlD,IAAK,MAAMqoB,KAAYzB,EAChB3Y,KAAK0Z,OAAOzZ,IAAIma,IAAcpa,KAAK2Z,QAAQ1Z,IAAIma,IAClD9b,EAAOgf,UAAUjoB,KAAK,CACpBtD,KAAMqoB,EACNvB,YAAaF,EAAWyB,GAAUvB,YAClCE,SAAUJ,EAAWyB,GAAUrB,WAKrC,OAAOza,CACT,EAKA,qBAAMkf,CAAgBpD,GACpB,IAAKpa,KAAK0Z,OAAOzZ,IAAIma,GAEnB,YADA3lB,QAAQwB,KAAK,YAAYmkB,SAI3B3lB,QAAQqK,KAAK,gBAAgB6Z,EAAWyB,IAAWvB,aAAeuB,KAGlE,MAAML,EAAiBC,sBAAsB,WAE7C,GADmBha,KAAK0Z,OAAOvZ,IAAIia,GACnB,CAEd,MACMO,EADoBF,oBACW9C,KAAK5lB,GAAQA,IAASqoB,GAAYroB,EAAK6X,SAASwQ,IAErF,GAAIO,EAAY,CACd,MAAM8C,EAAgB1D,EAAeG,WAAWpc,OAAO/L,GAAQA,IAAS4oB,SAClEQ,qBAAqB,UAAW,CACpClB,QAASF,EAAeE,QACxBC,WAAYuD,GAEhB,CACF,CAEAzd,KAAK0Z,OAAO3X,OAAOqY,EACrB,EAKA,qBAAMsD,CAAgBtD,GAGpB,OAFA3lB,QAAQqK,KAAK,kBAAkB6Z,EAAWyB,IAAWvB,aAAeuB,WAC9Dpa,KAAKwd,gBAAgBpD,SACdpa,KAAKma,cAAcC,EAClC,EAKA,gBAAMve,GAgBJ,GAdAsD,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,QACT9B,KAAM,CAAE2nB,mBAAoB3d,KAAKf,YAAa2a,aAAc5Z,KAAK4Z,cACjErkB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAELK,KAAKf,YAEP,YADAxK,QAAQqK,KAAK,oBAIfrK,QAAQqK,KAAK,yBAEPkB,KAAK8Z,yBAGX,IAAI8D,EAAU,EACVC,EAAgC,GACpC,KAAOD,EAAU,IAAI,CACnB,IAEE,GADAC,EAAsBpD,oBAClBoD,EAAoBroB,OAAS,EAAG,CAClCf,QAAQqK,KAAK,wBAAwB+e,EAAoBroB,aACzDf,QAAQqK,KAAK,mBAAmB+e,EAAoBnP,KAAK,SACzD,KACF,CACF,CAAE,MAAOrY,GAET,CAEA5B,QAAQqK,KAAK,wBAAwB8e,EAAU,eACzC,IAAIE,QAAQC,GAAW/lB,WAAW+lB,EAAS,MACjDH,GACF,CAGAnpB,QAAQqK,KAAK,qBACb,IAAK,MAAMsb,KAAYzB,EAAY,CACjC,MAAM/Z,EAAS+Z,EAAWyB,GACpB4D,EAAcH,EAAoBnU,KACtC3X,GAAQA,IAAS6M,EAAOia,aAAe9mB,IAAS6M,EAAO7M,MAAQA,EAAK6X,SAAShL,EAAOia,cAEtFpkB,QAAQqK,KACN,OAAOF,EAAOia,gBAAgBuB,WACrBxb,EAAOyN,kBACNzN,EAAOma,SAAW,IAAM,YAC1BiF,EAAc,IAAM,KAEhC,CAGA,MAAMC,EAA0B,GAChC,IAAK,MAAM7D,KAAYzB,EACjBA,EAAWyB,GAAUrB,UACvBkF,EAAc5oB,KAAK+kB,GAIvB3lB,QAAQqK,KAAK,mBAAmBmf,EAAczoB,eAE9C,IAAK,MAAM4kB,KAAY6D,EACrB,UACQje,KAAKma,cAAcC,EAC3B,CAAE,MAAO8D,GACPzpB,QAAQwB,KAAK,oBAAoBmkB,IAAY8D,EAC/C,CAGFle,KAAKf,aAAc,EAEnB,MAAMX,EAAS0B,KAAKod,YAyBpB,GAxBA3oB,QAAQqK,KAAK,oBACbrK,QAAQuJ,MAAMM,EAAOob,QAErBva,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,QACT9B,KAAM,CACJmoB,YAAa7f,EAAOob,OAAOlkB,OAC3B4oB,aAAc9f,EAAOqb,QAAQnkB,OAC7BwlB,eAAgB1c,EAAOgf,UAAU9nB,OACjCokB,aAAc5Z,KAAK4Z,cAErBrkB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAILK,KAAK4Z,aAAc,CACrBnlB,QAAQwB,KAAK,uDACbxB,QAAQwB,KAAK,sBACbxB,QAAQwB,KAAK,6BACbxB,QAAQwB,KAAK,8BACbxB,QAAQwB,KAAK,uDAEb,MAAMooB,EAAgB/f,EAAOob,OAAO5b,OAAOsL,GAAKA,EAAEgS,UAClD3mB,QAAQuJ,MAAMqgB,GAGdrmB,WAAW,KACTvD,QAAQqK,KAAK,2BACbkB,KAAKse,YACJ,IACL,MACE7pB,QAAQqK,KAAK,8BAEjB,EAKA,QAAAwf,GACE7pB,QAAQqK,KAAK,sBAGbkB,KAAK0Z,OAAO1X,QACZhC,KAAK2Z,QAAQ3X,QAGT,WACM,EAAqDmY,qBACrD,EAAuDqD,uBACvD,EAAuDE,uBACvD,EAAuDpC,uBACvD,EAA0DY,0BAC1D,EAA0DqC,0BAC1D,EAAmD1B,aAG7D7c,KAAKf,aAAc,EACnBe,KAAK4Z,cAAe,EAEpBnlB,QAAQqK,KAAK,4BACbrK,QAAQqK,KAAK,oBACf,GAKA,EASAqb,cAAiBC,GAAqBX,EAAgBU,cAAcC,GACrE,EAAmFoD,gBAClFpD,GACGX,EAAgB+D,gBAAgBpD,GACpC,EAA8FsD,gBAC7FtD,GACGX,EAAgBiE,gBAAgBtD,GACpC,EAAkFkB,gBACjF/X,GACGkW,EAAgB6B,gBAAgB/X,GACpC,EAAgFsZ,YAAeC,GAC9FrD,EAAgBoD,YAAYC,GAC7B,EAA+FZ,mBAAqB,CACnH3Y,EACApK,IACGsgB,EAAgByC,mBAAmB3Y,EAASpK,GAChD,EAAwEolB,mBAAqB,IAC5F9E,EAAgB2D,YAElB,EAAGre,eAAe,YAAa0a,GAE/BhlB,QAAQqK,KAAK,uBAGb,EAAGpH,OAAO+E,GAAG,kBAAoB+hB,IAC/B,MAAM1e,EAAQ0e,EACV1e,GAAOyH,aACTkS,EAAgB6B,gBAAgBxb,EAAMyH,aAAa5H,MAAMue,IACvDzpB,QAAQwB,KAAK,oBAAqBioB,OAMxC,EAAGxmB,OAAO+E,GAAG,aAAezG,IAE1BmJ,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,WACT9B,KAAM,CACJwZ,UAAWxZ,EACXyZ,gBAAiBzZ,EACjB0Z,WAC4D,iBAAlD1Z,GAAyC8M,KAC5C9M,EAA2B8M,MAAMtN,OAClC,EACNyJ,YAAawa,EAAgBxa,aAE/B1J,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAET,MAAM+L,EAAQ1V,EACV0V,GAAO5I,MAAQ4I,EAAM5I,KAAKtN,OAAS,IAErC2J,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,SACT9B,KAAM,CAAE0Z,WAAYhE,EAAM5I,KAAKtN,OAAQipB,YAAa/S,EAAM5I,KAAK/L,UAAU,EAAG,KAC5ExB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAET8Z,EAAgBoD,YAAYnR,EAAM5I,MAAMnD,MAAMue,IAE5C/e,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,SACT9B,KAAM,CAAEK,MAAO6nB,aAAermB,MAAQqmB,EAAIpmB,QAAUC,OAAOmmB,IAC3D3oB,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAETlL,QAAQwB,KAAK,mBAAoBioB,QAMvCrf,EAAE,KACApK,QAAQqK,KAAK,qBAGb9G,WAAW0mB,UACTjqB,QAAQqK,KAAK,uBAEb,UACQ2a,EAAgB5d,aACtBpH,QAAQqK,KAAK,qBACf,CAAE,MAAOzI,GACP5B,QAAQ4B,MAAM,sBAAuBA,GACrC5B,QAAQqK,KAAK,kDACf,GACC,OAIJtH,OAAoFmnB,oBACnFD,iBAGE,GAFAjqB,QAAQqK,KAAK,qBAET2a,EAAgBxa,YAElB,OADAxK,QAAQqK,KAAK,oBACN2a,EAAgB2D,YAGzB,IAGE,aAFM3D,EAAgB5d,aACtBpH,QAAQqK,KAAK,sBACN2a,EAAgB2D,WACzB,CAAE,MAAO/mB,GAEP,MADA5B,QAAQ4B,MAAM,sBAAuBA,GAC/BA,CACR,CACF,EAEF5B,QAAQqK,KAAK,qBACbrK,QAAQqK,KAAK,wDACf,MAr7BErK,QAAQ4B,MAAM,oBAEd8I,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,0BACVxH,QAAS,YACT9B,KAAM,CAAE2Z,WAAYxK,OAAOC,KAAK5N,QAAQsG,OAAO8R,GAAKA,EAAEhG,SAAS,cAAgBgG,EAAEhG,SAAS,eAC1FrU,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QCpUXR,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,cACVxH,QAAS,yBACT9B,KAAM,CACJT,UAAW1B,KAAKC,MAChB8qB,UAAgC,oBAAdC,UAA4BA,UAAUD,UAAY,UACpErf,sBAAyC,oBAAX/H,aAAqE,IAAnCA,OAAeC,iBAEjFlC,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGTlL,QAAQqK,KAAK,4BAKbK,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,cACVxH,QAAS,eACT9B,KAAM,CACJT,UAAW1B,KAAKC,MAChByL,sBAAyC,oBAAX/H,aAAqE,IAAnCA,OAAeC,iBAEjFlC,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QASTR,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3B9E,KAAMlD,KAAKkG,UAAU,CACnB+B,SAAU,cACVxH,QAAS,WACT9B,KAAM,CACJT,UAAW1B,KAAKC,MAChByL,sBAAyC,oBAAX/H,aAAqE,IAAnCA,OAAeC,gBAC/EqnB,0BACoB,oBAAXtnB,cAAiCA,OAAeC,gBAAkB,oBAE7ElC,UAAW1B,KAAKC,MAChB0L,UAAW,gBACXC,MAAO,OACPC,aAAc,QAEfC,MAAM,QAGTlL,QAAQqK,KAAK","sources":["src://tavern_helper_template/src//status_panel.ts","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/src//core.ts","src://tavern_helper_template/src//event_system.ts","src://tavern_helper_template/src//npc_system.ts","src://tavern_helper_template/src//worldbook_loader.ts","src://tavern_helper_template/src//index.ts"],"sourcesContent":["/**\n *  - \n * HTML\n * : 3.5.2\n */\n\n// ==========  ==========\n\ninterface ProtagonistState {\n  name?: string;\n  age?: number;\n  crime?: string;\n  health: number;\n  mental: number;\n  strength: number;\n  intelligence: number;\n  appearance?: {\n    height?: number;\n    weight?: number;\n    hair?: string;\n    condition?: string;\n  };\n  clothing?: {\n    top?: string;\n    bottom?: string;\n    underwear?: string;\n    underpants?: string;\n    socks?: string;\n    shoes?: string;\n    restraints?: string;\n    cleanliness?: string;\n  };\n  currentTask?: string;\n  currentThought?: string;\n  biggestWorry?: string;\n  days?: number;\n  stage?: string;\n  cellType?: string;\n}\n\ninterface StatusChange {\n  value: number;\n  timestamp: number;\n}\n\ninterface TrendAnalysis {\n  health: { value: number; trend: 'up' | 'down' | 'stable'; changes: StatusChange[] };\n  mental: { value: number; trend: 'up' | 'down' | 'stable'; changes: StatusChange[] };\n  strength: { value: number; trend: 'up' | 'down' | 'stable'; changes: StatusChange[] };\n  intelligence: { value: number; trend: 'up' | 'down' | 'stable'; changes: StatusChange[] };\n}\n\ninterface StatusPanelConfig {\n  updateInterval: number;\n  animationDuration: number;\n  trendWindow: number;\n  slowChangeThreshold: number;\n  regressionRate: number;\n  healthBaseline: number;\n  mentalBaseline: number;\n  parseRetryAttempts: number;\n  parseRetryDelay: number;\n  debugMode: boolean;\n}\n\ninterface StatusPanelState {\n  name: string;\n  age: number;\n  crime: string;\n  health: number;\n  mental: number;\n  strength: number;\n  intelligence: number;\n  appearance: {\n    height: number;\n    weight: number;\n    hair: string;\n    condition: string;\n  };\n  clothing: {\n    top: string;\n    bottom: string;\n    underwear: string;\n    underpants: string;\n    socks: string;\n    shoes: string;\n    restraints: string;\n    cleanliness: string;\n  };\n  currentTask: string;\n  currentThought: string;\n  biggestWorry: string;\n  days: number;\n  stage: string;\n  cellType: string;\n  changes: {\n    health: StatusChange[];\n    mental: StatusChange[];\n    strength: StatusChange[];\n    intelligence: StatusChange[];\n  };\n  accumulated: {\n    health: number;\n    mental: number;\n    strength: number;\n    intelligence: number;\n  };\n  lastUpdate: number;\n  stats: {\n    totalUpdates: number;\n    successfulParses: number;\n    failedParses: number;\n    lastParseTime: number;\n  };\n}\n\ninterface StatusPanelImpl {\n  version: string;\n  state: StatusPanelState;\n  initialize(): void;\n  destroy(): void;\n  getState(): ProtagonistState;\n  modifyValue(key: string, delta: number, reason?: string): void;\n  getTrendAnalysis(): TrendAnalysis;\n  getCurrentStage(): { days: number; stage: string; cellType: string };\n  parseStatusUpdate(jsonStr: string, attempt?: number): boolean;\n  reset(): void;\n  exportData(): { version: string; timestamp: number; state: StatusPanelState };\n  importData(data: { version?: string; state?: StatusPanelState }): boolean;\n}\n\ndeclare global {\n  interface Window {\n    detentionSystem?: DetentionSystem;\n  }\n}\n\ninterface DetentionSystem {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  events: EventEmitter;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n}\n\ninterface EventEmitter {\n  on(event: string, callback: (data?: unknown) => void): void;\n  off(event: string, callback: (data?: unknown) => void): void;\n  emit(event: string, data?: unknown): void;\n}\n\n// ==========  ==========\n\nconst CONFIG: StatusPanelConfig = {\n  updateInterval: 500,\n  animationDuration: 300,\n  trendWindow: 5,\n  slowChangeThreshold: 1.0,\n  regressionRate: 0.005,\n  healthBaseline: 70,\n  mentalBaseline: 65,\n  parseRetryAttempts: 3,\n  parseRetryDelay: 100,\n  debugMode: true,\n};\n\nconst TREND_SYMBOLS = {\n  up: '',\n  down: '',\n  stable: '',\n};\n\nlet state: StatusPanelState = {\n  name: '',\n  age: 0,\n  crime: '',\n  health: 75,\n  mental: 70,\n  strength: 65,\n  intelligence: 70,\n  appearance: {\n    height: 0,\n    weight: 0,\n    hair: '',\n    condition: '',\n  },\n  clothing: {\n    top: '',\n    bottom: '',\n    underwear: '',\n    underpants: '',\n    socks: '',\n    shoes: '',\n    restraints: '',\n    cleanliness: '',\n  },\n  currentTask: '',\n  currentThought: '',\n  biggestWorry: '',\n  days: 0,\n  stage: '',\n  cellType: '',\n  changes: {\n    health: [],\n    mental: [],\n    strength: [],\n    intelligence: [],\n  },\n  accumulated: {\n    health: 0,\n    mental: 0,\n    strength: 0,\n    intelligence: 0,\n  },\n  lastUpdate: Date.now(),\n  stats: {\n    totalUpdates: 0,\n    successfulParses: 0,\n    failedParses: 0,\n    lastParseTime: 0,\n  },\n};\n\nlet skipDisplayUpdate = false;\nlet isUpdating = false;\nlet mutationObserver: MutationObserver | null = null;\nlet updateLoopInterval: ReturnType<typeof setInterval> | null = null;\n\n// ==========  ==========\n\nfunction debugLog(...args: unknown[]): void {\n  if (CONFIG.debugMode) {\n    console.log('[]', ...args);\n  }\n}\n\nfunction formatDuration(ms: number): string {\n  const seconds = Math.floor(ms / 1000);\n  const minutes = Math.floor(seconds / 60);\n  const hours = Math.floor(minutes / 60);\n  const days = Math.floor(hours / 24);\n\n  if (days > 0) return `${days}${hours % 24}`;\n  if (hours > 0) return `${hours}${minutes % 60}`;\n  if (minutes > 0) return `${minutes}${seconds % 60}`;\n  return `${seconds}`;\n}\n\n// ==========  ==========\n\nfunction recordChange(key: keyof typeof state.changes, delta: number): void {\n  if (!state.changes[key]) {\n    state.changes[key] = [];\n  }\n\n  state.changes[key].push({\n    value: delta,\n    timestamp: Date.now(),\n  });\n\n  if (state.changes[key].length > CONFIG.trendWindow) {\n    state.changes[key].shift();\n  }\n\n  debugLog(`: ${key} ${delta > 0 ? '+' : ''}${delta}`);\n}\n\nfunction calculateTrend(key: keyof typeof state.changes): 'up' | 'down' | 'stable' {\n  if (!state.changes[key] || state.changes[key].length === 0) {\n    return 'stable';\n  }\n\n  const sum = state.changes[key].reduce((acc, change) => acc + change.value, 0);\n\n  if (sum > 2) return 'up';\n  if (sum < -2) return 'down';\n  return 'stable';\n}\n\nfunction applyRegression(): void {\n  const healthDelta = (CONFIG.healthBaseline - state.health) * CONFIG.regressionRate;\n  if (Math.abs(healthDelta) > 0.01) {\n    state.accumulated.health += healthDelta;\n    if (Math.abs(state.accumulated.health) >= CONFIG.slowChangeThreshold) {\n      const change = Math.floor(state.accumulated.health);\n      state.health += change;\n      state.accumulated.health -= change;\n      recordChange('health', change);\n      debugLog(`: ${change}`);\n    }\n  }\n\n  const mentalDelta = (CONFIG.mentalBaseline - state.mental) * CONFIG.regressionRate;\n  if (Math.abs(mentalDelta) > 0.01) {\n    state.accumulated.mental += mentalDelta;\n    if (Math.abs(state.accumulated.mental) >= CONFIG.slowChangeThreshold) {\n      const change = Math.floor(state.accumulated.mental);\n      state.mental += change;\n      state.accumulated.mental -= change;\n      recordChange('mental', change);\n      debugLog(`: ${change}`);\n    }\n  }\n}\n\nfunction updateState(data: Partial<ProtagonistState>): void {\n  if (isUpdating) {\n    console.warn('[] ');\n    return;\n  }\n\n  isUpdating = true;\n\n  try {\n    debugLog(':', data);\n\n    state.stats.totalUpdates++;\n\n    if (data.name !== undefined) state.name = data.name;\n    if (data.age !== undefined) state.age = data.age;\n    if (data.crime !== undefined) state.crime = data.crime;\n\n    if (data.health !== undefined) {\n      const delta = data.health - state.health;\n      if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n        state.health = data.health;\n        recordChange('health', delta);\n        debugLog(`: ${state.health} (: ${delta})`);\n      } else {\n        state.accumulated.health += delta;\n        debugLog(`: ${state.accumulated.health}`);\n        if (Math.abs(state.accumulated.health) >= CONFIG.slowChangeThreshold) {\n          const change = Math.floor(state.accumulated.health);\n          state.health += change;\n          state.accumulated.health -= change;\n          recordChange('health', change);\n          debugLog(`: ${state.health} (: ${change})`);\n        }\n      }\n    }\n\n    if (data.mental !== undefined) {\n      const delta = data.mental - state.mental;\n      if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n        state.mental = data.mental;\n        recordChange('mental', delta);\n        debugLog(`: ${state.mental} (: ${delta})`);\n      } else {\n        state.accumulated.mental += delta;\n        debugLog(`: ${state.accumulated.mental}`);\n        if (Math.abs(state.accumulated.mental) >= CONFIG.slowChangeThreshold) {\n          const change = Math.floor(state.accumulated.mental);\n          state.mental += change;\n          state.accumulated.mental -= change;\n          recordChange('mental', change);\n          debugLog(`: ${state.mental} (: ${change})`);\n        }\n      }\n    }\n\n    if (data.strength !== undefined) {\n      const delta = data.strength - state.strength;\n      if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n        state.strength = data.strength;\n        recordChange('strength', delta);\n        debugLog(`: ${state.strength} (: ${delta})`);\n      } else {\n        state.accumulated.strength += delta;\n        debugLog(`: ${state.accumulated.strength}`);\n        if (Math.abs(state.accumulated.strength) >= CONFIG.slowChangeThreshold) {\n          const change = Math.floor(state.accumulated.strength);\n          state.strength += change;\n          state.accumulated.strength -= change;\n          recordChange('strength', change);\n          debugLog(`: ${state.strength} (: ${change})`);\n        }\n      }\n    }\n\n    if (data.intelligence !== undefined) {\n      const delta = data.intelligence - state.intelligence;\n      if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n        state.intelligence = data.intelligence;\n        recordChange('intelligence', delta);\n        debugLog(`: ${state.intelligence} (: ${delta})`);\n      } else {\n        state.accumulated.intelligence += delta;\n        debugLog(`: ${state.accumulated.intelligence}`);\n        if (Math.abs(state.accumulated.intelligence) >= CONFIG.slowChangeThreshold) {\n          const change = Math.floor(state.accumulated.intelligence);\n          state.intelligence += change;\n          state.accumulated.intelligence -= change;\n          recordChange('intelligence', change);\n          debugLog(`: ${state.intelligence} (: ${change})`);\n        }\n      }\n    }\n\n    if (data.appearance) {\n      if (data.appearance.height !== undefined) state.appearance.height = data.appearance.height;\n      if (data.appearance.weight !== undefined) state.appearance.weight = data.appearance.weight;\n      if (data.appearance.hair !== undefined) state.appearance.hair = data.appearance.hair;\n      if (data.appearance.condition !== undefined) state.appearance.condition = data.appearance.condition;\n    }\n\n    if (data.clothing) {\n      if (data.clothing.top !== undefined) state.clothing.top = data.clothing.top;\n      if (data.clothing.bottom !== undefined) state.clothing.bottom = data.clothing.bottom;\n      if (data.clothing.underwear !== undefined) state.clothing.underwear = data.clothing.underwear;\n      if (data.clothing.underpants !== undefined) state.clothing.underpants = data.clothing.underpants;\n      if (data.clothing.socks !== undefined) state.clothing.socks = data.clothing.socks;\n      if (data.clothing.shoes !== undefined) state.clothing.shoes = data.clothing.shoes;\n      if (data.clothing.restraints !== undefined) state.clothing.restraints = data.clothing.restraints;\n      if (data.clothing.cleanliness !== undefined) state.clothing.cleanliness = data.clothing.cleanliness;\n    }\n\n    if (data.currentTask !== undefined) state.currentTask = data.currentTask;\n    if (data.currentThought !== undefined) state.currentThought = data.currentThought;\n    if (data.biggestWorry !== undefined) state.biggestWorry = data.biggestWorry;\n\n    if (data.days !== undefined) state.days = data.days;\n    if (data.stage !== undefined) state.stage = data.stage;\n    if (data.cellType !== undefined) state.cellType = data.cellType;\n\n    state.lastUpdate = Date.now();\n\n    debugLog('');\n\n    updateDisplay();\n  } catch (error) {\n    console.error('[] :', error);\n  } finally {\n    isUpdating = false;\n  }\n}\n\n// ========== HTML ==========\n\nfunction parseCommentNode(node: Node): void {\n  if (!node || node.nodeType !== Node.COMMENT_NODE) {\n    return;\n  }\n\n  try {\n    let content = (node as Comment).nodeValue || (node as Comment).textContent || '';\n    content = content.trim();\n\n    if (!content) {\n      return;\n    }\n\n    debugLog(':', content.substring(0, 100) + (content.length > 100 ? '...' : ''));\n\n    if (content.startsWith('STATUS_UPDATE:')) {\n      const jsonStr = content.substring('STATUS_UPDATE:'.length).trim();\n      debugLog('JSON:', jsonStr.substring(0, 100) + (jsonStr.length > 100 ? '...' : ''));\n      parseStatusUpdate(jsonStr);\n    }\n  } catch (error) {\n    console.error('[] :', error);\n  }\n}\n\nfunction parseStatusUpdate(jsonStr: string, attempt = 1): boolean {\n  try {\n    jsonStr = jsonStr.trim();\n    jsonStr = jsonStr.replace(/,(\\s*[}\\]])/g, '$1');\n    jsonStr = jsonStr.replace(/[\\n\\r\\t]/g, '');\n\n    debugLog(`JSON (${attempt}):`, jsonStr.substring(0, 200) + (jsonStr.length > 200 ? '...' : ''));\n\n    const data = JSON.parse(jsonStr) as Partial<ProtagonistState>;\n    console.log('[]  :', data);\n\n    state.stats.successfulParses++;\n    state.stats.lastParseTime = Date.now();\n\n    updateState(data);\n\n    const DS = window.detentionSystem;\n    if (DS && DS.events) {\n      DS.events.emit('statusUpdated', data);\n    }\n\n    return true;\n  } catch (error) {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    console.error(`[]   ( ${attempt}/${CONFIG.parseRetryAttempts}):`, errorMessage);\n    console.error('[] JSON:', jsonStr);\n\n    state.stats.failedParses++;\n\n    if (attempt < CONFIG.parseRetryAttempts) {\n      console.log(`[]  ${CONFIG.parseRetryDelay}ms ...`);\n      setTimeout(() => {\n        parseStatusUpdate(jsonStr, attempt + 1);\n      }, CONFIG.parseRetryDelay);\n      return false;\n    } else {\n      console.error('[]  ');\n\n      const DS = window.detentionSystem;\n      if (DS && DS.events) {\n        DS.events.emit('parseError', {\n          jsonStr,\n          error: errorMessage,\n          attempts: attempt,\n        });\n      }\n\n      return false;\n    }\n  }\n}\n\nfunction checkForStatusUpdate(element: Element): void {\n  if (!element || element.nodeType !== Node.ELEMENT_NODE) {\n    return;\n  }\n\n  try {\n    const walker = document.createTreeWalker(element, NodeFilter.SHOW_COMMENT, null, false);\n\n    let node: Node | null;\n    let count = 0;\n    while ((node = walker.nextNode())) {\n      count++;\n      parseCommentNode(node);\n    }\n\n    if (count > 0) {\n      debugLog(`TreeWalker  ${count} `);\n    }\n  } catch (error) {\n    console.error('[] TreeWalker :', error);\n  }\n}\n\n// ========== UI ==========\n\nfunction updateElement(id: string, value: string): void {\n  const element = document.getElementById(id);\n  if (element && element.textContent !== value) {\n    element.textContent = value;\n\n    element.classList.remove('updated');\n    setTimeout(() => {\n      element.classList.add('updated');\n    }, 10);\n\n    setTimeout(() => {\n      element.classList.remove('updated');\n    }, 500);\n  }\n}\n\nfunction updateStat(key: 'health' | 'mental' | 'strength' | 'intelligence', value: number): void {\n  value = Math.max(0, Math.min(100, value));\n\n  const valueElement = document.getElementById(`${key}-value`);\n  if (valueElement) {\n    valueElement.textContent = Math.round(value).toString();\n  }\n\n  const barElement = document.getElementById(`${key}-bar`);\n  if (barElement) {\n    barElement.style.width = `${value}%`;\n\n    const statBar = barElement.closest('.stat-bar');\n    if (statBar) {\n      statBar.classList.remove('changed');\n      setTimeout(() => {\n        statBar.classList.add('changed');\n      }, 10);\n\n      setTimeout(() => {\n        statBar.classList.remove('changed');\n      }, 500);\n    }\n  }\n\n  const trend = calculateTrend(key);\n  const trendElement = document.getElementById(`${key}-trend`);\n  if (trendElement) {\n    trendElement.textContent = TREND_SYMBOLS[trend];\n    trendElement.style.color = trend === 'up' ? '#43e97b' : trend === 'down' ? '#f5576c' : '#999';\n  }\n}\n\nfunction updateDisplay(): void {\n  if (skipDisplayUpdate) return;\n\n  try {\n    updateElement('status-name', state.name || '');\n    updateElement('status-age', state.age ? `${state.age}` : '');\n    updateElement('status-crime', state.crime || '');\n    updateElement('status-days', `${state.days}`);\n    updateElement('status-stage', state.stage);\n    updateElement('status-cell', state.cellType);\n\n    updateStat('health', state.health);\n    updateStat('mental', state.mental);\n    updateStat('strength', state.strength);\n    updateStat('intelligence', state.intelligence);\n\n    updateElement('status-height', state.appearance.height ? `${state.appearance.height}cm` : '');\n    updateElement('status-weight', state.appearance.weight ? `${state.appearance.weight}kg` : '');\n    updateElement('status-hair', state.appearance.hair || '');\n    updateElement('status-condition', state.appearance.condition || '');\n\n    updateElement('status-top', state.clothing.top || '');\n    updateElement('status-bottom', state.clothing.bottom || '');\n    updateElement('status-underwear', state.clothing.underwear || '');\n    updateElement('status-underpants', state.clothing.underpants || '');\n    updateElement('status-socks', state.clothing.socks || '');\n    updateElement('status-shoes', state.clothing.shoes || '');\n    updateElement('status-restraints', state.clothing.restraints || '');\n    updateElement('status-cleanliness', state.clothing.cleanliness || '');\n\n    updateElement('status-task', state.currentTask || '');\n    updateElement('status-thought', state.currentThought || '');\n    updateElement('status-worry', state.biggestWorry || '');\n  } catch (error) {\n    console.error('[] :', error);\n  }\n}\n\nfunction addStyles(): void {\n  if (document.getElementById('detention-status-styles')) {\n    return;\n  }\n\n  const style = document.createElement('style');\n  style.id = 'detention-status-styles';\n  style.textContent = `\n    #detention-status-panel {\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      width: 320px;\n      max-height: 90vh;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      border-radius: 12px;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n      z-index: 10000;\n      font-family: 'Microsoft YaHei', 'SimHei', sans-serif;\n      overflow: hidden;\n      backdrop-filter: blur(10px);\n    }\n\n    .status-header {\n      background: rgba(0, 0, 0, 0.2);\n      padding: 12px 16px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .status-header h3 {\n      margin: 0;\n      color: #fff;\n      font-size: 16px;\n      font-weight: 600;\n    }\n\n    .status-header-buttons {\n      display: flex;\n      gap: 8px;\n    }\n\n    .status-toggle, .status-debug-btn {\n      background: rgba(255, 255, 255, 0.2);\n      border: none;\n      color: #fff;\n      width: 28px;\n      height: 28px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 16px;\n      line-height: 1;\n      transition: all 0.3s;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .status-toggle:hover, .status-debug-btn:hover {\n      background: rgba(255, 255, 255, 0.3);\n      transform: scale(1.1);\n    }\n\n    .status-content {\n      max-height: calc(90vh - 60px);\n      overflow-y: auto;\n      padding: 16px;\n    }\n\n    .status-content::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .status-content::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.1);\n      border-radius: 3px;\n    }\n\n    .status-content::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.3);\n      border-radius: 3px;\n    }\n\n    .status-content::-webkit-scrollbar-thumb:hover {\n      background: rgba(255, 255, 255, 0.5);\n    }\n\n    .status-section {\n      background: rgba(255, 255, 255, 0.95);\n      border-radius: 8px;\n      padding: 12px;\n      margin-bottom: 12px;\n    }\n\n    .status-section:last-child {\n      margin-bottom: 0;\n    }\n\n    .status-section h4 {\n      margin: 0 0 10px 0;\n      color: #667eea;\n      font-size: 14px;\n      font-weight: 600;\n      border-bottom: 2px solid #667eea;\n      padding-bottom: 6px;\n    }\n\n    .status-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 6px 0;\n      border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n    }\n\n    .status-item:last-child {\n      border-bottom: none;\n    }\n\n    .status-item.full-width {\n      flex-direction: column;\n      align-items: flex-start;\n    }\n\n    .status-item.full-width .value {\n      width: 100%;\n      margin-top: 4px;\n      padding: 6px;\n      background: rgba(102, 126, 234, 0.1);\n      border-radius: 4px;\n    }\n\n    .status-item .label {\n      color: #666;\n      font-size: 13px;\n      font-weight: 500;\n    }\n\n    .status-item .value {\n      color: #333;\n      font-size: 13px;\n      font-weight: 600;\n      text-align: right;\n    }\n\n    .stat-bar {\n      margin-bottom: 12px;\n    }\n\n    .stat-bar:last-child {\n      margin-bottom: 0;\n    }\n\n    .stat-label {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 6px;\n      font-size: 13px;\n      font-weight: 600;\n      color: #333;\n    }\n\n    .stat-value {\n      color: #667eea;\n      font-size: 14px;\n    }\n\n    .stat-trend {\n      font-size: 16px;\n      margin-left: 4px;\n    }\n\n    .stat-progress {\n      height: 8px;\n      background: rgba(0, 0, 0, 0.1);\n      border-radius: 4px;\n      overflow: hidden;\n    }\n\n    .stat-fill {\n      height: 100%;\n      transition: width 0.3s ease, background-color 0.3s ease;\n      border-radius: 4px;\n    }\n\n    .stat-fill.health {\n      background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);\n    }\n\n    .stat-fill.mental {\n      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);\n    }\n\n    .stat-fill.strength {\n      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);\n    }\n\n    .stat-fill.intelligence {\n      background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);\n    }\n\n    .debug-buttons {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      margin-top: 12px;\n    }\n\n    .debug-btn {\n      background: #667eea;\n      color: white;\n      border: none;\n      padding: 8px 12px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n      transition: all 0.3s;\n    }\n\n    .debug-btn:hover {\n      background: #764ba2;\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n    }\n\n    @keyframes pulse {\n      0%, 100% { transform: scale(1); }\n      50% { transform: scale(1.05); }\n    }\n\n    .stat-bar.changed {\n      animation: pulse 0.5s ease;\n    }\n\n    @keyframes fadeIn {\n      from { opacity: 0; transform: translateY(-10px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    .status-item.updated {\n      animation: fadeIn 0.3s ease;\n    }\n\n    @media (max-width: 768px) {\n      #detention-status-panel {\n        width: 280px;\n        top: 10px;\n        right: 10px;\n      }\n    }\n  `;\n\n  document.head.appendChild(style);\n}\n\nfunction createStatusPanel(): void {\n  if (document.getElementById('detention-status-panel')) {\n    console.log('[] ');\n    return;\n  }\n\n  const panel = document.createElement('div');\n  panel.id = 'detention-status-panel';\n  panel.innerHTML = `\n    <div class=\"status-header\">\n      <h3> </h3>\n      <div class=\"status-header-buttons\">\n        <button class=\"status-debug-btn\" title=\"\"></button>\n        <button class=\"status-toggle\" title=\"/\"></button>\n      </div>\n    </div>\n    <div class=\"status-content\">\n      <div class=\"status-section basic-info\">\n        <h4></h4>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-name\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-age\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-crime\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-days\">0</span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-stage\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-cell\"></span>\n        </div>\n      </div>\n\n      <div class=\"status-section core-stats\">\n        <h4></h4>\n        <div class=\"stat-bar\">\n          <div class=\"stat-label\">\n            <span></span>\n            <span class=\"stat-value\" id=\"health-value\">75</span>\n            <span class=\"stat-trend\" id=\"health-trend\"></span>\n          </div>\n          <div class=\"stat-progress\">\n            <div class=\"stat-fill health\" id=\"health-bar\" style=\"width: 75%\"></div>\n          </div>\n        </div>\n        <div class=\"stat-bar\">\n          <div class=\"stat-label\">\n            <span></span>\n            <span class=\"stat-value\" id=\"mental-value\">70</span>\n            <span class=\"stat-trend\" id=\"mental-trend\"></span>\n          </div>\n          <div class=\"stat-progress\">\n            <div class=\"stat-fill mental\" id=\"mental-bar\" style=\"width: 70%\"></div>\n          </div>\n        </div>\n        <div class=\"stat-bar\">\n          <div class=\"stat-label\">\n            <span></span>\n            <span class=\"stat-value\" id=\"strength-value\">65</span>\n            <span class=\"stat-trend\" id=\"strength-trend\"></span>\n          </div>\n          <div class=\"stat-progress\">\n            <div class=\"stat-fill strength\" id=\"strength-bar\" style=\"width: 65%\"></div>\n          </div>\n        </div>\n        <div class=\"stat-bar\">\n          <div class=\"stat-label\">\n            <span></span>\n            <span class=\"stat-value\" id=\"intelligence-value\">70</span>\n            <span class=\"stat-trend\" id=\"intelligence-trend\"></span>\n          </div>\n          <div class=\"stat-progress\">\n            <div class=\"stat-fill intelligence\" id=\"intelligence-bar\" style=\"width: 70%\"></div>\n          </div>\n        </div>\n      </div>\n\n      <div class=\"status-section appearance-info\">\n        <h4></h4>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-height\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-weight\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-hair\"></span>\n        </div>\n        <div class=\"status-item full-width\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-condition\"></span>\n        </div>\n      </div>\n\n      <div class=\"status-section clothing-info\">\n        <h4></h4>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-top\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-bottom\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-underwear\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-underpants\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-socks\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-shoes\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-restraints\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-cleanliness\"></span>\n        </div>\n      </div>\n\n      <div class=\"status-section psychological-info\">\n        <h4></h4>\n        <div class=\"status-item full-width\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-task\"></span>\n        </div>\n        <div class=\"status-item full-width\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-thought\"></span>\n        </div>\n        <div class=\"status-item full-width\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"status-worry\"></span>\n        </div>\n      </div>\n\n      <div class=\"status-section debug-info\" style=\"display: none;\">\n        <h4></h4>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"debug-total-updates\">0</span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"debug-success-parses\">0</span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"debug-failed-parses\">0</span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"debug-last-update\"></span>\n        </div>\n        <div class=\"status-item\">\n          <span class=\"label\">:</span>\n          <span class=\"value\" id=\"debug-observer-status\"></span>\n        </div>\n        <div class=\"debug-buttons\">\n          <button class=\"debug-btn\" onclick=\"window.detentionSystem?.statusPanel?.debug?.scanAllComments()\"></button>\n          <button class=\"debug-btn\" onclick=\"console.log(window.detentionSystem?.statusPanel?.debug?.getDiagnostics())\"></button>\n          <button class=\"debug-btn\" onclick=\"window.detentionSystem?.statusPanel?.reset()\"></button>\n        </div>\n      </div>\n    </div>\n  `;\n\n  addStyles();\n\n  document.body.appendChild(panel);\n\n  const toggleBtn = panel.querySelector('.status-toggle');\n  const content = panel.querySelector('.status-content') as HTMLElement;\n  if (toggleBtn && content) {\n    toggleBtn.addEventListener('click', () => {\n      const isCollapsed = content.style.display === 'none';\n      content.style.display = isCollapsed ? 'block' : 'none';\n      toggleBtn.textContent = isCollapsed ? '' : '+';\n    });\n  }\n\n  const debugBtn = panel.querySelector('.status-debug-btn');\n  const debugSection = panel.querySelector('.debug-info') as HTMLElement;\n  if (debugBtn && debugSection) {\n    debugBtn.addEventListener('click', () => {\n      const isHidden = debugSection.style.display === 'none';\n      debugSection.style.display = isHidden ? 'block' : 'none';\n      updateDebugInfo();\n    });\n  }\n\n  console.log('[] UI');\n}\n\nfunction updateDebugInfo(): void {\n  updateElement('debug-total-updates', state.stats.totalUpdates.toString());\n  updateElement('debug-success-parses', state.stats.successfulParses.toString());\n  updateElement('debug-failed-parses', state.stats.failedParses.toString());\n\n  const lastUpdate =\n    state.stats.lastParseTime > 0 ? new Date(state.stats.lastParseTime).toLocaleTimeString('zh-CN') : '';\n  updateElement('debug-last-update', lastUpdate);\n\n  const observerStatus = mutationObserver ? '' : '';\n  updateElement('debug-observer-status', observerStatus);\n}\n\n// ==========  ==========\n\nfunction startCommentListener(): void {\n  if (mutationObserver) {\n    mutationObserver.disconnect();\n  }\n\n  console.log('[] HTML...');\n\n  mutationObserver = new MutationObserver(mutations => {\n    for (const mutation of mutations) {\n      if (mutation.type === 'childList') {\n        for (const node of mutation.addedNodes) {\n          if (node.nodeType === Node.COMMENT_NODE) {\n            parseCommentNode(node);\n          } else if (node.nodeType === Node.ELEMENT_NODE) {\n            checkForStatusUpdate(node as Element);\n          }\n        }\n      }\n\n      if (mutation.type === 'characterData') {\n        if (mutation.target.nodeType === Node.COMMENT_NODE) {\n          parseCommentNode(mutation.target);\n        }\n      }\n    }\n  });\n\n  mutationObserver.observe(document.body, {\n    childList: true,\n    subtree: true,\n    characterData: true,\n    characterDataOldValue: false,\n  });\n\n  console.log('[] ...');\n  setTimeout(() => {\n    checkForStatusUpdate(document.body);\n  }, 1000);\n\n  console.log('[] HTML');\n}\n\nfunction stopCommentListener(): void {\n  if (mutationObserver) {\n    mutationObserver.disconnect();\n    mutationObserver = null;\n    console.log('[] HTML');\n  }\n}\n\nfunction startUpdateLoop(): void {\n  if (updateLoopInterval) {\n    clearInterval(updateLoopInterval);\n  }\n\n  updateLoopInterval = setInterval(() => {\n    updateDisplay();\n    applyRegression();\n  }, CONFIG.updateInterval);\n\n  debugLog('');\n}\n\nfunction stopUpdateLoop(): void {\n  if (updateLoopInterval) {\n    clearInterval(updateLoopInterval);\n    updateLoopInterval = null;\n    debugLog('');\n  }\n}\n\n// ========== API ==========\n\nconst StatusPanel: StatusPanelImpl & {\n  state: StatusPanelState;\n  getState(): ProtagonistState;\n} = {\n  version: '3.5.2',\n\n  state,\n\n  initialize() {\n    console.log('[]  v3.5.2');\n\n    createStatusPanel();\n    startUpdateLoop();\n    startCommentListener();\n\n    const DS = window.detentionSystem;\n    if (DS && DS.events) {\n      DS.events.on('stateChanged', (data?: unknown) => {\n        debugLog(':', data);\n        if (data && typeof data === 'object') {\n          updateState(data as Partial<ProtagonistState>);\n        }\n      });\n\n      DS.events.on('dayAdvanced', (data?: unknown) => {\n        debugLog(':', data);\n        if (data && typeof data === 'object') {\n          const d = data as { days?: number; stage?: string; cellType?: string };\n          if (d.days !== undefined) state.days = d.days;\n          if (d.stage !== undefined) state.stage = d.stage;\n          if (d.cellType !== undefined) state.cellType = d.cellType;\n          updateDisplay();\n        }\n      });\n    }\n\n    console.log('[] ');\n    console.log('[] :', CONFIG.debugMode ? '' : '');\n  },\n\n  destroy() {\n    console.log('[] ...');\n\n    stopCommentListener();\n    stopUpdateLoop();\n\n    const panel = document.getElementById('detention-status-panel');\n    if (panel) {\n      panel.remove();\n      console.log('[] UI');\n    }\n\n    const styles = document.getElementById('detention-status-styles');\n    if (styles) {\n      styles.remove();\n      console.log('[] ');\n    }\n\n    const DS = window.detentionSystem;\n    if (DS && DS.events) {\n      DS.events.off('stateChanged', () => {});\n      DS.events.off('dayAdvanced', () => {});\n    }\n\n    console.log('[] ');\n  },\n\n  getState(): ProtagonistState {\n    return {\n      name: state.name,\n      age: state.age,\n      crime: state.crime,\n      health: state.health,\n      mental: state.mental,\n      strength: state.strength,\n      intelligence: state.intelligence,\n      appearance: { ...state.appearance },\n      clothing: { ...state.clothing },\n      currentTask: state.currentTask,\n      currentThought: state.currentThought,\n      biggestWorry: state.biggestWorry,\n      days: state.days,\n      stage: state.stage,\n      cellType: state.cellType,\n    };\n  },\n\n  modifyValue(key: string, delta: number, reason = ''): void {\n    if ((state as Record<string, unknown>)[key] === undefined) {\n      console.error(`[] : ${key}`);\n      return;\n    }\n\n    const oldValue = (state as Record<string, number>)[key];\n    const newValue = Math.max(0, Math.min(100, oldValue + delta));\n\n    if (newValue !== oldValue) {\n      (state as Record<string, number>)[key] = newValue;\n      recordChange(key as keyof typeof state.changes, delta);\n\n      console.log(\n        `[] ${key} : ${oldValue}  ${newValue} (${delta > 0 ? '+' : ''}${delta}) ${reason ? `: ${reason}` : ''}`,\n      );\n\n      const DS = window.detentionSystem;\n      if (DS && DS.events) {\n        DS.events.emit('valueChanged', {\n          key,\n          oldValue,\n          newValue,\n          delta,\n          reason,\n        });\n      }\n\n      updateDisplay();\n    }\n  },\n\n  getTrendAnalysis(): TrendAnalysis {\n    return {\n      health: {\n        value: state.health,\n        trend: calculateTrend('health'),\n        changes: state.changes.health || [],\n      },\n      mental: {\n        value: state.mental,\n        trend: calculateTrend('mental'),\n        changes: state.changes.mental || [],\n      },\n      strength: {\n        value: state.strength,\n        trend: calculateTrend('strength'),\n        changes: state.changes.strength || [],\n      },\n      intelligence: {\n        value: state.intelligence,\n        trend: calculateTrend('intelligence'),\n        changes: state.changes.intelligence || [],\n      },\n    };\n  },\n\n  getCurrentStage() {\n    return {\n      days: state.days,\n      stage: state.stage,\n      cellType: state.cellType,\n    };\n  },\n\n  parseStatusUpdate,\n\n  reset() {\n    state = {\n      name: '',\n      age: 0,\n      crime: '',\n      health: 75,\n      mental: 70,\n      strength: 65,\n      intelligence: 70,\n      appearance: {\n        height: 0,\n        weight: 0,\n        hair: '',\n        condition: '',\n      },\n      clothing: {\n        top: '',\n        bottom: '',\n        underwear: '',\n        underpants: '',\n        socks: '',\n        shoes: '',\n        restraints: '',\n        cleanliness: '',\n      },\n      currentTask: '',\n      currentThought: '',\n      biggestWorry: '',\n      days: 0,\n      stage: '',\n      cellType: '',\n      changes: {\n        health: [],\n        mental: [],\n        strength: [],\n        intelligence: [],\n      },\n      accumulated: {\n        health: 0,\n        mental: 0,\n        strength: 0,\n        intelligence: 0,\n      },\n      lastUpdate: Date.now(),\n      stats: {\n        totalUpdates: 0,\n        successfulParses: 0,\n        failedParses: 0,\n        lastParseTime: 0,\n      },\n    };\n\n    updateDisplay();\n    console.log('[] ');\n  },\n\n  exportData() {\n    return {\n      version: '3.5.2',\n      timestamp: Date.now(),\n      state: JSON.parse(JSON.stringify(state)),\n    };\n  },\n\n  importData(data: { version?: string; state?: StatusPanelState }): boolean {\n    if (!data || !data.state) {\n      console.error('[] ');\n      return false;\n    }\n\n    try {\n      if (data.version && data.version !== '3.5.2') {\n        console.warn(`[] : ${data.version} vs 3.5.2`);\n      }\n\n      state = data.state;\n\n      if (!state.changes) {\n        state.changes = {\n          health: [],\n          mental: [],\n          strength: [],\n          intelligence: [],\n        };\n      }\n\n      if (!state.accumulated) {\n        state.accumulated = {\n          health: 0,\n          mental: 0,\n          strength: 0,\n          intelligence: 0,\n        };\n      }\n\n      if (!state.stats) {\n        state.stats = {\n          totalUpdates: 0,\n          successfulParses: 0,\n          failedParses: 0,\n          lastParseTime: 0,\n        };\n      }\n\n      state.lastUpdate = Date.now();\n\n      updateDisplay();\n      console.log('[] ');\n      return true;\n    } catch (error) {\n      console.error('[] :', error);\n      return false;\n    }\n  },\n};\n\n// ==========  ==========\n\nfunction scanAllComments(): unknown[] {\n  console.log('[] ...');\n\n  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_COMMENT, null, false);\n\n  const comments: Array<{ content: string; fullContent: string; isStatusUpdate: boolean; length: number }> = [];\n  let node: Node | null;\n  while ((node = walker.nextNode())) {\n    const content = ((node as Comment).nodeValue || (node as Comment).textContent || '').trim();\n    comments.push({\n      content: content.substring(0, 100) + (content.length > 100 ? '...' : ''),\n      fullContent: content,\n      isStatusUpdate: content.startsWith('STATUS_UPDATE:'),\n      length: content.length,\n    });\n\n    if (content.startsWith('STATUS_UPDATE:')) {\n      console.log('[]  :', content.substring(0, 100));\n      parseCommentNode(node);\n    }\n  }\n\n  console.log(`[]  ${comments.length} `);\n  console.log('[] :', comments.filter(c => c.isStatusUpdate).length);\n  console.table(comments);\n\n  return comments;\n}\n\nfunction getDiagnostics(): {\n  version: string;\n  timestamp: string;\n  observer: { active: boolean; status: string };\n  state: { lastUpdate: string; timeSinceUpdate: number; timeSinceUpdateFormatted: string };\n  stats: {\n    totalUpdates: number;\n    successfulParses: number;\n    failedParses: number;\n    successRate: string;\n    lastParseTime: string;\n  };\n  currentState: ProtagonistState;\n  config: StatusPanelConfig;\n} {\n  const diagnostics = {\n    version: '3.5.2',\n    timestamp: new Date().toLocaleString('zh-CN'),\n    observer: {\n      active: mutationObserver !== null,\n      status: mutationObserver ? '' : '',\n    },\n    state: {\n      lastUpdate: new Date(state.lastUpdate).toLocaleString('zh-CN'),\n      timeSinceUpdate: Date.now() - state.lastUpdate,\n      timeSinceUpdateFormatted: formatDuration(Date.now() - state.lastUpdate),\n    },\n    stats: {\n      totalUpdates: state.stats.totalUpdates,\n      successfulParses: state.stats.successfulParses,\n      failedParses: state.stats.failedParses,\n      successRate:\n        state.stats.totalUpdates > 0\n          ? `${((state.stats.successfulParses / state.stats.totalUpdates) * 100).toFixed(2)}%`\n          : 'N/A',\n      lastParseTime:\n        state.stats.lastParseTime > 0 ? new Date(state.stats.lastParseTime).toLocaleString('zh-CN') : '',\n    },\n    currentState: StatusPanel.getState(),\n    config: CONFIG,\n  };\n\n  console.log('===  ===');\n  console.log(':', diagnostics.version);\n  console.log(':', diagnostics.timestamp);\n  console.log(':', diagnostics.observer.status);\n  console.log(':', diagnostics.state.lastUpdate);\n  console.log(':', diagnostics.state.timeSinceUpdateFormatted);\n  console.log(':', diagnostics.stats);\n  console.log(':', diagnostics.currentState);\n  console.log('======================');\n\n  return diagnostics;\n}\n\n//  StatusPanel \n(\n  StatusPanel as StatusPanelImpl & {\n    debug?: {\n      scanAllComments: () => unknown[];\n      getDiagnostics: () => ReturnType<typeof getDiagnostics>;\n      parseCommentNode: (node: Node) => void;\n      checkForStatusUpdate: (element: Element) => void;\n    };\n  }\n).debug = {\n  scanAllComments,\n  getDiagnostics,\n  parseCommentNode,\n  checkForStatusUpdate,\n};\n\n// ==========  ==========\n\n$(() => {\n  console.info('[]  v3.5.2');\n\n  const DS = window.detentionSystem;\n  if (!DS) {\n    console.error('[] ');\n    return;\n  }\n\n  // \n  (\n    DS as DetentionSystem & {\n      getState?: () => ProtagonistState;\n      modifyValue?: (key: string, delta: number, reason?: string) => void;\n      getTrendAnalysis?: () => TrendAnalysis;\n      getCurrentStage?: () => { days: number; stage: string; cellType: string };\n      parseStatusUpdate?: (jsonStr: string) => boolean;\n    }\n  ).getState = () => StatusPanel.getState();\n  (DS as DetentionSystem & { modifyValue?: (key: string, delta: number, reason?: string) => void }).modifyValue = (\n    key: string,\n    delta: number,\n    reason?: string,\n  ) => StatusPanel.modifyValue(key, delta, reason);\n  (DS as DetentionSystem & { getTrendAnalysis?: () => TrendAnalysis }).getTrendAnalysis = () =>\n    StatusPanel.getTrendAnalysis();\n  (\n    DS as DetentionSystem & {\n      getCurrentStage?: () => { days: number; stage: string; cellType: string };\n    }\n  ).getCurrentStage = () => StatusPanel.getCurrentStage();\n  (DS as DetentionSystem & { parseStatusUpdate?: (jsonStr: string) => boolean }).parseStatusUpdate = (\n    jsonStr: string,\n  ) => StatusPanel.parseStatusUpdate(jsonStr);\n\n  // \n  DS.registerModule('statusPanel', StatusPanel);\n\n  //  window \n  (window.detentionSystem as DetentionSystem & { statusPanel?: StatusPanelImpl }).statusPanel = StatusPanel;\n\n  // \n  DS.events.on('initialized', () => {\n    console.info('[] ');\n    setTimeout(() => {\n      try {\n        StatusPanel.initialize();\n        console.info('[]  ');\n      } catch (error) {\n        console.error('[]  :', error);\n      }\n    }, 500);\n  });\n\n  // \n  if (DS.initialized) {\n    setTimeout(() => {\n      try {\n        StatusPanel.initialize();\n        console.info('[]  ');\n      } catch (error) {\n        console.error('[]  :', error);\n      }\n    }, 500);\n  }\n\n  console.info('[]  v3.5.2');\n});\n\n// \n$(window).on('pagehide', () => {\n  console.log('[] ...');\n  stopCommentListener();\n  stopUpdateLoop();\n});\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","export {};\n\ntype JQueryStaticLike = typeof globalThis extends { $: infer T } ? T : (selector: any) => any;\ndeclare const $: JQueryStaticLike;\n\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'core.ts:9',\n    message: 'core.ts ',\n    data: {\n      timestamp: Date.now(),\n      windowDetentionSystem: typeof window !== 'undefined' && typeof (window as any).detentionSystem !== 'undefined',\n    },\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'run1',\n    hypothesisId: 'A',\n  }),\n}).catch(() => {});\n// #endregion\n\nconsole.info('[] ...');\n\ntype BudgetStatus = 'critical' | 'warning' | 'normal';\n\ninterface BudgetInfo {\n  used: number;\n  total: number;\n  percentage: string;\n  remaining: number;\n  status: BudgetStatus;\n}\n\ninterface DetentionConfig {\n  tokenBudget: number;\n  fallbackBudget: number;\n  compressionQuality: number;\n  cacheExpiry: number;\n  healthCheckInterval: number;\n  healthCheckTimeout: number;\n}\n\ninterface DetentionErrorInfo {\n  message: string;\n  context: string;\n  timestamp: number;\n  stack?: string;\n}\n\ninterface DetentionState {\n  mode: 'detecting' | 'external' | 'fallback';\n  tokenUsed: number;\n  lastHealthCheck: number;\n  errors: DetentionErrorInfo[];\n}\n\ninterface CacheEntry<T> {\n  value: T;\n  expiry: number | null;\n}\n\ninterface CacheManager {\n  set<T>(key: string, value: T, ttl?: number | null): void;\n  get<T>(key: string): T | null;\n  has(key: string): boolean;\n  delete(key: string): void;\n  clear(): void;\n  cleanup(): void;\n}\n\ninterface EnvironmentInfo {\n  isSillyTavern: boolean;\n  version: string | null;\n  hasHelper: boolean;\n  helperVersion: string | null;\n  hasDataTable: boolean;\n}\n\nclass EventEmitter {\n  private readonly events = new Map<string, Array<(data?: unknown) => void>>();\n\n  on(event: string, callback: (data?: unknown) => void) {\n    if (!this.events.has(event)) {\n      this.events.set(event, []);\n    }\n    this.events.get(event)!.push(callback);\n  }\n\n  off(event: string, callback: (data?: unknown) => void) {\n    const callbacks = this.events.get(event);\n    if (!callbacks) return;\n    const index = callbacks.indexOf(callback);\n    if (index > -1) callbacks.splice(index, 1);\n  }\n\n  emit(event: string, data?: unknown) {\n    const callbacks = this.events.get(event);\n    if (!callbacks) return;\n    callbacks.forEach(cb => {\n      try {\n        cb(data);\n      } catch (error) {\n        console.error(`[]  ${event} :`, error);\n      }\n    });\n  }\n\n  once(event: string, callback: (data?: unknown) => void) {\n    const wrapper = (data?: unknown) => {\n      callback(data);\n      this.off(event, wrapper);\n    };\n    this.on(event, wrapper);\n  }\n}\n\ninterface DetentionSystem {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  config: DetentionConfig;\n  state: DetentionState;\n  events: EventEmitter;\n  CacheManager: CacheManager;\n  EventEmitter: typeof EventEmitter;\n  ping(): boolean;\n  checkTokenBudget(): BudgetInfo;\n  updateTokenUsage(tokens: number): BudgetInfo;\n  compressContent(content: unknown, quality?: number | null): string;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n  handleError(error: unknown, context?: string): void;\n  detectEnvironment(): EnvironmentInfo;\n  initialize(): void;\n}\n\ndeclare global {\n  interface Window {\n    detentionSystem?: DetentionSystem;\n  }\n}\n\nconst cacheStore: Map<string, CacheEntry<unknown>> = new Map();\nlet cacheCleanupTimer: ReturnType<typeof setInterval> | undefined;\n\nfunction createCacheManager(): CacheManager {\n  return {\n    set<T>(key: string, value: T, ttl?: number | null) {\n      const expiry = ttl ? Date.now() + ttl * 1000 : null;\n      cacheStore.set(key, { value, expiry });\n    },\n    get<T>(key: string) {\n      const item = cacheStore.get(key);\n      if (!item) return null;\n      if (item.expiry !== null && Date.now() > item.expiry) {\n        cacheStore.delete(key);\n        return null;\n      }\n      return item.value as T;\n    },\n    has(key: string) {\n      return this.get(key) !== null;\n    },\n    delete(key: string) {\n      cacheStore.delete(key);\n    },\n    clear() {\n      cacheStore.clear();\n    },\n    cleanup() {\n      const now = Date.now();\n      for (const [key, item] of cacheStore.entries()) {\n        if (item.expiry !== null && now > item.expiry) {\n          cacheStore.delete(key);\n        }\n      }\n    },\n  };\n}\n\nfunction normalizeError(error: unknown): Error {\n  if (error instanceof Error) return error;\n  return new Error(typeof error === 'string' ? error : JSON.stringify(error));\n}\n\nfunction bootstrapDetentionSystem(): DetentionSystem {\n  const events = new EventEmitter();\n  const CacheManager = createCacheManager();\n\n  const system: DetentionSystem = {\n    version: '3.2.0',\n    initialized: false,\n    modules: {},\n    config: {\n      tokenBudget: 100000,\n      fallbackBudget: 40000,\n      compressionQuality: 0.8,\n      cacheExpiry: 600000,\n      healthCheckInterval: 500,\n      healthCheckTimeout: 3000,\n    },\n    state: {\n      mode: 'detecting',\n      tokenUsed: 0,\n      lastHealthCheck: 0,\n      errors: [],\n    },\n    events,\n    CacheManager,\n    EventEmitter,\n\n    ping() {\n      system.state.lastHealthCheck = Date.now();\n      return true;\n    },\n\n    checkTokenBudget() {\n      const total = system.state.mode === 'external' ? system.config.tokenBudget : system.config.fallbackBudget;\n      const used = system.state.tokenUsed;\n      const percentage = (used / total) * 100;\n\n      const status: BudgetStatus = percentage > 95 ? 'critical' : percentage > 85 ? 'warning' : 'normal';\n\n      return {\n        used,\n        total,\n        percentage: percentage.toFixed(2),\n        remaining: total - used,\n        status,\n      };\n    },\n\n    updateTokenUsage(tokens: number) {\n      system.state.tokenUsed += tokens;\n      const budget = system.checkTokenBudget();\n\n      if (budget.status === 'warning') {\n        console.warn(`[Token] :  ${budget.percentage}%`);\n        system.events.emit('token_warning', budget);\n      } else if (budget.status === 'critical') {\n        console.error(`[Token] :  ${budget.percentage}%`);\n        system.events.emit('token_critical', budget);\n      }\n\n      return budget;\n    },\n\n    compressContent(content: unknown, quality: number | null = null) {\n      const text = typeof content === 'string' ? content : JSON.stringify(content);\n      const actualQuality = quality ?? system.config.compressionQuality;\n\n      let compressed = text\n        .replace(/\\s+/g, ' ')\n        .replace(/\\n\\s*\\n/g, '\\n')\n        .trim();\n\n      if (actualQuality < 0.9) {\n        compressed = compressed.replace(//g, ',').replace(//g, '.').replace(//g, ';').replace(//g, ':');\n      }\n\n      const originalSize = text.length;\n      const compressedSize = compressed.length;\n      const ratio = ((1 - compressedSize / originalSize) * 100).toFixed(2);\n\n      console.info(`[] : ${originalSize} -> : ${compressedSize} ( ${ratio}%)`);\n\n      return compressed;\n    },\n\n    registerModule(name: string, module: unknown) {\n      if (system.modules[name]) {\n        console.warn(`[]  ${name} `);\n      }\n      system.modules[name] = module;\n      console.info(`[]  ${name} `);\n      system.events.emit('module_registered', { name, module });\n    },\n\n    getModule<T = unknown>(name: string) {\n      return system.modules[name] as T | undefined;\n    },\n\n    handleError(error: unknown, context: string = 'unknown') {\n      const normalized = normalizeError(error);\n      const errorInfo: DetentionErrorInfo = {\n        message: normalized.message,\n        context,\n        timestamp: Date.now(),\n        stack: normalized.stack,\n      };\n\n      system.state.errors.push(errorInfo);\n      console.error(`[]  [${context}]:`, normalized);\n      system.events.emit('error', errorInfo);\n\n      if (system.state.errors.length > 100) {\n        system.state.errors.shift();\n      }\n    },\n\n    detectEnvironment() {\n      const env: EnvironmentInfo = {\n        isSillyTavern: false,\n        version: null,\n        hasHelper: false,\n        helperVersion: null,\n        hasDataTable: false,\n      };\n\n      const isSillyTavernAvailable = typeof SillyTavern !== 'undefined';\n      if (isSillyTavernAvailable || $('#send_textarea').length > 0) {\n        env.isSillyTavern = true;\n        if (typeof getTavernVersion === 'function') {\n          env.version = getTavernVersion() ?? null;\n        }\n      }\n\n      if (typeof getTavernHelperVersion === 'function') {\n        env.hasHelper = true;\n        env.helperVersion = getTavernHelperVersion() ?? null;\n      }\n\n      const windowWithTable = window as typeof window & {\n        insertRow?: unknown;\n        updateRow?: unknown;\n      };\n      if (typeof windowWithTable.insertRow === 'function' && typeof windowWithTable.updateRow === 'function') {\n        env.hasDataTable = true;\n      }\n\n      return env;\n    },\n\n    initialize() {\n      if (system.initialized) {\n        console.warn('[] ');\n        return;\n      }\n\n      console.info('[] ...');\n\n      const env = system.detectEnvironment();\n      console.info('[] :', env);\n\n      if (!env.isSillyTavern) {\n        console.warn('[] SillyTavern');\n      }\n\n      system.state.mode = 'external';\n      system.initialized = true;\n\n      console.info('[] ');\n      console.info(`[] : ${system.version}`);\n      console.info(`[] : ${system.state.mode}`);\n      console.info(`[] Token: ${system.config.tokenBudget}`);\n\n      system.events.emit('initialized', { env, state: system.state });\n    },\n  };\n\n  return system;\n}\n\nfunction ensureCacheCleanup(system: DetentionSystem) {\n  if (!cacheCleanupTimer) {\n    cacheCleanupTimer = setInterval(() => system.CacheManager.cleanup(), 60000);\n  }\n}\n\nfunction stopCacheCleanup() {\n  if (cacheCleanupTimer) {\n    clearInterval(cacheCleanupTimer);\n    cacheCleanupTimer = undefined;\n  }\n}\n\n// \nif (!window.detentionSystem) {\n  window.detentionSystem = bootstrapDetentionSystem();\n  console.info('[] ');\n  console.info('[] window.detentionSystem :', typeof window.detentionSystem);\n  console.info('[] window.detentionSystem :', window.detentionSystem);\n}\n\n$(() => {\n  console.info('[] jQuery ready');\n\n  // \n  if (!window.detentionSystem) {\n    console.warn('[]  jQuery ready ');\n    window.detentionSystem = bootstrapDetentionSystem();\n    console.info('[] jQuery ready ');\n  }\n\n  const system = window.detentionSystem!;\n  console.info('[] :', {\n    exists: !!system,\n    version: system.version,\n    initialized: system.initialized,\n  });\n\n  ensureCacheCleanup(system);\n\n  setTimeout(() => {\n    try {\n      system.initialize();\n    } catch (error) {\n      system.handleError(error, 'initialize');\n    }\n  }, 1000);\n});\n\n$(window).on('pagehide', () => {\n  stopCacheCleanup();\n});\n\nconsole.info('[] ');\nconsole.info('[]  window.detentionSystem:', {\n  exists: typeof window.detentionSystem !== 'undefined',\n  type: typeof window.detentionSystem,\n  value: window.detentionSystem ? 'object' : 'undefined',\n});\nconsole.info('[]  window.detentionSystem:', {\n  exists: typeof window.detentionSystem !== 'undefined',\n  type: typeof window.detentionSystem,\n  value: window.detentionSystem ? 'object' : 'undefined',\n});\n","export {};\n\n/**\n * \n *  registerModule \n */\n\ntype EventPriority = 1 | 2 | 3 | 4;\n\ntype Stage =\n  | 'detention'\n  | 'approval'\n  | 'investigation'\n  | 'prosecution'\n  | 'trial1'\n  | 'firstVerdict'\n  | 'appeal'\n  | 'trial2'\n  | 'finalVerdict'\n  | 'transfer'\n  | 'execution'\n  | 'deathReview'\n  | 'end';\n\ninterface EventBus {\n  on(event: string, callback: (data?: unknown) => void): void;\n  emit(event: string, data?: unknown): void;\n}\n\ninterface EventSystemExports {\n  generateRandomEvent?: (context?: unknown) => EventRecord | null;\n  advanceDay?: (days?: number) => unknown;\n  getCurrentStage?: () => unknown;\n  checkCellTransfer?: () => boolean;\n  setCaseComplexity?: (complexity: 'simple' | 'normal' | 'complex' | 'very_complex') => void;\n  rollbackToStage?: (stage: Stage, reason?: string) => boolean;\n  setDeathPenalty?: (flag: boolean) => void;\n  getEventStatistics?: () => unknown;\n  exportTimeline?: () => unknown;\n  importTimeline?: (data: unknown) => boolean;\n}\n\ninterface DetentionSystem extends EventSystemExports {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  config: Record<string, unknown>;\n  state: Record<string, unknown>;\n  events: EventBus;\n  CacheManager: unknown;\n  EventEmitter: unknown;\n  ping(): boolean;\n  checkTokenBudget(): unknown;\n  updateTokenUsage(tokens: number): unknown;\n  compressContent(content: unknown, quality?: number | null): string;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n  handleError(error: unknown, context?: string): void;\n  detectEnvironment(): unknown;\n  initialize(): void;\n}\n\ninterface ProtagonistState {\n  health: number;\n  mental: number;\n  strength?: number;\n  intelligence?: number;\n}\n\ninterface Timeline {\n  arrestDay: number;\n  approvalDay: number | null;\n  prosecutionDay: number | null;\n  firstTrialDay: number | null;\n  firstVerdictDay: number | null;\n  secondTrialDay: number | null;\n  finalVerdictDay: number | null;\n  transferDay: number | null;\n  executionDay: number | null;\n}\n\ninterface EventRecord {\n  id: string;\n  name: string;\n  type?: string;\n  category?: string;\n  description?: string;\n  priority?: EventPriority;\n  day?: number;\n  stage?: Stage;\n  isEnding?: boolean;\n  endingType?: 'prison' | 'death';\n  aiControlled?: boolean;\n  text?: string;\n  from?: string;\n  to?: string;\n  reason?: string;\n}\n\ndeclare global {\n  interface Window {\n    chat?: Array<{ mes?: string }>;\n  }\n}\n\ninterface EventSystemImpl {\n  currentDay: number;\n  lastEventDay: number;\n  eventHistory: EventRecord[];\n  legalTimeline: Timeline;\n  currentStage: Stage;\n  cellType: string;\n  caseComplexity: 'simple' | 'normal' | 'complex' | 'very_complex';\n  complexityMultiplier: number;\n  eventCounters: Record<string, number>;\n  isDeathPenalty: boolean;\n  lastStageChangeDay: number;\n  readonly PRIORITY: {\n    readonly LEGAL: 1;\n    readonly CONDITION: 2;\n    readonly RANDOM: 3;\n    readonly DAILY: 4;\n  };\n  legalEvents: Record<string, unknown>;\n  conditionEvents: Array<any>;\n  randomEvents: Record<string, Array<{ id: string; name: string; weight: number }>>;\n  innerMonologues: Array<{ id: string; text: string; weight: number }>;\n  initialize(this: EventSystemImpl, startDay?: number): void;\n  setCaseComplexity(this: EventSystemImpl, complexity: 'simple' | 'normal' | 'complex' | 'very_complex'): void;\n  checkComplexityAdjustment(this: EventSystemImpl): void;\n  rollbackToStage(this: EventSystemImpl, targetStage: Stage, reason?: string): boolean;\n  handleUserRollback(this: EventSystemImpl, input: string): boolean;\n  advanceDay(\n    this: EventSystemImpl,\n    days?: number,\n  ): { interrupted: boolean; currentDay: number; event?: EventRecord; accumulatedEvents: EventRecord[] };\n  checkDayEvents(this: EventSystemImpl): EventRecord;\n  checkLegalEvent(this: EventSystemImpl): EventRecord | null;\n  checkConditionEvent(this: EventSystemImpl): EventRecord | null;\n  generateRandomEvent(this: EventSystemImpl): EventRecord | null;\n  generateInnerMonologue(this: EventSystemImpl): EventRecord | null;\n  weightedRandom(this: EventSystemImpl, count: number, weights: number[]): number;\n  getProtagonistState(this: EventSystemImpl): ProtagonistState;\n  getRecentContext(this: EventSystemImpl): string;\n  checkCellTransfer(this: EventSystemImpl): boolean;\n  setDeathPenalty(this: EventSystemImpl, isDeathPenalty: boolean): void;\n  getCurrentStageInfo(this: EventSystemImpl): unknown;\n  getEventStatistics(this: EventSystemImpl): unknown;\n  exportTimeline(this: EventSystemImpl): unknown;\n  importTimeline(this: EventSystemImpl, data: any): boolean;\n}\n\nconsole.info('[] ...');\n\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'event_system.ts:151',\n    message: '',\n    data: { hasDetentionSystem: !!window.detentionSystem, detentionSystemType: typeof window.detentionSystem },\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'run1',\n    hypothesisId: 'A',\n  }),\n}).catch(() => {});\n// #endregion\n\nconst DS = window.detentionSystem as (DetentionSystem & EventSystemExports) | undefined;\nif (!DS) {\n  console.error('[] ');\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'event_system.ts:156',\n      message: '',\n      data: { windowKeys: Object.keys(window).filter(k => k.includes('detention') || k.includes('Detention')) },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'run1',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n  // #endregion\n} else {\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'event_system.ts:160',\n      message: '',\n      data: {\n        version: DS.version,\n        initialized: DS.initialized,\n        hasEvents: !!DS.events,\n        moduleCount: Object.keys(DS.modules || {}).length,\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'run1',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n  // #endregion\n  // ----------------  ----------------\n  const EventSystem: EventSystemImpl = {\n    currentDay: 0,\n    lastEventDay: 0,\n    eventHistory: [] as EventRecord[],\n    legalTimeline: {\n      arrestDay: 0,\n      approvalDay: null,\n      prosecutionDay: null,\n      firstTrialDay: null,\n      firstVerdictDay: null,\n      secondTrialDay: null,\n      finalVerdictDay: null,\n      transferDay: null,\n      executionDay: null,\n    } as Timeline,\n    currentStage: 'detention' as Stage,\n    cellType: 'transition',\n\n    // \n    caseComplexity: 'normal' as 'simple' | 'normal' | 'complex' | 'very_complex',\n    complexityMultiplier: 1.0,\n\n    // \n    eventCounters: {\n      interrogation: 0,\n      lawyerVisit: 0,\n      familyVisit: 0,\n      medicalVisit: 0,\n      sceneIdentification: 0,\n    } as Record<string, number>,\n\n    // \n    isDeathPenalty: false,\n\n    // \n    lastStageChangeDay: 0,\n\n    // \n    PRIORITY: {\n      LEGAL: 1,\n      CONDITION: 2,\n      RANDOM: 3,\n      DAILY: 4,\n    } as const,\n\n    // \n    legalEvents: {\n      approval: {\n        name: '',\n        minDay: 30,\n        maxDay: 37,\n        stage: 'approval',\n        description: '',\n        nextStage: 'investigation',\n      },\n      investigation: {\n        name: '',\n        duration: [60, 210],\n        stage: 'investigation',\n        description: '',\n        nextStage: 'prosecution',\n      },\n      prosecution: {\n        name: '',\n        duration: [30, 45],\n        stage: 'prosecution',\n        description: '',\n        nextStage: 'trial1',\n      },\n      firstTrial: {\n        name: '',\n        duration: [30, 45],\n        stage: 'trial1',\n        description: '',\n        nextStage: 'firstVerdict',\n      },\n      firstVerdict: {\n        name: '',\n        duration: [7, 30],\n        stage: 'firstVerdict',\n        description: '',\n        nextStage: 'appeal',\n      },\n      appeal: {\n        name: '',\n        duration: [10, 10],\n        stage: 'appeal',\n        description: '10',\n        nextStage: 'trial2',\n      },\n      secondTrial: {\n        name: '',\n        duration: [60, 90],\n        stage: 'trial2',\n        description: '',\n        nextStage: 'finalVerdict',\n      },\n      finalVerdict: {\n        name: '',\n        duration: [7, 14],\n        stage: 'finalVerdict',\n        description: '',\n        nextStage: 'transfer',\n      },\n      transfer: {\n        name: '',\n        duration: [30, 90],\n        stage: 'transfer',\n        description: '',\n        nextStage: 'end',\n      },\n      deathReview: {\n        name: '',\n        duration: [180, 720],\n        stage: 'deathReview',\n        description: '',\n        nextStage: 'execution',\n      },\n      execution: {\n        name: '',\n        duration: [1, 7],\n        stage: 'execution',\n        description: '',\n        nextStage: 'end',\n      },\n    },\n\n    // \n    conditionEvents: [\n      {\n        id: 'mental_breakdown',\n        name: '',\n        condition: (state: ProtagonistState) => state.mental < 20,\n        weight: 100,\n        description: '',\n        checkAlways: true,\n      },\n      {\n        id: 'health_crisis',\n        name: '',\n        condition: (state: ProtagonistState) => state.health < 30,\n        weight: 100,\n        description: '',\n        checkAlways: true,\n      },\n      {\n        id: 'major_twist',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentDay !== system.lastStageChangeDay) return false;\n          return Math.random() < 0.15;\n        },\n        weight: 100,\n        description: '',\n        stageChangeOnly: true,\n      },\n      {\n        id: 'evidence_reversal',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentDay !== system.lastStageChangeDay) return false;\n          return Math.random() < 0.1;\n        },\n        weight: 100,\n        description: '',\n        stageChangeOnly: true,\n      },\n      {\n        id: 'interrogation',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentStage !== 'investigation') return false;\n\n          const daysSinceApproval = system.legalTimeline.approvalDay\n            ? system.currentDay - system.legalTimeline.approvalDay\n            : 0;\n\n          let baseProbability = 0.15;\n\n          if (daysSinceApproval < 30) {\n            baseProbability = 0.25;\n          } else if (daysSinceApproval < 60) {\n            baseProbability = 0.15;\n          } else {\n            baseProbability = 0.08;\n          }\n\n          const decayFactor = Math.pow(0.7, system.eventCounters.interrogation);\n          const finalProbability = baseProbability * decayFactor;\n\n          return Math.random() < finalProbability;\n        },\n        weight: 100,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'lawyer_visit',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          let baseProbability = 0.03;\n\n          const daysInCustody = system.currentDay - system.legalTimeline.arrestDay;\n          if (daysInCustody <= 14) {\n            baseProbability = 0.15;\n          }\n\n          if (system.legalTimeline.firstTrialDay) {\n            const daysToTrial = system.legalTimeline.firstTrialDay - system.currentDay;\n            if (daysToTrial > 0 && daysToTrial <= 7) {\n              baseProbability = 0.3;\n            }\n          }\n\n          if (system.legalTimeline.secondTrialDay) {\n            const daysToTrial2 = system.legalTimeline.secondTrialDay - system.currentDay;\n            if (daysToTrial2 > 0 && daysToTrial2 <= 7) {\n              baseProbability = 0.25;\n            }\n          }\n\n          return Math.random() < baseProbability;\n        },\n        weight: 90,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'family_visit',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (!system.legalTimeline.firstVerdictDay) return false;\n\n          let baseProbability = 0.05;\n\n          if (system.isDeathPenalty) {\n            baseProbability = 0.1;\n          }\n\n          const lastVisit = system.eventHistory\n            .filter(e => e.id === 'family_visit')\n            .sort((a, b) => (b.day ?? 0) - (a.day ?? 0))[0];\n\n          if (lastVisit && system.currentDay - (lastVisit.day ?? 0) < 30) {\n            return false;\n          }\n\n          return Math.random() < baseProbability;\n        },\n        weight: 85,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'medical_visit',\n        name: '',\n        condition: (state: ProtagonistState, system: typeof EventSystem) => {\n          if (state.health >= 25) return false;\n\n          let probability = 0;\n          if (state.health < 10) {\n            probability = 0.4;\n          } else if (state.health < 15) {\n            probability = 0.25;\n          } else if (state.health < 20) {\n            probability = 0.15;\n          } else {\n            probability = 0.08;\n          }\n\n          const lastMedical = system.eventHistory\n            .filter(e => e.id === 'medical_visit')\n            .sort((a, b) => (b.day ?? 0) - (a.day ?? 0))[0];\n\n          if (lastMedical && system.currentDay - (lastMedical.day ?? 0) < 7) {\n            return false;\n          }\n\n          return Math.random() < probability;\n        },\n        weight: 95,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'scene_identification',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentStage !== 'investigation') return false;\n          if (system.eventCounters.sceneIdentification > 0) return false;\n\n          const daysSinceApproval = system.legalTimeline.approvalDay\n            ? system.currentDay - system.legalTimeline.approvalDay\n            : 0;\n\n          if (daysSinceApproval < 15 || daysSinceApproval > 120) {\n            return false;\n          }\n\n          const baseProbability = 0.08;\n\n          const recentContext = system.getRecentContext ? system.getRecentContext() : '';\n          const keywords = ['', '', '', '', ''];\n          const hasKeyword = keywords.some(kw => recentContext.includes(kw));\n\n          const finalProbability = hasKeyword ? baseProbability * 3 : baseProbability;\n\n          return Math.random() < finalProbability;\n        },\n        weight: 80,\n        description: '',\n        category: 'procedural',\n        aiControlled: true,\n      },\n    ],\n\n    // \n    randomEvents: {\n      violence: [\n        { id: 'newcomer_bullying', name: '', weight: 30 },\n        { id: 'bed_dispute', name: '', weight: 25 },\n        { id: 'food_robbery', name: '', weight: 20 },\n        { id: 'faction_conflict', name: '', weight: 15 },\n        { id: 'revenge', name: '', weight: 10 },\n      ],\n      medical: [\n        { id: 'epidemic', name: '', weight: 15 },\n        { id: 'mental_illness', name: '', weight: 25 },\n        { id: 'chronic_disease', name: '', weight: 20 },\n        { id: 'injury', name: '', weight: 20 },\n        { id: 'gynecological', name: '', weight: 10 },\n        { id: 'malnutrition', name: '', weight: 10 },\n      ],\n      emotional: [\n        { id: 'deep_friendship', name: '', weight: 20 },\n        { id: 'betrayal', name: '', weight: 15 },\n        { id: 'motherly_bond', name: '', weight: 15 },\n        { id: 'jealousy', name: '', weight: 20 },\n        { id: 'secret_sharing', name: '', weight: 15 },\n        { id: 'collective_exclusion', name: '', weight: 10 },\n        { id: 'romance', name: '', weight: 5 },\n      ],\n      accident: [\n        { id: 'facility_failure', name: '', weight: 25 },\n        { id: 'safety_incident', name: '', weight: 20 },\n        { id: 'external_news', name: '', weight: 30 },\n        { id: 'extreme_weather', name: '', weight: 15 },\n        { id: 'management_change', name: '', weight: 10 },\n      ],\n    },\n\n    // \n    innerMonologues: [\n      { id: 'worry_about_family', text: '...', weight: 20 },\n      { id: 'regret_past', text: '...', weight: 20 },\n      { id: 'fear_future', text: '...', weight: 18 },\n      { id: 'miss_freedom', text: '...', weight: 15 },\n      { id: 'self_reflection', text: '...', weight: 12 },\n      { id: 'hope_for_leniency', text: '...', weight: 10 },\n      { id: 'worry_about_children', text: '...', weight: 15 },\n      { id: 'fear_of_inmates', text: '...', weight: 12 },\n      { id: 'loneliness', text: '...', weight: 15 },\n      { id: 'time_perception', text: '...', weight: 10 },\n      { id: 'dream_of_past', text: '...', weight: 12 },\n      { id: 'worry_about_health', text: '...', weight: 10 },\n      { id: 'guilt', text: '...', weight: 8 },\n      { id: 'anger', text: '...', weight: 8 },\n      { id: 'acceptance', text: '...', weight: 7 },\n      { id: 'hope_for_appeal', text: '...', weight: 8 },\n      { id: 'fear_of_death', text: '...', weight: 5 },\n      { id: 'nostalgia', text: '...', weight: 10 },\n    ],\n\n    // \n    initialize(startDay = 0) {\n      this.currentDay = startDay;\n      this.legalTimeline.arrestDay = startDay;\n      this.currentStage = 'detention';\n      this.cellType = 'transition';\n      this.caseComplexity = 'normal';\n      this.complexityMultiplier = 1.0;\n      this.isDeathPenalty = false;\n      this.lastStageChangeDay = startDay;\n      this.lastEventDay = startDay;\n\n      for (const key of Object.keys(this.eventCounters)) {\n        this.eventCounters[key] = 0;\n      }\n\n      console.info('[] ');\n      console.info(`[] : ${startDay}`);\n\n      DS.events.emit('event_system_initialized', {\n        day: this.currentDay,\n        stage: this.currentStage,\n      });\n    },\n\n    setCaseComplexity(complexity: 'simple' | 'normal' | 'complex' | 'very_complex') {\n      const validComplexities: Record<string, number> = {\n        simple: 0.8,\n        normal: 1.0,\n        complex: 1.3,\n        very_complex: 1.6,\n      };\n\n      if (complexity in validComplexities) {\n        this.caseComplexity = complexity;\n        this.complexityMultiplier = validComplexities[complexity];\n\n        console.info(`[] : ${complexity} (: ${this.complexityMultiplier})`);\n\n        DS.events.emit('complexity_changed', {\n          complexity: this.caseComplexity,\n          multiplier: this.complexityMultiplier,\n        });\n      } else {\n        console.warn(`[] : ${complexity}`);\n      }\n    },\n\n    checkComplexityAdjustment() {\n      if (this.currentDay % 30 !== 0) return;\n\n      DS.events.emit('request_complexity_assessment', {\n        day: this.currentDay,\n        stage: this.currentStage,\n        eventHistory: this.eventHistory,\n      });\n    },\n\n    rollbackToStage(targetStage: Stage, reason = '') {\n      console.info(`[] : ${this.currentStage} -> ${targetStage}`);\n      console.info(`[] : ${reason}`);\n\n      const stageOrder: Stage[] = [\n        'detention',\n        'approval',\n        'investigation',\n        'prosecution',\n        'trial1',\n        'firstVerdict',\n        'appeal',\n        'trial2',\n        'finalVerdict',\n        'transfer',\n        'execution',\n      ];\n\n      const targetIndex = stageOrder.indexOf(targetStage);\n      const currentIndex = stageOrder.indexOf(this.currentStage);\n\n      if (targetIndex === -1 || targetIndex >= currentIndex) {\n        console.warn('[] ');\n        return false;\n      }\n\n      const timelineKeys: Partial<Record<Stage, keyof Timeline>> = {\n        approval: 'approvalDay',\n        investigation: 'approvalDay',\n        prosecution: 'prosecutionDay',\n        trial1: 'firstTrialDay',\n        firstVerdict: 'firstVerdictDay',\n        appeal: 'firstVerdictDay',\n        trial2: 'secondTrialDay',\n        finalVerdict: 'finalVerdictDay',\n        transfer: 'transferDay',\n        execution: 'executionDay',\n      };\n\n      for (let i = targetIndex + 1; i < stageOrder.length; i++) {\n        const stage = stageOrder[i];\n        const key = timelineKeys[stage];\n        if (key && this.legalTimeline[key]) {\n          this.legalTimeline[key] = null as never;\n        }\n      }\n\n      this.currentStage = targetStage;\n\n      if (targetIndex <= stageOrder.indexOf('investigation')) {\n        this.cellType = 'pretrial';\n      }\n\n      this.eventHistory.push({\n        id: 'procedure_rollback',\n        name: '',\n        type: 'legal',\n        day: this.currentDay,\n        from: stageOrder[currentIndex],\n        to: targetStage,\n        reason,\n      });\n\n      DS.events.emit('procedure_rollback', {\n        from: stageOrder[currentIndex],\n        to: targetStage,\n        reason,\n        day: this.currentDay,\n      });\n\n      return true;\n    },\n\n    handleUserRollback(input: string) {\n      const rollbackPatterns = [\n        { pattern: /.*?.*?(|||)/, stage: null as Stage | null },\n        { pattern: /.*?(|)/, stage: null as Stage | null },\n        { pattern: /.*?(|)/, stage: null as Stage | null },\n      ];\n\n      for (const rule of rollbackPatterns) {\n        const match = input.match(rule.pattern);\n        if (match) {\n          let targetStage: Stage | null = null;\n\n          if (match[1].includes('')) {\n            targetStage = 'investigation';\n          } else if (match[1].includes('')) {\n            targetStage = 'prosecution';\n          } else if (match[1].includes('')) {\n            targetStage = 'trial1';\n          } else if (match[1].includes('')) {\n            targetStage = 'trial2';\n          }\n\n          if (targetStage) {\n            return this.rollbackToStage(targetStage, '');\n          }\n        }\n      }\n\n      return false;\n    },\n\n    advanceDay(days = 1) {\n      const events: EventRecord[] = [];\n\n      for (let i = 0; i < days; i++) {\n        this.currentDay++;\n        this.lastEventDay = this.currentDay;\n\n        this.checkComplexityAdjustment();\n\n        const dayEvent = this.checkDayEvents();\n\n        if (dayEvent) {\n          events.push(dayEvent);\n\n          this.eventHistory.push({\n            ...dayEvent,\n            day: this.currentDay,\n          });\n\n          if (Object.prototype.hasOwnProperty.call(this.eventCounters, dayEvent.id)) {\n            this.eventCounters[dayEvent.id] = (this.eventCounters[dayEvent.id] || 0) + 1;\n          }\n\n          if ((dayEvent.priority ?? this.PRIORITY.DAILY) <= this.PRIORITY.RANDOM) {\n            console.info(`[] ${this.currentDay}: ${dayEvent.name}`);\n            DS.events.emit('event_triggered', dayEvent);\n            return {\n              interrupted: true,\n              currentDay: this.currentDay,\n              event: dayEvent,\n              accumulatedEvents: events,\n            };\n          }\n        }\n      }\n\n      return {\n        interrupted: false,\n        currentDay: this.currentDay,\n        accumulatedEvents: events,\n      };\n    },\n\n    checkDayEvents(): EventRecord {\n      const legalEvent = this.checkLegalEvent();\n      if (legalEvent) {\n        return {\n          ...legalEvent,\n          priority: this.PRIORITY.LEGAL,\n          day: this.currentDay,\n        };\n      }\n\n      const conditionEvent = this.checkConditionEvent();\n      if (conditionEvent) {\n        return {\n          ...conditionEvent,\n          priority: this.PRIORITY.CONDITION,\n          day: this.currentDay,\n        };\n      }\n\n      if (Math.random() < 0.1) {\n        const randomEvent = this.generateRandomEvent();\n        if (randomEvent) {\n          return {\n            ...randomEvent,\n            priority: this.PRIORITY.RANDOM,\n            day: this.currentDay,\n          };\n        }\n      }\n\n      if (Math.random() < 0.15) {\n        const monologue = this.generateInnerMonologue();\n        if (monologue) {\n          return {\n            ...monologue,\n            priority: this.PRIORITY.DAILY,\n            day: this.currentDay,\n          };\n        }\n      }\n\n      return {\n        id: 'daily_routine',\n        name: '',\n        type: 'daily',\n        priority: this.PRIORITY.DAILY,\n        day: this.currentDay,\n        description: '',\n      };\n    },\n\n    checkLegalEvent(): EventRecord | null {\n      const daysInCustody = this.currentDay - this.legalTimeline.arrestDay;\n      const stageBefore = this.currentStage;\n\n      if (!this.legalTimeline.approvalDay) {\n        const minDays = Math.floor(30 * this.complexityMultiplier);\n        const maxDays = Math.floor(37 * this.complexityMultiplier);\n\n        if (daysInCustody >= minDays && daysInCustody <= maxDays) {\n          if (Math.random() < 0.3) {\n            this.legalTimeline.approvalDay = this.currentDay;\n            this.currentStage = 'investigation';\n            this.lastStageChangeDay = this.currentDay;\n            return {\n              id: 'approval',\n              name: '',\n              type: 'legal',\n              stage: 'approval',\n              description: '',\n              from: stageBefore,\n              to: 'investigation',\n            };\n          }\n        }\n      }\n\n      if (this.legalTimeline.approvalDay && !this.legalTimeline.prosecutionDay) {\n        const daysSinceApproval = this.currentDay - this.legalTimeline.approvalDay;\n        const minDays = Math.floor(60 * this.complexityMultiplier);\n        const maxDays = Math.floor(210 * this.complexityMultiplier);\n\n        if (daysSinceApproval >= minDays && daysSinceApproval <= maxDays && Math.random() < 0.02) {\n          this.legalTimeline.prosecutionDay = this.currentDay;\n          this.currentStage = 'prosecution';\n          this.lastStageChangeDay = this.currentDay;\n          return {\n            id: 'prosecution',\n            name: '',\n            type: 'legal',\n            stage: 'prosecution',\n            description: '',\n            from: stageBefore,\n            to: 'prosecution',\n          };\n        }\n      }\n\n      if (this.legalTimeline.prosecutionDay && !this.legalTimeline.firstTrialDay) {\n        const daysSinceProsecution = this.currentDay - this.legalTimeline.prosecutionDay;\n        const minDays = Math.floor(30 * this.complexityMultiplier);\n        const maxDays = Math.floor(45 * this.complexityMultiplier);\n\n        if (daysSinceProsecution >= minDays && daysSinceProsecution <= maxDays && Math.random() < 0.05) {\n          this.legalTimeline.firstTrialDay = this.currentDay;\n          this.currentStage = 'trial1';\n          this.lastStageChangeDay = this.currentDay;\n\n          if (this.cellType === 'transition') {\n            this.cellType = 'pretrial';\n            DS.events.emit('cell_transfer', {\n              from: 'transition',\n              to: 'pretrial',\n              reason: '',\n            });\n          }\n\n          return {\n            id: 'first_trial',\n            name: '',\n            type: 'legal',\n            stage: 'trial1',\n            description: '',\n            from: stageBefore,\n            to: 'trial1',\n          };\n        }\n      }\n\n      if (this.legalTimeline.firstTrialDay && !this.legalTimeline.firstVerdictDay) {\n        const daysSinceTrial = this.currentDay - this.legalTimeline.firstTrialDay;\n        const minDays = Math.floor(7 * this.complexityMultiplier);\n        const maxDays = Math.floor(30 * this.complexityMultiplier);\n\n        if (daysSinceTrial >= minDays && daysSinceTrial <= maxDays && Math.random() < 0.1) {\n          this.legalTimeline.firstVerdictDay = this.currentDay;\n          this.currentStage = 'appeal';\n          this.lastStageChangeDay = this.currentDay;\n\n          this.cellType = 'convicted';\n          DS.events.emit('cell_transfer', {\n            from: 'pretrial',\n            to: 'convicted',\n            reason: '',\n          });\n\n          return {\n            id: 'first_verdict',\n            name: '',\n            type: 'legal',\n            stage: 'firstVerdict',\n            description: '',\n            from: stageBefore,\n            to: 'appeal',\n          };\n        }\n      }\n\n      if (\n        this.legalTimeline.firstVerdictDay &&\n        !this.legalTimeline.secondTrialDay &&\n        !this.legalTimeline.finalVerdictDay\n      ) {\n        const daysSinceVerdict = this.currentDay - this.legalTimeline.firstVerdictDay;\n\n        if (daysSinceVerdict === 10) {\n          if (Math.random() < 0.7) {\n            this.legalTimeline.secondTrialDay = this.currentDay;\n            this.currentStage = 'trial2';\n            this.lastStageChangeDay = this.currentDay;\n\n            return {\n              id: 'appeal_filed',\n              name: '',\n              type: 'legal',\n              stage: 'appeal',\n              description: '',\n              from: stageBefore,\n              to: 'trial2',\n            };\n          } else {\n            this.legalTimeline.finalVerdictDay = this.currentDay;\n            this.currentStage = 'transfer';\n            this.lastStageChangeDay = this.currentDay;\n\n            return {\n              id: 'verdict_final',\n              name: '',\n              type: 'legal',\n              stage: 'finalVerdict',\n              description: '',\n              from: stageBefore,\n              to: 'transfer',\n            };\n          }\n        }\n      }\n\n      if (this.legalTimeline.secondTrialDay && !this.legalTimeline.finalVerdictDay) {\n        const daysSinceAppeal = this.currentDay - this.legalTimeline.secondTrialDay;\n        const minDays = Math.floor(60 * this.complexityMultiplier);\n        const maxDays = Math.floor(90 * this.complexityMultiplier);\n\n        if (daysSinceAppeal >= minDays && daysSinceAppeal <= maxDays && Math.random() < 0.03) {\n          this.legalTimeline.finalVerdictDay = this.currentDay;\n          this.currentStage = 'transfer';\n          this.lastStageChangeDay = this.currentDay;\n\n          return {\n            id: 'final_verdict',\n            name: '',\n            type: 'legal',\n            stage: 'finalVerdict',\n            description: '',\n            from: stageBefore,\n            to: 'transfer',\n          };\n        }\n      }\n\n      if (this.legalTimeline.finalVerdictDay && !this.legalTimeline.transferDay && !this.isDeathPenalty) {\n        const daysSinceVerdict = this.currentDay - this.legalTimeline.finalVerdictDay;\n        const minDays = Math.floor(30 * this.complexityMultiplier);\n        const maxDays = Math.floor(90 * this.complexityMultiplier);\n\n        if (daysSinceVerdict >= minDays && daysSinceVerdict <= maxDays && Math.random() < 0.02) {\n          this.legalTimeline.transferDay = this.currentDay;\n          this.currentStage = 'end';\n          this.lastStageChangeDay = this.currentDay;\n\n          return {\n            id: 'transfer_prison',\n            name: '',\n            type: 'legal',\n            stage: 'transfer',\n            description: '',\n            isEnding: true,\n            endingType: 'prison',\n            from: stageBefore,\n            to: 'end',\n          };\n        }\n      }\n\n      if (this.legalTimeline.finalVerdictDay && this.isDeathPenalty && !this.legalTimeline.executionDay) {\n        const daysSinceVerdict = this.currentDay - this.legalTimeline.finalVerdictDay;\n        const minDays = 180;\n        const maxDays = 720;\n\n        if (daysSinceVerdict >= minDays && daysSinceVerdict <= maxDays && Math.random() < 0.005) {\n          this.legalTimeline.executionDay = this.currentDay + 7;\n          this.currentStage = 'execution';\n          this.lastStageChangeDay = this.currentDay;\n\n          return {\n            id: 'death_review_approved',\n            name: '',\n            type: 'legal',\n            stage: 'deathReview',\n            description: '7',\n            from: stageBefore,\n            to: 'execution',\n          };\n        }\n      }\n\n      if (this.legalTimeline.executionDay && this.currentDay >= this.legalTimeline.executionDay) {\n        this.currentStage = 'end';\n        this.lastStageChangeDay = this.currentDay;\n\n        return {\n          id: 'execution',\n          name: '',\n          type: 'legal',\n          stage: 'execution',\n          description: '',\n          isEnding: true,\n          endingType: 'death',\n          from: stageBefore,\n          to: 'end',\n        };\n      }\n\n      return null;\n    },\n\n    checkConditionEvent(): EventRecord | null {\n      const state = this.getProtagonistState();\n\n      for (const event of this.conditionEvents) {\n        if (event.stageChangeOnly && this.currentDay !== this.lastStageChangeDay) {\n          continue;\n        }\n\n        if (event.checkAlways || !event.stageChangeOnly) {\n          if (event.condition(state, this)) {\n            if (Math.random() * 100 < event.weight) {\n              return {\n                id: event.id,\n                name: event.name,\n                type: event.category || 'condition',\n                description: event.description,\n                aiControlled: event.aiControlled || false,\n              };\n            }\n          }\n        }\n      }\n\n      return null;\n    },\n\n    generateRandomEvent(): EventRecord | null {\n      const types = ['violence', 'medical', 'emotional', 'accident'] as const;\n      const weights = [25, 30, 30, 15];\n\n      const typeIndex = this.weightedRandom(types.length, weights);\n      const eventType = types[typeIndex];\n      const eventList = this.randomEvents[eventType];\n\n      const eventWeights = eventList.map(e => e.weight);\n      const eventIndex = this.weightedRandom(eventList.length, eventWeights);\n      const event = eventList[eventIndex];\n\n      return {\n        id: event.id,\n        name: event.name,\n        type: eventType,\n        category: 'random',\n        description: `: ${event.name}`,\n      };\n    },\n\n    generateInnerMonologue(): EventRecord | null {\n      const weights = this.innerMonologues.map(m => m.weight);\n      const index = this.weightedRandom(this.innerMonologues.length, weights);\n      const monologue = this.innerMonologues[index];\n\n      return {\n        id: monologue.id,\n        name: '',\n        type: 'monologue',\n        category: 'daily',\n        description: monologue.text,\n        text: monologue.text,\n      };\n    },\n\n    weightedRandom(count: number, weights: number[]): number {\n      const totalWeight = weights.reduce((sum, w) => sum + w, 0);\n      let random = Math.random() * totalWeight;\n\n      for (let i = 0; i < count; i++) {\n        random -= weights[i];\n        if (random <= 0) {\n          return i;\n        }\n      }\n\n      return count - 1;\n    },\n\n    getProtagonistState(): ProtagonistState {\n      const statusPanel = DS.getModule<{ getState?: () => ProtagonistState }>('statusPanel');\n      if (statusPanel && statusPanel.getState) {\n        return statusPanel.getState();\n      }\n\n      return {\n        health: 80,\n        mental: 70,\n        strength: 60,\n        intelligence: 70,\n      };\n    },\n\n    getRecentContext(): string {\n      if (Array.isArray(window.chat)) {\n        const recentMessages = window.chat.slice(-5);\n        return recentMessages.map(m => m.mes || '').join(' ');\n      }\n      return '';\n    },\n\n    checkCellTransfer() {\n      const daysInCustody = this.currentDay - this.legalTimeline.arrestDay;\n\n      if (this.cellType === 'transition' && daysInCustody >= 7 && daysInCustody <= 14) {\n        if (Math.random() < 0.2) {\n          this.cellType = 'pretrial';\n          DS.events.emit('cell_transfer', {\n            from: 'transition',\n            to: 'pretrial',\n            reason: '',\n            day: this.currentDay,\n          });\n          return true;\n        }\n      }\n\n      return false;\n    },\n\n    setDeathPenalty(isDeathPenalty: boolean) {\n      this.isDeathPenalty = isDeathPenalty;\n      console.info(`[] : ${isDeathPenalty}`);\n\n      DS.events.emit('death_penalty_status_changed', {\n        isDeathPenalty: this.isDeathPenalty,\n        day: this.currentDay,\n      });\n    },\n\n    getCurrentStageInfo() {\n      return {\n        day: this.currentDay,\n        stage: this.currentStage,\n        cellType: this.cellType,\n        daysInCustody: this.currentDay - this.legalTimeline.arrestDay,\n        timeline: { ...this.legalTimeline },\n        complexity: this.caseComplexity,\n        complexityMultiplier: this.complexityMultiplier,\n        isDeathPenalty: this.isDeathPenalty,\n        eventCounters: { ...this.eventCounters },\n      };\n    },\n\n    getEventStatistics() {\n      const stats: {\n        totalEvents: number;\n        byType: Record<string, number>;\n        byPriority: Record<number, number>;\n        recentEvents: EventRecord[];\n      } = {\n        totalEvents: this.eventHistory.length,\n        byType: {},\n        byPriority: {},\n        recentEvents: this.eventHistory.slice(-10),\n      };\n\n      this.eventHistory.forEach((event: EventRecord) => {\n        const type = event.type || 'unknown';\n        stats.byType[type] = (stats.byType[type] || 0) + 1;\n\n        const priority = event.priority || 4;\n        stats.byPriority[priority] = (stats.byPriority[priority] || 0) + 1;\n      });\n\n      return stats;\n    },\n\n    exportTimeline() {\n      return {\n        currentDay: this.currentDay,\n        currentStage: this.currentStage,\n        cellType: this.cellType,\n        timeline: { ...this.legalTimeline },\n        complexity: this.caseComplexity,\n        isDeathPenalty: this.isDeathPenalty,\n        eventCounters: { ...this.eventCounters },\n        eventHistory: [...this.eventHistory],\n        lastStageChangeDay: this.lastStageChangeDay,\n      };\n    },\n\n    importTimeline(data: any) {\n      if (!data) return false;\n\n      try {\n        this.currentDay = data.currentDay || 0;\n        this.currentStage = (data.currentStage as Stage) || 'detention';\n        this.cellType = data.cellType || 'transition';\n        this.legalTimeline = (data.timeline as Timeline) || ({} as Timeline);\n        this.caseComplexity = data.complexity || 'normal';\n        this.isDeathPenalty = Boolean(data.isDeathPenalty);\n        this.eventCounters = data.eventCounters || {};\n        this.eventHistory = data.eventHistory || [];\n        this.lastStageChangeDay = data.lastStageChangeDay || 0;\n\n        console.info('[] ');\n        return true;\n      } catch (error) {\n        console.error('[] :', error);\n        return false;\n      }\n    },\n  };\n\n  // \n  DS.generateRandomEvent = (_context?: unknown) => EventSystem.generateRandomEvent();\n  DS.advanceDay = (days?: number) => EventSystem.advanceDay(days);\n  DS.getCurrentStage = () => EventSystem.getCurrentStageInfo();\n  DS.checkCellTransfer = () => EventSystem.checkCellTransfer();\n  DS.setCaseComplexity = (complexity: 'simple' | 'normal' | 'complex' | 'very_complex') =>\n    EventSystem.setCaseComplexity(complexity);\n  DS.rollbackToStage = (stage: Stage, reason?: string) => EventSystem.rollbackToStage(stage, reason);\n  DS.setDeathPenalty = (isDeathPenalty: boolean) => EventSystem.setDeathPenalty(isDeathPenalty);\n  DS.getEventStatistics = () => EventSystem.getEventStatistics();\n  DS.exportTimeline = () => EventSystem.exportTimeline();\n  DS.importTimeline = (data: unknown) => EventSystem.importTimeline(data);\n\n  DS.registerModule('eventSystem', EventSystem);\n\n  // \n  DS.events.on('user_input', (data?: unknown) => {\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'event_system.ts:1236',\n        message: '',\n        data: {\n          hasData: !!data,\n          dataType: typeof data,\n          textLength:\n            typeof (data as { text?: unknown } | undefined)?.text === 'string'\n              ? (data as { text?: string }).text?.length\n              : 0,\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'run1',\n        hypothesisId: 'E',\n      }),\n    }).catch(() => {});\n    // #endregion\n    const text =\n      typeof (data as { text?: unknown } | undefined)?.text === 'string' ? (data as { text?: string }).text : undefined;\n    if (text) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:1242',\n          message: '',\n          data: { text: text.substring(0, 50) },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'E',\n        }),\n      }).catch(() => {});\n      // #endregion\n      EventSystem.handleUserRollback(text);\n    }\n  });\n\n  // \n  DS.events.on('initialized', () => {\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'event_system.ts:1246',\n        message: '',\n        data: { currentDay: EventSystem.currentDay, currentStage: EventSystem.currentStage },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'run1',\n        hypothesisId: 'B',\n      }),\n    }).catch(() => {});\n    // #endregion\n    try {\n      EventSystem.initialize(0);\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:1250',\n          message: '',\n          data: { currentDay: EventSystem.currentDay, currentStage: EventSystem.currentStage },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'B',\n        }),\n      }).catch(() => {});\n      // #endregion\n    } catch (error) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:1254',\n          message: '',\n          data: {\n            error: error instanceof Error ? error.message : String(error),\n            stack: error instanceof Error ? error.stack : undefined,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'B',\n        }),\n      }).catch(() => {});\n      // #endregion\n      console.error('[] :', error);\n    }\n  });\n\n  console.info('[]  v3.4.0');\n}\n","export {};\n\n/**\n * NPC  NPC////\n *  registerModule \n */\n\ntype NPCGender = 'female' | 'male';\ntype NPCStatus = 'active' | 'removed';\ntype NPCRelationship = {\n  toProtagonist: number;\n  faction: string | null;\n  allies: string[];\n  enemies: string[];\n  influence: number;\n};\ntype NPCTraits = {\n  aggression: number;\n  sociability: number;\n  intelligence: number;\n  emotional: number;\n  dominance: number;\n  kindness: number;\n};\ntype NPCPersonality = { traits: NPCTraits; tags: string[] };\ntype NPCAppearance = {\n  height: number;\n  weight: number;\n  hair: string;\n  eyes: string;\n  skin: string;\n  features: string;\n};\ntype NPCBackground = {\n  education: string;\n  maritalStatus: string;\n  hasChildren: boolean;\n  childrenCount: number;\n  hometown: string;\n  priorConvictions: number;\n};\n\ntype NPCBase = {\n  id: string;\n  name: string;\n  gender: NPCGender;\n  age: number;\n  crime: string;\n  sentence: number;\n  appearance: NPCAppearance;\n  personality: NPCPersonality;\n  background: NPCBackground;\n  relationship: NPCRelationship;\n  cellType: string;\n  daysInCustody: number;\n  status: NPCStatus;\n  createdAt: number;\n};\n\ntype NPCPolice = {\n  role: 'police';\n  rank: string;\n  attitude: number;\n};\n\ntype NPCLawyer = {\n  role: 'lawyer';\n  type: string;\n  experience: number;\n  successRate: number;\n};\n\ntype NPCDoctor = {\n  role: 'doctor';\n  specialty: string;\n  experience: number;\n};\n\ntype NPCFamily = {\n  role: 'family';\n  relation: string;\n  supportLevel: number;\n};\n\ntype NPCSpecial = NPCPolice | NPCLawyer | NPCDoctor | NPCFamily;\ntype NPC = NPCBase & Partial<NPCSpecial>;\n\ntype EventTriggeredPayload = { id?: string };\ntype CellTransferPayload = { to?: string };\n\ninterface EventSystemModule {\n  getCurrentStageInfo?: () => { cellType?: string };\n}\n\ninterface DetentionSystem {\n  events: { on(event: string, callback: (data?: unknown) => void): void; emit(event: string, data?: unknown): void };\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n}\n\ntype DetentionSystemWithNPC = DetentionSystem & {\n  generateNPC?: (count?: number, context?: Record<string, unknown>) => NPC[];\n  generateNPCForEvent?: (eventType: string) => NPC | { police: NPC; witnesses: NPC[] };\n  getCurrentCellNPCs?: () => NPC[];\n  setCurrentCellNPCs?: (npcs: NPC[]) => void;\n  addNPCToCell?: (npc: NPC) => void;\n  removeNPCFromCell?: (npcId: string) => NPC | null;\n  findNPC?: (npcId: string) => NPC | undefined;\n  updateNPCRelationship?: (npcId: string, delta: number) => void;\n  exportNPCData?: () => { database: NPC[]; currentCell: NPC[] };\n  importNPCData?: (data: { database?: NPC[]; currentCell?: NPC[] } | undefined) => boolean;\n};\n\ndeclare global {\n  interface DetentionSystem {\n    generateNPC?: (count?: number, context?: Record<string, unknown>) => NPC[];\n    generateNPCForEvent?: (eventType: string) => NPC | { police: NPC; witnesses: NPC[] };\n    getCurrentCellNPCs?: () => NPC[];\n    setCurrentCellNPCs?: (npcs: NPC[]) => void;\n    addNPCToCell?: (npc: NPC) => void;\n    removeNPCFromCell?: (npcId: string) => NPC | null;\n    findNPC?: (npcId: string) => NPC | undefined;\n    updateNPCRelationship?: (npcId: string, delta: number) => void;\n    exportNPCData?: () => { database: NPC[]; currentCell: NPC[] };\n    importNPCData?: (data: { database?: NPC[]; currentCell?: NPC[] } | undefined) => boolean;\n  }\n}\n\nconst DS = window.detentionSystem as DetentionSystemWithNPC | undefined;\n\nif (!DS) {\n  console.error('[NPC] ');\n} else {\n  console.info('[NPC] ...');\n\n  // ==========  ==========\n  const NameGenerator = {\n    surnames: {\n      tier1: {\n        names: ['', '', '', '', '', '', '', '', '', ''],\n        weight: 35,\n      },\n      tier2: {\n        names: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        weight: 30,\n      },\n      tier3: {\n        names: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        weight: 20,\n      },\n      tier4: {\n        names: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        weight: 10,\n      },\n      tier5: {\n        names: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n        weight: 5,\n      },\n    },\n    givenNames: {\n      vintage: {\n        single: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n        double: [\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n        ],\n        weight: 25,\n      },\n      classic: {\n        single: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n        double: [\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n        ],\n        weight: 35,\n      },\n      modern: {\n        single: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        double: [\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n        ],\n        weight: 30,\n      },\n      contemporary: {\n        single: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n        double: [\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n          ['', ''],\n        ],\n        weight: 10,\n      },\n    },\n    badNames: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    badChars: ['', '', '', '', '', '', '', '', '', '', '', ''],\n\n    generate(birthYear: number): string {\n      let attempts = 0;\n      const maxAttempts = 50;\n      while (attempts < maxAttempts) {\n        attempts++;\n        const surname = this.selectSurname();\n        const givenName = this.selectGivenName(birthYear);\n        const fullName = surname + givenName;\n        if (this.isValidName(fullName)) return fullName;\n      }\n      return '' + this.givenNames.classic.single[0];\n    },\n\n    selectSurname(): string {\n      const tiers = Object.values(this.surnames);\n      const totalWeight = tiers.reduce((sum, tier) => sum + tier.weight, 0);\n      let random = Math.random() * totalWeight;\n      for (const tier of tiers) {\n        random -= tier.weight;\n        if (random <= 0) {\n          return tier.names[Math.floor(Math.random() * tier.names.length)];\n        }\n      }\n      return this.surnames.tier1.names[0];\n    },\n\n    selectGivenName(birthYear: number): string {\n      const currentYear = new Date().getFullYear();\n      const age = currentYear - birthYear;\n      const style = age >= 50 ? 'vintage' : age >= 35 ? 'classic' : age >= 20 ? 'modern' : 'contemporary';\n      const styleData = this.givenNames[style as keyof typeof this.givenNames];\n      const useDouble = Math.random() < 0.6;\n      if (useDouble && styleData.double.length > 0) {\n        const pair = styleData.double[Math.floor(Math.random() * styleData.double.length)];\n        return pair[0] + pair[1];\n      }\n      return styleData.single[Math.floor(Math.random() * styleData.single.length)];\n    },\n\n    isValidName(name: string): boolean {\n      if (this.badNames.includes(name)) return false;\n      return !this.badChars.some(char => name.includes(char));\n    },\n  };\n\n  // ==========  ==========\n  const CrimeGenerator = {\n    characterBookCrimes: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    crimes: {\n      violent: {\n        names: ['', '', '', '', '', ''],\n        weight: 12,\n        sentenceRange: [3, 20] as [number, number],\n      },\n      property: {\n        names: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        weight: 35,\n        sentenceRange: [1, 15] as [number, number],\n      },\n      drug: {\n        names: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        weight: 20,\n        sentenceRange: [3, 15] as [number, number],\n      },\n      economic: {\n        names: ['', '', '', '', '', '', ''],\n        weight: 15,\n        sentenceRange: [2, 10] as [number, number],\n      },\n      social: {\n        names: [\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n          '',\n        ],\n        weight: 13,\n        sentenceRange: [1, 7] as [number, number],\n      },\n      other: {\n        names: ['', '', '', '', '', ''],\n        weight: 5,\n        sentenceRange: [1, 5] as [number, number],\n      },\n    },\n\n    generate(): { crime: string; sentence: number; category: { sentenceRange: [number, number] } } {\n      if (Math.random() < 0.3) {\n        const crime = this.characterBookCrimes[Math.floor(Math.random() * this.characterBookCrimes.length)];\n        const category = this.findCategoryByCrime(crime);\n        const sentence = this.generateSentence(category ? category.sentenceRange : [1, 10]);\n        return { crime, sentence, category: category || this.crimes.property };\n      }\n\n      const categories = Object.values(this.crimes);\n      const totalWeight = categories.reduce((sum, cat) => sum + cat.weight, 0);\n      let random = Math.random() * totalWeight;\n      for (const category of categories) {\n        random -= category.weight;\n        if (random <= 0) {\n          const crime = category.names[Math.floor(Math.random() * category.names.length)];\n          const sentence = this.generateSentence(category.sentenceRange);\n          return { crime, sentence, category };\n        }\n      }\n\n      return { crime: '', sentence: 3, category: this.crimes.property };\n    },\n\n    findCategoryByCrime(crimeName: string) {\n      for (const key of Object.keys(this.crimes)) {\n        const category = this.crimes[key as keyof typeof this.crimes];\n        if (category.names.includes(crimeName)) return category;\n      }\n      return null;\n    },\n\n    generateSentence(range: [number, number]): number {\n      const [min, max] = range;\n      return Math.floor(Math.random() * (max - min + 1)) + min;\n    },\n  };\n\n  // ========== NPC ==========\n  const NPCGenerator = {\n    npcDatabase: [] as NPC[],\n    currentCellNPCs: [] as NPC[],\n\n    generate(count = 1, context: Record<string, unknown> = {}): NPC[] {\n      const npcs: NPC[] = [];\n      for (let i = 0; i < count; i++) {\n        const npc = this.generateSingle(context);\n        npcs.push(npc);\n        this.npcDatabase.push(npc);\n      }\n      return npcs;\n    },\n\n    generateSingle(context: Record<string, unknown> = {}): NPC {\n      const eventSystem = DS.getModule<EventSystemModule>('eventSystem');\n      const stageInfo = eventSystem?.getCurrentStageInfo ? eventSystem.getCurrentStageInfo() : {};\n\n      const age = this.generateAge();\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const crimeData = CrimeGenerator.generate();\n      const appearance = this.generateAppearance(age);\n      const personality = this.generatePersonality();\n      const background = this.generateBackground(age, crimeData);\n      const relationship = this.generateRelationship();\n\n      const cellType =\n        typeof stageInfo?.cellType === 'string' ? stageInfo.cellType : (context.cellType as string) || 'transition';\n      this.adjustByCellType(personality, relationship, cellType);\n\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: 'female',\n        age,\n        crime: crimeData.crime,\n        sentence: crimeData.sentence,\n        appearance,\n        personality,\n        background,\n        relationship,\n        cellType,\n        daysInCustody: Math.floor(Math.random() * 365) + 30,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateAge(): number {\n      const random = Math.random();\n      if (random < 0.05) return Math.floor(Math.random() * 3) + 18;\n      if (random < 0.25) return Math.floor(Math.random() * 10) + 21;\n      if (random < 0.55) return Math.floor(Math.random() * 10) + 31;\n      if (random < 0.8) return Math.floor(Math.random() * 10) + 41;\n      if (random < 0.95) return Math.floor(Math.random() * 10) + 51;\n      return Math.floor(Math.random() * 15) + 61;\n    },\n\n    generateAppearance(age: number): NPCAppearance {\n      const heights = [150, 155, 160, 165, 170, 175];\n      const weights = [45, 50, 55, 60, 65, 70, 75];\n      const height = heights[Math.floor(Math.random() * heights.length)];\n      const weight = weights[Math.floor(Math.random() * weights.length)];\n      const hairStyles =\n        age > 50\n          ? ['', '', '', '']\n          : ['', '', '', '', '', '', ''];\n      const skinTones = ['', '', '', '', ''];\n      const features = ['', '', '', '', '', '', ''];\n      return {\n        height,\n        weight,\n        hair: hairStyles[Math.floor(Math.random() * hairStyles.length)],\n        eyes: '',\n        skin: skinTones[Math.floor(Math.random() * skinTones.length)],\n        features: features[Math.floor(Math.random() * features.length)],\n      };\n    },\n\n    generatePersonality(): NPCPersonality {\n      const traits: NPCTraits = {\n        aggression: Math.floor(Math.random() * 100),\n        sociability: Math.floor(Math.random() * 100),\n        intelligence: Math.floor(Math.random() * 100),\n        emotional: Math.floor(Math.random() * 100),\n        dominance: Math.floor(Math.random() * 100),\n        kindness: Math.floor(Math.random() * 100),\n      };\n      const tags: string[] = [];\n      if (traits.aggression > 70) tags.push('');\n      if (traits.sociability > 70) tags.push('');\n      if (traits.intelligence > 70) tags.push('');\n      if (traits.emotional > 70) tags.push('');\n      if (traits.dominance > 70) tags.push('');\n      if (traits.kindness > 70) tags.push('');\n      if (traits.aggression < 30) tags.push('');\n      if (traits.sociability < 30) tags.push('');\n      if (traits.emotional < 30) tags.push('');\n      if (traits.dominance < 30) tags.push('');\n      return { traits, tags };\n    },\n\n    generateBackground(\n      age: number,\n      _crimeData: { crime: string; sentence: number; category: { sentenceRange: [number, number] } },\n    ): NPCBackground {\n      const educations = ['', '', '', '', '', '', ''];\n      const educationWeights = [10, 25, 30, 15, 10, 8, 2];\n      const educationIndex = this.weightedRandom(educations.length, educationWeights);\n      const maritalStatuses = ['', '', '', ''];\n      const maritalWeights = age < 25 ? [80, 15, 5, 0] : age < 40 ? [20, 60, 15, 5] : [10, 50, 30, 10];\n      const maritalIndex = this.weightedRandom(maritalStatuses.length, maritalWeights);\n      const hasChildren = maritalStatuses[maritalIndex] !== '' && Math.random() < 0.7;\n      const childrenCount = hasChildren ? Math.floor(Math.random() * 3) + 1 : 0;\n      return {\n        education: educations[educationIndex],\n        maritalStatus: maritalStatuses[maritalIndex],\n        hasChildren,\n        childrenCount,\n        hometown: this.generateHometown(),\n        priorConvictions: Math.random() < 0.3 ? Math.floor(Math.random() * 3) + 1 : 0,\n      };\n    },\n\n    generateHometown(): string {\n      const provinces = [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ];\n      return provinces[Math.floor(Math.random() * provinces.length)];\n    },\n\n    generateRelationship(): NPCRelationship {\n      return {\n        toProtagonist: 50,\n        faction: null,\n        allies: [],\n        enemies: [],\n        influence: Math.floor(Math.random() * 100),\n      };\n    },\n\n    adjustByCellType(personality: NPCPersonality, relationship: NPCRelationship, cellType: string) {\n      if (cellType === 'transition') {\n        personality.traits.emotional += 10;\n        relationship.influence -= 20;\n      } else if (cellType === 'pretrial') {\n        personality.traits.emotional += 15;\n        personality.traits.aggression += 5;\n      } else if (cellType === 'convicted') {\n        personality.traits.emotional -= 10;\n        personality.traits.aggression += 10;\n        relationship.influence += 10;\n      }\n      (Object.keys(personality.traits) as Array<keyof NPCTraits>).forEach(key => {\n        personality.traits[key] = Math.max(0, Math.min(100, personality.traits[key]));\n      });\n      relationship.influence = Math.max(0, Math.min(100, relationship.influence));\n    },\n\n    weightedRandom(count: number, weights: number[]): number {\n      const totalWeight = weights.reduce((sum, w) => sum + w, 0);\n      let random = Math.random() * totalWeight;\n      for (let i = 0; i < count; i++) {\n        random -= weights[i];\n        if (random <= 0) return i;\n      }\n      return count - 1;\n    },\n\n    generateId(): string {\n      return 'npc_' + Date.now() + '_' + Math.random().toString(36).slice(2, 11);\n    },\n\n    generateForEvent(eventType: string): NPC | { police: NPC; witnesses: NPC[] } {\n      if (eventType === 'interrogation') return this.generatePolice();\n      if (eventType === 'lawyer_visit') return this.generateLawyer();\n      if (eventType === 'family_visit') return this.generateFamily();\n      if (eventType === 'medical_visit') return this.generateDoctor();\n      if (eventType === 'scene_identification') {\n        return { police: this.generatePolice(), witnesses: this.generate(2, { type: 'witness' }) };\n      }\n      return this.generateSingle({ eventType });\n    },\n\n    generatePolice(): NPC {\n      const age = Math.floor(Math.random() * 20) + 25;\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const ranks = ['', '', '', ''];\n      const rank = ranks[Math.floor(Math.random() * ranks.length)];\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: 'female',\n        age,\n        role: 'police',\n        rank,\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 30) + 40,\n            sociability: Math.floor(Math.random() * 40) + 30,\n            intelligence: Math.floor(Math.random() * 30) + 50,\n            emotional: Math.floor(Math.random() * 40) + 20,\n            dominance: Math.floor(Math.random() * 30) + 60,\n            kindness: Math.floor(Math.random() * 60) + 20,\n          },\n          tags: ['', ''],\n        },\n        attitude: Math.floor(Math.random() * 40) + 30,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'staff',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateLawyer(): NPC {\n      const age = Math.floor(Math.random() * 25) + 28;\n      const birthYear = new Date().getFullYear() - age;\n      const isFemale = Math.random() < 0.8;\n      const name = NameGenerator.generate(birthYear);\n      const types = ['', '', ''];\n      const typeWeights = [50, 40, 10];\n      const typeIndex = this.weightedRandom(types.length, typeWeights);\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: isFemale ? 'female' : 'male',\n        age,\n        role: 'lawyer',\n        type: types[typeIndex],\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 20) + 20,\n            sociability: Math.floor(Math.random() * 30) + 60,\n            intelligence: Math.floor(Math.random() * 20) + 70,\n            emotional: Math.floor(Math.random() * 40) + 30,\n            dominance: Math.floor(Math.random() * 40) + 40,\n            kindness: Math.floor(Math.random() * 40) + 40,\n          },\n          tags: ['', ''],\n        },\n        experience: Math.floor(Math.random() * 20) + 5,\n        successRate: Math.floor(Math.random() * 40) + 40,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'external',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateFamily(): NPC {\n      const relationships = ['', '', '', '', '', '', '', ''];\n      const weights = [30, 20, 15, 10, 10, 10, 3, 2];\n      const relationIndex = this.weightedRandom(relationships.length, weights);\n      const relation = relationships[relationIndex];\n      let age = 40;\n      let isFemale = true;\n      if (relation === '') {\n        age = Math.floor(Math.random() * 20) + 45;\n        isFemale = true;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 20) + 45;\n        isFemale = false;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 30) + 25;\n        isFemale = false;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 30) + 25;\n        isFemale = true;\n      } else if (relation === '' || relation === '') {\n        age = Math.floor(Math.random() * 30) + 20;\n        isFemale = true;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 15) + 5;\n        isFemale = true;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 15) + 5;\n        isFemale = false;\n      }\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: isFemale ? 'female' : 'male',\n        age,\n        role: 'family',\n        relation,\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 30) + 10,\n            sociability: Math.floor(Math.random() * 50) + 30,\n            intelligence: Math.floor(Math.random() * 60) + 30,\n            emotional: Math.floor(Math.random() * 50) + 40,\n            dominance: Math.floor(Math.random() * 50) + 20,\n            kindness: Math.floor(Math.random() * 30) + 60,\n          },\n          tags: ['', ''],\n        },\n        supportLevel: Math.floor(Math.random() * 40) + 60,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'external',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateDoctor(): NPC {\n      const age = Math.floor(Math.random() * 25) + 30;\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const specialties = ['', '', '', '', ''];\n      const specialty = specialties[Math.floor(Math.random() * specialties.length)];\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: 'female',\n        age,\n        role: 'doctor',\n        specialty,\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 20) + 10,\n            sociability: Math.floor(Math.random() * 40) + 40,\n            intelligence: Math.floor(Math.random() * 20) + 70,\n            emotional: Math.floor(Math.random() * 40) + 30,\n            dominance: Math.floor(Math.random() * 40) + 40,\n            kindness: Math.floor(Math.random() * 30) + 60,\n          },\n          tags: ['', ''],\n        },\n        experience: Math.floor(Math.random() * 25) + 5,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'external',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    getCurrentCellNPCs(): NPC[] {\n      return this.currentCellNPCs;\n    },\n\n    setCurrentCellNPCs(npcs: NPC[]) {\n      this.currentCellNPCs = npcs;\n      DS.events.emit('cell_npcs_changed', { npcs });\n    },\n\n    addNPCToCell(npc: NPC) {\n      this.currentCellNPCs.push(npc);\n      DS.events.emit('npc_joined_cell', { npc });\n    },\n\n    removeNPCFromCell(npcId: string): NPC | null {\n      const index = this.currentCellNPCs.findIndex(n => n.id === npcId);\n      if (index !== -1) {\n        const npc = this.currentCellNPCs.splice(index, 1)[0];\n        DS.events.emit('npc_left_cell', { npc });\n        return npc;\n      }\n      return null;\n    },\n\n    findNPCById(npcId: string): NPC | undefined {\n      return this.npcDatabase.find(n => n.id === npcId) || this.currentCellNPCs.find(n => n.id === npcId);\n    },\n\n    updateRelationship(npcId: string, delta: number) {\n      const npc = this.findNPCById(npcId);\n      if (npc && npc.relationship) {\n        npc.relationship.toProtagonist = Math.max(0, Math.min(100, npc.relationship.toProtagonist + delta));\n        DS.events.emit('relationship_changed', {\n          npcId,\n          npcName: npc.name,\n          value: npc.relationship.toProtagonist,\n          delta,\n        });\n      }\n    },\n\n    exportData() {\n      return {\n        database: this.npcDatabase,\n        currentCell: this.currentCellNPCs,\n      };\n    },\n\n    importData(data: { database?: NPC[]; currentCell?: NPC[] } | undefined): boolean {\n      if (!data) return false;\n      try {\n        this.npcDatabase = data.database || [];\n        this.currentCellNPCs = data.currentCell || [];\n        console.info('[NPC] ');\n        return true;\n      } catch (error) {\n        console.error('[NPC] :', error);\n        return false;\n      }\n    },\n\n    clearData() {\n      this.npcDatabase = [];\n      this.currentCellNPCs = [];\n      console.info('[NPC] ');\n    },\n  };\n\n  // ==========  ==========\n  DS.generateNPC = (count?: number, context?: Record<string, unknown>) => NPCGenerator.generate(count, context ?? {});\n  DS.generateNPCForEvent = (eventType: string) => NPCGenerator.generateForEvent(eventType);\n  DS.getCurrentCellNPCs = () => NPCGenerator.getCurrentCellNPCs();\n  DS.setCurrentCellNPCs = (npcs: NPC[]) => NPCGenerator.setCurrentCellNPCs(npcs);\n  DS.addNPCToCell = (npc: NPC) => NPCGenerator.addNPCToCell(npc);\n  DS.removeNPCFromCell = (npcId: string) => NPCGenerator.removeNPCFromCell(npcId);\n  DS.findNPC = (npcId: string) => NPCGenerator.findNPCById(npcId);\n  DS.updateNPCRelationship = (npcId: string, delta: number) => NPCGenerator.updateRelationship(npcId, delta);\n  DS.exportNPCData = () => NPCGenerator.exportData();\n  DS.importNPCData = (data?: { database?: NPC[]; currentCell?: NPC[] }) => NPCGenerator.importData(data);\n\n  DS.registerModule('npcSystem', NPCGenerator);\n\n  // ==========  ==========\n  DS.events.on('event_triggered', (event?: unknown) => {\n    const eventId =\n      typeof (event as EventTriggeredPayload | undefined)?.id === 'string'\n        ? (event as EventTriggeredPayload).id\n        : undefined;\n    if (!eventId) return;\n    if (['interrogation', 'lawyer_visit', 'family_visit', 'medical_visit', 'scene_identification'].includes(eventId)) {\n      const npc = NPCGenerator.generateForEvent(eventId);\n      DS.events.emit('event_npc_generated', { event, npc });\n    }\n  });\n\n  // ==========  ==========\n  DS.events.on('cell_transfer', (data?: unknown) => {\n    const to = (data as CellTransferPayload | undefined)?.to;\n    const newCellType = typeof to === 'string' ? to : 'transition';\n    const npcCount = Math.floor(Math.random() * 5) + 3;\n    const newNPCs = NPCGenerator.generate(npcCount, { cellType: newCellType });\n    NPCGenerator.setCurrentCellNPCs(newNPCs);\n    console.info(`[NPC] ${npcCount}NPC`);\n  });\n\n  console.info('[NPC]  - ');\n}\n","export {};\n\ntype JQueryStaticLike = typeof globalThis extends { $: infer T } ? T : (selector: any) => any;\ndeclare const $: JQueryStaticLike;\n\n/**\n * \n *  API name\n */\n\ninterface WorldbookConfig {\n  name: string; // \n  displayName: string; // \n  priority: number; // \n  keywords: string[]; // \n  autoLoad: boolean; // \n  description?: string; // \n  position?: 'before_char' | 'after_char'; // \n  depth?: number; // \n  fallbackEntries?: unknown[]; // \n}\n\ninterface LoadedWorldbook {\n  name: string;\n  displayName: string;\n  entries: unknown[];\n  fallback: boolean;\n  error?: string;\n  loadedAt: number;\n}\n\ninterface WorldbookStatus {\n  initialized: boolean;\n  fallbackMode: boolean;\n  characterWorldbook: string | null;\n  loaded: Array<{\n    name: string;\n    displayName: string;\n    entries: number;\n    fallback: boolean;\n    error?: string;\n    loadedAt: string;\n  }>;\n  loading: Array<{\n    name: string;\n    displayName: string;\n  }>;\n  available: Array<{\n    name: string;\n    displayName: string;\n    autoLoad: boolean;\n  }>;\n}\n\ninterface EventBus {\n  on(event: string, callback: (data?: unknown) => void): void;\n  emit(event: string, data?: unknown): void;\n}\n\ninterface DetentionSystem {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  config: Record<string, unknown>;\n  state: Record<string, unknown>;\n  events: EventBus;\n  CacheManager: unknown;\n  EventEmitter: unknown;\n  ping(): boolean;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n  handleError(error: unknown, context?: string): void;\n}\n\n// \nconst WORLDBOOKS: Record<string, WorldbookConfig> = {\n  detention_rules: {\n    name: 'detention_rules',\n    displayName: '',\n    description: '',\n    priority: 10,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: true,\n    position: 'before_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  internal_basic_procedures: {\n    name: 'internal_basic_procedures',\n    displayName: '',\n    description: '',\n    priority: 9,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'after_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  internal_basic_legal: {\n    name: 'internal_basic_legal',\n    displayName: '',\n    description:\n      '//',\n    priority: 8,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'before_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  legal_knowledge: {\n    name: 'legal_knowledge',\n    displayName: '',\n    description: '',\n    priority: 7,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'after_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  environment_descriptions: {\n    name: 'environment_descriptions',\n    displayName: '',\n    description: '',\n    priority: 6,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'before_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  narrative_enhancements: {\n    name: 'narrative_enhancements',\n    displayName: '',\n    description: '',\n    priority: 5,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'after_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n};\n\ninterface WorldbookLoaderImpl {\n  loaded: Map<string, LoadedWorldbook>;\n  loading: Map<string, Promise<LoadedWorldbook>>;\n  initialized: boolean;\n  fallbackMode: boolean;\n  characterWorldbookId: string | null;\n\n  findCharacterWorldbook(): Promise<string | null>;\n  loadWorldbook(bookName: string): Promise<LoadedWorldbook>;\n  _loadWorldbookInternal(bookName: string, config: WorldbookConfig): Promise<LoadedWorldbook>;\n  predictiveCache(context: string): Promise<void>;\n  getRelevantEntries(context: string, maxEntries?: number): unknown[];\n  dynamicLoad(userInput: string): Promise<void>;\n  getStatus(): WorldbookStatus;\n  unloadWorldbook(bookName: string): Promise<void>;\n  reloadWorldbook(bookName: string): Promise<LoadedWorldbook>;\n  initialize(): Promise<void>;\n  shutdown(): void;\n}\n\nconsole.info('[] v5.1.0 ...');\n\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'worldbook_loader.ts:190',\n    message: '',\n    data: { hasDetentionSystem: !!window.detentionSystem, detentionSystemType: typeof window.detentionSystem },\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'run1',\n    hypothesisId: 'A',\n  }),\n}).catch(() => {});\n// #endregion\n\nconst DS = window.detentionSystem as DetentionSystem | undefined;\n\nif (!DS) {\n  console.error('[] ');\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'worldbook_loader.ts:195',\n      message: '',\n      data: { windowKeys: Object.keys(window).filter(k => k.includes('detention') || k.includes('Detention')) },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'run1',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n  // #endregion\n} else {\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'worldbook_loader.ts:199',\n      message: '',\n      data: {\n        version: DS.version,\n        initialized: DS.initialized,\n        hasEvents: !!DS.events,\n        moduleCount: Object.keys(DS.modules || {}).length,\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'run1',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n  // #endregion\n  // \n  (DS as DetentionSystem & { characterId?: string }).characterId = 'detention_center';\n  console.info('[]  ');\n\n  // ==========  ==========\n  const WorldbookLoader: WorldbookLoaderImpl = {\n    loaded: new Map(),\n    loading: new Map(),\n    initialized: false,\n    fallbackMode: false,\n    characterWorldbookId: null,\n\n    /**\n     * \n     */\n    async findCharacterWorldbook(): Promise<string | null> {\n      console.info('[] ...');\n\n      try {\n        const charWorldbooks = getCharWorldbookNames('current');\n        if (charWorldbooks.primary) {\n          console.info(`[]  : ${charWorldbooks.primary}`);\n          this.characterWorldbookId = charWorldbooks.primary;\n          return charWorldbooks.primary;\n        }\n\n        if (charWorldbooks.additional.length > 0) {\n          console.info(`[]  : ${charWorldbooks.additional[0]}`);\n          this.characterWorldbookId = charWorldbooks.additional[0];\n          return charWorldbooks.additional[0];\n        }\n\n        console.warn('[]  ');\n        return null;\n      } catch (error) {\n        console.error('[] :', error);\n        return null;\n      }\n    },\n\n    /**\n     * \n     */\n    async loadWorldbook(bookName: string): Promise<LoadedWorldbook> {\n      const config = WORLDBOOKS[bookName];\n      if (!config) {\n        throw new Error(`: ${bookName}`);\n      }\n\n      // \n      if (this.loaded.has(bookName)) {\n        console.info(`[] ${config.displayName} `);\n        return this.loaded.get(bookName)!;\n      }\n\n      // \n      if (this.loading.has(bookName)) {\n        console.info(`[] ${config.displayName} ...`);\n        return await this.loading.get(bookName)!;\n      }\n\n      //  Promise\n      const loadPromise = this._loadWorldbookInternal(bookName, config);\n      this.loading.set(bookName, loadPromise);\n\n      try {\n        const result = await loadPromise;\n        this.loaded.set(bookName, result);\n        return result;\n      } finally {\n        this.loading.delete(bookName);\n      }\n    },\n\n    /**\n     * \n     */\n    async _loadWorldbookInternal(bookName: string, config: WorldbookConfig): Promise<LoadedWorldbook> {\n      console.info(`[] : ${config.displayName} (${bookName})`);\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'worldbook_loader.ts:274',\n          message: '',\n          data: { bookName, displayName: config.displayName, priority: config.priority },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'C',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      try {\n        // \n        const allWorldbookNames = getWorldbookNames();\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'worldbook_loader.ts:279',\n            message: '',\n            data: {\n              count: allWorldbookNames.length,\n              names: allWorldbookNames.slice(0, 10),\n              targetDisplayName: config.displayName,\n              targetName: config.name,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'run1',\n            hypothesisId: 'C',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // displayName\n        let targetWorldbookName: string | null = null;\n\n        // 1.  displayName- \n        const exactDisplayMatch = allWorldbookNames.find(name => name === config.displayName);\n        if (exactDisplayMatch) {\n          targetWorldbookName = exactDisplayMatch;\n          console.info(`[]  : \"${config.displayName}\"`);\n        } else if (allWorldbookNames.includes(config.name)) {\n          // 2.  name\n          targetWorldbookName = config.name;\n          console.info(`[]  : \"${config.name}\"`);\n        } else {\n          // 3.  displayName  name\n          const fuzzyMatch = allWorldbookNames.find(\n            name =>\n              name.includes(config.displayName) ||\n              config.displayName.includes(name) ||\n              name.includes(config.name) ||\n              config.name.includes(name),\n          );\n          if (fuzzyMatch) {\n            targetWorldbookName = fuzzyMatch;\n            console.info(`[]  : \"${fuzzyMatch}\"`);\n          }\n        }\n\n        if (!targetWorldbookName) {\n          const availableBooks = allWorldbookNames.join(', ');\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:309',\n              message: '',\n              data: {\n                bookName,\n                displayName: config.displayName,\n                availableCount: allWorldbookNames.length,\n                availableNames: allWorldbookNames,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'run1',\n              hypothesisId: 'C',\n            }),\n          }).catch(() => {});\n          // #endregion\n          throw new Error(\n            `: ${config.displayName} (${bookName})\\n` +\n              `: ${availableBooks}\\n` +\n              `:  displayName  name `,\n          );\n        }\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'worldbook_loader.ts:318',\n            message: '',\n            data: { bookName, targetWorldbookName, displayName: config.displayName },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'run1',\n            hypothesisId: 'C',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        const entries = await getWorldbook(targetWorldbookName);\n\n        if (entries.length === 0) {\n          throw new Error('');\n        }\n\n        // \n        const charWorldbooks = getCharWorldbookNames('current');\n        if (!charWorldbooks.additional.includes(targetWorldbookName)) {\n          await rebindCharWorldbooks('current', {\n            primary: charWorldbooks.primary,\n            additional: [...charWorldbooks.additional, targetWorldbookName],\n          });\n          console.info(`[]  : ${targetWorldbookName}`);\n        }\n\n        console.info(`[]  ${config.displayName}  (${entries.length} )`);\n\n        return {\n          name: bookName,\n          displayName: config.displayName,\n          entries: entries,\n          fallback: false,\n          loadedAt: Date.now(),\n        };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        console.warn(`[]  ${config.displayName} :`, errorMessage);\n\n        // \n        if (config.fallbackEntries && config.fallbackEntries.length > 0) {\n          console.info(`[]  ${config.displayName}  (${config.fallbackEntries.length} )`);\n          this.fallbackMode = true;\n\n          return {\n            name: bookName,\n            displayName: config.displayName,\n            entries: config.fallbackEntries,\n            fallback: true,\n            error: errorMessage,\n            loadedAt: Date.now(),\n          };\n        }\n\n        throw error;\n      }\n    },\n\n    /**\n     * \n     */\n    async predictiveCache(context: string): Promise<void> {\n      if (!context || typeof context !== 'string') {\n        return;\n      }\n\n      console.info('[] ...');\n\n      const predictions: Array<{ bookName: string; score: number; priority: number; weightedScore: number }> = [];\n\n      for (const bookName in WORLDBOOKS) {\n        const config = WORLDBOOKS[bookName];\n\n        if (this.loaded.has(bookName)) {\n          continue;\n        }\n\n        let matchScore = 0;\n        let weightedScore = 0;\n\n        // \n        for (const keyword of config.keywords) {\n          if (context.includes(keyword)) {\n            matchScore++;\n            // \n            const keywordWeight = keyword.length >= 3 ? 2 : 1;\n            weightedScore += keywordWeight;\n\n            // \n            if (config.description && config.description.includes(keyword)) {\n              weightedScore += 1;\n            }\n          }\n        }\n\n        // \n        if (config.description) {\n          const descKeywords = config.description.match(/[\\u4e00-\\u9fa5]{2,}/g) || [];\n          for (const descKw of descKeywords) {\n            if (context.includes(descKw) && descKw.length >= 2) {\n              weightedScore += 0.5;\n            }\n          }\n        }\n\n        if (matchScore > 0) {\n          //  =  * 10 + \n          const finalScore = config.priority * 10 + weightedScore;\n\n          predictions.push({\n            bookName,\n            score: matchScore,\n            priority: config.priority,\n            weightedScore: finalScore,\n          });\n        }\n      }\n\n      // \n      predictions.sort((a, b) => {\n        if (Math.abs(b.weightedScore - a.weightedScore) > 1) {\n          return b.weightedScore - a.weightedScore;\n        }\n        if (b.priority !== a.priority) {\n          return b.priority - a.priority;\n        }\n        return b.score - a.score;\n      });\n\n      console.info(`[]  ${predictions.length} `);\n\n      // 1>10\n      const toLoad = predictions.filter(p => p.weightedScore > 10).slice(0, 3);\n\n      if (toLoad.length === 0) {\n        console.info('[] ');\n        return;\n      }\n\n      for (const pred of toLoad) {\n        console.info(\n          `[] : ${WORLDBOOKS[pred.bookName].displayName} ` +\n            `(: ${pred.score}, : ${pred.weightedScore.toFixed(1)})`,\n        );\n\n        try {\n          await this.loadWorldbook(pred.bookName);\n        } catch (error) {\n          console.warn(`[] : ${pred.bookName}`, error);\n        }\n      }\n    },\n\n    /**\n     * \n     */\n    getRelevantEntries(context: string, maxEntries: number = 5): unknown[] {\n      if (!context || typeof context !== 'string') {\n        return [];\n      }\n\n      const allEntries: Array<{ entry: unknown; bookName: string; bookDisplayName: string; priority: number }> = [];\n\n      this.loaded.forEach((bookData, bookName) => {\n        if (bookData.entries && Array.isArray(bookData.entries)) {\n          for (const entry of bookData.entries) {\n            allEntries.push({\n              entry,\n              bookName: bookName,\n              bookDisplayName: bookData.displayName,\n              priority: WORLDBOOKS[bookName]?.priority || 0,\n            });\n          }\n        }\n      });\n\n      const scoredEntries = allEntries.map(item => {\n        let score = 0;\n        const entry = item.entry as {\n          keys?: string[];\n          key?: string[];\n          constant?: boolean;\n          name?: string;\n          content?: string;\n        };\n        const keys = entry.keys || entry.key || [];\n\n        // \n        for (const key of keys) {\n          if (context.includes(key)) {\n            const keyWeight = key.length >= 3 ? 15 : 10;\n            score += keyWeight;\n\n            // \n            if (entry.name && entry.name.includes(key)) {\n              score += 5;\n            }\n          }\n        }\n\n        // \n        if (entry.name && context.includes(entry.name)) {\n          score += 20;\n        }\n\n        // \n        if (entry.content) {\n          const contentMatch = entry.content.substring(0, 100);\n          if (context.includes(contentMatch.substring(0, 10))) {\n            score += 3;\n          }\n        }\n\n        // \n        score += item.priority || 0;\n\n        // \n        if (entry.constant) {\n          score += 30;\n        }\n\n        return {\n          entry: item.entry,\n          score,\n          bookName: item.bookName,\n          bookDisplayName: item.bookDisplayName,\n        };\n      });\n\n      // \n      scoredEntries.sort((a, b) => {\n        if (Math.abs(b.score - a.score) > 5) {\n          return b.score - a.score;\n        }\n        // \n        const aPriority = WORLDBOOKS[a.bookName]?.priority || 0;\n        const bPriority = WORLDBOOKS[b.bookName]?.priority || 0;\n        return bPriority - aPriority;\n      });\n\n      const relevant = scoredEntries\n        .filter(item => item.score > 0)\n        .slice(0, maxEntries)\n        .map(item => item.entry);\n\n      if (relevant.length > 0) {\n        console.info(\n          `[]  ${relevant.length}  ` +\n            `(: ${scoredEntries[0]?.score || 0}, : ${scoredEntries[0]?.bookDisplayName || ''})`,\n        );\n      }\n\n      return relevant;\n    },\n\n    /**\n     * \n     */\n    async dynamicLoad(userInput: string): Promise<void> {\n      if (!userInput || typeof userInput !== 'string' || userInput.length < 3) {\n        return;\n      }\n\n      console.info('[] ...');\n\n      const triggers: Array<{\n        bookName: string;\n        keyword: string;\n        priority: number;\n        matchCount: number;\n        score: number;\n      }> = [];\n\n      for (const bookName in WORLDBOOKS) {\n        const config = WORLDBOOKS[bookName];\n\n        if (this.loaded.has(bookName)) {\n          continue;\n        }\n\n        let matchCount = 0;\n        let bestKeyword = '';\n        let maxKeywordLength = 0;\n\n        // \n        for (const keyword of config.keywords) {\n          if (userInput.includes(keyword)) {\n            matchCount++;\n            if (keyword.length > maxKeywordLength) {\n              maxKeywordLength = keyword.length;\n              bestKeyword = keyword;\n            }\n          }\n        }\n\n        // \n        if (matchCount > 0) {\n          //  =  * 10 +  * 2 + \n          const score = config.priority * 10 + matchCount * 2 + maxKeywordLength;\n\n          triggers.push({\n            bookName,\n            keyword: bestKeyword,\n            priority: config.priority,\n            matchCount,\n            score,\n          });\n        }\n      }\n\n      if (triggers.length === 0) {\n        console.info('[] ');\n        return;\n      }\n\n      // \n      triggers.sort((a, b) => {\n        if (Math.abs(b.score - a.score) > 2) {\n          return b.score - a.score;\n        }\n        return b.priority - a.priority;\n      });\n\n      console.info(`[]  ${triggers.length} `);\n\n      // 3\n      const toLoad = triggers.slice(0, 3);\n\n      for (const trigger of toLoad) {\n        console.info(\n          `[] : ${WORLDBOOKS[trigger.bookName].displayName} ` +\n            `(: ${trigger.keyword}, : ${trigger.matchCount}, : ${trigger.score})`,\n        );\n\n        try {\n          await this.loadWorldbook(trigger.bookName);\n        } catch (error) {\n          console.warn(`[] : ${trigger.bookName}`, error);\n        }\n      }\n    },\n\n    /**\n     * \n     */\n    getStatus(): WorldbookStatus {\n      const status: WorldbookStatus = {\n        initialized: this.initialized,\n        fallbackMode: this.fallbackMode,\n        characterWorldbook: this.characterWorldbookId,\n        loaded: [],\n        loading: [],\n        available: [],\n      };\n\n      this.loaded.forEach((data, name) => {\n        status.loaded.push({\n          name: name,\n          displayName: data.displayName,\n          entries: data.entries.length,\n          fallback: data.fallback,\n          error: data.error,\n          loadedAt: new Date(data.loadedAt).toLocaleTimeString(),\n        });\n      });\n\n      this.loading.forEach((_promise, name) => {\n        status.loading.push({\n          name: name,\n          displayName: WORLDBOOKS[name]?.displayName || name,\n        });\n      });\n\n      for (const bookName in WORLDBOOKS) {\n        if (!this.loaded.has(bookName) && !this.loading.has(bookName)) {\n          status.available.push({\n            name: bookName,\n            displayName: WORLDBOOKS[bookName].displayName,\n            autoLoad: WORLDBOOKS[bookName].autoLoad,\n          });\n        }\n      }\n\n      return status;\n    },\n\n    /**\n     * \n     */\n    async unloadWorldbook(bookName: string): Promise<void> {\n      if (!this.loaded.has(bookName)) {\n        console.warn(`[] ${bookName} `);\n        return;\n      }\n\n      console.info(`[] : ${WORLDBOOKS[bookName]?.displayName || bookName}`);\n\n      // \n      const charWorldbooks = getCharWorldbookNames('current');\n      const loadedData = this.loaded.get(bookName);\n      if (loadedData) {\n        // \n        const allWorldbookNames = getWorldbookNames();\n        const targetName = allWorldbookNames.find(name => name === bookName || name.includes(bookName));\n\n        if (targetName) {\n          const newAdditional = charWorldbooks.additional.filter(name => name !== targetName);\n          await rebindCharWorldbooks('current', {\n            primary: charWorldbooks.primary,\n            additional: newAdditional,\n          });\n        }\n      }\n\n      this.loaded.delete(bookName);\n    },\n\n    /**\n     * \n     */\n    async reloadWorldbook(bookName: string): Promise<LoadedWorldbook> {\n      console.info(`[] : ${WORLDBOOKS[bookName]?.displayName || bookName}`);\n      await this.unloadWorldbook(bookName);\n      return await this.loadWorldbook(bookName);\n    },\n\n    /**\n     * \n     */\n    async initialize(): Promise<void> {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'worldbook_loader.ts:738',\n          message: '',\n          data: { alreadyInitialized: this.initialized, fallbackMode: this.fallbackMode },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'D',\n        }),\n      }).catch(() => {});\n      // #endregion\n      if (this.initialized) {\n        console.info('[] ');\n        return;\n      }\n\n      console.info('[] ...');\n\n      await this.findCharacterWorldbook();\n\n      // \n      let retries = 0;\n      let availableWorldbooks: string[] = [];\n      while (retries < 40) {\n        try {\n          availableWorldbooks = getWorldbookNames();\n          if (availableWorldbooks.length > 0) {\n            console.info(`[]   (${availableWorldbooks.length} )`);\n            console.info(`[] : ${availableWorldbooks.join(', ')}`);\n            break;\n          }\n        } catch (error) {\n          // \n        }\n\n        console.info(`[] ... (${retries + 1}/40)`);\n        await new Promise(resolve => setTimeout(resolve, 500));\n        retries++;\n      }\n\n      // \n      console.info('[] :');\n      for (const bookName in WORLDBOOKS) {\n        const config = WORLDBOOKS[bookName];\n        const isAvailable = availableWorldbooks.some(\n          name => name === config.displayName || name === config.name || name.includes(config.displayName),\n        );\n        console.info(\n          `  - ${config.displayName} (${bookName}): ` +\n            `=${config.priority}, ` +\n            `=${config.autoLoad ? '' : ''}, ` +\n            `=${isAvailable ? '' : ''}`,\n        );\n      }\n\n      // \n      const autoLoadBooks: string[] = [];\n      for (const bookName in WORLDBOOKS) {\n        if (WORLDBOOKS[bookName].autoLoad) {\n          autoLoadBooks.push(bookName);\n        }\n      }\n\n      console.info(`[]  ${autoLoadBooks.length} `);\n\n      for (const bookName of autoLoadBooks) {\n        try {\n          await this.loadWorldbook(bookName);\n        } catch (err) {\n          console.warn(`[] : ${bookName}`, err);\n        }\n      }\n\n      this.initialized = true;\n\n      const status = this.getStatus();\n      console.info('[]  ');\n      console.table(status.loaded);\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'worldbook_loader.ts:801',\n          message: '',\n          data: {\n            loadedCount: status.loaded.length,\n            loadingCount: status.loading.length,\n            availableCount: status.available.length,\n            fallbackMode: this.fallbackMode,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'D',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      // \n      if (this.fallbackMode) {\n        console.warn('');\n        console.warn('[]  ');\n        console.warn('[]  ');\n        console.warn('[]  ');\n        console.warn('');\n\n        const fallbackBooks = status.loaded.filter(b => b.fallback);\n        console.table(fallbackBooks);\n\n        // 3\n        setTimeout(() => {\n          console.info('[] ...');\n          this.shutdown();\n        }, 3000);\n      } else {\n        console.info('[]  ');\n      }\n    },\n\n    /**\n     * \n     */\n    shutdown(): void {\n      console.info('[] ...');\n\n      // \n      this.loaded.clear();\n      this.loading.clear();\n\n      // \n      if (DS) {\n        delete (DS as DetentionSystem & { loadWorldbook?: unknown }).loadWorldbook;\n        delete (DS as DetentionSystem & { unloadWorldbook?: unknown }).unloadWorldbook;\n        delete (DS as DetentionSystem & { reloadWorldbook?: unknown }).reloadWorldbook;\n        delete (DS as DetentionSystem & { predictiveCache?: unknown }).predictiveCache;\n        delete (DS as DetentionSystem & { getRelevantEntries?: unknown }).getRelevantEntries;\n        delete (DS as DetentionSystem & { getWorldbookStatus?: unknown }).getWorldbookStatus;\n        delete (DS as DetentionSystem & { dynamicLoad?: unknown }).dynamicLoad;\n      }\n\n      this.initialized = false;\n      this.fallbackMode = false;\n\n      console.info('[]  ');\n      console.info('[] ');\n    },\n  };\n\n  // ==========  ==========\n  (\n    DS as DetentionSystem & {\n      loadWorldbook?: (bookName: string) => Promise<LoadedWorldbook>;\n      unloadWorldbook?: (bookName: string) => Promise<void>;\n      reloadWorldbook?: (bookName: string) => Promise<LoadedWorldbook>;\n      predictiveCache?: (context: string) => Promise<void>;\n      dynamicLoad?: (userInput: string) => Promise<void>;\n      getRelevantEntries?: (context: string, max?: number) => unknown[];\n      getWorldbookStatus?: () => WorldbookStatus;\n    }\n  ).loadWorldbook = (bookName: string) => WorldbookLoader.loadWorldbook(bookName);\n  (DS as DetentionSystem & { unloadWorldbook?: (bookName: string) => Promise<void> }).unloadWorldbook = (\n    bookName: string,\n  ) => WorldbookLoader.unloadWorldbook(bookName);\n  (DS as DetentionSystem & { reloadWorldbook?: (bookName: string) => Promise<LoadedWorldbook> }).reloadWorldbook = (\n    bookName: string,\n  ) => WorldbookLoader.reloadWorldbook(bookName);\n  (DS as DetentionSystem & { predictiveCache?: (context: string) => Promise<void> }).predictiveCache = (\n    context: string,\n  ) => WorldbookLoader.predictiveCache(context);\n  (DS as DetentionSystem & { dynamicLoad?: (userInput: string) => Promise<void> }).dynamicLoad = (userInput: string) =>\n    WorldbookLoader.dynamicLoad(userInput);\n  (DS as DetentionSystem & { getRelevantEntries?: (context: string, max?: number) => unknown[] }).getRelevantEntries = (\n    context: string,\n    max?: number,\n  ) => WorldbookLoader.getRelevantEntries(context, max);\n  (DS as DetentionSystem & { getWorldbookStatus?: () => WorldbookStatus }).getWorldbookStatus = () =>\n    WorldbookLoader.getStatus();\n\n  DS.registerModule('worldbook', WorldbookLoader);\n\n  console.info('[]  ');\n\n  // ==========  ==========\n  DS.events.on('event_triggered', (eventData?: unknown) => {\n    const event = eventData as { id?: string; description?: string } | undefined;\n    if (event?.description) {\n      WorldbookLoader.predictiveCache(event.description).catch(err => {\n        console.warn('[] :', err);\n      });\n    }\n  });\n\n  // ==========  ==========\n  DS.events.on('user_input', (data?: unknown) => {\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'worldbook_loader.ts:899',\n        message: '',\n        data: {\n          hasData: !!data,\n          dataType: typeof data,\n          textLength:\n            typeof (data as { text?: unknown } | undefined)?.text === 'string'\n              ? (data as { text?: string }).text?.length\n              : 0,\n          initialized: WorldbookLoader.initialized,\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'run1',\n        hypothesisId: 'E',\n      }),\n    }).catch(() => {});\n    // #endregion\n    const input = data as { text?: string } | undefined;\n    if (input?.text && input.text.length > 5) {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'worldbook_loader.ts:905',\n          message: '',\n          data: { textLength: input.text.length, textPreview: input.text.substring(0, 50) },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'run1',\n          hypothesisId: 'E',\n        }),\n      }).catch(() => {});\n      // #endregion\n      WorldbookLoader.dynamicLoad(input.text).catch(err => {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'worldbook_loader.ts:908',\n            message: '',\n            data: { error: err instanceof Error ? err.message : String(err) },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'run1',\n            hypothesisId: 'E',\n          }),\n        }).catch(() => {});\n        // #endregion\n        console.warn('[] :', err);\n      });\n    }\n  });\n\n  // ==========  ==========\n  $(() => {\n    console.info('[] ...');\n\n    // 2\n    setTimeout(async () => {\n      console.info('[] ...');\n\n      try {\n        await WorldbookLoader.initialize();\n        console.info('[]  ');\n      } catch (error) {\n        console.error('[]  :', error);\n        console.info('[]  : window.initWorldbookLoader()');\n      }\n    }, 2000);\n  });\n\n  // ==========  ==========\n  (window as typeof window & { initWorldbookLoader?: () => Promise<WorldbookStatus> }).initWorldbookLoader =\n    async function () {\n      console.info('[] ...');\n\n      if (WorldbookLoader.initialized) {\n        console.info('[] ');\n        return WorldbookLoader.getStatus();\n      }\n\n      try {\n        await WorldbookLoader.initialize();\n        console.info('[]  ');\n        return WorldbookLoader.getStatus();\n      } catch (error) {\n        console.error('[]  :', error);\n        throw error;\n      }\n    };\n\n  console.info('[]  ');\n  console.info('[]  : window.initWorldbookLoader()');\n}\n","/**\n *  - \n * NPC\n *\n * \n * 1.  (core.ts) - \n * 2.  (status_panel.ts) - HTML\n * 3.  (event_system.ts) - \n * 4. NPC (npc_system.ts) - NPC\n * 5.  (worldbook_loader.ts) - \n */\n\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'index.ts:20',\n    message: ' - index.ts ',\n    data: {\n      timestamp: Date.now(),\n      userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'unknown',\n      windowDetentionSystem: typeof window !== 'undefined' && typeof (window as any).detentionSystem !== 'undefined',\n    },\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'run1',\n    hypothesisId: 'A',\n  }),\n}).catch(() => {});\n// #endregion\n\nconsole.info('[] ...');\n\n// \nimport './core';\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'index.ts:35',\n    message: 'core.ts ',\n    data: {\n      timestamp: Date.now(),\n      windowDetentionSystem: typeof window !== 'undefined' && typeof (window as any).detentionSystem !== 'undefined',\n    },\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'run1',\n    hypothesisId: 'A',\n  }),\n}).catch(() => {});\n// #endregion\n\nimport './status_panel';\nimport './event_system';\nimport './npc_system';\nimport './worldbook_loader';\n\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'index.ts:55',\n    message: '',\n    data: {\n      timestamp: Date.now(),\n      windowDetentionSystem: typeof window !== 'undefined' && typeof (window as any).detentionSystem !== 'undefined',\n      windowDetentionSystemType:\n        typeof window !== 'undefined' ? typeof (window as any).detentionSystem : 'window undefined',\n    },\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'run1',\n    hypothesisId: 'A',\n  }),\n}).catch(() => {});\n// #endregion\n\nconsole.info('[] ');\n"],"names":["CONFIG","updateInterval","animationDuration","trendWindow","slowChangeThreshold","regressionRate","healthBaseline","mentalBaseline","parseRetryAttempts","parseRetryDelay","debugMode","TREND_SYMBOLS","up","down","stable","state","name","age","crime","health","mental","strength","intelligence","appearance","height","weight","hair","condition","clothing","top","bottom","underwear","underpants","socks","shoes","restraints","cleanliness","currentTask","currentThought","biggestWorry","days","stage","cellType","changes","accumulated","lastUpdate","Date","now","stats","totalUpdates","successfulParses","failedParses","lastParseTime","isUpdating","mutationObserver","updateLoopInterval","debugLog","args","console","log","formatDuration","ms","seconds","Math","floor","minutes","hours","recordChange","key","delta","push","value","timestamp","length","shift","calculateTrend","sum","reduce","acc","change","updateState","data","warn","undefined","abs","updateDisplay","error","parseCommentNode","node","nodeType","Node","COMMENT_NODE","content","nodeValue","textContent","trim","substring","startsWith","jsonStr","parseStatusUpdate","attempt","replace","JSON","parse","DS","window","detentionSystem","events","emit","errorMessage","Error","message","String","setTimeout","attempts","checkForStatusUpdate","element","ELEMENT_NODE","walker","document","createTreeWalker","NodeFilter","SHOW_COMMENT","count","nextNode","updateElement","id","getElementById","classList","remove","add","updateStat","max","min","valueElement","round","toString","barElement","style","width","statBar","closest","trend","trendElement","color","createStatusPanel","panel","createElement","innerHTML","head","appendChild","addStyles","body","toggleBtn","querySelector","addEventListener","isCollapsed","display","debugBtn","debugSection","isHidden","toLocaleTimeString","updateDebugInfo","stopCommentListener","disconnect","startUpdateLoop","clearInterval","setInterval","healthDelta","mentalDelta","applyRegression","stopUpdateLoop","StatusPanel","version","initialize","MutationObserver","mutations","mutation","type","addedNodes","target","observe","childList","subtree","characterData","characterDataOldValue","on","d","destroy","styles","off","getState","modifyValue","reason","oldValue","newValue","getTrendAnalysis","getCurrentStage","reset","exportData","stringify","importData","debug","scanAllComments","comments","fullContent","isStatusUpdate","filter","c","table","getDiagnostics","diagnostics","toLocaleString","observer","active","status","timeSinceUpdate","timeSinceUpdateFormatted","successRate","toFixed","currentState","config","$","info","registerModule","statusPanel","initialized","__webpack_module_cache__","fetch","method","headers","location","windowDetentionSystem","sessionId","runId","hypothesisId","catch","EventEmitter","Map","event","callback","this","has","set","get","callbacks","index","indexOf","splice","forEach","cb","once","wrapper","cacheStore","cacheCleanupTimer","bootstrapDetentionSystem","system","modules","tokenBudget","fallbackBudget","compressionQuality","cacheExpiry","healthCheckInterval","healthCheckTimeout","mode","tokenUsed","lastHealthCheck","errors","CacheManager","ttl","expiry","item","delete","clear","cleanup","entries","ping","checkTokenBudget","total","used","percentage","remaining","updateTokenUsage","tokens","budget","compressContent","quality","text","actualQuality","compressed","originalSize","compressedSize","ratio","module","getModule","handleError","context","normalized","normalizeError","errorInfo","stack","detectEnvironment","env","isSillyTavern","hasHelper","helperVersion","hasDataTable","SillyTavern","getTavernVersion","getTavernHelperVersion","windowWithTable","insertRow","updateRow","exists","ensureCacheCleanup","__webpack_require__","moduleId","cachedModule","exports","__webpack_modules__","hasDetentionSystem","detentionSystemType","hasEvents","moduleCount","Object","keys","EventSystem","currentDay","lastEventDay","eventHistory","legalTimeline","arrestDay","approvalDay","prosecutionDay","firstTrialDay","firstVerdictDay","secondTrialDay","finalVerdictDay","transferDay","executionDay","currentStage","caseComplexity","complexityMultiplier","eventCounters","interrogation","lawyerVisit","familyVisit","medicalVisit","sceneIdentification","isDeathPenalty","lastStageChangeDay","PRIORITY","LEGAL","CONDITION","RANDOM","DAILY","legalEvents","approval","minDay","maxDay","description","nextStage","investigation","duration","prosecution","firstTrial","firstVerdict","appeal","secondTrial","finalVerdict","transfer","deathReview","execution","conditionEvents","checkAlways","_state","random","stageChangeOnly","daysSinceApproval","baseProbability","finalProbability","pow","category","daysToTrial","daysToTrial2","lastVisit","e","sort","a","b","day","probability","lastMedical","recentContext","getRecentContext","some","kw","includes","aiControlled","randomEvents","violence","medical","emotional","accident","innerMonologues","startDay","setCaseComplexity","complexity","validComplexities","simple","normal","complex","very_complex","multiplier","checkComplexityAdjustment","rollbackToStage","targetStage","stageOrder","targetIndex","currentIndex","timelineKeys","trial1","trial2","i","from","to","handleUserRollback","input","rollbackPatterns","pattern","rule","match","advanceDay","dayEvent","checkDayEvents","prototype","hasOwnProperty","call","priority","interrupted","accumulatedEvents","legalEvent","checkLegalEvent","conditionEvent","checkConditionEvent","randomEvent","generateRandomEvent","monologue","generateInnerMonologue","daysInCustody","stageBefore","minDays","maxDays","daysSinceProsecution","daysSinceTrial","daysSinceAppeal","daysSinceVerdict","isEnding","endingType","getProtagonistState","types","eventType","weightedRandom","eventList","eventWeights","map","weights","m","totalWeight","w","Array","isArray","chat","slice","mes","join","checkCellTransfer","setDeathPenalty","getCurrentStageInfo","timeline","getEventStatistics","totalEvents","byType","byPriority","recentEvents","exportTimeline","importTimeline","Boolean","_context","hasData","dataType","textLength","windowKeys","k","NameGenerator","surnames","tier1","names","tier2","tier3","tier4","tier5","givenNames","vintage","single","double","classic","modern","contemporary","badNames","badChars","generate","birthYear","fullName","selectSurname","selectGivenName","isValidName","tiers","values","tier","getFullYear","styleData","pair","char","CrimeGenerator","characterBookCrimes","crimes","violent","sentenceRange","property","drug","economic","social","other","findCategoryByCrime","sentence","generateSentence","categories","cat","crimeName","range","NPCGenerator","npcDatabase","currentCellNPCs","npcs","npc","generateSingle","eventSystem","stageInfo","generateAge","crimeData","generateAppearance","personality","generatePersonality","background","generateBackground","relationship","generateRelationship","adjustByCellType","generateId","gender","createdAt","heights","hairStyles","skinTones","features","eyes","skin","traits","aggression","sociability","dominance","kindness","tags","_crimeData","educations","educationIndex","maritalStatuses","maritalWeights","maritalIndex","hasChildren","childrenCount","education","maritalStatus","hometown","generateHometown","priorConvictions","provinces","toProtagonist","faction","allies","enemies","influence","generateForEvent","generatePolice","generateLawyer","generateFamily","generateDoctor","police","witnesses","ranks","rank","role","attitude","isFemale","typeIndex","experience","relationships","relation","supportLevel","specialties","specialty","getCurrentCellNPCs","setCurrentCellNPCs","addNPCToCell","removeNPCFromCell","npcId","findIndex","n","findNPCById","find","updateRelationship","npcName","database","currentCell","clearData","generateNPC","generateNPCForEvent","findNPC","updateNPCRelationship","exportNPCData","importNPCData","eventId","newCellType","npcCount","newNPCs","WORLDBOOKS","detention_rules","displayName","keywords","autoLoad","position","depth","fallbackEntries","internal_basic_procedures","internal_basic_legal","legal_knowledge","environment_descriptions","narrative_enhancements","characterId","WorldbookLoader","loaded","loading","fallbackMode","characterWorldbookId","findCharacterWorldbook","charWorldbooks","getCharWorldbookNames","primary","additional","loadWorldbook","bookName","loadPromise","_loadWorldbookInternal","result","allWorldbookNames","getWorldbookNames","targetDisplayName","targetName","targetWorldbookName","exactDisplayMatch","fuzzyMatch","availableBooks","availableCount","availableNames","getWorldbook","rebindCharWorldbooks","fallback","loadedAt","predictiveCache","predictions","matchScore","weightedScore","keyword","descKeywords","descKw","finalScore","score","toLoad","p","pred","getRelevantEntries","maxEntries","allEntries","bookData","entry","bookDisplayName","scoredEntries","contentMatch","constant","aPriority","relevant","dynamicLoad","userInput","triggers","matchCount","bestKeyword","maxKeywordLength","trigger","getStatus","characterWorldbook","available","_promise","unloadWorldbook","newAdditional","reloadWorldbook","alreadyInitialized","retries","availableWorldbooks","Promise","resolve","isAvailable","autoLoadBooks","err","loadedCount","loadingCount","fallbackBooks","shutdown","getWorldbookStatus","eventData","textPreview","async","initWorldbookLoader","userAgent","navigator","windowDetentionSystemType"],"ignoreList":[],"sourceRoot":""}