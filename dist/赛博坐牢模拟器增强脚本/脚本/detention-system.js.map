{"version":3,"file":"detention-system.js","mappings":"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A,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,KACA,KACA,KACA,OACA,OACA,QACA,MACA,OACA,MACA,KACA,KACA,MACA,KACA,KACA,MAEFC,UAAU,EACVC,SAAU,cACVC,MAAO,EACPC,gBAAiB,IAEnBG,gBAAiB,CACfp/B,KAAM,kBACN4+B,YAAa,QACbztB,YAAa,mBACbd,SAAU,EACVwuB,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,OACA,OACA,OACA,OACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,QAEFC,UAAU,EACVC,SAAU,aACVC,MAAO,EACPC,gBAAiB,IAEnBI,yBAA0B,CACxBr/B,KAAM,2BACN4+B,YAAa,QACbztB,YAAa,uCACbd,SAAU,EACVwuB,SAAU,CACR,KACA,MACA,MACA,MACA,KACA,KACA,KACA,KACA,OACA,KACA,OACA,OACA,KACA,KACA,KACA,MACA,KACA,KACA,MACA,MACA,MACA,KACA,MAEFC,UAAU,EACVC,SAAU,cACVC,MAAO,EACPC,gBAAiB,IAEnBK,uBAAwB,CACtBt/B,KAAM,yBACN4+B,YAAa,QACbztB,YAAa,qBACbd,SAAU,EACVwuB,SAAU,CACR,KACA,KACA,KACA,KACA,KACA,KACA,KACA,OACA,KACA,MACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,KACA,MAEFC,UAAU,EACVC,SAAU,aACVC,MAAO,EACPC,gBAAiB,KA8BrB,SAASM,IAyBP,GAvBA98B,MAAM,oEAAqE,CACzEC,OAAQ,OACRC,QAAS,CAAE,eAAgB,oBAC3BC,KAAMvD,KAAKC,UAAU,CACnB/C,SAAU,4CACVuE,QAAS,YACTpF,KAAM,CACJ8jC,iBAA0D,IAArCt/B,OAAeu/B,kBACpCC,gBAAmC,oBAAXx/B,UAA6BA,OAAey/B,aACpEC,kBACoB,oBAAX1/B,UACJA,OAAey/B,cACwC,mBAAlDz/B,OAAey/B,aAAaF,mBAExCrjC,UAAWC,KAAKC,MAChB0G,UAAW,gBACXC,MAAO,UACPzG,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","sources":["src://tavern_helper_template/src///core.ts","src://tavern_helper_template/src///event_system.ts","src://tavern_helper_template/src///npc_system.ts","src://tavern_helper_template/external var \"Vue\"","src://tavern_helper_template/src///status_panel.ts","src://tavern_helper_template/src///worldbook_loader.ts","src://tavern_helper_template/src///index.ts"],"sourcesContent":["export {};\n\ntype JQueryStaticLike = typeof globalThis extends { $: infer T } ? T : (selector: any) => any;\ndeclare const $: JQueryStaticLike;\n\n//  CORS \n\nconsole.info('[] ...');\n\ntype BudgetStatus = 'critical' | 'warning' | 'normal';\n\ninterface BudgetInfo {\n  used: number;\n  total: number;\n  percentage: string;\n  remaining: number;\n  status: BudgetStatus;\n}\n\ninterface DetentionConfig {\n  tokenBudget: number;\n  fallbackBudget: number;\n  compressionQuality: number;\n  cacheExpiry: number;\n  healthCheckInterval: number;\n  healthCheckTimeout: number;\n}\n\ninterface DetentionErrorInfo {\n  message: string;\n  context: string;\n  timestamp: number;\n  stack?: string;\n}\n\ninterface DetentionState {\n  mode: 'detecting' | 'external' | 'fallback';\n  tokenUsed: number;\n  lastHealthCheck: number;\n  errors: DetentionErrorInfo[];\n}\n\ninterface CacheEntry<T> {\n  value: T;\n  expiry: number | null;\n}\n\ninterface CacheManager {\n  set<T>(key: string, value: T, ttl?: number | null): void;\n  get<T>(key: string): T | null;\n  has(key: string): boolean;\n  delete(key: string): void;\n  clear(): void;\n  cleanup(): void;\n}\n\ninterface EnvironmentInfo {\n  isSillyTavern: boolean;\n  version: string | null;\n  hasHelper: boolean;\n  helperVersion: string | null;\n  hasDataTable: boolean;\n}\n\nclass EventEmitter {\n  private readonly events = new Map<string, Array<(data?: unknown) => void>>();\n\n  on(event: string, callback: (data?: unknown) => void) {\n    if (!this.events.has(event)) {\n      this.events.set(event, []);\n    }\n    this.events.get(event)!.push(callback);\n  }\n\n  off(event: string, callback: (data?: unknown) => void) {\n    const callbacks = this.events.get(event);\n    if (!callbacks) return;\n    const index = callbacks.indexOf(callback);\n    if (index > -1) callbacks.splice(index, 1);\n  }\n\n  emit(event: string, data?: unknown) {\n    const callbacks = this.events.get(event);\n    if (!callbacks) return;\n    callbacks.forEach(cb => {\n      try {\n        cb(data);\n      } catch (error) {\n        console.error(`[]  ${event} :`, error);\n      }\n    });\n  }\n\n  once(event: string, callback: (data?: unknown) => void) {\n    const wrapper = (data?: unknown) => {\n      callback(data);\n      this.off(event, wrapper);\n    };\n    this.on(event, wrapper);\n  }\n}\n\ninterface DetentionSystem {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  config: DetentionConfig;\n  state: DetentionState;\n  events: EventEmitter;\n  CacheManager: CacheManager;\n  EventEmitter: typeof EventEmitter;\n  ping(): boolean;\n  checkTokenBudget(): BudgetInfo;\n  updateTokenUsage(tokens: number): BudgetInfo;\n  compressContent(content: unknown, quality?: number | null): string;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n  handleError(error: unknown, context?: string): void;\n  detectEnvironment(): EnvironmentInfo;\n  initialize(): void;\n  initializeState?(state: {\n    name?: string;\n    age?: number;\n    crime?: string;\n    health?: number;\n    mental?: number;\n    strength?: number;\n    intelligence?: number;\n    appearance?: {\n      height?: number;\n      weight?: number;\n      hair?: string;\n      condition?: string;\n    };\n    clothing?: {\n      top?: string;\n      bottom?: string;\n      underwear?: string;\n      underpants?: string;\n      socks?: string;\n      shoes?: string;\n      restraints?: string;\n      cleanliness?: string;\n    };\n    currentTask?: string;\n    currentThought?: string;\n    biggestWorry?: string;\n  }): void;\n}\n\ndeclare global {\n  interface Window {\n    detentionSystem?: DetentionSystem;\n  }\n}\n\nconst cacheStore: Map<string, CacheEntry<unknown>> = new Map();\nlet cacheCleanupTimer: ReturnType<typeof setInterval> | undefined;\n\nfunction createCacheManager(): CacheManager {\n  return {\n    set<T>(key: string, value: T, ttl?: number | null) {\n      const expiry = ttl ? Date.now() + ttl * 1000 : null;\n      cacheStore.set(key, { value, expiry });\n    },\n    get<T>(key: string) {\n      const item = cacheStore.get(key);\n      if (!item) return null;\n      if (item.expiry !== null && Date.now() > item.expiry) {\n        cacheStore.delete(key);\n        return null;\n      }\n      return item.value as T;\n    },\n    has(key: string) {\n      return this.get(key) !== null;\n    },\n    delete(key: string) {\n      cacheStore.delete(key);\n    },\n    clear() {\n      cacheStore.clear();\n    },\n    cleanup() {\n      const now = Date.now();\n      for (const [key, item] of cacheStore.entries()) {\n        if (item.expiry !== null && now > item.expiry) {\n          cacheStore.delete(key);\n        }\n      }\n    },\n  };\n}\n\nfunction normalizeError(error: unknown): Error {\n  if (error instanceof Error) return error;\n  return new Error(typeof error === 'string' ? error : JSON.stringify(error));\n}\n\nfunction bootstrapDetentionSystem(): DetentionSystem {\n  // #region agent log\n  console.log('[DEBUG-HYP-D] core.ts:172 - bootstrapDetentionSystem ', {\n    timestamp: Date.now(),\n    location: 'core.ts:172',\n    hypothesisId: 'D',\n  });\n  // #endregion\n\n  const events = new EventEmitter();\n  const CacheManager = createCacheManager();\n\n  // #region agent log\n  console.log('[DEBUG-HYP-D] core.ts:175 - EventEmitter  CacheManager ', {\n    timestamp: Date.now(),\n    eventsType: typeof events,\n    cacheManagerType: typeof CacheManager,\n    location: 'core.ts:175',\n    hypothesisId: 'D',\n  });\n  // #endregion\n\n  const system: DetentionSystem = {\n    version: '3.2.0',\n    initialized: false,\n    modules: {},\n    config: {\n      tokenBudget: 100000,\n      fallbackBudget: 40000,\n      compressionQuality: 0.8,\n      cacheExpiry: 600000,\n      healthCheckInterval: 500,\n      healthCheckTimeout: 3000,\n    },\n    state: {\n      mode: 'detecting',\n      tokenUsed: 0,\n      lastHealthCheck: 0,\n      errors: [],\n    },\n    events,\n    CacheManager,\n    EventEmitter,\n\n    ping() {\n      system.state.lastHealthCheck = Date.now();\n      return true;\n    },\n\n    checkTokenBudget() {\n      const total = system.state.mode === 'external' ? system.config.tokenBudget : system.config.fallbackBudget;\n      const used = system.state.tokenUsed;\n      const percentage = (used / total) * 100;\n\n      const status: BudgetStatus = percentage > 95 ? 'critical' : percentage > 85 ? 'warning' : 'normal';\n\n      return {\n        used,\n        total,\n        percentage: percentage.toFixed(2),\n        remaining: total - used,\n        status,\n      };\n    },\n\n    updateTokenUsage(tokens: number) {\n      system.state.tokenUsed += tokens;\n      const budget = system.checkTokenBudget();\n\n      if (budget.status === 'warning') {\n        console.warn(`[Token] :  ${budget.percentage}%`);\n        system.events.emit('token_warning', budget);\n      } else if (budget.status === 'critical') {\n        console.error(`[Token] :  ${budget.percentage}%`);\n        system.events.emit('token_critical', budget);\n      }\n\n      return budget;\n    },\n\n    compressContent(content: unknown, quality: number | null = null) {\n      const text = typeof content === 'string' ? content : JSON.stringify(content);\n      const actualQuality = quality ?? system.config.compressionQuality;\n\n      let compressed = text\n        .replace(/\\s+/g, ' ')\n        .replace(/\\n\\s*\\n/g, '\\n')\n        .trim();\n\n      if (actualQuality < 0.9) {\n        compressed = compressed.replace(//g, ',').replace(//g, '.').replace(//g, ';').replace(//g, ':');\n      }\n\n      const originalSize = text.length;\n      const compressedSize = compressed.length;\n      const ratio = ((1 - compressedSize / originalSize) * 100).toFixed(2);\n\n      console.info(`[] : ${originalSize} -> : ${compressedSize} ( ${ratio}%)`);\n\n      return compressed;\n    },\n\n    registerModule(name: string, module: unknown) {\n      if (system.modules[name]) {\n        console.warn(`[]  ${name} `);\n      }\n      system.modules[name] = module;\n      console.info(`[]  ${name} `);\n      system.events.emit('module_registered', { name, module });\n\n      // \n      try {\n        if (window.parent && window.parent !== window) {\n          (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem }).detentionSystem = system;\n          (window.parent as any).DS = system;\n        }\n      } catch (e) {\n        // \n      }\n    },\n\n    getModule<T = unknown>(name: string) {\n      return system.modules[name] as T | undefined;\n    },\n\n    handleError(error: unknown, context: string = 'unknown') {\n      const normalized = normalizeError(error);\n      const errorInfo: DetentionErrorInfo = {\n        message: normalized.message,\n        context,\n        timestamp: Date.now(),\n        stack: normalized.stack,\n      };\n\n      system.state.errors.push(errorInfo);\n      console.error(`[]  [${context}]:`, normalized);\n      system.events.emit('error', errorInfo);\n\n      if (system.state.errors.length > 100) {\n        system.state.errors.shift();\n      }\n    },\n\n    detectEnvironment() {\n      const env: EnvironmentInfo = {\n        isSillyTavern: false,\n        version: null,\n        hasHelper: false,\n        helperVersion: null,\n        hasDataTable: false,\n      };\n\n      const isSillyTavernAvailable = typeof SillyTavern !== 'undefined';\n      if (isSillyTavernAvailable || $('#send_textarea').length > 0) {\n        env.isSillyTavern = true;\n        if (typeof getTavernVersion === 'function') {\n          env.version = getTavernVersion() ?? null;\n        }\n      }\n\n      if (typeof getTavernHelperVersion === 'function') {\n        env.hasHelper = true;\n        env.helperVersion = getTavernHelperVersion() ?? null;\n      }\n\n      const windowWithTable = window as typeof window & {\n        insertRow?: unknown;\n        updateRow?: unknown;\n      };\n      if (typeof windowWithTable.insertRow === 'function' && typeof windowWithTable.updateRow === 'function') {\n        env.hasDataTable = true;\n      }\n\n      return env;\n    },\n\n    initialize() {\n      if (system.initialized) {\n        console.warn('[] ');\n        return;\n      }\n\n      console.info('[] ...');\n\n      const env = system.detectEnvironment();\n      console.info('[] :', env);\n\n      if (!env.isSillyTavern) {\n        console.warn('[] SillyTavern');\n      }\n\n      system.state.mode = 'external';\n      system.initialized = true;\n\n      console.info('[] ');\n      console.info(`[] : ${system.version}`);\n      console.info(`[] : ${system.state.mode}`);\n      console.info(`[] Token: ${system.config.tokenBudget}`);\n\n      system.events.emit('initialized', { env, state: system.state });\n    },\n\n    // \n    initializeState(state?: {\n      name?: string;\n      age?: number;\n      crime?: string;\n      health?: number;\n      mental?: number;\n      strength?: number;\n      intelligence?: number;\n      appearance?: {\n        height?: number;\n        weight?: number;\n        hair?: string;\n        condition?: string;\n      };\n      clothing?: {\n        top?: string;\n        bottom?: string;\n        underwear?: string;\n        underpants?: string;\n        socks?: string;\n        shoes?: string;\n        restraints?: string;\n        cleanliness?: string;\n      };\n      currentTask?: string;\n      currentThought?: string;\n      biggestWorry?: string;\n    }) {\n      if (!state) {\n        console.warn('[] initializeState ');\n        return;\n      }\n\n      console.info('[] :', state);\n\n      //  stateChanged \n      system.events.emit('stateChanged', state);\n\n      // \n      const statusPanel = system.getModule('statusPanel') as\n        | {\n            initialize?: () => void;\n            getState?: () => unknown;\n          }\n        | undefined;\n\n      if (statusPanel) {\n        console.info('[]  ');\n      } else {\n        console.warn('[]  ');\n      }\n    },\n  };\n\n  // #region agent log\n  console.log('[DEBUG-HYP-D] core.ts:365 - bootstrapDetentionSystem  system ', {\n    timestamp: Date.now(),\n    systemType: typeof system,\n    systemExists: !!system,\n    hasVersion: 'version' in system,\n    hasModules: 'modules' in system,\n    hasEvents: 'events' in system,\n    systemVersion: system.version,\n    location: 'core.ts:365',\n    hypothesisId: 'D',\n  });\n  // #endregion\n\n  return system;\n}\n\nfunction ensureCacheCleanup(system: DetentionSystem) {\n  if (!cacheCleanupTimer) {\n    cacheCleanupTimer = setInterval(() => system.CacheManager.cleanup(), 60000);\n  }\n}\n\nfunction stopCacheCleanup() {\n  if (cacheCleanupTimer) {\n    clearInterval(cacheCleanupTimer);\n    cacheCleanupTimer = undefined;\n  }\n}\n\n// #region agent log\nconsole.log('[DEBUG-HYP-B] core.ts:363 - ', {\n  timestamp: Date.now(),\n  windowExists: typeof window !== 'undefined',\n  windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n  location: 'core.ts:363',\n  hypothesisId: 'B',\n});\n// #endregion\n\n// \nif (!window.detentionSystem) {\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'core.ts:',\n      message: ' bootstrapDetentionSystem',\n      data: {\n        windowType: typeof window,\n        isIframe: window.parent !== window,\n        parentExists: !!window.parent,\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'fix-init-failure',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n  // #endregion\n\n  try {\n    window.detentionSystem = bootstrapDetentionSystem();\n    //  DS \n    (window as any).DS = window.detentionSystem;\n    console.info('[]   DS  window.detentionSystem ');\n\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'core.ts:',\n        message: '',\n        data: {\n          hasWindowDetentionSystem: typeof window.detentionSystem !== 'undefined',\n          hasPing: typeof (window.detentionSystem as DetentionSystem).ping === 'function',\n          pingResult:\n            typeof (window.detentionSystem as DetentionSystem).ping === 'function'\n              ? (window.detentionSystem as DetentionSystem).ping()\n              : 'N/A',\n          hasInitializeState:\n            typeof (window.detentionSystem as DetentionSystem & { initializeState?: unknown }).initializeState ===\n            'function',\n          version: (window.detentionSystem as DetentionSystem).version,\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'fix-init-failure',\n        hypothesisId: 'B',\n      }),\n    }).catch(() => {});\n    // #endregion\n\n    // #region agent log\n    console.log('[DEBUG-HYP-D] core.ts:365 - bootstrapDetentionSystem ', {\n      timestamp: Date.now(),\n      resultType: typeof window.detentionSystem,\n      resultExists: !!window.detentionSystem,\n      hasVersion: !!(window.detentionSystem && 'version' in window.detentionSystem),\n      location: 'core.ts:365',\n      hypothesisId: 'D',\n    });\n    // #endregion\n\n    console.info('[]  ');\n    console.info('[] window.detentionSystem :', typeof window.detentionSystem);\n    console.info('[] window.detentionSystem :', window.detentionSystem);\n    // \n    (window as any).__DETENTION_SYSTEM_CORE_LOADED__ = true;\n    (window as any).__DETENTION_SYSTEM_VERSION__ = window.detentionSystem.version;\n\n    //  iframe \n    try {\n      if (window.parent && window.parent !== window) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:iframe',\n            message: ' iframe ',\n            data: {\n              hasParent: !!window.parent,\n              parentIsDifferent: window.parent !== window,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-init-failure',\n            hypothesisId: 'C',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        //  jQuery ready \n        $(() => {\n          try {\n            (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem }).detentionSystem =\n              window.detentionSystem;\n            //  DS\n            (window.parent as any).DS = window.detentionSystem;\n            console.info('[]  iframe ');\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:iframe',\n                message: '',\n                data: {\n                  parentHasDetentionSystem:\n                    typeof (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem })\n                      .detentionSystem !== 'undefined',\n                  parentHasDS: typeof (window.parent as any).DS !== 'undefined',\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-init-failure',\n                hypothesisId: 'D',\n              }),\n            }).catch(() => {});\n            // #endregion\n          } catch (e) {\n            console.warn('[]  :', e);\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:iframe',\n                message: '',\n                data: {\n                  error: e instanceof Error ? e.message : String(e),\n                  errorType: e instanceof Error ? e.constructor.name : typeof e,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-init-failure',\n                hypothesisId: 'E',\n              }),\n            }).catch(() => {});\n            // #endregion\n          }\n        });\n\n        //  jQuery ready\n        try {\n          (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem }).detentionSystem =\n            window.detentionSystem;\n          (window.parent as any).DS = window.detentionSystem;\n          console.info('[]  iframe ');\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:iframe',\n              message: '',\n              data: {\n                parentHasDetentionSystem:\n                  typeof (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem })\n                    .detentionSystem !== 'undefined',\n                parentHasDS: typeof (window.parent as any).DS !== 'undefined',\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-init-failure',\n              hypothesisId: 'F',\n            }),\n          }).catch(() => {});\n          // #endregion\n        } catch (e) {\n          console.debug('[]  jQuery ready :', e);\n        }\n      } else {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:iframe',\n            message: ' iframe ',\n            data: {\n              hasParent: !!window.parent,\n              parentIsDifferent: window.parent !== window,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-init-failure',\n            hypothesisId: 'G',\n          }),\n        }).catch(() => {});\n        // #endregion\n      }\n    } catch (e) {\n      console.warn('[]  iframe :', e);\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'core.ts:iframe',\n          message: 'iframe ',\n          data: {\n            error: e instanceof Error ? e.message : String(e),\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-init-failure',\n          hypothesisId: 'H',\n        }),\n      }).catch(() => {});\n      // #endregion\n    }\n  } catch (error) {\n    // #region agent log\n    console.error('[DEBUG-HYP-D] core.ts:365 - bootstrapDetentionSystem ', {\n      timestamp: Date.now(),\n      error: error instanceof Error ? error.message : String(error),\n      errorStack: error instanceof Error ? error.stack : undefined,\n      location: 'core.ts:365',\n      hypothesisId: 'D',\n    });\n    // #endregion\n    throw error;\n  }\n} else {\n  // #region agent log\n  console.log('[DEBUG-HYP-E] core.ts:364 - window.detentionSystem ', {\n    timestamp: Date.now(),\n    existingType: typeof window.detentionSystem,\n    location: 'core.ts:364',\n    hypothesisId: 'E',\n  });\n  // #endregion\n}\n\n// #region agent log\nconsole.log('[DEBUG-HYP-F] core.ts:371 -  jQuery ', {\n  timestamp: Date.now(),\n  jQueryExists: typeof $ !== 'undefined',\n  jQueryType: typeof $,\n  location: 'core.ts:371',\n  hypothesisId: 'F',\n});\n// #endregion\n\n$(() => {\n  // #region agent log\n  console.log('[DEBUG-HYP-F] core.ts:371 - jQuery ready ', {\n    timestamp: Date.now(),\n    windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n    location: 'core.ts:371',\n    hypothesisId: 'F',\n  });\n  // #endregion\n\n  console.info('[] jQuery ready');\n\n  // \n  if (!window.detentionSystem) {\n    // #region agent log\n    console.warn('[DEBUG-HYP-E] core.ts:375 -  jQuery ready ', {\n      timestamp: Date.now(),\n      location: 'core.ts:375',\n      hypothesisId: 'E',\n    });\n    // #endregion\n\n    console.warn('[]  jQuery ready ');\n    window.detentionSystem = bootstrapDetentionSystem();\n    //  DS \n    if (!(window as any).DS) {\n      (window as any).DS = window.detentionSystem;\n      console.info('[]   DS  window.detentionSystem ');\n    }\n    console.info('[] jQuery ready ');\n  } else {\n    // #region agent log\n    console.log('[DEBUG-HYP-E] core.ts:375 - jQuery ready ', {\n      timestamp: Date.now(),\n      systemType: typeof window.detentionSystem,\n      systemVersion: window.detentionSystem?.version,\n      location: 'core.ts:375',\n      hypothesisId: 'E',\n    });\n    // #endregion\n  }\n\n  const system = window.detentionSystem!;\n\n  //  DS \n  if (!(window as any).DS) {\n    (window as any).DS = system;\n    console.info('[]   DS  window.detentionSystem ');\n  }\n\n  console.info('[] :', {\n    exists: !!system,\n    version: system.version,\n    initialized: system.initialized,\n  });\n\n  ensureCacheCleanup(system);\n\n  console.info('[]  1 ...');\n  setTimeout(() => {\n    console.info('[] setTimeout ...');\n    try {\n      system.initialize();\n      console.info('[] initialize() ');\n\n      // \n      try {\n        if (window.parent && window.parent !== window && system) {\n          (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem }).detentionSystem = system;\n          //  DS\n          (window.parent as any).DS = system;\n          console.info('[]  ');\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:',\n              message: '',\n              data: {\n                parentHasDetentionSystem:\n                  typeof (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem })\n                    .detentionSystem !== 'undefined',\n                parentHasDS: typeof (window.parent as any).DS !== 'undefined',\n                modulesCount: Object.keys(system.modules).length,\n                moduleNames: Object.keys(system.modules),\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-init-failure',\n              hypothesisId: 'I',\n            }),\n          }).catch(() => {});\n          // #endregion\n        }\n      } catch (e) {\n        console.warn('[]  :', e);\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:',\n            message: '',\n            data: {\n              error: e instanceof Error ? e.message : String(e),\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-init-failure',\n            hypothesisId: 'J',\n          }),\n        }).catch(() => {});\n        // #endregion\n      }\n\n      //  DS\n      if (!(window as any).DS && system) {\n        (window as any).DS = system;\n        console.info('[]   DS ');\n      }\n    } catch (error) {\n      console.error('[] initialize() :', error);\n      system.handleError(error, 'initialize');\n    }\n  }, 1000);\n});\n\n$(window).on('pagehide', () => {\n  stopCacheCleanup();\n});\n\n// ==========  ==========\n// ID\nlet skipMessageId: number | null = null;\n\n$(() => {\n  console.info('[] ...');\n\n  // \n  const skipCommandMessages = new Set<number>();\n\n  // \n  //  eventMakeFirst  quick-reply \n  eventMakeFirst(tavern_events.USER_MESSAGE_RENDERED, async (message_id: number) => {\n    try {\n      const messages = getChatMessages(message_id, { role: 'user' });\n      const userMessage = messages[0];\n      if (!userMessage || !userMessage.message) return;\n\n      const userInput = userMessage.message;\n\n      //  data \n      const messageData = userMessage.data as { isSystemEventMessage?: boolean } | undefined;\n      const isSystemEventMessage = messageData?.isSystemEventMessage === true;\n      const isSystemByContent =\n        userInput.startsWith('[]') || (userInput.startsWith('[') && userInput.includes(']'));\n\n      if (isSystemEventMessage || isSystemByContent) {\n        //  event_triggered \n        //  quick-reply \n        // \n        //\n        // \n        // 1.  eventMakeFirst\n        // 2.  GENERATION_STARTED \n        // 3.  waitingForEventResponse \n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:USER_MESSAGE_RENDERED',\n            message: 'event_triggered',\n            data: {\n              message_id,\n              isSystemEventMessage,\n              isSystemByContent,\n              userInput: userInput.substring(0, 50) + '...',\n              waitingForEventResponse,\n              duringGenerating:\n                typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v7',\n            hypothesisId: 'SKIP_SYSTEM_EVENT',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        if (waitingForEventResponse) {\n          //  quick-reply\n          try {\n            await stopAllGeneration();\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:USER_MESSAGE_RENDERED',\n                message: 'USER_MESSAGE_RENDERED',\n                data: {\n                  message_id,\n                  waitingForEventResponse,\n                  afterStopDuringGenerating:\n                    typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-duplicate-trigger-v7',\n                hypothesisId: 'STOP_IN_USER_RENDERED',\n              }),\n            }).catch(() => {});\n            // #endregion\n          } catch (error) {\n            console.warn('[] USER_MESSAGE_RENDERED:', error);\n          }\n        }\n\n        return; // \n      }\n\n      // \n      // 151515\n      const skipDayPattern =\n        /(?:|||)\\s*(\\d+|[]?|[][]?|[]??[]?|[]??[]??[]?|)\\s*[\\s]*/;\n      const skipDayMatch = userInput.match(skipDayPattern);\n\n      if (skipDayMatch) {\n        // \n        try {\n          await setChatMessages([{ message_id, is_hidden: true, message: '.' }], { refresh: 'all' });\n          skipCommandMessages.add(message_id);\n          console.info(`[]  USER_MESSAGE_RENDERED (message_id: ${message_id})`);\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:USER_MESSAGE_RENDERED',\n              message: '',\n              data: { message_id, userInput },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-skip-rounds-early',\n              hypothesisId: 'HIDE_EARLY',\n            }),\n          }).catch(() => {});\n          // #endregion\n        } catch (error) {\n          console.warn('[] USER_MESSAGE_RENDERED:', error);\n        }\n      }\n    } catch (error) {\n      console.warn('[] USER_MESSAGE_RENDERED:', error);\n    }\n  });\n\n  // AI\n  eventOn(tavern_events.GENERATE_BEFORE_COMBINE_PROMPTS, () => {\n    // \n    if (skipCommandMessages.size > 0) {\n      // \n      skipCommandMessages.clear();\n      // \n    }\n\n    // \n    try {\n      const messages = getChatMessages(-1, { role: 'user' });\n      const lastUserMessage = messages[messages.length - 1];\n      if (lastUserMessage) {\n        const messageData = lastUserMessage.data as { isSystemEventMessage?: boolean } | undefined;\n        const isSystemEventMessage = messageData?.isSystemEventMessage === true;\n        const userInput = lastUserMessage.message || '';\n        const isSystemByContent =\n          userInput.startsWith('[]') || (userInput.startsWith('[') && userInput.includes(']'));\n\n        if (isSystemEventMessage || isSystemByContent) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:GENERATE_BEFORE_COMBINE_PROMPTS',\n              message: '',\n              data: {\n                message_id: lastUserMessage.message_id,\n                isSystemEventMessage,\n                isSystemByContent,\n                waitingForEventResponse,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-duplicate-trigger-v7',\n              hypothesisId: 'GENERATE_BEFORE_CHECK',\n            }),\n          }).catch(() => {});\n          // #endregion\n          // GENERATE_BEFORE_COMBINE_PROMPTS \n          //  MESSAGE_SENT  USER_MESSAGE_RENDERED \n        }\n      }\n    } catch (error) {\n      // \n    }\n  });\n\n  // \n  //  ID triggerSlash \n  let lastTriggerTime: number | null = null;\n  let lastTriggerEventName: string | null = null;\n  const generationTracking: Array<{\n    generation_id: string | null;\n    type: string;\n    timestamp: number;\n    triggerTime: number | null;\n    eventName: string | null;\n    source: 'iframe' | 'tavern';\n  }> = [];\n\n  //  iframe_events  tavern_events  GENERATION_STARTED\n  eventOn(iframe_events.GENERATION_STARTED, (generation_id: string) => {\n    // #region agent log -  GENERATION_STARTED iframe\n    const now = Date.now();\n    generationTracking.push({\n      generation_id: generation_id,\n      type: 'iframe',\n      timestamp: now,\n      triggerTime: lastTriggerTime,\n      eventName: lastTriggerEventName,\n      source: 'iframe',\n    });\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'core.ts:GENERATION_STARTED:iframe',\n        message: 'iframe_events.GENERATION_STARTED ',\n        data: {\n          generation_id,\n          timestamp: now,\n          lastTriggerTime,\n          lastTriggerEventName,\n          timeSinceLastTrigger: lastTriggerTime ? now - lastTriggerTime : null,\n          trackingCount: generationTracking.length,\n          source: 'iframe',\n        },\n        timestamp: now,\n        sessionId: 'debug-session',\n        runId: 'track-streaming-gen',\n        hypothesisId: 'GEN_STARTED_TRACK_IFRAME',\n      }),\n    }).catch(() => {});\n    // #endregion\n\n    if (skipMessageId !== null) {\n      console.info(`[]   (generation_id: ${generation_id})`);\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'core.ts:GENERATION_STARTED',\n          message: '',\n          data: {\n            generation_id,\n            skipMessageId,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-skip-rounds',\n          hypothesisId: 'STOP_GEN',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      stopGenerationById(generation_id).then(success => {\n        if (success) {\n          console.info(`[]   (generation_id: ${generation_id})`);\n        } else {\n          console.warn(`[]  (generation_id: ${generation_id})`);\n        }\n        // \n        skipMessageId = null;\n      });\n      return;\n    }\n\n    // \n    try {\n      const messages = getChatMessages(-1, { role: 'user' });\n      const lastUserMessage = messages[messages.length - 1];\n      if (lastUserMessage) {\n        const messageData = lastUserMessage.data as { isSystemEventMessage?: boolean } | undefined;\n        const isSystemEventMessage = messageData?.isSystemEventMessage === true;\n        const userInput = lastUserMessage.message || '';\n        const isSystemByContent =\n          userInput.startsWith('[]') || (userInput.startsWith('[') && userInput.includes(']'));\n\n        // \n        if (waitingForEventResponse && (isSystemEventMessage || isSystemByContent)) {\n          console.warn(\n            `[]   (generation_id: ${generation_id})`,\n          );\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:GENERATION_STARTED',\n              message: '',\n              data: {\n                generation_id,\n                message_id: lastUserMessage.message_id,\n                isSystemEventMessage,\n                isSystemByContent,\n                waitingForEventResponse,\n                userInput: userInput.substring(0, 100),\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-duplicate-trigger-v7',\n              hypothesisId: 'STOP_SYSTEM_EVENT_GEN',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          stopGenerationById(generation_id).then(success => {\n            if (success) {\n              console.info(`[]   (generation_id: ${generation_id})`);\n            } else {\n              console.warn(`[]  (generation_id: ${generation_id})`);\n            }\n          });\n        }\n      }\n    } catch (error) {\n      // \n    }\n  });\n\n  //  tavern_events.GENERATION_STARTED triggerSlash \n  eventOn(tavern_events.GENERATION_STARTED, (type: string, options: unknown, dry_run: boolean) => {\n    // #region agent log -  GENERATION_STARTED tavern\n    const now = Date.now();\n    generationTracking.push({\n      generation_id: null,\n      type,\n      timestamp: now,\n      triggerTime: lastTriggerTime,\n      eventName: lastTriggerEventName,\n      source: 'tavern',\n    });\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'core.ts:GENERATION_STARTED:tavern',\n        message: 'tavern_events.GENERATION_STARTED ',\n        data: {\n          type,\n          dry_run,\n          options: typeof options === 'object' && options !== null ? Object.keys(options as object) : typeof options,\n          timestamp: now,\n          lastTriggerTime,\n          lastTriggerEventName,\n          timeSinceLastTrigger: lastTriggerTime ? now - lastTriggerTime : null,\n          trackingCount: generationTracking.length,\n          source: 'tavern',\n          waitingForEventResponse,\n        },\n        timestamp: now,\n        sessionId: 'debug-session',\n        runId: 'track-streaming-gen',\n        hypothesisId: 'GEN_STARTED_TRACK_TAVERN',\n      }),\n    }).catch(() => {});\n    // #endregion\n  });\n\n  //  AI \n  const aiMessageTracking: Array<{\n    message_id: number;\n    timestamp: number;\n    triggerTime: number | null;\n    eventName: string | null;\n    messageLength: number;\n    messagePreview: string;\n  }> = [];\n\n  //  AI \n  //  eventMakeFirst \n  eventMakeFirst(tavern_events.CHARACTER_MESSAGE_RENDERED, (message_id: number) => {\n    try {\n      const messages = getChatMessages(message_id, { role: 'assistant' });\n      const aiMessage = messages[0];\n      if (aiMessage && aiMessage.message) {\n        const now = Date.now();\n        const messageText = aiMessage.message;\n\n        // \n        const alreadyTracked = aiMessageTracking.some(m => m.message_id === message_id);\n        if (alreadyTracked) {\n          console.warn(`[]  CHARACTER_MESSAGE_RENDERED message_id: ${message_id}`);\n          return;\n        }\n\n        aiMessageTracking.push({\n          message_id,\n          timestamp: now,\n          triggerTime: lastTriggerTime,\n          eventName: lastTriggerEventName,\n          messageLength: messageText.length,\n          messagePreview: messageText.substring(0, 100),\n        });\n\n        // #region agent log -  CHARACTER_MESSAGE_RENDERED \n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:CHARACTER_MESSAGE_RENDERED',\n            message: 'CHARACTER_MESSAGE_RENDERED ',\n            data: {\n              message_id,\n              timestamp: now,\n              lastTriggerTime,\n              lastTriggerEventName,\n              timeSinceLastTrigger: lastTriggerTime ? now - lastTriggerTime : null,\n              messageLength: messageText.length,\n              messagePreview: messageText.substring(0, 200),\n              trackingCount: aiMessageTracking.length,\n              allMessageIds: aiMessageTracking.map(m => m.message_id),\n              allMessages: aiMessageTracking.map(m => ({\n                id: m.message_id,\n                length: m.messageLength,\n                triggerTime: m.triggerTime,\n                eventName: m.eventName,\n                timestamp: m.timestamp,\n              })),\n              totalCharacters: aiMessageTracking.reduce((sum, m) => sum + m.messageLength, 0),\n              // \n              recentMessages: aiMessageTracking\n                .filter(m => Math.abs(m.timestamp - now) < 5000 && m.message_id !== message_id)\n                .map(m => ({\n                  id: m.message_id,\n                  length: m.messageLength,\n                  timeDiff: Math.abs(m.timestamp - now),\n                })),\n            },\n            timestamp: now,\n            sessionId: 'debug-session',\n            runId: 'track-streaming-gen',\n            hypothesisId: 'CHAR_MSG_RENDERED_TRACK',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        const relatedMessages = aiMessageTracking.filter(\n          m => m.triggerTime === lastTriggerTime && m.eventName === lastTriggerEventName,\n        );\n\n        // \n        if (relatedMessages.length > 1) {\n          const timeGaps = relatedMessages\n            .sort((a, b) => a.timestamp - b.timestamp)\n            .map((m, i, arr) => (i > 0 ? m.timestamp - arr[i - 1].timestamp : 0))\n            .filter(gap => gap > 0);\n\n          console.warn(\n            `[]   \"${lastTriggerEventName}\"  ${relatedMessages.length} `,\n            {\n              messageIds: relatedMessages.map(m => m.message_id),\n              lengths: relatedMessages.map(m => m.messageLength),\n              timeGaps,\n              totalLength: relatedMessages.reduce((sum, m) => sum + m.messageLength, 0),\n            },\n          );\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:CHARACTER_MESSAGE_RENDERED',\n              message: ' ',\n              data: {\n                eventName: lastTriggerEventName,\n                triggerTime: lastTriggerTime,\n                messageCount: relatedMessages.length,\n                messages: relatedMessages\n                  .sort((a, b) => a.timestamp - b.timestamp)\n                  .map((m, i, arr) => ({\n                    message_id: m.message_id,\n                    messageLength: m.messageLength,\n                    timestamp: m.timestamp,\n                    timeSinceTrigger: lastTriggerTime ? m.timestamp - lastTriggerTime : null,\n                    timeSincePrevious: i > 0 ? m.timestamp - arr[i - 1].timestamp : null,\n                    preview: m.messagePreview.substring(0, 150),\n                  })),\n                totalLength: relatedMessages.reduce((sum, m) => sum + m.messageLength, 0),\n                averageLength: relatedMessages.reduce((sum, m) => sum + m.messageLength, 0) / relatedMessages.length,\n                timeGaps,\n                potentialSplit: timeGaps.length > 0 && timeGaps.some(gap => gap < 2000), // 2\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'track-streaming-gen',\n              hypothesisId: 'MESSAGE_SPLIT_DETECTED',\n            }),\n          }).catch(() => {});\n          // #endregion\n        }\n\n        //  triggerTime \n        const recentMessages = aiMessageTracking.filter(\n          m => m.message_id !== message_id && Math.abs(m.timestamp - now) < 3000,\n        );\n        if (recentMessages.length > 0) {\n          console.info(\n            `[]  ${recentMessages.length} 3`,\n            recentMessages.map(m => ({ id: m.message_id, timeDiff: Math.abs(m.timestamp - now) })),\n          );\n        }\n      }\n    } catch (error) {\n      console.warn('[] CHARACTER_MESSAGE_RENDERED :', error);\n    }\n  });\n\n  // \n  // \n  eventOn(tavern_events.MESSAGE_SENT, async (message_id: number | string) => {\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'core.ts:MESSAGE_SENT',\n        message: 'MESSAGE_SENT',\n        data: {\n          message_id,\n          messageIdType: typeof message_id,\n          waitingForEventResponse,\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'fix-duplicate-trigger-v5',\n        hypothesisId: 'A',\n      }),\n    }).catch(() => {});\n    // #endregion\n\n    try {\n      console.info(`[]  MESSAGE_SENT message_id: ${message_id}`);\n\n      // \n      // \n      if (waitingForEventResponse) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:MESSAGE_SENT',\n            message: '',\n            data: {\n              message_id,\n              waitingForEventResponse: true,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v5',\n            hypothesisId: 'EARLY_CHECK',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        const messages = getChatMessages(-1, { role: 'user' });\n        const userMessage = messages.find(m => m.message_id === Number(message_id));\n\n        if (userMessage) {\n          //  data \n          const messageData = userMessage.data as { isSystemEventMessage?: boolean } | undefined;\n          const isSystemEventMessage = messageData?.isSystemEventMessage === true;\n          const userInput = userMessage.message || '';\n          const isSystemByContent =\n            userInput.startsWith('[]') || (userInput.startsWith('[') && userInput.includes(']'));\n\n          if (isSystemEventMessage || isSystemByContent) {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:MESSAGE_SENT',\n                message: '',\n                data: {\n                  message_id,\n                  isSystemEventMessage,\n                  isSystemByContent,\n                  matchedByData: isSystemEventMessage,\n                  matchedByContent: isSystemByContent,\n                  waitingForEventResponse: true,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-duplicate-trigger-v5',\n                hypothesisId: 'EARLY_SKIP',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            //  user_input \n            return;\n          }\n        }\n      }\n\n      // \n      const messages = getChatMessages(-1, { role: 'user' });\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'core.ts:MESSAGE_SENT',\n          message: '',\n          data: {\n            message_id,\n            messagesCount: messages.length,\n            messageIds: messages.map(m => m.message_id),\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-skip-rounds-input',\n          hypothesisId: 'B',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      const userMessage = messages.find(m => m.message_id === Number(message_id));\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'core.ts:MESSAGE_SENT',\n          message: '',\n          data: {\n            message_id,\n            foundMessage: !!userMessage,\n            hasMessage: !!(userMessage && userMessage.message),\n            messageLength: userMessage?.message?.length || 0,\n            messagePreview: userMessage?.message?.substring(0, 100) || 'N/A',\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-skip-rounds-input',\n          hypothesisId: 'C',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      if (userMessage && userMessage.message) {\n        const userInput = userMessage.message;\n        console.info('[] :', userInput.substring(0, 50) + '...');\n\n        //  data \n        const messageData = userMessage.data as { isSystemEventMessage?: boolean } | undefined;\n        const isSystemEventMessage = messageData?.isSystemEventMessage === true;\n\n        //  data \n        if (\n          isSystemEventMessage ||\n          userInput.startsWith('[]') ||\n          (userInput.startsWith('[') && userInput.includes(']'))\n        ) {\n          // \n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:MESSAGE_SENT',\n              message: '',\n              data: {\n                userInput: userInput.substring(0, 100),\n                message_id: Number(message_id),\n                isSystemEventMessage,\n                matchedByData: isSystemEventMessage,\n                matchedByContent:\n                  userInput.startsWith('[]') || (userInput.startsWith('[') && userInput.includes(']')),\n                matchedPattern: isSystemEventMessage\n                  ? 'data'\n                  : userInput.startsWith('[]')\n                    ? '[]'\n                    : '[X]',\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-duplicate-trigger-v2',\n              hypothesisId: 'SKIP_SYSTEM_MSG',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          // \n          // 1. event_triggered AI\n          // 2.  event_triggered \n          // 3. \n          //  user_input \n          // const DS_EMIT_SYSTEM = window.detentionSystem;\n          // if (DS_EMIT_SYSTEM && DS_EMIT_SYSTEM.events) {\n          //   DS_EMIT_SYSTEM.events.emit('user_input', { text: userInput, message_id });\n          // }\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:MESSAGE_SENT',\n              message: '',\n              data: {\n                message_id: Number(message_id),\n                currentMessageId: Number(message_id),\n                waitingForEventResponse,\n                isSystemMessage: true,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-duplicate-trigger',\n              hypothesisId: 'SKIP_RETURN',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          return;\n        }\n\n        // \"\"\"\"\n        const protagonistPattern = /(?:|||)\\s*(\\d+)?\\s*(?:|)?\\s*(?:||)/;\n        const protagonistMatch = userInput.match(protagonistPattern);\n\n        if (protagonistMatch) {\n          // #region agent log - HYP-PROTAGONIST: \n          try {\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:MESSAGE_SENT:',\n                message: '',\n                data: {\n                  userInput,\n                  message_id: Number(message_id),\n                  match: protagonistMatch[0],\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'protagonist-generation',\n                hypothesisId: 'PROTAGONIST-DETECT',\n              }),\n            }).catch(() => {});\n          } catch (e) {}\n          // #endregion\n\n          console.info('[] :', userInput);\n\n          try {\n            const DS_PROTAGONIST = window.detentionSystem;\n            const npcSystem = DS_PROTAGONIST?.getModule('npcSystem') as {\n              generateProtagonist?: (options?: {\n                crimeType?: string;\n                excludeCrimes?: string[];\n                background?: {\n                  isIntellectual?: boolean;\n                  isAcademic?: boolean;\n                  isBusiness?: boolean;\n                };\n                ageRange?: [number, number];\n                education?: string;\n                profession?: string[];\n              }) => {\n                name?: string;\n                age?: number;\n                crime?: string;\n                appearance?: {\n                  height?: number;\n                  weight?: number;\n                  hair?: string;\n                  skin?: string;\n                  features?: string;\n                };\n                background?: {\n                  education?: string;\n                  profession?: string;\n                };\n                personality?: {\n                  tags?: string[];\n                };\n              };\n            };\n\n            if (npcSystem && npcSystem.generateProtagonist) {\n              // \n              const options: {\n                crimeType?: string;\n                excludeCrimes?: string[];\n                background?: {\n                  isIntellectual?: boolean;\n                  isAcademic?: boolean;\n                  isBusiness?: boolean;\n                };\n                ageRange?: [number, number];\n                education?: string;\n                profession?: string[];\n              } = {};\n\n              // \n              if (userInput.includes('') || userInput.includes('')) {\n                options.crimeType = 'economic';\n              }\n              if (userInput.includes('')) {\n                options.excludeCrimes = [''];\n              } else if (userInput.includes('') || userInput.includes('')) {\n                options.excludeCrimes = [''];\n              }\n\n              // \n              if (userInput.includes('') || userInput.includes('')) {\n                options.background = { ...options.background, isIntellectual: true };\n              }\n              if (userInput.includes('') || userInput.includes('')) {\n                options.background = { ...options.background, isAcademic: false };\n              }\n              if (userInput.includes('') || userInput.includes('')) {\n                options.background = { ...options.background, isBusiness: true };\n              }\n\n              // \n              if (userInput.includes('35') || userInput.includes('45')) {\n                options.ageRange = [35, 45];\n              }\n\n              // \n              if (userInput.includes('') || userInput.includes('') || userInput.includes('')) {\n                options.education = 'high';\n              }\n\n              // #region agent log - HYP-PROTAGONIST: generateProtagonist\n              try {\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:MESSAGE_SENT:generateProtagonist',\n                    message: 'generateProtagonist',\n                    data: {\n                      hasGenerateProtagonist: !!npcSystem.generateProtagonist,\n                      options,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'protagonist-generation',\n                    hypothesisId: 'PROTAGONIST-BEFORE',\n                  }),\n                }).catch(() => {});\n              } catch (e) {}\n              // #endregion\n\n              const protagonistData = npcSystem.generateProtagonist(options);\n\n              // #region agent log - HYP-PROTAGONIST: generateProtagonist\n              try {\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:MESSAGE_SENT:generateProtagonist',\n                    message: 'generateProtagonist',\n                    data: {\n                      hasProtagonistData: !!protagonistData,\n                      protagonistName: protagonistData?.name || 'N/A',\n                      protagonistAge: protagonistData?.age || 'N/A',\n                      protagonistCrime: protagonistData?.crime || 'N/A',\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'protagonist-generation',\n                    hypothesisId: 'PROTAGONIST-AFTER',\n                  }),\n                }).catch(() => {});\n              } catch (e) {}\n              // #endregion\n\n              if (protagonistData && protagonistData.name) {\n                // \n                const chatId = SillyTavern.getCurrentChatId();\n                if (chatId) {\n                  const protagonistInfo = {\n                    name: protagonistData.name,\n                    age: protagonistData.age || 30,\n                    crime: protagonistData.crime || '',\n                    appearance: protagonistData.appearance || {\n                      height: 168,\n                      weight: 58,\n                      hair: '',\n                      skin: '',\n                      features: '',\n                    },\n                    background: protagonistData.background || {},\n                    personality: protagonistData.personality || {},\n                  };\n\n                  // replaceVariables\n                  replaceVariables(\n                    {\n                      protagonist: protagonistInfo,\n                      protagonist_name: protagonistData.name,\n                      protagonist_age: protagonistData.age || 30,\n                      protagonist_crime: protagonistData.crime || '',\n                    },\n                    { type: 'chat' },\n                  );\n\n                  console.info(\n                    '[]  :',\n                    protagonistData.name,\n                    protagonistData.age,\n                    protagonistData.crime,\n                  );\n\n                  // #region agent log - HYP-PROTAGONIST: \n                  try {\n                    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify({\n                        location: 'core.ts:MESSAGE_SENT:',\n                        message: '',\n                        data: {\n                          protagonistName: protagonistData.name,\n                          protagonistAge: protagonistData.age,\n                          protagonistCrime: protagonistData.crime,\n                          chatId,\n                        },\n                        timestamp: Date.now(),\n                        sessionId: 'debug-session',\n                        runId: 'protagonist-generation',\n                        hypothesisId: 'PROTAGONIST-SAVED',\n                      }),\n                    }).catch(() => {});\n                  } catch (e) {}\n                  // #endregion\n                }\n              } else {\n                console.warn('[] generateProtagonist');\n              }\n            } else {\n              console.warn('[] NPCgenerateProtagonist');\n            }\n          } catch (error) {\n            console.error('[] :', error);\n\n            // #region agent log - HYP-PROTAGONIST: \n            try {\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:MESSAGE_SENT:',\n                  message: '',\n                  data: {\n                    error: error instanceof Error ? error.message : String(error),\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'protagonist-generation',\n                  hypothesisId: 'PROTAGONIST-ERROR',\n                }),\n              }).catch(() => {});\n            } catch (e) {}\n            // #endregion\n          }\n\n          // return\n        }\n\n        // \"X\"\"X\"\"X\"\n        // 1015\n        const skipDayPattern =\n          /(?:|||)\\s*(\\d+|[]?|[][]?|[]??[]?|[]??[]??[]?|)\\s*[\\s]*/;\n        const skipDayMatch = userInput.match(skipDayPattern);\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:MESSAGE_SENT',\n            message: '',\n            data: {\n              userInput,\n              skipDayMatch: skipDayMatch ? skipDayMatch[0] : null,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-skip-rounds-input',\n            hypothesisId: 'D',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        const DS_CHECK = window.detentionSystem;\n        if (DS_CHECK && DS_CHECK.initialized) {\n          const eventSystem = DS_CHECK.getModule('eventSystem');\n          if (eventSystem && (DS_CHECK as any).advanceDay) {\n            let daysToSkip = 0;\n\n            // \"\"\"\"\n            const parseNumber = (numStr: string): number => {\n              // \n              const parsed = parseInt(numStr, 10);\n              if (!isNaN(parsed)) return parsed;\n\n              // \n              const chineseDigits: Record<string, number> = {\n                : 0,\n                : 1,\n                : 2,\n                : 3,\n                : 4,\n                : 5,\n                : 6,\n                : 7,\n                : 8,\n                : 9,\n                : 10,\n                : 100,\n                : 1000,\n                : 10000,\n              };\n\n              // \n              if (numStr in chineseDigits) return chineseDigits[numStr];\n\n              // \"\"\"\"\"\"\n              let result = 0;\n\n              // \"X\"\"\"\"\"\n              if (numStr.startsWith('')) {\n                result = 10;\n                const rest = numStr.slice(1);\n                if (rest in chineseDigits) result += chineseDigits[rest];\n              }\n              // \"X\"\"\"\"\"\n              else if (numStr.endsWith('')) {\n                const prefix = numStr.slice(0, -1);\n                if (prefix in chineseDigits) result = chineseDigits[prefix] * 10;\n              }\n              // \"XY\"\"\"\"\"\n              else {\n                const shiIndex = numStr.indexOf('');\n                if (shiIndex > -1) {\n                  const before = numStr.slice(0, shiIndex);\n                  const after = numStr.slice(shiIndex + 1);\n                  const beforeNum = before in chineseDigits ? chineseDigits[before] : 0;\n                  const afterNum = after in chineseDigits ? chineseDigits[after] : 0;\n                  result = (beforeNum || 1) * 10 + afterNum; // \"\"1\"\"\n                }\n              }\n\n              return result > 0 ? result : 0;\n            };\n\n            // \"X\"\"X\"\"X\"\n            if (skipDayMatch) {\n              daysToSkip = parseNumber(skipDayMatch[1]);\n              if (daysToSkip > 0) {\n                console.info(`[] /: ${skipDayMatch[0].trim()} (${daysToSkip})`);\n              }\n            }\n\n            // \n            if (daysToSkip > 0) {\n              // \n              if (skipCommandMessages.has(Number(message_id))) {\n                console.debug(`[]  ${message_id} `);\n                return;\n              }\n\n              // \n              skipMessageId = Number(message_id);\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:MESSAGE_SENT',\n                  message: '/',\n                  data: {\n                    userInput,\n                    daysToSkip,\n                    originalInput: userInput,\n                    message_id: Number(message_id),\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-skip-rounds',\n                  hypothesisId: 'A',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              // AI\n              try {\n                await stopAllGeneration();\n                console.info(`[]  `);\n\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:MESSAGE_SENT',\n                    message: 'stopAllGeneration',\n                    data: {\n                      duringGenerating:\n                        typeof builtin !== 'undefined' && builtin.duringGenerating\n                          ? builtin.duringGenerating()\n                          : 'unknown',\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-skip-rounds',\n                    hypothesisId: 'STOP_GEN',\n                  }),\n                }).catch(() => {});\n                // #endregion\n\n                // event_triggered\n                const waitForGenerationToStop = (): Promise<void> => {\n                  return new Promise(resolve => {\n                    let resolved = false;\n                    let eventReturn: { stop: () => void } | null = null;\n\n                    const cleanup = () => {\n                      if (eventReturn) {\n                        eventReturn.stop();\n                        eventReturn = null;\n                      }\n                    };\n\n                    //  eventOnce \n                    eventReturn = eventOnce(tavern_events.GENERATION_ENDED, () => {\n                      if (!resolved) {\n                        // 800ms\n                        setTimeout(() => {\n                          if (!resolved) {\n                            resolved = true;\n                            clearTimeout(timeout);\n                            cleanup();\n                            resolve();\n                          }\n                        }, 800);\n                      }\n                    });\n\n                    // 2500msGENERATION_ENDED\n                    const timeout = setTimeout(() => {\n                      if (!resolved) {\n                        resolved = true;\n                        cleanup();\n                        // #region agent log\n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                          method: 'POST',\n                          headers: { 'Content-Type': 'application/json' },\n                          body: JSON.stringify({\n                            location: 'core.ts:MESSAGE_SENT',\n                            message: '',\n                            data: {\n                              duringGenerating:\n                                typeof builtin !== 'undefined' && builtin.duringGenerating\n                                  ? builtin.duringGenerating()\n                                  : 'unknown',\n                            },\n                            timestamp: Date.now(),\n                            sessionId: 'debug-session',\n                            runId: 'fix-skip-rounds',\n                            hypothesisId: 'WAIT_TIMEOUT',\n                          }),\n                        }).catch(() => {});\n                        // #endregion\n                        resolve();\n                      }\n                    }, 2500);\n\n                    // resolve\n                    if (typeof builtin === 'undefined' || !builtin.duringGenerating || !builtin.duringGenerating()) {\n                      if (!resolved) {\n                        resolved = true;\n                        clearTimeout(timeout);\n                        cleanup();\n                        resolve();\n                      }\n                    }\n                  });\n                };\n\n                await waitForGenerationToStop();\n\n                // \n                let finalCheckCount = 0;\n                while (\n                  typeof builtin !== 'undefined' &&\n                  builtin.duringGenerating &&\n                  builtin.duringGenerating() &&\n                  finalCheckCount < 5\n                ) {\n                  finalCheckCount++;\n                  console.warn(`[]   (${finalCheckCount})`);\n                  await stopAllGeneration();\n                  // 500ms\n                  await new Promise(resolve => setTimeout(resolve, 500));\n                }\n\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:MESSAGE_SENT',\n                    message: '',\n                    data: {\n                      duringGenerating:\n                        typeof builtin !== 'undefined' && builtin.duringGenerating\n                          ? builtin.duringGenerating()\n                          : 'unknown',\n                      finalCheckCount,\n                      forcedStop: finalCheckCount > 0,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-skip-rounds',\n                    hypothesisId: 'GEN_STOPPED',\n                  }),\n                }).catch(() => {});\n                // #endregion\n              } catch (stopError) {\n                console.warn('[] :', stopError);\n              }\n\n              // USER_MESSAGE_RENDERED\n              const checkMessages = getChatMessages(Number(message_id), { role: 'user' });\n              const existingMessage = checkMessages[0];\n              const alreadyHidden = existingMessage?.is_hidden === true || skipCommandMessages.has(Number(message_id));\n\n              if (!alreadyHidden) {\n                // AI\n                try {\n                  await setChatMessages([{ message_id: Number(message_id), is_hidden: true, message: '.' }], {\n                    refresh: 'all',\n                  });\n                  skipCommandMessages.add(Number(message_id));\n                  console.info(`[]  MESSAGE_SENT (message_id: ${message_id})`);\n\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:MESSAGE_SENT',\n                      message: '',\n                      data: {\n                        message_id: Number(message_id),\n                      },\n                      timestamp: Date.now(),\n                      sessionId: 'debug-session',\n                      runId: 'fix-skip-rounds',\n                      hypothesisId: 'DELETE',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n                } catch (hideError) {\n                  console.warn('[] :', hideError);\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:MESSAGE_SENT',\n                      message: '',\n                      data: {\n                        error: hideError instanceof Error ? hideError.message : String(hideError),\n                        message_id: Number(message_id),\n                      },\n                      timestamp: Date.now(),\n                      sessionId: 'debug-session',\n                      runId: 'fix-skip-rounds',\n                      hypothesisId: 'HIDE_ERROR',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n                }\n              } else {\n                console.info(`[] USER_MESSAGE_RENDERED (message_id: ${message_id})`);\n              }\n\n              // \n              try {\n                const worldbookLoader = DS_CHECK.getModule('worldbook') as {\n                  loadWorldbook?: (bookName: string) => Promise<unknown>;\n                };\n                if (worldbookLoader && worldbookLoader.loadWorldbook) {\n                  console.info('[] ');\n                  // \n                  Promise.all([\n                    worldbookLoader.loadWorldbook('environment_descriptions').catch(err => {\n                      console.warn('[] :', err);\n                    }),\n                    worldbookLoader.loadWorldbook('internal_basic_procedures').catch(err => {\n                      console.warn('[] :', err);\n                    }),\n                  ]).catch(() => {\n                    // \n                  });\n                }\n              } catch (loadError) {\n                console.warn('[] :', loadError);\n              }\n\n              // \n              try {\n                const result = (DS_CHECK as any).advanceDay(daysToSkip) as {\n                  interrupted?: boolean;\n                  currentDay?: number;\n                  tempCurrentDay?: number;\n                  pendingDays?: number;\n                  event?: { name?: string; priority?: number };\n                };\n\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:MESSAGE_SENT',\n                    message: '/',\n                    data: {\n                      daysToSkip,\n                      result,\n                      interrupted: result.interrupted,\n                      eventName: result.event?.name,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-skip-rounds',\n                    hypothesisId: 'B',\n                  }),\n                }).catch(() => {});\n                // #endregion\n\n                if (result && result.interrupted && result.event) {\n                  // currentDay\n                  const eventDay = result.event.day ?? result.tempCurrentDay ?? result.currentDay ?? 0;\n                  console.info(`[]  ${daysToSkip} : ${result.event.name} (${eventDay})`);\n\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:MESSAGE_SENT',\n                      message: '',\n                      data: {\n                        daysToSkip,\n                        eventName: result.event.name,\n                        eventPriority: result.event.priority,\n                        currentDay: result.currentDay,\n                        willWaitForEventTriggered: true,\n                      },\n                      timestamp: Date.now(),\n                      sessionId: 'debug-session',\n                      runId: 'fix-skip-rounds',\n                      hypothesisId: 'INTERRUPTED',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n\n                  //  advanceDay  DS.events.emit('event_triggered') \n                  // event_triggered AI\n                  //  event_triggered \n                } else {\n                  // AI\n                  if (result.pendingDays !== undefined && result.pendingDays > 0) {\n                    const eventSystem = DS_CHECK.getModule('eventSystem') as {\n                      confirmDayAdvancement?: (pendingDays: number) => void;\n                    };\n                    if (eventSystem && eventSystem.confirmDayAdvancement) {\n                      eventSystem.confirmDayAdvancement(result.pendingDays);\n                    }\n                  }\n\n                  const finalDay = result.tempCurrentDay ?? result.currentDay ?? 0;\n                  console.info(`[]  ${daysToSkip}  ${finalDay} `);\n\n                  // AI\n                  // AI\n                  try {\n                    await createChatMessages([\n                      {\n                        role: 'system',\n                        message: `[]  ${daysToSkip}  ${finalDay} `,\n                        is_hidden: true,\n                      },\n                    ]);\n                  } catch (createError) {\n                    console.warn('[] :', createError);\n                  }\n                }\n              } catch (error) {\n                console.error('[] :', error);\n\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:MESSAGE_SENT',\n                    message: '',\n                    data: {\n                      error: error instanceof Error ? error.message : String(error),\n                      daysToSkip,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-skip-rounds',\n                    hypothesisId: 'C',\n                  }),\n                }).catch(() => {});\n                // #endregion\n              }\n\n              // \n              skipMessageId = null;\n\n              // \n              return;\n            }\n          }\n        }\n\n        //  user_input \n        const DS_EMIT = window.detentionSystem;\n        if (DS_EMIT && DS_EMIT.events) {\n          DS_EMIT.events.emit('user_input', { text: userInput, message_id });\n        }\n      }\n    } catch (error) {\n      console.warn('[] :', error);\n    }\n  });\n\n  // \n  let waitingForEventResponse = false;\n\n  console.info('[]  ');\n  console.info('[]  MESSAGE_SENT \"X\"');\n\n  // AI\n  const DS_EVENT = window.detentionSystem as DetentionSystem & {\n    generateNPC?: (\n      count?: number,\n      context?: Record<string, unknown>,\n    ) => Array<{\n      name?: string;\n      role?: string;\n      age?: number;\n      rank?: string;\n      type?: string;\n      relation?: string;\n      relationship?: { influence?: number };\n    }>;\n    generateNPCForEvent?: (\n      eventType: string,\n    ) =>\n      | { name: string; role?: string; age?: number; rank?: string; type?: string; relation?: string }\n      | { police: { name: string; rank?: string }; witnesses: Array<{ name: string }> };\n    getCurrentCellNPCs?: () => Array<{ name?: string; relationship?: { influence?: number } }>;\n    setCurrentCellNPCs?: (npcs: Array<{ name?: string; relationship?: { influence?: number } }>) => void;\n  };\n  if (DS_EVENT && DS_EVENT.events) {\n    DS_EVENT.events.on('event_triggered', async (eventData?: unknown) => {\n      try {\n        const event = eventData as\n          | {\n              id?: string;\n              name?: string;\n              description?: string;\n              type?: string;\n              priority?: number;\n              day?: number;\n              text?: string;\n            }\n          | undefined;\n\n        if (!event || !event.name) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: '',\n              data: {\n                hasEvent: !!event,\n                eventName: event?.name,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-event-trigger',\n              hypothesisId: 'B',\n            }),\n          }).catch(() => {});\n          // #endregion\n          return;\n        }\n\n        //  <= 4\n        // LEGAL(1), PROCEDURAL(2), CONDITION(3), RANDOM(4), DAILY(5)\n        //  <= 4 AI advanceDay \n        const eventPriority = event.priority ?? 5;\n        if (eventPriority > 4) {\n          console.debug(`[]  ${event.name} AI: ${eventPriority}`);\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: '',\n              data: {\n                eventName: event.name,\n                eventPriority,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-event-trigger',\n              hypothesisId: 'C',\n            }),\n          }).catch(() => {});\n          // #endregion\n          return;\n        }\n\n        // \n        //  MESSAGE_SENT \n        waitingForEventResponse = true;\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: ' waitingForEventResponse ',\n            data: {\n              eventName: event.name,\n              eventId: event.id,\n              waitingForEventResponse: true,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v5',\n            hypothesisId: 'SET_FLAG',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        console.info(`[] : ${event.name}AI`);\n\n        // \n        const eventSystem = DS_EVENT.getModule('eventSystem') as {\n          currentDay?: number;\n          advanceDay?: (days: number) => { accumulatedEvents?: unknown[] };\n        };\n        //  day \n        // eventSystem.currentDay AI\n        const currentDay = event.day ?? eventSystem?.currentDay ?? 0;\n\n        let userInput = '';\n\n        // \"\"\n\n        // AI\n        const eventText = event.text || event.description || `${event.name}`;\n\n        // NPCuserInput\n        let npcInfoText = '';\n        const eventId = event.id || '';\n\n        // #region agent log - NPC\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered-NPC',\n            message: 'NPC',\n            data: {\n              eventId,\n              eventName: event.name,\n              hasGenerateNPCForEvent: typeof DS_EVENT.generateNPCForEvent === 'function',\n              hasGetCurrentCellNPCs: typeof DS_EVENT.getCurrentCellNPCs === 'function',\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-npc-injection',\n            hypothesisId: 'NPC_INJECT_START',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // NPCNPC\n        if (\n          eventId &&\n          [\n            'interrogation',\n            'lawyer_visit',\n            'family_visit',\n            'medical_visit',\n            'scene_identification',\n            'prosecutor_interrogation',\n          ].includes(eventId)\n        ) {\n          try {\n            if (typeof DS_EVENT.generateNPCForEvent === 'function') {\n              const eventNPC = DS_EVENT.generateNPCForEvent(eventId);\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered-NPC',\n                  message: 'NPC',\n                  data: {\n                    eventId,\n                    npcType:\n                      typeof eventNPC === 'object' && eventNPC !== null\n                        ? Array.isArray(eventNPC)\n                          ? 'array'\n                          : Object.keys(eventNPC)\n                        : typeof eventNPC,\n                    npcName:\n                      typeof eventNPC === 'object' && eventNPC !== null && 'name' in eventNPC\n                        ? (eventNPC as { name: string }).name\n                        : undefined,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-npc-injection',\n                  hypothesisId: 'NPC_GENERATED',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              if (eventNPC && typeof eventNPC === 'object') {\n                // NPC\n                if ('name' in eventNPC && typeof (eventNPC as { name: string }).name === 'string') {\n                  const npc = eventNPC as {\n                    name: string;\n                    role?: string;\n                    age?: number;\n                    rank?: string;\n                    type?: string;\n                    relation?: string;\n                  };\n                  const npcDesc =\n                    npc.role === 'police'\n                      ? `${npc.name}${npc.rank || ''}`\n                      : npc.role === 'lawyer'\n                        ? `${npc.name}${npc.type || ''}`\n                        : npc.role === 'family'\n                          ? `${npc.name}${npc.relation || ''}`\n                          : npc.role === 'doctor'\n                            ? `${npc.name}`\n                            : npc.name;\n                  npcInfoText = `\\n\\nNPC${npcDesc}NPC`;\n                }\n                // NPC\n                else if ('police' in eventNPC && 'witnesses' in eventNPC) {\n                  const sceneData = eventNPC as {\n                    police: { name: string; rank?: string };\n                    witnesses: Array<{ name: string }>;\n                  };\n                  const policeDesc = `${sceneData.police.name}${sceneData.police.rank || ''}`;\n                  const witnessesDesc = sceneData.witnesses.map(w => w.name).join('');\n                  npcInfoText = `\\n\\nNPC${policeDesc}${witnessesDesc}NPC`;\n                }\n              }\n            }\n          } catch (npcError) {\n            console.warn('[] NPC:', npcError);\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:event_triggered-NPC',\n                message: 'NPC',\n                data: {\n                  eventId,\n                  error: npcError instanceof Error ? npcError.message : String(npcError),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-npc-injection',\n                hypothesisId: 'NPC_GEN_ERROR',\n              }),\n            }).catch(() => {});\n            // #endregion\n          }\n        }\n\n        // NPC\n        if (eventId === 'cell_transfer') {\n          try {\n            // \n            const eventSystemModule = DS_EVENT.getModule('eventSystem') as\n              | {\n                  cellType?: string;\n                }\n              | undefined;\n            const targetCellType = (event as { to?: string }).to || eventSystemModule?.cellType || 'pretrial';\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:event_triggered-NPC',\n                message: 'NPC',\n                data: {\n                  eventId: 'cell_transfer',\n                  targetCellType,\n                  hasGenerateNPC: typeof DS_EVENT.generateNPC === 'function',\n                  hasSetCurrentCellNPCs: typeof DS_EVENT.setCurrentCellNPCs === 'function',\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-npc-injection',\n                hypothesisId: 'CELL_TRANSFER_START',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            // NPCcell_transfer\n            if (typeof DS_EVENT.generateNPC === 'function' && typeof DS_EVENT.setCurrentCellNPCs === 'function') {\n              const npcCount = Math.floor(Math.random() * 5) + 3; // 3-7\n              const newNPCs = DS_EVENT.generateNPC(npcCount, { cellType: targetCellType });\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered-NPC',\n                  message: 'NPC',\n                  data: {\n                    eventId: 'cell_transfer',\n                    npcCount: Array.isArray(newNPCs) ? newNPCs.length : 0,\n                    npcNames: Array.isArray(newNPCs)\n                      ? newNPCs.map((npc: { name?: string }) => npc.name).filter(Boolean)\n                      : [],\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-npc-injection',\n                  hypothesisId: 'CELL_NPC_GENERATED',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              if (Array.isArray(newNPCs) && newNPCs.length > 0) {\n                // NPCNPC\n                DS_EVENT.setCurrentCellNPCs(newNPCs);\n                console.info(`[]  ${newNPCs.length}NPC`);\n\n                // \n                const cellBoss = newNPCs.reduce((max, npc) => {\n                  const influence = (npc as { relationship?: { influence?: number } }).relationship?.influence ?? 0;\n                  const maxInfluence = (max as { relationship?: { influence?: number } }).relationship?.influence ?? 0;\n                  return influence > maxInfluence ? npc : max;\n                }, newNPCs[0]);\n\n                const otherNPCs = newNPCs.filter(npc => npc !== cellBoss);\n                const cellBossName = (cellBoss as { name?: string }).name || '';\n                const otherNames = otherNPCs\n                  .map((npc: { name?: string }) => npc.name)\n                  .filter(Boolean)\n                  .join('');\n\n                npcInfoText = `\\n\\nNPC${cellBossName}${otherNames || ''}NPC`;\n              }\n            }\n          } catch (cellNPCError) {\n            console.warn('[] NPC:', cellNPCError);\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:event_triggered-NPC',\n                message: 'NPC',\n                data: {\n                  eventId: 'cell_transfer',\n                  error: cellNPCError instanceof Error ? cellNPCError.message : String(cellNPCError),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-npc-injection',\n                hypothesisId: 'CELL_NPC_ERROR',\n              }),\n            }).catch(() => {});\n            // #endregion\n          }\n        }\n\n        // NPCNPC\n        // category'random'ID\n        const eventCategory = (event as { category?: string }).category;\n        if (\n          !npcInfoText &&\n          (eventCategory === 'random' || event.priority === 4) &&\n          typeof DS_EVENT.getCurrentCellNPCs === 'function'\n        ) {\n          try {\n            let cellNPCs = DS_EVENT.getCurrentCellNPCs();\n\n            // NPC01NPC\n            if ((!cellNPCs || (Array.isArray(cellNPCs) && cellNPCs.length === 0)) && currentDay <= 1) {\n              console.info('[] NPC');\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered-NPC',\n                  message: 'NPC',\n                  data: {\n                    currentDay,\n                    eventId,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-npc-injection',\n                  hypothesisId: 'INIT_CELL_NPC',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              if (typeof DS_EVENT.generateNPC === 'function') {\n                const eventSystemModule = DS_EVENT.getModule('eventSystem') as\n                  | {\n                      cellType?: string;\n                    }\n                  | undefined;\n                const cellType = eventSystemModule?.cellType || 'transition';\n                const initialNPCCount = Math.floor(Math.random() * 5) + 3; // 3-7\n                const initialNPCs = DS_EVENT.generateNPC(initialNPCCount, { cellType });\n\n                if (Array.isArray(initialNPCs) && initialNPCs.length > 0) {\n                  if (typeof DS_EVENT.setCurrentCellNPCs === 'function') {\n                    DS_EVENT.setCurrentCellNPCs(initialNPCs);\n                    console.info(`[]  ${initialNPCs.length}NPC`);\n                  }\n                  cellNPCs = initialNPCs;\n                }\n              }\n            }\n\n            if (Array.isArray(cellNPCs) && cellNPCs.length > 0) {\n              // 1-3NPC\n              const selectedNPCs = cellNPCs.sort(() => Math.random() - 0.5).slice(0, Math.min(3, cellNPCs.length));\n              const npcNames = selectedNPCs\n                .map((npc: { name?: string }) => npc.name)\n                .filter(Boolean)\n                .join('');\n              if (npcNames) {\n                npcInfoText = `\\n\\nNPC${npcNames}NPC`;\n              }\n            }\n          } catch (cellNPCError) {\n            console.warn('[] NPC:', cellNPCError);\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:event_triggered-NPC',\n                message: 'NPC',\n                data: {\n                  eventId,\n                  error: cellNPCError instanceof Error ? cellNPCError.message : String(cellNPCError),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-npc-injection',\n                hypothesisId: 'RANDOM_NPC_ERROR',\n              }),\n            }).catch(() => {});\n            // #endregion\n          }\n        }\n\n        // text\"\"\n        // \n        if (event.text) {\n          // \n          userInput = `[] ${currentDay}${eventText}${npcInfoText}`;\n        } else {\n          // text\n          userInput = `[] ${currentDay}${eventText}${npcInfoText}`;\n        }\n\n        // #region agent log - NPC\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered-NPC',\n            message: 'NPC',\n            data: {\n              eventId,\n              eventName: event.name,\n              hasNPCInfo: !!npcInfoText,\n              npcInfoLength: npcInfoText.length,\n              finalUserInput: userInput.substring(0, 200),\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-npc-injection',\n            hypothesisId: 'NPC_INJECT_COMPLETE',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: '',\n            data: {\n              eventName: event.name,\n              currentDay,\n              userInput,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-event-description',\n            hypothesisId: 'BUILD_DESC',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: 'AI',\n            data: {\n              eventName: event.name,\n              eventId: event.id,\n              eventPriority,\n              userInput,\n              currentDay,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-ai-output',\n            hypothesisId: 'A',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        await stopAllGeneration();\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: '',\n            data: {\n              eventName: event.name,\n              duringGenerating:\n                typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-ai-output',\n            hypothesisId: 'BEFORE_CREATE',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: '',\n            data: {\n              eventName: event.name,\n              eventId: event.id,\n              userInputLength: userInput.length,\n              waitingForEventResponse,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger',\n            hypothesisId: 'HYP-A',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        await stopAllGeneration();\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: '',\n            data: {\n              eventName: event.name,\n              duringGenerating:\n                typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n              beforeCreateChatMessages: true,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v4',\n            hypothesisId: 'HYP-D',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        //  refresh: 'affected'  MESSAGE_SENT \n        // MESSAGE_SENT \n        // createChatMessages  MESSAGE_SENT \n        const createPromise = createChatMessages(\n          [\n            {\n              role: 'user',\n              message: userInput,\n              is_hidden: false,\n              //  data  MESSAGE_SENT \n              data: {\n                isSystemEventMessage: true,\n                eventId: event.id,\n                eventName: event.name,\n              },\n            },\n          ],\n          { refresh: 'affected' }, //  'affected'  MESSAGE_SENT \n        );\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: 'createChatMessages ',\n            data: {\n              eventName: event.name,\n              duringGenerating:\n                typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n              createPromisePending: true,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v4',\n            hypothesisId: 'HYP-F',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        await createPromise;\n\n        // \n        //  MESSAGE_SENT \n        await new Promise(resolve => setTimeout(resolve, 150)); //  MESSAGE_SENT \n        await stopAllGeneration();\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: 'createChatMessages  + ',\n            data: {\n              eventName: event.name,\n              duringGenerating:\n                typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n              afterCreateChatMessages: true,\n              afterDelay: true,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v4',\n            hypothesisId: 'HYP-E',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: 'refresh: affected data ',\n            data: {\n              eventName: event.name,\n              eventId: event.id,\n              eventMessageId: getLastMessageId(),\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v2',\n            hypothesisId: 'HYP-B',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // message_id/\n        //  MESSAGE_SENT \n        await new Promise(resolve => setTimeout(resolve, 200));\n        const eventMessageId = getLastMessageId();\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: ' MESSAGE_SENT ',\n            data: {\n              eventName: event.name,\n              eventMessageId,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-duplicate-trigger-v2',\n            hypothesisId: 'HYP-C',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'core.ts:event_triggered',\n            message: '',\n            data: {\n              userInput,\n              duringGenerating:\n                typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-ai-output',\n            hypothesisId: 'B',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // AI\n        try {\n          // createChatMessages\n          await stopAllGeneration();\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: 'stopAllGeneration',\n              data: {\n                eventName: event.name,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-ai-output',\n              hypothesisId: 'WAIT_STOP_START',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          //  GENERATION_ENDED \n          const waitForGenerationToStop = (): Promise<void> => {\n            return new Promise(resolve => {\n              let resolved = false;\n              let eventReturn: { stop: () => void } | null = null;\n              let generationStartedReturn: { stop: () => void } | null = null;\n              let generationEndedReceived = false;\n              let generationStartedCount = 0;\n\n              const cleanup = () => {\n                if (eventReturn) {\n                  eventReturn.stop();\n                  eventReturn = null;\n                }\n                if (generationStartedReturn) {\n                  generationStartedReturn.stop();\n                  generationStartedReturn = null;\n                }\n              };\n\n              //  GENERATION_STARTED \n              generationStartedReturn = eventOn(\n                tavern_events.GENERATION_STARTED,\n                async (type: string, options: unknown, dry_run: boolean) => {\n                  generationStartedCount++;\n                  const now = Date.now();\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:event_triggered:waitForGenerationToStop',\n                      message: 'tavern_events.GENERATION_STARTED',\n                      data: {\n                        eventName: event.name,\n                        generationStartedCount,\n                        type,\n                        dry_run,\n                        timestamp: now,\n                        lastTriggerTime,\n                        lastTriggerEventName,\n                        timeSinceLastTrigger: lastTriggerTime ? now - lastTriggerTime : null,\n                      },\n                      timestamp: now,\n                      sessionId: 'debug-session',\n                      runId: 'track-streaming-gen',\n                      hypothesisId: 'NEW_GENERATION_DETECTED_IN_WAIT',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n                  await stopAllGeneration();\n                },\n              );\n\n              //  eventOnce \n              eventReturn = eventOnce(tavern_events.GENERATION_ENDED, () => {\n                if (!resolved) {\n                  generationEndedReceived = true;\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:event_triggered',\n                      message: 'GENERATION_ENDED',\n                      data: {\n                        eventName: event.name,\n                        generationStartedCount,\n                      },\n                      timestamp: Date.now(),\n                      sessionId: 'debug-session',\n                      runId: 'fix-ai-output',\n                      hypothesisId: 'GENERATION_ENDED_RECEIVED',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n                  // GENERATION_ENDED\n                  setTimeout(() => {\n                    if (!resolved) {\n                      resolved = true;\n                      clearTimeout(timeout);\n                      cleanup();\n                      resolve();\n                    }\n                  }, 800); // 800ms\n                }\n              });\n\n              // 2000msGENERATION_ENDED\n              const timeout = setTimeout(() => {\n                if (!resolved) {\n                  resolved = true;\n                  cleanup();\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:event_triggered',\n                      message: '',\n                      data: {\n                        eventName: event.name,\n                        generationEndedReceived,\n                        generationStartedCount,\n                        duringGenerating:\n                          typeof builtin !== 'undefined' && builtin.duringGenerating\n                            ? builtin.duringGenerating()\n                            : 'unknown',\n                      },\n                      timestamp: Date.now(),\n                      sessionId: 'debug-session',\n                      runId: 'fix-ai-output',\n                      hypothesisId: 'WAIT_TIMEOUT',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n                  resolve();\n                }\n              }, 2500); // 2500ms\n            });\n          };\n\n          await waitForGenerationToStop();\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: '',\n              data: {\n                eventName: event.name,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-ai-output',\n              hypothesisId: 'WAIT_STOP_DONE',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          // \n          const waitForGenerationToComplete = (): Promise<void> => {\n            return new Promise(resolve => {\n              // resolve\n              if (typeof builtin === 'undefined' || !builtin.duringGenerating || !builtin.duringGenerating()) {\n                resolve();\n                return;\n              }\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered',\n                  message: '',\n                  data: {\n                    eventName: event.name,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-ai-output',\n                  hypothesisId: 'WAIT_NATURAL_END',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              let timeoutHandle: ReturnType<typeof setTimeout> | null = null;\n\n              //  GENERATION_ENDED \n              const eventReturn = eventOnce(tavern_events.GENERATION_ENDED, () => {\n                if (timeoutHandle) {\n                  clearTimeout(timeoutHandle);\n                  timeoutHandle = null;\n                }\n                // 500ms\n                setTimeout(() => {\n                  // #region agent log\n                  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                      location: 'core.ts:event_triggered',\n                      message: '',\n                      data: {\n                        eventName: event.name,\n                        duringGenerating:\n                          typeof builtin !== 'undefined' && builtin.duringGenerating\n                            ? builtin.duringGenerating()\n                            : 'unknown',\n                      },\n                      timestamp: Date.now(),\n                      sessionId: 'debug-session',\n                      runId: 'fix-ai-output',\n                      hypothesisId: 'NATURAL_END',\n                    }),\n                  }).catch(() => {});\n                  // #endregion\n                  resolve();\n                }, 500);\n              });\n\n              // 10\n              timeoutHandle = setTimeout(() => {\n                eventReturn.stop();\n                timeoutHandle = null;\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:event_triggered',\n                    message: '10',\n                    data: {\n                      eventName: event.name,\n                      duringGenerating:\n                        typeof builtin !== 'undefined' && builtin.duringGenerating\n                          ? builtin.duringGenerating()\n                          : 'unknown',\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-ai-output',\n                    hypothesisId: 'NATURAL_END_TIMEOUT',\n                  }),\n                }).catch(() => {});\n                // #endregion\n                resolve(); // resolve\n              }, 10000);\n            });\n          };\n\n          await waitForGenerationToComplete();\n\n          // 3\n          let forceStopAttempts = 0;\n          while (\n            typeof builtin !== 'undefined' &&\n            builtin.duringGenerating &&\n            builtin.duringGenerating() &&\n            forceStopAttempts < 3\n          ) {\n            forceStopAttempts++;\n            console.warn(`[]   (${forceStopAttempts}): ${event.name}`);\n            await stopAllGeneration();\n            // 500ms\n            await new Promise(resolve => setTimeout(resolve, 500));\n          }\n\n          // \n          if (typeof builtin !== 'undefined' && builtin.duringGenerating && builtin.duringGenerating()) {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:event_triggered',\n                message: 'AI',\n                data: {\n                  eventName: event.name,\n                  duringGenerating: builtin.duringGenerating(),\n                  forceStopAttempts,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-ai-output',\n                hypothesisId: 'FORCE_STOP_FAILED',\n              }),\n            }).catch(() => {});\n            // #endregion\n            console.warn(`[]  AI: ${event.name}`);\n            // AI\n          }\n\n          // 300ms\n          await new Promise(resolve => setTimeout(resolve, 300));\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: 'AI',\n              data: {\n                eventName: event.name,\n                eventId: event.id,\n                eventMessageId: eventMessageId,\n                beforeTriggerDuringGenerating:\n                  typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-ai-output',\n              hypothesisId: 'BEFORE_TRIGGER',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          // AI\n          // \n          const eventName = event.name;\n          const eventId = event.id;\n          lastTriggerTime = Date.now();\n          lastTriggerEventName = event.name;\n          generationTracking.length = 0; // \n\n          //  triggerSlash \n          let messagesBeforeTrigger: Array<{ message_id: number; role: string; messageLength: number }> = [];\n          let lastAssistantMessage: { message_id: number; message: string; messageLength: number } | null = null;\n          try {\n            const allMessages = getChatMessages(-1);\n            messagesBeforeTrigger = allMessages.map(m => ({\n              message_id: m.message_id || 0,\n              role: m.role || 'unknown',\n              messageLength: (m.message || '').length,\n            }));\n\n            // \n            const assistantMessages = allMessages.filter(m => m.role === 'assistant');\n            if (assistantMessages.length > 0) {\n              const lastAssistant = assistantMessages[assistantMessages.length - 1];\n              lastAssistantMessage = {\n                message_id: lastAssistant.message_id || 0,\n                message: lastAssistant.message || '',\n                messageLength: (lastAssistant.message || '').length,\n              };\n            }\n          } catch (error) {\n            console.warn('[]  triggerSlash :', error);\n          }\n\n          // \n          // \n          const lastAssistantMessageId = lastAssistantMessage?.message_id || null;\n          const lastAssistantMessageLength = lastAssistantMessage?.messageLength || 0;\n          const lastAssistantMessagePreview = lastAssistantMessage?.message?.substring(0, 100) || '';\n          const potentiallyIncompleteMessage =\n            lastAssistantMessageId !== null &&\n            (lastAssistantMessageLength < 100 || // \n              lastAssistantMessagePreview.includes('<thinking>') || // \n              lastAssistantMessagePreview.includes('...')); // \n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: ' triggerSlash(/trigger)',\n              data: {\n                eventName: event.name,\n                eventId: event.id,\n                eventMessageId: eventMessageId,\n                triggerTime: lastTriggerTime,\n                beforeTriggerDuringGenerating:\n                  typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n                messagesBeforeTrigger: messagesBeforeTrigger.length,\n                messageIdsBeforeTrigger: messagesBeforeTrigger.map(m => m.message_id),\n                lastAssistantMessageId,\n                lastAssistantMessageLength,\n                lastAssistantMessagePreview,\n                potentiallyIncompleteMessage,\n                // \n                warning: potentiallyIncompleteMessage\n                  ? ''\n                  : null,\n              },\n              timestamp: lastTriggerTime,\n              sessionId: 'debug-session',\n              runId: 'track-streaming-gen',\n              hypothesisId: 'BEFORE_TRIGGER_SLASH',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          await triggerSlash('/trigger');\n\n          // #region agent log\n          const afterTriggerTime = Date.now();\n\n          //  triggerSlash \n          let messagesAfterTrigger: Array<{ message_id: number; role: string; messageLength: number }> = [];\n          try {\n            // \n            await new Promise(resolve => setTimeout(resolve, 100));\n            const allMessages = getChatMessages(-1);\n            messagesAfterTrigger = allMessages.map(m => ({\n              message_id: m.message_id || 0,\n              role: m.role || 'unknown',\n              messageLength: (m.message || '').length,\n            }));\n          } catch (error) {\n            console.warn('[]  triggerSlash :', error);\n          }\n\n          const newMessages = messagesAfterTrigger.filter(\n            m => !messagesBeforeTrigger.some(b => b.message_id === m.message_id),\n          );\n\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: 'triggerSlash(/trigger) ',\n              data: {\n                eventName: event.name,\n                eventId: event.id,\n                eventMessageId: eventMessageId,\n                triggerTime: lastTriggerTime,\n                afterTriggerTime,\n                timeSinceTrigger: afterTriggerTime - lastTriggerTime!,\n                generationsTriggered: generationTracking.length,\n                afterTriggerDuringGenerating:\n                  typeof builtin !== 'undefined' && builtin.duringGenerating ? builtin.duringGenerating() : 'unknown',\n                messagesBeforeCount: messagesBeforeTrigger.length,\n                messagesAfterCount: messagesAfterTrigger.length,\n                newMessagesCount: newMessages.length,\n                newMessageIds: newMessages.map(m => m.message_id),\n                newAssistantMessages: newMessages.filter(m => m.role === 'assistant'),\n                // \n                immediatelyCreatedAssistantMessages: newMessages.filter(\n                  m =>\n                    m.role === 'assistant' &&\n                    messagesBeforeTrigger.length > 0 &&\n                    m.message_id > Math.max(...messagesBeforeTrigger.map(b => b.message_id)),\n                ),\n              },\n              timestamp: afterTriggerTime,\n              sessionId: 'debug-session',\n              runId: 'track-streaming-gen',\n              hypothesisId: 'AFTER_TRIGGER_SLASH',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          console.info(`[]  AI: ${event.name}`);\n\n          // AI\n          const generationEndHandler = eventOnce(tavern_events.GENERATION_ENDED, (message_id: number) => {\n            const endTime = Date.now();\n            waitingForEventResponse = false;\n            console.debug(`[] AI: ${eventName}`);\n\n            // \n            const relatedMessages = aiMessageTracking.filter(\n              m => m.triggerTime === lastTriggerTime && m.eventName === lastTriggerEventName,\n            );\n\n            //  ID \n            const messageIdMatched = relatedMessages.some(m => m.message_id === message_id);\n\n            //  message_id  CHARACTER_MESSAGE_RENDERED \n            let messageEndContent: string | null = null;\n            let messageEndLength = 0;\n            try {\n              const messageEnd = getChatMessages(message_id, { role: 'assistant' });\n              if (messageEnd && messageEnd.length > 0 && messageEnd[0].message) {\n                messageEndContent = messageEnd[0].message;\n                messageEndLength = messageEndContent.length;\n              }\n            } catch (error) {\n              // \n            }\n\n            //  message_id 5 \n            let message5Content: string | null = null;\n            let message5Length = 0;\n            let message5Preview: string | null = null;\n            try {\n              const message5 = getChatMessages(5, { role: 'assistant' });\n              if (message5 && message5.length > 0 && message5[0].message) {\n                message5Content = message5[0].message;\n                message5Length = message5Content.length;\n                message5Preview = message5Content.substring(0, 300);\n              }\n            } catch (error) {\n              // \n            }\n\n            //  message_id 5  message_id 5\n            // \n            const message5ContainsEventContent = message5Content && eventName && message5Content.includes(eventName);\n            // \n            const message5ContainsSystemEvent =\n              message5Content &&\n              (message5Content.includes('[]') ||\n                (message5Content.includes('') && message5Content.includes('')));\n            //  message_id 6  message_id 5  message_id 5\n            const contentUpdatedToMessage5 =\n              !messageEndContent && (message5ContainsEventContent || message5ContainsSystemEvent);\n\n            // \n            let allAssistantMessages: Array<{ message_id: number; messageLength: number; timestamp?: number }> = [];\n            try {\n              const allMessages = getChatMessages(-1, { role: 'assistant' });\n              allAssistantMessages = allMessages.map(m => ({\n                message_id: m.message_id || 0,\n                messageLength: (m.message || '').length,\n              }));\n              //  aiMessageTracking \n              allAssistantMessages = allAssistantMessages.map(msg => {\n                const tracked = aiMessageTracking.find(t => t.message_id === msg.message_id);\n                return { ...msg, timestamp: tracked?.timestamp };\n              });\n            } catch (error) {\n              // \n            }\n\n            // #region agent log -  GENERATION_ENDED \n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'core.ts:event_triggered:GENERATION_ENDED',\n                message: 'GENERATION_ENDED ',\n                data: {\n                  eventName: eventName,\n                  eventId: eventId,\n                  eventMessageId: eventMessageId,\n                  generationEndMessageId: message_id,\n                  triggerTime: lastTriggerTime,\n                  endTime,\n                  timeSinceTrigger: lastTriggerTime ? endTime - lastTriggerTime : null,\n                  generationsTracked: generationTracking.length,\n                  generationIds: generationTracking.map(g => ({ id: g.generation_id, type: g.type, source: g.source })),\n                  relatedMessagesCount: relatedMessages.length,\n                  relatedMessageIds: relatedMessages.map(m => m.message_id),\n                  totalCharactersInRelatedMessages: relatedMessages.reduce((sum, m) => sum + m.messageLength, 0),\n                  messageIdMatched,\n                  //  ID  message_id \n                  messageEndExists: messageEndContent !== null,\n                  messageEndLength,\n                  messageEndPreview: messageEndContent ? messageEndContent.substring(0, 200) : null,\n                  //  message_id 5 \n                  message5Exists: message5Content !== null,\n                  message5Length,\n                  message5Preview,\n                  message5ContainsEventContent,\n                  message5ContainsSystemEvent,\n                  //  message_id 6  message_id 5  message_id 5\n                  contentUpdatedToMessage5,\n                  allAssistantMessagesCount: allAssistantMessages.length,\n                  allAssistantMessageIds: allAssistantMessages.map(m => m.message_id),\n                  assistantMessagesAfterTriggerTime: allAssistantMessages.filter(\n                    m => !m.timestamp || (lastTriggerTime && m.timestamp >= lastTriggerTime),\n                  ),\n                  //  ID \n                  potentialMessageSplit: relatedMessages.length > 0 && !messageIdMatched,\n                  allTrackedMessages: aiMessageTracking.map(m => ({\n                    id: m.message_id,\n                    triggerTime: m.triggerTime,\n                    eventName: m.eventName,\n                    length: m.messageLength,\n                    timestamp: m.timestamp,\n                  })),\n                  // \n                  nearbyMessages: aiMessageTracking\n                    .filter(m => Math.abs(m.timestamp - endTime) < 5000)\n                    .map(m => ({\n                      id: m.message_id,\n                      length: m.messageLength,\n                      timeDiff: Math.abs(m.timestamp - endTime),\n                      triggerTime: m.triggerTime,\n                      eventName: m.eventName,\n                    })),\n                },\n                timestamp: endTime,\n                sessionId: 'debug-session',\n                runId: 'track-streaming-gen',\n                hypothesisId: 'GEN_ENDED_TRACK',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            //  message_id 5 relatedMessages\n            if (contentUpdatedToMessage5) {\n              //  message_id5 message_id6\n              const actualMessageId = 5;\n\n              console.warn(\n                `[]   message_id ${actualMessageId} message_id ${message_id} message_id ${actualMessageId} `,\n                {\n                  expectedMessageId: message_id,\n                  actualMessageId,\n                  message5Length,\n                  message5ContainsEventContent,\n                  message5ContainsSystemEvent,\n                  relatedMessagesCount: relatedMessages.length,\n                },\n              );\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered:GENERATION_ENDED',\n                  message:\n                    '  message_id 5 message_id 6 message_id',\n                  data: {\n                    eventName: eventName,\n                    expectedMessageId: message_id,\n                    actualMessageId,\n                    trackedMessageIds: relatedMessages.map(m => m.message_id),\n                    message5Exists: message5Content !== null,\n                    message5Length,\n                    message5Preview,\n                    message5ContainsEventContent,\n                    message5ContainsSystemEvent,\n                    contentUpdatedToMessage5: true,\n                    allTrackedMessages: aiMessageTracking.map(m => ({\n                      id: m.message_id,\n                      triggerTime: m.triggerTime,\n                      eventName: m.eventName,\n                      length: m.messageLength,\n                      preview: m.messagePreview.substring(0, 100),\n                      timestamp: m.timestamp,\n                    })),\n                    triggerTime: lastTriggerTime,\n                    eventMessageId: eventMessageId,\n                    // \n                    rootCause:\n                      ' message_id 5 GENERATION_ENDED  message_id 6 ',\n                    //  message_id  message_id\n                    optimization: ' message_id 5  ID ',\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'track-streaming-gen',\n                  hypothesisId: 'CONTENT_UPDATED_TO_EXISTING_MESSAGE',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              //  message_id \n              //  message_id  GENERATION_ENDED  message_id\n              //  message_id \n            } else if (relatedMessages.length > 0 && !messageIdMatched) {\n              //  ID  contentUpdatedToMessage5 \n              console.warn(\n                `[]   ID GENERATION_ENDED  message_id (${message_id})  CHARACTER_MESSAGE_RENDERED  ID `,\n                {\n                  generationEndMessageId: message_id,\n                  trackedMessageIds: relatedMessages.map(m => m.message_id),\n                  allTrackedMessages: aiMessageTracking.map(m => ({\n                    id: m.message_id,\n                    triggerTime: m.triggerTime,\n                    eventName: m.eventName,\n                    length: m.messageLength,\n                  })),\n                },\n              );\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered:GENERATION_ENDED',\n                  message: '  ID ',\n                  data: {\n                    eventName: eventName,\n                    generationEndMessageId: message_id,\n                    trackedMessageIds: relatedMessages.map(m => m.message_id),\n                    allTrackedMessages: aiMessageTracking.map(m => ({\n                      id: m.message_id,\n                      triggerTime: m.triggerTime,\n                      eventName: m.eventName,\n                      length: m.messageLength,\n                      preview: m.messagePreview.substring(0, 100),\n                      timestamp: m.timestamp,\n                    })),\n                    triggerTime: lastTriggerTime,\n                    eventMessageId: eventMessageId,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'track-streaming-gen',\n                  hypothesisId: 'MESSAGE_ID_MISMATCH',\n                }),\n              }).catch(() => {});\n              // #endregion\n            } else if (!contentUpdatedToMessage5 && relatedMessages.length > 1) {\n              // \n              // \n              console.warn(\n                `[]   \"${lastTriggerEventName}\"  ${relatedMessages.length} `,\n                {\n                  eventName: lastTriggerEventName,\n                  triggerTime: lastTriggerTime,\n                  generationEndMessageId: message_id,\n                  relatedMessageIds: relatedMessages.map(m => m.message_id),\n                  totalLength: relatedMessages.reduce((sum, m) => sum + m.messageLength, 0),\n                },\n              );\n\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'core.ts:event_triggered:GENERATION_ENDED',\n                  message: ' ',\n                  data: {\n                    eventName: lastTriggerEventName,\n                    triggerTime: lastTriggerTime,\n                    generationEndMessageId: message_id,\n                    messageCount: relatedMessages.length,\n                    messages: relatedMessages.map(m => ({\n                      message_id: m.message_id,\n                      messageLength: m.messageLength,\n                      timestamp: m.timestamp,\n                      timeSinceTrigger: lastTriggerTime ? m.timestamp - lastTriggerTime : null,\n                      preview: m.messagePreview,\n                    })),\n                    totalLength: relatedMessages.reduce((sum, m) => sum + m.messageLength, 0),\n                    eventMessageId: eventMessageId,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'track-streaming-gen',\n                  hypothesisId: 'MESSAGE_SPLIT_DETECTED_IN_GEN_ENDED',\n                }),\n              }).catch(() => {});\n              // #endregion\n            }\n\n            // AI\n            try {\n              const eventSystem = DS_EVENT.getModule('eventSystem') as {\n                saveStateToChatVars?: () => void;\n                saveEventInterruptSnapshot?: () => void;\n                confirmDayAdvancement?: (pendingDays: number) => void;\n              };\n\n              // \n              const eventWithPending = event as { pendingDayAdvancement?: number };\n              if (eventSystem && eventWithPending.pendingDayAdvancement !== undefined) {\n                // AI\n                if (eventSystem.confirmDayAdvancement) {\n                  eventSystem.confirmDayAdvancement(eventWithPending.pendingDayAdvancement);\n                }\n              }\n\n              if (eventSystem && eventSystem.saveStateToChatVars) {\n                // \n                eventSystem.saveStateToChatVars();\n                // \n                // \"\"\n                if (eventSystem.saveEventInterruptSnapshot) {\n                  eventSystem.saveEventInterruptSnapshot();\n                }\n                console.debug('[] AI');\n\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                  method: 'POST',\n                  headers: { 'Content-Type': 'application/json' },\n                  body: JSON.stringify({\n                    location: 'core.ts:event_triggered',\n                    message: 'AI',\n                    data: {\n                      eventName: event.name,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-snapshot-timing',\n                    hypothesisId: 'SAVE_SNAPSHOT_ON_REPLY_END',\n                  }),\n                }).catch(() => {});\n                // #endregion\n              }\n            } catch (error) {\n              console.warn('[] AI:', error);\n            }\n          });\n\n          // \n          const generationStoppedHandler = eventOnce(tavern_events.GENERATION_STOPPED, () => {\n            // \n            try {\n              const messages = getChatMessages(eventMessageId, { role: 'user' });\n              if (!messages || messages.length === 0) {\n                // \n                // \n                const eventSystem = DS_EVENT.getModule('eventSystem') as {\n                  rollbackToInterruptSnapshot?: () => boolean;\n                };\n                if (eventSystem && eventSystem.rollbackToInterruptSnapshot) {\n                  const rollbackSuccess = eventSystem.rollbackToInterruptSnapshot();\n                  if (rollbackSuccess) {\n                    console.info(`[]  `);\n                    // #region agent log\n                    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                      method: 'POST',\n                      headers: { 'Content-Type': 'application/json' },\n                      body: JSON.stringify({\n                        location: 'core.ts:event_triggered',\n                        message: '',\n                        data: {\n                          eventName: event.name,\n                          eventMessageId,\n                        },\n                        timestamp: Date.now(),\n                        sessionId: 'debug-session',\n                        runId: 'add-rollback',\n                        hypothesisId: 'ROLLBACK_ON_DELETE',\n                      }),\n                    }).catch(() => {});\n                    // #endregion\n                  }\n                }\n              }\n            } catch (error) {\n              console.warn('[] :', error);\n            }\n\n            waitingForEventResponse = false;\n            generationEndHandler.stop();\n          });\n\n          // 30AI\n          setTimeout(() => {\n            if (waitingForEventResponse) {\n              waitingForEventResponse = false;\n              generationStoppedHandler.stop();\n              console.warn(`[]  30: ${eventName}`);\n            }\n          }, 30000);\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: 'AI',\n              data: { eventName: event.name },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-ai-output',\n              hypothesisId: 'C',\n            }),\n          }).catch(() => {});\n          // #endregion\n        } catch (error) {\n          console.error(`[]  AI:`, error);\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'core.ts:event_triggered',\n              message: 'AI',\n              data: {\n                error: error instanceof Error ? error.message : String(error),\n                eventName: event.name,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-ai-output',\n              hypothesisId: 'D',\n            }),\n          }).catch(() => {});\n          // #endregion\n        }\n      } catch (error) {\n        console.error('[] AI:', error);\n      }\n    });\n\n    console.info('[] AI');\n  }\n});\n\nconsole.info('[] ');\nconsole.info('[]   - : ' + new Date().toLocaleTimeString());\n\n// \nconst systemCheck = {\n  exists: typeof window.detentionSystem !== 'undefined',\n  type: typeof window.detentionSystem,\n  value: window.detentionSystem ? 'object' : 'undefined',\n  hasPing: window.detentionSystem && typeof (window.detentionSystem as DetentionSystem).ping === 'function',\n  pingResult:\n    window.detentionSystem && typeof (window.detentionSystem as DetentionSystem).ping === 'function'\n      ? (window.detentionSystem as DetentionSystem).ping()\n      : 'N/A',\n  hasInitializeState:\n    window.detentionSystem &&\n    typeof (window.detentionSystem as DetentionSystem & { initializeState?: unknown }).initializeState === 'function',\n  hasModules: window.detentionSystem && 'modules' in (window.detentionSystem as DetentionSystem),\n  modulesCount:\n    window.detentionSystem && 'modules' in (window.detentionSystem as DetentionSystem)\n      ? Object.keys((window.detentionSystem as DetentionSystem).modules).length\n      : 0,\n  isIframe: window.parent !== window,\n  hasParent: !!window.parent,\n  parentHasDetentionSystem:\n    window.parent && window.parent !== window\n      ? typeof (window.parent as typeof window.parent & { detentionSystem?: DetentionSystem }).detentionSystem !==\n        'undefined'\n      : 'N/A',\n  parentHasDS: window.parent && window.parent !== window ? typeof (window.parent as any).DS !== 'undefined' : 'N/A',\n};\n\nconsole.info('[]  window.detentionSystem:', systemCheck);\n\n// #region agent log\nfetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n  method: 'POST',\n  headers: { 'Content-Type': 'application/json' },\n  body: JSON.stringify({\n    location: 'core.ts:',\n    message: '',\n    data: systemCheck,\n    timestamp: Date.now(),\n    sessionId: 'debug-session',\n    runId: 'fix-init-failure',\n    hypothesisId: 'FINAL_CHECK',\n  }),\n}).catch(() => {});\n// #endregion\n","export {};\n\n/**\n * \n *  registerModule \n */\n\ntype EventPriority = 1 | 2 | 3 | 4 | 5;\n\ntype Stage =\n  | 'detention'\n  | 'approval'\n  | 'investigation'\n  | 'prosecution'\n  | 'trial1'\n  | 'firstVerdict'\n  | 'appeal'\n  | 'trial2'\n  | 'finalVerdict'\n  | 'transfer'\n  | 'execution'\n  | 'deathReview'\n  | 'end';\n\ninterface EventBus {\n  on(event: string, callback: (data?: unknown) => void): void;\n  emit(event: string, data?: unknown): void;\n}\n\ninterface EventSystemExports {\n  generateRandomEvent?: (context?: unknown) => EventRecord | null;\n  advanceDay?: (days?: number) => unknown;\n  getCurrentDay?: () => number;\n  getCurrentStage?: () => unknown;\n  checkCellTransfer?: () => boolean;\n  setCaseComplexity?: (complexity: 'simple' | 'normal' | 'complex' | 'very_complex') => void;\n  rollbackToStage?: (stage: Stage, reason?: string) => boolean;\n  advanceToStage?: (stage: Stage, reason?: string) => boolean;\n  setDeathPenalty?: (flag: boolean) => void;\n  getEventStatistics?: () => unknown;\n  exportTimeline?: () => unknown;\n  importTimeline?: (data: unknown) => boolean;\n  rollbackToInterruptSnapshot?: () => boolean;\n}\n\ninterface DetentionSystem extends EventSystemExports {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  config: Record<string, unknown>;\n  state: Record<string, unknown>;\n  events: EventBus;\n  CacheManager: unknown;\n  EventEmitter: unknown;\n  ping(): boolean;\n  checkTokenBudget(): unknown;\n  updateTokenUsage(tokens: number): unknown;\n  compressContent(content: unknown, quality?: number | null): string;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n  handleError(error: unknown, context?: string): void;\n  detectEnvironment(): unknown;\n  initialize(): void;\n}\n\ninterface ProtagonistState {\n  health: number;\n  mental: number;\n  strength?: number;\n  intelligence?: number;\n}\n\ninterface Timeline {\n  arrestDay: number;\n  approvalDay: number | null;\n  prosecutionDay: number | null;\n  firstTrialDay: number | null;\n  firstVerdictDay: number | null;\n  secondTrialDay: number | null;\n  finalVerdictDay: number | null;\n  transferDay: number | null;\n  executionDay: number | null;\n}\n\ninterface EventRecord {\n  id: string;\n  name: string;\n  type?: string;\n  category?: string;\n  description?: string;\n  priority?: EventPriority;\n  day?: number;\n  stage?: Stage;\n  isEnding?: boolean;\n  endingType?: 'prison' | 'death';\n  aiControlled?: boolean;\n  text?: string;\n  from?: string;\n  to?: string;\n  reason?: string;\n}\n\ndeclare global {\n  interface Window {\n    chat?: Array<{ mes?: string }>;\n  }\n}\n\ninterface EventSystemImpl {\n  currentDay: number;\n  lastEventDay: number;\n  eventHistory: EventRecord[];\n  legalTimeline: Timeline;\n  currentStage: Stage;\n  cellType: string;\n  caseComplexity: 'simple' | 'normal' | 'complex' | 'very_complex';\n  complexityMultiplier: number;\n  eventCounters: Record<string, number>;\n  isDeathPenalty: boolean;\n  lastStageChangeDay: number;\n  assignedOfficers: { police: string[]; prosecutor: string | null };\n  getCurrentDayInternal(this: EventSystemImpl): number;\n  readonly PRIORITY: {\n    readonly LEGAL: 1;\n    readonly PROCEDURAL: 2;\n    readonly CONDITION: 3;\n    readonly RANDOM: 4;\n    readonly DAILY: 5;\n  };\n  legalEvents: Record<string, unknown>;\n  conditionEvents: Array<any>;\n  randomEvents: Record<string, Array<{ id: string; name: string; weight: number }>>;\n  innerMonologues: Array<{ id: string; text: string; weight: number }>;\n  initialize(this: EventSystemImpl, startDay?: number): void;\n  setCaseComplexity(this: EventSystemImpl, complexity: 'simple' | 'normal' | 'complex' | 'very_complex'): void;\n  checkComplexityAdjustment(this: EventSystemImpl): void;\n  rollbackToStage(this: EventSystemImpl, targetStage: Stage, reason?: string): boolean;\n  advanceToStage(this: EventSystemImpl, targetStage: Stage, reason?: string): boolean;\n  handleUserRollback(this: EventSystemImpl, input: string): boolean;\n  advanceDay(\n    this: EventSystemImpl,\n    days?: number,\n  ): {\n    interrupted: boolean;\n    currentDay: number;\n    tempCurrentDay?: number;\n    pendingDays?: number;\n    event?: EventRecord;\n  };\n  checkDayEvents(this: EventSystemImpl): EventRecord;\n  checkLegalEvent(this: EventSystemImpl): EventRecord | null;\n  checkConditionEvent(this: EventSystemImpl): EventRecord | null;\n  generateRandomEvent(this: EventSystemImpl): EventRecord | null;\n  generateInnerMonologue(this: EventSystemImpl): EventRecord | null;\n  weightedRandom(this: EventSystemImpl, count: number, weights: number[]): number;\n  getProtagonistState(this: EventSystemImpl): ProtagonistState;\n  getRecentContext(this: EventSystemImpl): string;\n  checkCellTransfer(this: EventSystemImpl): boolean;\n  setDeathPenalty(this: EventSystemImpl, isDeathPenalty: boolean): void;\n  getCurrentStageInfo(this: EventSystemImpl): unknown;\n  getEventStatistics(this: EventSystemImpl): unknown;\n  exportTimeline(this: EventSystemImpl): unknown;\n  importTimeline(this: EventSystemImpl, data: any): boolean;\n  saveStateToChatVars(this: EventSystemImpl): void;\n  saveEventInterruptSnapshot(this: EventSystemImpl): void;\n  rollbackToInterruptSnapshot(this: EventSystemImpl): boolean;\n  confirmDayAdvancement(this: EventSystemImpl, pendingDays: number): void;\n}\n\nconsole.info('[] ...');\n\n//  jQuery ready \n$(() => {\n  const DS_RAW = window.detentionSystem as (DetentionSystem & EventSystemExports) | undefined;\n\n  // \n  let saveStateTimer: ReturnType<typeof setTimeout> | null = null;\n  if (!DS_RAW) {\n    console.error('[] ');\n    console.error('[]  core.ts ');\n    return;\n  }\n\n  // DS \n  const DS = DS_RAW as DetentionSystem & EventSystemExports;\n\n  // ==========  ==========\n  /**\n   * \n   * @returns \n   */\n  function getCurrentDayFromMemoryEnhancement(fallback: number = 0): number {\n    try {\n      //  statusPanel \n      const statusPanel = DS.getModule('statusPanel') as {\n        getState?: () => { days?: number; day?: number };\n      };\n\n      if (statusPanel && statusPanel.getState) {\n        const state = statusPanel.getState();\n        if (state && (state.days !== undefined || state.day !== undefined)) {\n          const dayFromMemory = state.days ?? state.day ?? fallback;\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:getCurrentDayFromMemoryEnhancement',\n              message: '',\n              data: {\n                dayFromMemory,\n                fallback,\n                hasStatusPanel: !!statusPanel,\n                stateHasDays: state.days !== undefined,\n                stateHasDay: state.day !== undefined,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-day-from-memory',\n              hypothesisId: 'GET_DAY_FROM_MEMORY',\n            }),\n          }).catch(() => {});\n          // #endregion\n          return dayFromMemory;\n        }\n      }\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:getCurrentDayFromMemoryEnhancement',\n          message: '',\n          data: {\n            fallback,\n            hasStatusPanel: !!statusPanel,\n            hasGetState: !!(statusPanel && statusPanel.getState),\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-day-from-memory',\n          hypothesisId: 'GET_DAY_FALLBACK',\n        }),\n      }).catch(() => {});\n      // #endregion\n      return fallback;\n    } catch (error) {\n      console.warn('[] :', error);\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:getCurrentDayFromMemoryEnhancement',\n          message: '',\n          data: {\n            error: error instanceof Error ? error.message : String(error),\n            fallback,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-day-from-memory',\n          hypothesisId: 'GET_DAY_ERROR',\n        }),\n      }).catch(() => {});\n      // #endregion\n      return fallback;\n    }\n  }\n\n  // ----------------  ----------------\n  const EventSystem: EventSystemImpl = {\n    currentDay: 0, // \n\n    /**\n     * \n     * @returns \n     */\n    getCurrentDayInternal(): number {\n      return getCurrentDayFromMemoryEnhancement(this.currentDay);\n    },\n\n    lastEventDay: 0,\n    eventHistory: [] as EventRecord[],\n    legalTimeline: {\n      arrestDay: 0,\n      approvalDay: null,\n      prosecutionDay: null,\n      firstTrialDay: null,\n      firstVerdictDay: null,\n      secondTrialDay: null,\n      finalVerdictDay: null,\n      transferDay: null,\n      executionDay: null,\n    } as Timeline,\n    currentStage: 'detention' as Stage,\n    cellType: 'transition',\n\n    // \n    caseComplexity: 'normal' as 'simple' | 'normal' | 'complex' | 'very_complex',\n    complexityMultiplier: 1.0,\n\n    // ID\n    eventCounters: {\n      interrogation: 0,\n      prosecutor_interrogation: 0,\n      lawyer_visit: 0,\n      family_visit: 0,\n      medical_visit: 0,\n      scene_identification: 0,\n    } as Record<string, number>,\n\n    // \n    isDeathPenalty: false,\n\n    // \n    lastStageChangeDay: 0,\n\n    // \n    assignedOfficers: {\n      police: [] as string[],\n      prosecutor: null as string | null,\n    },\n\n    // \n    // LEGAL: 1 - \n    // PROCEDURAL: 2 - \n    // CONDITION: 3 - \n    // RANDOM: 4 - \n    // DAILY: 5 - \n    PRIORITY: {\n      LEGAL: 1,\n      PROCEDURAL: 2,\n      CONDITION: 3,\n      RANDOM: 4,\n      DAILY: 5,\n    } as const,\n\n    // \n    legalEvents: {\n      approval: {\n        name: '',\n        minDay: 30,\n        maxDay: 37,\n        stage: 'approval',\n        description: '',\n        nextStage: 'investigation',\n      },\n      investigation: {\n        name: '',\n        duration: [60, 210],\n        stage: 'investigation',\n        description: '',\n        nextStage: 'prosecution',\n      },\n      prosecution: {\n        name: '',\n        duration: [30, 45],\n        stage: 'prosecution',\n        description: '',\n        nextStage: 'trial1',\n      },\n      firstTrial: {\n        name: '',\n        duration: [30, 45],\n        stage: 'trial1',\n        description: '',\n        nextStage: 'firstVerdict',\n      },\n      firstVerdict: {\n        name: '',\n        duration: [7, 30],\n        stage: 'firstVerdict',\n        description: '',\n        nextStage: 'appeal',\n      },\n      appeal: {\n        name: '',\n        duration: [10, 10],\n        stage: 'appeal',\n        description: '10',\n        nextStage: 'trial2',\n      },\n      secondTrial: {\n        name: '',\n        duration: [60, 90],\n        stage: 'trial2',\n        description: '',\n        nextStage: 'finalVerdict',\n      },\n      finalVerdict: {\n        name: '',\n        duration: [7, 14],\n        stage: 'finalVerdict',\n        description: '',\n        nextStage: 'transfer',\n      },\n      transfer: {\n        name: '',\n        duration: [30, 90],\n        stage: 'transfer',\n        description: '',\n        nextStage: 'end',\n      },\n      deathReview: {\n        name: '',\n        duration: [180, 720],\n        stage: 'deathReview',\n        description: '',\n        nextStage: 'execution',\n      },\n      execution: {\n        name: '',\n        duration: [1, 7],\n        stage: 'execution',\n        description: '',\n        nextStage: 'end',\n      },\n    },\n\n    // \n    conditionEvents: [\n      {\n        id: 'mental_breakdown',\n        name: '',\n        condition: (state: ProtagonistState) => state.mental < 20,\n        weight: 100,\n        description: '',\n        checkAlways: true,\n      },\n      {\n        id: 'health_crisis',\n        name: '',\n        condition: (state: ProtagonistState) => state.health < 30,\n        weight: 100,\n        description: '',\n        checkAlways: true,\n      },\n      {\n        id: 'major_twist',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentDay !== system.lastStageChangeDay) return false;\n          return Math.random() < 0.15;\n        },\n        weight: 100,\n        description: '',\n        stageChangeOnly: true,\n      },\n      {\n        id: 'evidence_reversal',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentDay !== system.lastStageChangeDay) return false;\n          return Math.random() < 0.1;\n        },\n        weight: 100,\n        description: '',\n        stageChangeOnly: true,\n      },\n      {\n        id: 'prosecutor_interrogation',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          // 30-37100%+2\n          // arrestDayapprovalDaynull30-37\n          if (\n            system.legalTimeline.arrestDay > 0 &&\n            system.legalTimeline.approvalDay === null &&\n            system.eventCounters.prosecutor_interrogation === 0\n          ) {\n            const daysInCustody = system.currentDay - system.legalTimeline.arrestDay;\n            const minDays = Math.floor(30 * system.complexityMultiplier);\n            const maxDays = Math.floor(37 * system.complexityMultiplier);\n\n            // 30-37100%\n            if (daysInCustody >= minDays && daysInCustody <= maxDays) {\n              return true;\n            }\n          }\n          return false;\n        },\n        weight: 100,\n        description: '+2',\n        category: 'procedural',\n      },\n      {\n        id: 'interrogation',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          // 10\n          if (system.currentDay <= 10 && system.eventCounters.interrogation === 0) {\n            const remainingDays = 10 - system.currentDay + 1;\n            const requiredTriggers = 1; // 1\n\n            // \n            if (remainingDays === requiredTriggers) {\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'event_system.ts:interrogation_condition',\n                  message: '10',\n                  data: {\n                    currentDay: system.currentDay,\n                    remainingDays,\n                    requiredTriggers,\n                    interrogationCount: system.eventCounters.interrogation,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'guarantee-interrogation',\n                  hypothesisId: 'A',\n                }),\n              }).catch(() => {});\n              // #endregion\n              return true;\n            }\n\n            // 10\n            // \n            const forcedProbability = requiredTriggers / remainingDays; // \n            const shouldTrigger = Math.random() < forcedProbability;\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:interrogation_condition',\n                message: '10',\n                data: {\n                  currentDay: system.currentDay,\n                  remainingDays,\n                  forcedProbability,\n                  shouldTrigger,\n                  interrogationCount: system.eventCounters.interrogation,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'guarantee-interrogation',\n                hypothesisId: 'B',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            if (shouldTrigger) {\n              return true;\n            }\n          }\n\n          //  investigation \n          if (system.currentStage !== 'investigation') return false;\n\n          const daysSinceApproval = system.legalTimeline.approvalDay\n            ? system.currentDay - system.legalTimeline.approvalDay\n            : 0;\n\n          let baseProbability = 0.15;\n\n          if (daysSinceApproval < 30) {\n            baseProbability = 0.25;\n          } else if (daysSinceApproval < 60) {\n            baseProbability = 0.15;\n          } else {\n            baseProbability = 0.08;\n          }\n\n          const decayFactor = Math.pow(0.7, system.eventCounters.interrogation);\n          const finalProbability = baseProbability * decayFactor;\n\n          return Math.random() < finalProbability;\n        },\n        weight: 100,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'lawyer_visit',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          //  pretrial  convicted \n          if (system.cellType === 'transition') {\n            return false;\n          }\n\n          // \n          if (!system.eventCounters.interrogation || system.eventCounters.interrogation === 0) {\n            return false;\n          }\n\n          let baseProbability = 0.03;\n\n          const daysInCustody = system.currentDay - system.legalTimeline.arrestDay;\n          if (daysInCustody <= 14) {\n            baseProbability = 0.15;\n          }\n\n          if (system.legalTimeline.firstTrialDay) {\n            const daysToTrial = system.legalTimeline.firstTrialDay - system.currentDay;\n            if (daysToTrial > 0 && daysToTrial <= 7) {\n              baseProbability = 0.3;\n            }\n          }\n\n          if (system.legalTimeline.secondTrialDay) {\n            const daysToTrial2 = system.legalTimeline.secondTrialDay - system.currentDay;\n            if (daysToTrial2 > 0 && daysToTrial2 <= 7) {\n              baseProbability = 0.25;\n            }\n          }\n\n          return Math.random() < baseProbability;\n        },\n        weight: 90,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'family_visit',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          // \n          if (!system.legalTimeline.firstVerdictDay) {\n            return false;\n          }\n\n          let baseProbability = 0.05;\n\n          if (system.isDeathPenalty) {\n            baseProbability = 0.1;\n          }\n\n          const lastVisit = system.eventHistory\n            .filter(e => e.id === 'family_visit')\n            .sort((a, b) => (b.day ?? 0) - (a.day ?? 0))[0];\n\n          if (lastVisit && system.currentDay - (lastVisit.day ?? 0) < 30) {\n            return false;\n          }\n\n          return Math.random() < baseProbability;\n        },\n        weight: 85,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'medical_visit',\n        name: '',\n        condition: (state: ProtagonistState, system: typeof EventSystem) => {\n          if (state.health >= 25) return false;\n\n          let probability = 0;\n          if (state.health < 10) {\n            probability = 0.4;\n          } else if (state.health < 15) {\n            probability = 0.25;\n          } else if (state.health < 20) {\n            probability = 0.15;\n          } else {\n            probability = 0.08;\n          }\n\n          const lastMedical = system.eventHistory\n            .filter(e => e.id === 'medical_visit')\n            .sort((a, b) => (b.day ?? 0) - (a.day ?? 0))[0];\n\n          if (lastMedical && system.currentDay - (lastMedical.day ?? 0) < 7) {\n            return false;\n          }\n\n          return Math.random() < probability;\n        },\n        weight: 95,\n        description: '',\n        category: 'procedural',\n      },\n      {\n        id: 'scene_identification',\n        name: '',\n        condition: (_state: ProtagonistState, system: typeof EventSystem) => {\n          if (system.currentStage !== 'investigation') return false;\n          if (system.eventCounters.scene_identification > 0) return false;\n\n          const daysSinceApproval = system.legalTimeline.approvalDay\n            ? system.currentDay - system.legalTimeline.approvalDay\n            : 0;\n\n          if (daysSinceApproval < 15 || daysSinceApproval > 120) {\n            return false;\n          }\n\n          const baseProbability = 0.08;\n\n          const recentContext = system.getRecentContext ? system.getRecentContext() : '';\n          const keywords = ['', '', '', '', ''];\n          const hasKeyword = keywords.some(kw => recentContext.includes(kw));\n\n          const finalProbability = hasKeyword ? baseProbability * 3 : baseProbability;\n\n          return Math.random() < finalProbability;\n        },\n        weight: 80,\n        description: '',\n        category: 'procedural',\n        aiControlled: true,\n      },\n    ],\n\n    // \n    randomEvents: {\n      violence: [\n        { id: 'newcomer_bullying', name: '', weight: 30 },\n        { id: 'bed_dispute', name: '', weight: 25 },\n        { id: 'food_robbery', name: '', weight: 20 },\n        { id: 'faction_conflict', name: '', weight: 15 },\n        { id: 'revenge', name: '', weight: 10 },\n      ],\n      medical: [\n        { id: 'epidemic', name: '', weight: 15 },\n        { id: 'mental_illness', name: '', weight: 25 },\n        { id: 'chronic_disease', name: '', weight: 20 },\n        { id: 'injury', name: '', weight: 20 },\n        { id: 'gynecological', name: '', weight: 10 },\n        { id: 'malnutrition', name: '', weight: 10 },\n      ],\n      emotional: [\n        { id: 'deep_friendship', name: '', weight: 20 },\n        { id: 'betrayal', name: '', weight: 15 },\n        { id: 'motherly_bond', name: '', weight: 15 },\n        { id: 'jealousy', name: '', weight: 20 },\n        { id: 'secret_sharing', name: '', weight: 15 },\n        { id: 'collective_exclusion', name: '', weight: 10 },\n        { id: 'romance', name: '', weight: 5 },\n      ],\n      accident: [\n        { id: 'facility_failure', name: '', weight: 25 },\n        { id: 'safety_incident', name: '', weight: 20 },\n        { id: 'external_news', name: '', weight: 30 },\n        { id: 'extreme_weather', name: '', weight: 15 },\n        { id: 'management_change', name: '', weight: 10 },\n      ],\n    },\n\n    // \n    innerMonologues: [\n      { id: 'worry_about_family', text: '...', weight: 20 },\n      { id: 'regret_past', text: '...', weight: 20 },\n      { id: 'fear_future', text: '...', weight: 18 },\n      { id: 'miss_freedom', text: '...', weight: 15 },\n      { id: 'self_reflection', text: '...', weight: 12 },\n      { id: 'hope_for_leniency', text: '...', weight: 10 },\n      { id: 'worry_about_children', text: '...', weight: 15 },\n      { id: 'fear_of_inmates', text: '...', weight: 12 },\n      { id: 'loneliness', text: '...', weight: 15 },\n      { id: 'time_perception', text: '...', weight: 10 },\n      { id: 'dream_of_past', text: '...', weight: 12 },\n      { id: 'worry_about_health', text: '...', weight: 10 },\n      { id: 'guilt', text: '...', weight: 8 },\n      { id: 'anger', text: '...', weight: 8 },\n      { id: 'acceptance', text: '...', weight: 7 },\n      { id: 'hope_for_appeal', text: '...', weight: 8 },\n      { id: 'fear_of_death', text: '...', weight: 5 },\n      { id: 'nostalgia', text: '...', weight: 10 },\n    ],\n\n    // \n    initialize(startDay = 0) {\n      // \n      try {\n        // ID saveChat \n        const currentChatId =\n          typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId ? SillyTavern.getCurrentChatId() : null;\n\n        if (!currentChatId) {\n          console.debug('[] ');\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:initialize',\n              message: '',\n              data: {\n                hasChatId: false,\n                startDay,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-chat-error',\n              hypothesisId: 'INIT_LOAD_SKIPPED',\n            }),\n          }).catch(() => {});\n          // #endregion\n          // \n          this.currentDay = startDay;\n          this.legalTimeline.arrestDay = startDay;\n          this.currentStage = 'detention';\n          this.cellType = 'transition';\n          this.caseComplexity = 'normal';\n          this.complexityMultiplier = 1.0;\n          this.isDeathPenalty = false;\n          this.lastStageChangeDay = startDay;\n          this.lastEventDay = startDay;\n\n          for (const key of Object.keys(this.eventCounters)) {\n            this.eventCounters[key] = 0;\n          }\n\n          // \n          this.assignedOfficers = {\n            police: [],\n            prosecutor: null,\n          };\n\n          console.info('[] ');\n          console.info(`[] : ${this.currentDay}`);\n          return;\n        }\n\n        // \n        let chatVars: Record<string, any> | null = null;\n        try {\n          chatVars = getVariables({ type: 'chat' });\n          // \n          if (!chatVars || typeof chatVars !== 'object') {\n            throw new Error('');\n          }\n        } catch (getVarsError) {\n          console.debug('[] :', getVarsError);\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:initialize',\n              message: '',\n              data: {\n                error: getVarsError instanceof Error ? getVarsError.message : String(getVarsError),\n                startDay,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-chat-error',\n              hypothesisId: 'GET_CHAT_VARS_ERROR',\n            }),\n          }).catch(() => {});\n          // #endregion\n          // \n          this.currentDay = startDay;\n          this.legalTimeline.arrestDay = startDay;\n          this.currentStage = 'detention';\n          this.cellType = 'transition';\n          this.caseComplexity = 'normal';\n          this.complexityMultiplier = 1.0;\n          this.isDeathPenalty = false;\n          this.lastStageChangeDay = startDay;\n          this.lastEventDay = startDay;\n\n          for (const key of Object.keys(this.eventCounters)) {\n            this.eventCounters[key] = 0;\n          }\n\n          console.info('[] ');\n          console.info(`[] : ${this.currentDay}`);\n          return;\n        }\n\n        if (chatVars && typeof chatVars === 'object') {\n          const savedData = (chatVars as Record<string, unknown>).detentionSystemState as\n            | {\n                currentDay?: number;\n                currentStage?: string;\n                cellType?: string;\n                legalTimeline?: Timeline;\n                caseComplexity?: string;\n                isDeathPenalty?: boolean;\n                eventCounters?: Record<string, number>;\n                eventHistory?: EventRecord[];\n                lastStageChangeDay?: number;\n                assignedOfficers?: { police?: string | string[] | null; prosecutor?: string | null };\n              }\n            | undefined;\n\n          if (savedData && typeof savedData === 'object') {\n            console.info('[] ');\n            this.currentDay = savedData.currentDay ?? startDay;\n            this.currentStage = (savedData.currentStage as Stage) ?? 'detention';\n            this.cellType = savedData.cellType ?? 'transition';\n            this.caseComplexity =\n              (savedData.caseComplexity as 'simple' | 'normal' | 'complex' | 'very_complex') ?? 'normal';\n            this.isDeathPenalty = Boolean(savedData.isDeathPenalty);\n            this.lastStageChangeDay = savedData.lastStageChangeDay ?? startDay;\n            this.lastEventDay = this.currentDay;\n\n            if (savedData.legalTimeline && typeof savedData.legalTimeline === 'object') {\n              this.legalTimeline = { ...this.legalTimeline, ...savedData.legalTimeline };\n            } else {\n              this.legalTimeline.arrestDay = this.currentDay;\n            }\n\n            if (savedData.eventCounters && typeof savedData.eventCounters === 'object') {\n              this.eventCounters = { ...this.eventCounters, ...savedData.eventCounters };\n            } else {\n              for (const key of Object.keys(this.eventCounters)) {\n                this.eventCounters[key] = 0;\n              }\n            }\n\n            if (Array.isArray(savedData.eventHistory)) {\n              this.eventHistory = [...savedData.eventHistory];\n            }\n\n            if (savedData.assignedOfficers && typeof savedData.assignedOfficers === 'object') {\n              // policenull\n              const savedPolice = savedData.assignedOfficers.police;\n              let policeArray: string[] = [];\n              if (Array.isArray(savedPolice)) {\n                policeArray = savedPolice;\n              } else if (typeof savedPolice === 'string' && savedPolice) {\n                policeArray = [savedPolice];\n              }\n\n              this.assignedOfficers = {\n                police: policeArray,\n                prosecutor: savedData.assignedOfficers.prosecutor ?? null,\n              };\n            } else {\n              this.assignedOfficers = {\n                police: [],\n                prosecutor: null,\n              };\n            }\n\n            console.info(`[] : ${this.currentDay}`);\n          } else {\n            // \n            this.currentDay = startDay;\n            this.legalTimeline.arrestDay = startDay;\n            this.currentStage = 'detention';\n            this.cellType = 'transition';\n            this.caseComplexity = 'normal';\n            this.complexityMultiplier = 1.0;\n            this.isDeathPenalty = false;\n            this.lastStageChangeDay = startDay;\n            this.lastEventDay = startDay;\n\n            for (const key of Object.keys(this.eventCounters)) {\n              this.eventCounters[key] = 0;\n            }\n          }\n        } else {\n          // \n          this.currentDay = startDay;\n          this.legalTimeline.arrestDay = startDay;\n          this.currentStage = 'detention';\n          this.cellType = 'transition';\n          this.caseComplexity = 'normal';\n          this.complexityMultiplier = 1.0;\n          this.isDeathPenalty = false;\n          this.lastStageChangeDay = startDay;\n          this.lastEventDay = startDay;\n\n          for (const key of Object.keys(this.eventCounters)) {\n            this.eventCounters[key] = 0;\n          }\n        }\n      } catch (error) {\n        console.warn('[] :', error);\n        // \n        this.currentDay = startDay;\n        this.legalTimeline.arrestDay = startDay;\n        this.currentStage = 'detention';\n        this.cellType = 'transition';\n        this.caseComplexity = 'normal';\n        this.complexityMultiplier = 1.0;\n        this.isDeathPenalty = false;\n        this.lastStageChangeDay = startDay;\n        this.lastEventDay = startDay;\n\n        for (const key of Object.keys(this.eventCounters)) {\n          this.eventCounters[key] = 0;\n        }\n      }\n\n      console.info('[] ');\n      console.info(`[] : ${this.currentDay}`);\n\n      // \n      // \n      setTimeout(() => {\n        try {\n          // ID\n          const currentChatId =\n            typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId ? SillyTavern.getCurrentChatId() : null;\n\n          if (currentChatId) {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:initialize',\n                message: '',\n                data: {\n                  currentChatId,\n                  currentDay: this.currentDay,\n                  hasChatId: !!currentChatId,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-conflict',\n                hypothesisId: 'INIT_SAVE_DELAYED',\n              }),\n            }).catch(() => {});\n            // #endregion\n            this.saveStateToChatVars();\n          } else {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:initialize',\n                message: 'ID',\n                data: {\n                  currentDay: this.currentDay,\n                  hasChatId: false,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-conflict',\n                hypothesisId: 'INIT_SAVE_SKIPPED',\n              }),\n            }).catch(() => {});\n            // #endregion\n            console.debug('[] ID');\n          }\n        } catch (error) {\n          console.warn('[] :', error);\n        }\n      }, 2000); // 2\n\n      DS.events.emit('event_system_initialized', {\n        day: this.currentDay,\n        stage: this.currentStage,\n      });\n    },\n\n    // \n    saveStateToChatVars() {\n      // \n      if (saveStateTimer) {\n        clearTimeout(saveStateTimer);\n        saveStateTimer = null;\n      }\n\n      // 500ms\n      // \n      saveStateTimer = setTimeout(() => {\n        try {\n          // ID saveChat \n          const currentChatId =\n            typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId ? SillyTavern.getCurrentChatId() : null;\n\n          if (!currentChatId) {\n            console.debug('[] ');\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:saveStateToChatVars',\n                message: '',\n                data: {\n                  hasChatId: false,\n                  currentDay: this.currentDay,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-chat-error',\n                hypothesisId: 'NO_CHAT_SKIP',\n              }),\n            }).catch(() => {});\n            // #endregion\n            saveStateTimer = null;\n            return;\n          }\n\n          const stateData = {\n            currentDay: this.currentDay,\n            currentStage: this.currentStage,\n            cellType: this.cellType,\n            legalTimeline: { ...this.legalTimeline },\n            caseComplexity: this.caseComplexity,\n            isDeathPenalty: this.isDeathPenalty,\n            eventCounters: { ...this.eventCounters },\n            eventHistory: [...this.eventHistory],\n            lastStageChangeDay: this.lastStageChangeDay,\n            assignedOfficers: { ...this.assignedOfficers },\n          };\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveStateToChatVars',\n              message: '',\n              data: {\n                stateDataSize: JSON.stringify(stateData).length,\n                currentDay: this.currentDay,\n                currentStage: this.currentStage,\n                eventHistoryLength: this.eventHistory.length,\n                currentChatId,\n                hasChatId: !!currentChatId,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-conflict',\n              hypothesisId: 'SAVE_STATE_START',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          //  eventHistory\n          const stateDataStr = JSON.stringify(stateData);\n          if (stateDataStr.length > 100000) {\n            // 50\n            console.warn('[] ');\n            const truncatedStateData = {\n              ...stateData,\n              eventHistory: this.eventHistory.slice(-50),\n            };\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:saveStateToChatVars',\n                message: '',\n                data: {\n                  originalSize: stateDataStr.length,\n                  truncatedSize: JSON.stringify(truncatedStateData).length,\n                  originalHistoryLength: this.eventHistory.length,\n                  truncatedHistoryLength: truncatedStateData.eventHistory.length,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-conflict',\n                hypothesisId: 'DATA_TOO_LARGE',\n              }),\n            }).catch(() => {});\n            // #endregion\n            stateData.eventHistory = truncatedStateData.eventHistory;\n          }\n\n          // \n          try {\n            const testChatVars = getVariables({ type: 'chat' });\n            if (!testChatVars || typeof testChatVars !== 'object') {\n              console.debug('[] ');\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'event_system.ts:saveStateToChatVars',\n                  message: '',\n                  data: {\n                    hasChatId: !!currentChatId,\n                    hasChatVars: !!testChatVars,\n                    chatVarsType: typeof testChatVars,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-save-chat-error',\n                  hypothesisId: 'NO_CHAT_VARS',\n                }),\n              }).catch(() => {});\n              // #endregion\n              saveStateTimer = null;\n              return;\n            }\n          } catch (testError) {\n            console.debug('[] :', testError);\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:saveStateToChatVars',\n                message: '',\n                data: {\n                  hasChatId: !!currentChatId,\n                  error: testError instanceof Error ? testError.message : String(testError),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-chat-error',\n                hypothesisId: 'TEST_CHAT_VARS_ERROR',\n              }),\n            }).catch(() => {});\n            // #endregion\n            saveStateTimer = null;\n            return;\n          }\n\n          // \n          try {\n            const testChatVars = getVariables({ type: 'chat' });\n            if (!testChatVars || typeof testChatVars !== 'object') {\n              console.debug('[] ');\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'event_system.ts:saveStateToChatVars',\n                  message: '',\n                  data: {\n                    hasChatId: !!currentChatId,\n                    hasChatVars: !!testChatVars,\n                    chatVarsType: typeof testChatVars,\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-save-chat-error',\n                  hypothesisId: 'NO_CHAT_VARS',\n                }),\n              }).catch(() => {});\n              // #endregion\n              saveStateTimer = null;\n              return;\n            }\n          } catch (testError) {\n            console.debug('[] :', testError);\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:saveStateToChatVars',\n                message: '',\n                data: {\n                  hasChatId: !!currentChatId,\n                  error: testError instanceof Error ? testError.message : String(testError),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-chat-error',\n                hypothesisId: 'TEST_CHAT_VARS_ERROR',\n              }),\n            }).catch(() => {});\n            // #endregion\n            saveStateTimer = null;\n            return;\n          }\n\n          //  updateVariablesWith  replaceVariables\n          // \n          updateVariablesWith(\n            variables => {\n              return { ...variables, detentionSystemState: stateData };\n            },\n            { type: 'chat' },\n          );\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveStateToChatVars',\n              message: ' (updateVariablesWith)',\n              data: {\n                success: true,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-conflict',\n              hypothesisId: 'SAVE_STATE_SUCCESS',\n            }),\n          }).catch(() => {});\n          // #endregion\n          console.debug('[]   ()');\n        } catch (error) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveStateToChatVars',\n              message: ' (updateVariablesWith)',\n              data: {\n                error: error instanceof Error ? error.message : String(error),\n                errorType: error instanceof Error ? error.constructor.name : typeof error,\n                errorStack: error instanceof Error ? error.stack : undefined,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-conflict',\n              hypothesisId: 'SAVE_STATE_ERROR',\n            }),\n          }).catch(() => {});\n          // #endregion\n          console.warn('[]  (updateVariablesWith):', error);\n          //  updateVariablesWith  replaceVariables\n          // \n        }\n        saveStateTimer = null;\n      }, 500); // 500ms\n    },\n\n    setCaseComplexity(complexity: 'simple' | 'normal' | 'complex' | 'very_complex') {\n      const validComplexities: Record<string, number> = {\n        simple: 0.8,\n        normal: 1.0,\n        complex: 1.3,\n        very_complex: 1.6,\n      };\n\n      if (complexity in validComplexities) {\n        this.caseComplexity = complexity;\n        this.complexityMultiplier = validComplexities[complexity];\n\n        console.info(`[] : ${complexity} (: ${this.complexityMultiplier})`);\n\n        DS.events.emit('complexity_changed', {\n          complexity: this.caseComplexity,\n          multiplier: this.complexityMultiplier,\n        });\n      } else {\n        console.warn(`[] : ${complexity}`);\n      }\n    },\n\n    checkComplexityAdjustment() {\n      if (this.currentDay % 30 !== 0) return;\n\n      DS.events.emit('request_complexity_assessment', {\n        day: this.currentDay,\n        stage: this.currentStage,\n        eventHistory: this.eventHistory,\n      });\n    },\n\n    rollbackToStage(targetStage: Stage, reason = '') {\n      console.info(`[] : ${this.currentStage} -> ${targetStage}`);\n      console.info(`[] : ${reason}`);\n\n      const stageOrder: Stage[] = [\n        'detention',\n        'approval',\n        'investigation',\n        'prosecution',\n        'trial1',\n        'firstVerdict',\n        'appeal',\n        'trial2',\n        'finalVerdict',\n        'transfer',\n        'execution',\n      ];\n\n      const targetIndex = stageOrder.indexOf(targetStage);\n      const currentIndex = stageOrder.indexOf(this.currentStage);\n\n      if (targetIndex === -1 || targetIndex >= currentIndex) {\n        console.warn('[] ');\n        return false;\n      }\n\n      const timelineKeys: Partial<Record<Stage, keyof Timeline>> = {\n        approval: 'approvalDay',\n        investigation: 'approvalDay',\n        prosecution: 'prosecutionDay',\n        trial1: 'firstTrialDay',\n        firstVerdict: 'firstVerdictDay',\n        appeal: 'firstVerdictDay',\n        trial2: 'secondTrialDay',\n        finalVerdict: 'finalVerdictDay',\n        transfer: 'transferDay',\n        execution: 'executionDay',\n      };\n\n      for (let i = targetIndex + 1; i < stageOrder.length; i++) {\n        const stage = stageOrder[i];\n        const key = timelineKeys[stage];\n        if (key && this.legalTimeline[key]) {\n          this.legalTimeline[key] = null as never;\n        }\n      }\n\n      this.currentStage = targetStage;\n\n      if (targetIndex <= stageOrder.indexOf('investigation')) {\n        this.cellType = 'pretrial';\n      }\n\n      this.eventHistory.push({\n        id: 'procedure_rollback',\n        name: '',\n        type: 'legal',\n        day: this.currentDay,\n        from: stageOrder[currentIndex],\n        to: targetStage,\n        reason,\n      });\n\n      DS.events.emit('procedure_rollback', {\n        from: stageOrder[currentIndex],\n        to: targetStage,\n        reason,\n        day: this.currentDay,\n      });\n\n      return true;\n    },\n\n    // \n    advanceToStage(targetStage: Stage, reason = '') {\n      console.info(`[] : ${this.currentStage} -> ${targetStage}`);\n      console.info(`[] : ${reason}`);\n\n      const stageOrder: Stage[] = [\n        'detention',\n        'approval',\n        'investigation',\n        'prosecution',\n        'trial1',\n        'firstVerdict',\n        'appeal',\n        'trial2',\n        'finalVerdict',\n        'transfer',\n        'execution',\n      ];\n\n      const targetIndex = stageOrder.indexOf(targetStage);\n      const currentIndex = stageOrder.indexOf(this.currentStage);\n\n      if (targetIndex === -1) {\n        console.warn(`[] : ${targetStage}`);\n        return false;\n      }\n\n      if (targetIndex <= currentIndex) {\n        console.warn(`[]  ${targetStage}  ${this.currentStage} `);\n        return false;\n      }\n\n      // \n      const timelineKeys: Partial<Record<Stage, keyof Timeline>> = {\n        approval: 'approvalDay',\n        investigation: 'approvalDay',\n        prosecution: 'prosecutionDay',\n        trial1: 'firstTrialDay',\n        firstVerdict: 'firstVerdictDay',\n        appeal: 'firstVerdictDay',\n        trial2: 'secondTrialDay',\n        finalVerdict: 'finalVerdictDay',\n        transfer: 'transferDay',\n        execution: 'executionDay',\n      };\n\n      // \n      for (let i = currentIndex + 1; i <= targetIndex; i++) {\n        const stage = stageOrder[i];\n        const key = timelineKeys[stage];\n        if (key && !this.legalTimeline[key]) {\n          // \n          (this.legalTimeline as any)[key] = this.currentDay;\n        }\n      }\n\n      // \n      this.currentStage = targetStage;\n      this.lastStageChangeDay = this.currentDay;\n\n      // \n      // \n      if (targetIndex >= stageOrder.indexOf('investigation') && targetIndex < stageOrder.indexOf('firstVerdict')) {\n        this.cellType = 'pretrial';\n      }\n      // \n      if (targetIndex >= stageOrder.indexOf('firstVerdict')) {\n        this.cellType = 'convicted';\n      }\n\n      // \n      if (targetStage === 'execution') {\n        this.isDeathPenalty = true;\n        // \n        this.legalTimeline.executionDay = this.currentDay;\n      }\n\n      // \n      this.eventHistory.push({\n        id: 'procedure_advance',\n        name: '',\n        type: 'legal',\n        day: this.currentDay,\n        from: stageOrder[currentIndex],\n        to: targetStage,\n        reason,\n      });\n\n      // \n      this.saveStateToChatVars();\n\n      // \n      DS.events.emit('procedure_advance', {\n        from: stageOrder[currentIndex],\n        to: targetStage,\n        reason,\n        day: this.currentDay,\n      });\n\n      console.info(`[]  : ${targetStage} (${this.currentDay})`);\n\n      return true;\n    },\n\n    handleUserRollback(input: string) {\n      const rollbackPatterns = [\n        { pattern: /.*?.*?(|||)/, stage: null as Stage | null },\n        { pattern: /.*?(|)/, stage: null as Stage | null },\n        { pattern: /.*?(|)/, stage: null as Stage | null },\n      ];\n\n      for (const rule of rollbackPatterns) {\n        const match = input.match(rule.pattern);\n        if (match) {\n          let targetStage: Stage | null = null;\n\n          if (match[1].includes('')) {\n            targetStage = 'investigation';\n          } else if (match[1].includes('')) {\n            targetStage = 'prosecution';\n          } else if (match[1].includes('')) {\n            targetStage = 'trial1';\n          } else if (match[1].includes('')) {\n            targetStage = 'trial2';\n          }\n\n          if (targetStage) {\n            return this.rollbackToStage(targetStage, '');\n          }\n        }\n      }\n\n      return false;\n    },\n\n    advanceDay(days = 1) {\n      const events: EventRecord[] = [];\n      // \n      const startDay = this.getCurrentDayInternal();\n\n      // currentDay\n      // AIconfirmDayAdvancement\n      // \n      let tempCurrentDay = this.getCurrentDayInternal();\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:advanceDay',\n          message: '',\n          data: { days, daysType: typeof days, startDay: this.currentDay, tempCurrentDay },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-day-calculation',\n          hypothesisId: 'A',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      // days>=1\n      const daysToAdvance = Math.max(1, Math.floor(days));\n\n      // LEGAL, PROCEDURAL, CONDITION\n      for (let i = 0; i < daysToAdvance; i++) {\n        tempCurrentDay++;\n        //  this.currentDay\n        // AI confirmDayAdvancement \n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:advanceDay',\n            message: 'N',\n            data: {\n              currentDay: this.currentDay,\n              tempCurrentDay,\n              dayIndex: i,\n              daysRemaining: daysToAdvance - i - 1,\n              willCheckDay0: tempCurrentDay === 0,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-day0-events',\n            hypothesisId: 'HYP-B',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // currentDay\n        const originalCurrentDay = this.currentDay;\n        this.currentDay = tempCurrentDay;\n        this.lastEventDay = tempCurrentDay;\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:advanceDay',\n            message: ' - ',\n            data: {\n              originalCurrentDay,\n              tempCurrentDay,\n              currentDayBeforeCheck: this.currentDay,\n              willSkipDay0: tempCurrentDay === 0,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-day0-events',\n            hypothesisId: 'HYP-C',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        this.checkComplexityAdjustment();\n\n        const dayEvent = this.checkDayEvents();\n\n        // originalCurrentDayAI\n        this.currentDay = originalCurrentDay;\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:advanceDay',\n            message: '',\n            data: {\n              currentDay: this.currentDay,\n              tempCurrentDay,\n              originalCurrentDay,\n              hasEvent: !!dayEvent,\n              eventName: dayEvent?.name,\n              eventId: dayEvent?.id,\n              eventPriority: dayEvent?.priority,\n              eventDay: dayEvent?.day,\n              isDay0Event: tempCurrentDay === 0 && !!dayEvent,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-day0-events',\n            hypothesisId: 'HYP-D',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // 0\n        if (tempCurrentDay === 0 && dayEvent && dayEvent.id !== 'no_event') {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:advanceDay',\n              message: '0',\n              data: {\n                eventId: dayEvent.id,\n                eventName: dayEvent.name,\n                tempCurrentDay,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-day0-events',\n              hypothesisId: 'HYP-E',\n            }),\n          }).catch(() => {});\n          // #endregion\n          continue; // 0\n        }\n\n        if (dayEvent) {\n          events.push(dayEvent);\n\n          this.eventHistory.push({\n            ...dayEvent,\n            day: tempCurrentDay,\n          });\n\n          if (Object.prototype.hasOwnProperty.call(this.eventCounters, dayEvent.id)) {\n            this.eventCounters[dayEvent.id] = (this.eventCounters[dayEvent.id] || 0) + 1;\n          }\n\n          // \n          // LEGAL: 1, PROCEDURAL: 2, CONDITION: 3, RANDOM: 4DAILY: 5\n          const eventPriority = dayEvent.priority ?? this.PRIORITY.DAILY;\n          const shouldInterrupt = eventPriority <= this.PRIORITY.RANDOM;\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:advanceDay',\n              message: '',\n              data: {\n                currentDay: this.currentDay,\n                tempCurrentDay,\n                eventName: dayEvent.name,\n                eventId: dayEvent.id,\n                eventPriority,\n                PRIORITY_RANDOM: this.PRIORITY.RANDOM,\n                shouldInterrupt,\n                daysRemaining: daysToAdvance - i - 1,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-interruption-v2',\n              hypothesisId: 'D',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          // LEGAL: 1, PROCEDURAL: 2, CONDITION: 3, RANDOM: 4\n          // DAILY: 5\n          if (shouldInterrupt) {\n            console.info(\n              `[] ${tempCurrentDay}: ${dayEvent.name} (: ${eventPriority})`,\n            );\n\n            // currentDay\n            // AIconfirmDayAdvancement\n            // \n            const pendingDays = tempCurrentDay - startDay;\n\n            // currentDay\n            this.saveStateToChatVars();\n\n            // accumulatedEvents\n            // \n            const eventData = {\n              ...dayEvent,\n              day: tempCurrentDay, // \n              pendingDayAdvancement: pendingDays, // \n              startDay, // \n            };\n            DS.events.emit('event_triggered', eventData);\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:advanceDay',\n                message: '',\n                data: {\n                  currentDay: this.currentDay,\n                  tempCurrentDay,\n                  startDay,\n                  pendingDays,\n                  eventName: dayEvent.name,\n                  eventPriority,\n                  accumulatedEventsCount: events.length,\n                  daysSkipped: i + 1,\n                  daysRemaining: daysToAdvance - i - 1,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-day-calculation',\n                hypothesisId: 'E',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            const result = {\n              interrupted: true,\n              currentDay: this.currentDay, // currentDay\n              tempCurrentDay, // \n              pendingDays, // \n              event: { ...dayEvent, day: tempCurrentDay },\n            };\n\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:advanceDay',\n                message: '',\n                data: { currentDay: this.currentDay, eventName: dayEvent.name, result },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-interruption-v2',\n                hypothesisId: 'E',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            return result;\n          } else {\n            // DAILY: 5\n            // RANDOMDAILY\n            console.debug(\n              `[] ${tempCurrentDay}: ${dayEvent.name} (: ${eventPriority})`,\n            );\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:advanceDay',\n                message: '',\n                data: {\n                  currentDay: this.currentDay,\n                  tempCurrentDay,\n                  eventName: dayEvent.name,\n                  eventPriority,\n                  daysRemaining: daysToAdvance - i - 1,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'simplify-date-system',\n                hypothesisId: 'F',\n              }),\n            }).catch(() => {});\n            // #endregion\n          }\n        } else {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:advanceDay',\n              message: '',\n              data: {\n                currentDay: this.currentDay,\n                tempCurrentDay,\n                daysRemaining: daysToAdvance - i - 1,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'simplify-date-system',\n              hypothesisId: 'G',\n            }),\n          }).catch(() => {});\n          // #endregion\n        }\n      }\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:advanceDay',\n          message: '',\n          data: {\n            currentDay: this.currentDay,\n            daysAdvanced: daysToAdvance,\n            startDay,\n            eventsCount: events.length,\n            hasInterruptedEvent: events.some(e => (e.priority ?? this.PRIORITY.DAILY) <= this.PRIORITY.CONDITION),\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'simplify-date-system',\n          hypothesisId: 'H',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      // LEGAL, PROCEDURAL, CONDITION, RANDOM\n      const interruptedEvent = events.find(e => {\n        const priority = e.priority ?? this.PRIORITY.DAILY;\n        return priority <= this.PRIORITY.RANDOM;\n      });\n\n      // currentDay\n      this.saveStateToChatVars();\n\n      // \n      const pendingDays = tempCurrentDay - startDay;\n\n      // \n      if (interruptedEvent) {\n        return {\n          interrupted: true,\n          currentDay: this.currentDay, // currentDay\n          tempCurrentDay, // \n          pendingDays, // \n          event: { ...interruptedEvent, day: tempCurrentDay },\n        };\n      }\n\n      // \n      // AIconfirmDayAdvancement\n      return {\n        interrupted: false,\n        currentDay: this.currentDay, // currentDay\n        tempCurrentDay, // \n        pendingDays, // \n      };\n    },\n\n    checkDayEvents(): EventRecord {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:checkDayEvents',\n          message: ' - ',\n          data: {\n            currentDay: this.currentDay,\n            shouldSkipDay0: this.currentDay === 0,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'fix-day0-events',\n          hypothesisId: 'HYP-A',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      // 0\n      if (this.currentDay === 0) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:checkDayEvents',\n            message: '0',\n            data: {\n              currentDay: this.currentDay,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-day0-events',\n            hypothesisId: 'HYP-A',\n          }),\n        }).catch(() => {});\n        // #endregion\n        return {\n          id: 'no_event',\n          name: '',\n          type: 'daily',\n          description: '0',\n          priority: this.PRIORITY.DAILY,\n          day: 0,\n        };\n      }\n\n      // \n      const currentDate = new Date();\n      const month = currentDate.getMonth() + 1;\n      const day = currentDate.getDate();\n\n      // 1. \n      const cellTransferResult = this.checkCellTransfer();\n      if (cellTransferResult) {\n        //  LEGAL\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:checkDayEvents',\n            message: '',\n            data: {\n              currentDay: this.currentDay,\n              cellType: this.cellType,\n              priority: this.PRIORITY.LEGAL,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-cell-transfer',\n            hypothesisId: 'CELL_TRANSFER',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // \n        const cellTypeNames: Record<string, string> = {\n          transition: '',\n          pretrial: '',\n          convicted: '',\n        };\n        const fromCellName = cellTypeNames['transition'] || '';\n        const toCellName = cellTypeNames[this.cellType] || '';\n\n        return {\n          id: 'cell_transfer',\n          name: '',\n          type: 'legal',\n          description: `${fromCellName}${toCellName}`,\n          priority: this.PRIORITY.LEGAL,\n          day: this.currentDay,\n          from: 'transition',\n          to: this.cellType,\n          reason: '',\n          text: `${month}${day}`,\n        };\n      }\n\n      // 2. \n      const legalEvent = this.checkLegalEvent();\n      if (legalEvent) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:checkDayEvents',\n            message: '',\n            data: {\n              currentDay: this.currentDay,\n              eventId: legalEvent.id,\n              eventName: legalEvent.name,\n              priority: this.PRIORITY.LEGAL,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-interruption',\n            hypothesisId: 'C',\n          }),\n        }).catch(() => {});\n        // #endregion\n        return {\n          ...legalEvent,\n          priority: this.PRIORITY.LEGAL,\n          day: this.currentDay,\n          text: `${month}${day}${legalEvent.name}`,\n        };\n      }\n\n      // 3. \n      const conditionEvent = this.checkConditionEvent();\n      if (conditionEvent) {\n        // \n        const isProcedural =\n          conditionEvent.id === 'interrogation' ||\n          conditionEvent.id === 'lawyer_visit' ||\n          conditionEvent.id === 'family_visit' ||\n          conditionEvent.id === 'prosecutor_interrogation';\n\n        const eventPriority = isProcedural ? this.PRIORITY.PROCEDURAL : this.PRIORITY.CONDITION;\n\n        // \n        if (conditionEvent.id === 'interrogation' || conditionEvent.id === 'prosecutor_interrogation') {\n          const policeNames = ['', '', '', '', '', '', '', ''];\n          const prosecutorNames = ['', '', '', '', '', ''];\n\n          // 30-371+2\n          if (conditionEvent.id === 'prosecutor_interrogation') {\n            // 22\n            if (this.assignedOfficers.police.length < 2) {\n              const usedNames = new Set(this.assignedOfficers.police);\n              while (this.assignedOfficers.police.length < 2) {\n                const availableNames = policeNames.filter(name => !usedNames.has(name));\n                if (availableNames.length === 0) break;\n                const selectedName = availableNames[Math.floor(Math.random() * availableNames.length)];\n                this.assignedOfficers.police.push(selectedName);\n                usedNames.add(selectedName);\n              }\n              console.info(`[] : ${this.assignedOfficers.police.join('')}`);\n            }\n\n            // \n            if (!this.assignedOfficers.prosecutor) {\n              this.assignedOfficers.prosecutor = prosecutorNames[Math.floor(Math.random() * prosecutorNames.length)];\n              console.info(`[] : ${this.assignedOfficers.prosecutor}`);\n            }\n\n            // +2\n            conditionEvent.description = `${this.assignedOfficers.prosecutor}${this.assignedOfficers.police.join('')}`;\n          }\n          // \n          else if (conditionEvent.id === 'interrogation') {\n            // 2\n            if (this.assignedOfficers.police.length < 2) {\n              const usedNames = new Set(this.assignedOfficers.police);\n              while (this.assignedOfficers.police.length < 2) {\n                const availableNames = policeNames.filter(name => !usedNames.has(name));\n                if (availableNames.length === 0) break;\n                const selectedName = availableNames[Math.floor(Math.random() * availableNames.length)];\n                this.assignedOfficers.police.push(selectedName);\n                usedNames.add(selectedName);\n              }\n              console.info(`[] : ${this.assignedOfficers.police.join('')}`);\n            }\n\n            // 50%\n            const hasApproval = this.legalTimeline.approvalDay !== null;\n            const beforeFirstTrial =\n              !this.legalTimeline.firstTrialDay || this.currentDay < this.legalTimeline.firstTrialDay;\n            const isInvestigationOrProsecution =\n              this.currentStage === 'investigation' || this.currentStage === 'prosecution';\n\n            if (hasApproval && beforeFirstTrial && isInvestigationOrProsecution && Math.random() < 0.5) {\n              // \n              if (!this.assignedOfficers.prosecutor) {\n                this.assignedOfficers.prosecutor = prosecutorNames[Math.floor(Math.random() * prosecutorNames.length)];\n                console.info(`[] : ${this.assignedOfficers.prosecutor}`);\n              }\n              // 2+\n              conditionEvent.description = `${this.assignedOfficers.police.join('')}${this.assignedOfficers.prosecutor}`;\n            } else {\n              // 2\n              conditionEvent.description = `${this.assignedOfficers.police.join('')}`;\n            }\n          }\n        }\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:checkDayEvents',\n            message: '',\n            data: {\n              currentDay: this.currentDay,\n              eventId: conditionEvent.id,\n              eventName: conditionEvent.name,\n              isProcedural,\n              priority: eventPriority,\n              assignedPolice: this.assignedOfficers.police,\n              assignedProsecutor: this.assignedOfficers.prosecutor,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-interruption',\n            hypothesisId: 'C',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // LEGALPROCEDURALCONDITION\n        const shouldInterrupt = eventPriority <= this.PRIORITY.CONDITION;\n\n        return {\n          ...conditionEvent,\n          priority: eventPriority,\n          day: this.currentDay,\n          text: shouldInterrupt\n            ? `${month}${day}${conditionEvent.name}`\n            : undefined,\n        };\n      }\n\n      // 4. 05%\n      if (this.currentDay > 0 && this.cellType !== 'transition' && Math.random() < 0.05) {\n        const randomEvent = this.generateRandomEvent();\n        if (randomEvent) {\n          return {\n            ...randomEvent,\n            priority: this.PRIORITY.RANDOM,\n            day: this.currentDay,\n            text: `${month}${day}${randomEvent.name}`,\n          };\n        }\n      }\n\n      // 5. \n      if (Math.random() < 0.15) {\n        const monologue = this.generateInnerMonologue();\n        if (monologue) {\n          return {\n            ...monologue,\n            priority: this.PRIORITY.DAILY,\n            day: this.currentDay,\n          };\n        }\n      }\n\n      // 6. \n      return {\n        id: 'daily_routine',\n        name: '',\n        type: 'daily',\n        priority: this.PRIORITY.DAILY,\n        day: this.currentDay,\n        description: '',\n      };\n    },\n\n    checkLegalEvent(): EventRecord | null {\n      const daysInCustody = this.currentDay - this.legalTimeline.arrestDay;\n      const stageBefore = this.currentStage;\n\n      if (!this.legalTimeline.approvalDay) {\n        const minDays = Math.floor(30 * this.complexityMultiplier);\n        const maxDays = Math.floor(37 * this.complexityMultiplier);\n\n        if (daysInCustody >= minDays && daysInCustody <= maxDays) {\n          if (Math.random() < 0.3) {\n            this.legalTimeline.approvalDay = this.currentDay;\n            this.currentStage = 'investigation';\n            this.lastStageChangeDay = this.currentDay;\n            return {\n              id: 'approval',\n              name: '',\n              type: 'legal',\n              stage: 'approval',\n              description: '',\n              from: stageBefore,\n              to: 'investigation',\n            };\n          }\n        }\n      }\n\n      if (this.legalTimeline.approvalDay && !this.legalTimeline.prosecutionDay) {\n        const daysSinceApproval = this.currentDay - this.legalTimeline.approvalDay;\n        const minDays = Math.floor(60 * this.complexityMultiplier);\n        const maxDays = Math.floor(210 * this.complexityMultiplier);\n\n        if (daysSinceApproval >= minDays && daysSinceApproval <= maxDays && Math.random() < 0.02) {\n          this.legalTimeline.prosecutionDay = this.currentDay;\n          this.currentStage = 'prosecution';\n          this.lastStageChangeDay = this.currentDay;\n          return {\n            id: 'prosecution',\n            name: '',\n            type: 'legal',\n            stage: 'prosecution',\n            description: '',\n            from: stageBefore,\n            to: 'prosecution',\n          };\n        }\n      }\n\n      if (this.legalTimeline.prosecutionDay && !this.legalTimeline.firstTrialDay) {\n        const daysSinceProsecution = this.currentDay - this.legalTimeline.prosecutionDay;\n        const minDays = Math.floor(30 * this.complexityMultiplier);\n        const maxDays = Math.floor(45 * this.complexityMultiplier);\n\n        if (daysSinceProsecution >= minDays && daysSinceProsecution <= maxDays && Math.random() < 0.05) {\n          this.legalTimeline.firstTrialDay = this.currentDay;\n          this.currentStage = 'trial1';\n          this.lastStageChangeDay = this.currentDay;\n\n          if (this.cellType === 'transition') {\n            this.cellType = 'pretrial';\n            DS.events.emit('cell_transfer', {\n              from: 'transition',\n              to: 'pretrial',\n              reason: '',\n            });\n          }\n\n          return {\n            id: 'first_trial',\n            name: '',\n            type: 'legal',\n            stage: 'trial1',\n            description: '',\n            from: stageBefore,\n            to: 'trial1',\n          };\n        }\n      }\n\n      if (this.legalTimeline.firstTrialDay && !this.legalTimeline.firstVerdictDay) {\n        const daysSinceTrial = this.currentDay - this.legalTimeline.firstTrialDay;\n        const minDays = Math.floor(7 * this.complexityMultiplier);\n        const maxDays = Math.floor(30 * this.complexityMultiplier);\n\n        if (daysSinceTrial >= minDays && daysSinceTrial <= maxDays && Math.random() < 0.1) {\n          this.legalTimeline.firstVerdictDay = this.currentDay;\n          this.currentStage = 'appeal';\n          this.lastStageChangeDay = this.currentDay;\n\n          this.cellType = 'convicted';\n          DS.events.emit('cell_transfer', {\n            from: 'pretrial',\n            to: 'convicted',\n            reason: '',\n          });\n\n          return {\n            id: 'first_verdict',\n            name: '',\n            type: 'legal',\n            stage: 'firstVerdict',\n            description: '',\n            from: stageBefore,\n            to: 'appeal',\n          };\n        }\n      }\n\n      if (\n        this.legalTimeline.firstVerdictDay &&\n        !this.legalTimeline.secondTrialDay &&\n        !this.legalTimeline.finalVerdictDay\n      ) {\n        const daysSinceVerdict = this.currentDay - this.legalTimeline.firstVerdictDay;\n\n        if (daysSinceVerdict === 10) {\n          if (Math.random() < 0.7) {\n            this.legalTimeline.secondTrialDay = this.currentDay;\n            this.currentStage = 'trial2';\n            this.lastStageChangeDay = this.currentDay;\n\n            return {\n              id: 'appeal_filed',\n              name: '',\n              type: 'legal',\n              stage: 'appeal',\n              description: '',\n              from: stageBefore,\n              to: 'trial2',\n            };\n          } else {\n            this.legalTimeline.finalVerdictDay = this.currentDay;\n            this.currentStage = 'transfer';\n            this.lastStageChangeDay = this.currentDay;\n\n            return {\n              id: 'verdict_final',\n              name: '',\n              type: 'legal',\n              stage: 'finalVerdict',\n              description: '',\n              from: stageBefore,\n              to: 'transfer',\n            };\n          }\n        }\n      }\n\n      if (this.legalTimeline.secondTrialDay && !this.legalTimeline.finalVerdictDay) {\n        const daysSinceAppeal = this.currentDay - this.legalTimeline.secondTrialDay;\n        const minDays = Math.floor(60 * this.complexityMultiplier);\n        const maxDays = Math.floor(90 * this.complexityMultiplier);\n\n        if (daysSinceAppeal >= minDays && daysSinceAppeal <= maxDays && Math.random() < 0.03) {\n          this.legalTimeline.finalVerdictDay = this.currentDay;\n          this.currentStage = 'transfer';\n          this.lastStageChangeDay = this.currentDay;\n\n          return {\n            id: 'final_verdict',\n            name: '',\n            type: 'legal',\n            stage: 'finalVerdict',\n            description: '',\n            from: stageBefore,\n            to: 'transfer',\n          };\n        }\n      }\n\n      if (this.legalTimeline.finalVerdictDay && !this.legalTimeline.transferDay && !this.isDeathPenalty) {\n        const daysSinceVerdict = this.currentDay - this.legalTimeline.finalVerdictDay;\n        const minDays = Math.floor(30 * this.complexityMultiplier);\n        const maxDays = Math.floor(90 * this.complexityMultiplier);\n\n        if (daysSinceVerdict >= minDays && daysSinceVerdict <= maxDays && Math.random() < 0.02) {\n          this.legalTimeline.transferDay = this.currentDay;\n          this.currentStage = 'end';\n          this.lastStageChangeDay = this.currentDay;\n\n          return {\n            id: 'transfer_prison',\n            name: '',\n            type: 'legal',\n            stage: 'transfer',\n            description: '',\n            isEnding: true,\n            endingType: 'prison',\n            from: stageBefore,\n            to: 'end',\n          };\n        }\n      }\n\n      if (this.legalTimeline.finalVerdictDay && this.isDeathPenalty && !this.legalTimeline.executionDay) {\n        const daysSinceVerdict = this.currentDay - this.legalTimeline.finalVerdictDay;\n        const minDays = 180;\n        const maxDays = 720;\n\n        if (daysSinceVerdict >= minDays && daysSinceVerdict <= maxDays && Math.random() < 0.005) {\n          this.legalTimeline.executionDay = this.currentDay + 7;\n          this.currentStage = 'execution';\n          this.lastStageChangeDay = this.currentDay;\n\n          return {\n            id: 'death_review_approved',\n            name: '',\n            type: 'legal',\n            stage: 'deathReview',\n            description: '7',\n            from: stageBefore,\n            to: 'execution',\n          };\n        }\n      }\n\n      if (this.legalTimeline.executionDay && this.currentDay >= this.legalTimeline.executionDay) {\n        this.currentStage = 'end';\n        this.lastStageChangeDay = this.currentDay;\n\n        return {\n          id: 'execution',\n          name: '',\n          type: 'legal',\n          stage: 'execution',\n          description: '',\n          isEnding: true,\n          endingType: 'death',\n          from: stageBefore,\n          to: 'end',\n        };\n      }\n\n      return null;\n    },\n\n    checkConditionEvent(): EventRecord | null {\n      const state = this.getProtagonistState();\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:checkConditionEvent',\n          message: '',\n          data: {\n            currentDay: this.currentDay,\n            stateHealth: state.health,\n            stateMental: state.mental,\n            stateStrength: state.strength,\n            stateIntelligence: state.intelligence,\n            conditionEventsCount: this.conditionEvents.length,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'check-status-dependency',\n          hypothesisId: 'E',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      for (const event of this.conditionEvents) {\n        if (event.stageChangeOnly && this.currentDay !== this.lastStageChangeDay) {\n          continue;\n        }\n\n        if (event.checkAlways || !event.stageChangeOnly) {\n          const conditionResult = event.condition(state, this);\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:checkConditionEvent',\n              message: '',\n              data: {\n                eventId: event.id,\n                eventName: event.name,\n                conditionResult,\n                stateHealth: state.health,\n                stateMental: state.mental,\n                stateStrength: state.strength,\n                stateIntelligence: state.intelligence,\n                eventWeight: event.weight,\n                dependsOnStatusPanel: ['mental_breakdown', 'health_crisis', 'medical_visit'].includes(event.id),\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'check-status-dependency',\n              hypothesisId: 'F',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          if (conditionResult) {\n            const randomCheck = Math.random() * 100 < event.weight;\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:checkConditionEvent',\n                message: '',\n                data: {\n                  eventId: event.id,\n                  eventName: event.name,\n                  conditionResult,\n                  randomCheck,\n                  randomValue: Math.random() * 100,\n                  eventWeight: event.weight,\n                  willTrigger: randomCheck,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'check-status-dependency',\n                hypothesisId: 'G',\n              }),\n            }).catch(() => {});\n            // #endregion\n\n            if (randomCheck) {\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'event_system.ts:checkConditionEvent',\n                  message: '',\n                  data: {\n                    eventId: event.id,\n                    eventName: event.name,\n                    stateHealth: state.health,\n                    stateMental: state.mental,\n                    dependsOnStatusPanel: ['mental_breakdown', 'health_crisis', 'medical_visit'].includes(event.id),\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'check-status-dependency',\n                  hypothesisId: 'H',\n                }),\n              }).catch(() => {});\n              // #endregion\n\n              return {\n                id: event.id,\n                name: event.name,\n                type: event.category || 'condition',\n                description: event.description,\n                aiControlled: event.aiControlled || false,\n              };\n            }\n          }\n        }\n      }\n\n      return null;\n    },\n\n    generateRandomEvent(): EventRecord | null {\n      const types = ['violence', 'medical', 'emotional', 'accident'] as const;\n      const weights = [25, 30, 30, 15];\n\n      const typeIndex = this.weightedRandom(types.length, weights);\n      const eventType = types[typeIndex];\n      const eventList = this.randomEvents[eventType];\n\n      const eventWeights = eventList.map(e => e.weight);\n      const eventIndex = this.weightedRandom(eventList.length, eventWeights);\n      const event = eventList[eventIndex];\n\n      return {\n        id: event.id,\n        name: event.name,\n        type: eventType,\n        category: 'random',\n        description: `: ${event.name}`,\n      };\n    },\n\n    generateInnerMonologue(): EventRecord | null {\n      const weights = this.innerMonologues.map(m => m.weight);\n      const index = this.weightedRandom(this.innerMonologues.length, weights);\n      const monologue = this.innerMonologues[index];\n\n      return {\n        id: monologue.id,\n        name: '',\n        type: 'monologue',\n        category: 'daily',\n        description: monologue.text,\n        text: monologue.text,\n      };\n    },\n\n    weightedRandom(count: number, weights: number[]): number {\n      const totalWeight = weights.reduce((sum, w) => sum + w, 0);\n      let random = Math.random() * totalWeight;\n\n      for (let i = 0; i < count; i++) {\n        random -= weights[i];\n        if (random <= 0) {\n          return i;\n        }\n      }\n\n      return count - 1;\n    },\n\n    getProtagonistState(): ProtagonistState {\n      // \n      console.log('[] getProtagonistState: ');\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:getProtagonistState',\n          message: '',\n          data: {\n            hasDS: !!DS,\n            hasGetModule: typeof DS?.getModule === 'function',\n            codeVersion: 'memory-enhancement-integration-v1',\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'memory-enhancement-integration',\n          hypothesisId: 'A',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      //  getState()\n      //  >  >  > \n      const statusPanel = DS.getModule<{ getState?: () => ProtagonistState }>('statusPanel');\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:getProtagonistState',\n          message: '',\n          data: {\n            hasStatusPanel: !!statusPanel,\n            hasGetState: !!(statusPanel && statusPanel.getState),\n            statusPanelType: typeof statusPanel,\n            willUseFallback: !(statusPanel && statusPanel.getState),\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'memory-enhancement-integration',\n          hypothesisId: 'B',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      if (statusPanel && statusPanel.getState) {\n        const state = statusPanel.getState();\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:getProtagonistState',\n            message: '',\n            data: {\n              health: state.health,\n              mental: state.mental,\n              strength: state.strength,\n              intelligence: state.intelligence,\n              source: 'statusPanel (with memory enhancement integration)',\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'memory-enhancement-integration',\n            hypothesisId: 'C',\n          }),\n        }).catch(() => {});\n        // #endregion\n        // \n        return state;\n      }\n\n      // \n      const fallbackState: ProtagonistState = {\n        health: 70,\n        mental: 65,\n        strength: 50,\n        intelligence: 55,\n        //  undefined ProtagonistState \n      };\n\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'event_system.ts:getProtagonistState',\n          message: '',\n          data: {\n            ...fallbackState,\n            source: 'fallback',\n            warning: '',\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'memory-enhancement-integration',\n          hypothesisId: 'D',\n        }),\n      }).catch(() => {});\n      // #endregion\n\n      console.warn('[] ');\n      return fallbackState;\n    },\n\n    getRecentContext(): string {\n      if (Array.isArray(window.chat)) {\n        const recentMessages = window.chat.slice(-5);\n        return recentMessages.map(m => m.mes || '').join(' ');\n      }\n      return '';\n    },\n\n    checkCellTransfer() {\n      const daysInCustody = this.currentDay - this.legalTimeline.arrestDay;\n\n      // \n      if (this.cellType === 'transition' && daysInCustody >= 7 && daysInCustody <= 14) {\n        this.cellType = 'pretrial';\n        DS.events.emit('cell_transfer', {\n          from: 'transition',\n          to: 'pretrial',\n          reason: '',\n          day: this.currentDay,\n        });\n        return true;\n      }\n\n      return false;\n    },\n\n    setDeathPenalty(isDeathPenalty: boolean) {\n      this.isDeathPenalty = isDeathPenalty;\n      console.info(`[] : ${isDeathPenalty}`);\n\n      DS.events.emit('death_penalty_status_changed', {\n        isDeathPenalty: this.isDeathPenalty,\n        day: this.currentDay,\n      });\n    },\n\n    getCurrentStageInfo() {\n      // \n      const cellTypeNames: Record<string, string> = {\n        transition: '',\n        pretrial: '',\n        convicted: '',\n      };\n      const cellTypeChinese = cellTypeNames[this.cellType] || '';\n\n      return {\n        day: this.currentDay,\n        stage: this.currentStage,\n        cellType: cellTypeChinese,\n        cellTypeRaw: this.cellType, // \n        daysInCustody: this.currentDay - this.legalTimeline.arrestDay,\n        timeline: { ...this.legalTimeline },\n        complexity: this.caseComplexity,\n        complexityMultiplier: this.complexityMultiplier,\n        isDeathPenalty: this.isDeathPenalty,\n        eventCounters: { ...this.eventCounters },\n      };\n    },\n\n    getEventStatistics() {\n      const stats: {\n        totalEvents: number;\n        byType: Record<string, number>;\n        byPriority: Record<number, number>;\n        recentEvents: EventRecord[];\n      } = {\n        totalEvents: this.eventHistory.length,\n        byType: {},\n        byPriority: {},\n        recentEvents: this.eventHistory.slice(-10),\n      };\n\n      this.eventHistory.forEach((event: EventRecord) => {\n        const type = event.type || 'unknown';\n        stats.byType[type] = (stats.byType[type] || 0) + 1;\n\n        const priority = event.priority || 4;\n        stats.byPriority[priority] = (stats.byPriority[priority] || 0) + 1;\n      });\n\n      return stats;\n    },\n\n    exportTimeline() {\n      return {\n        currentDay: this.currentDay,\n        currentStage: this.currentStage,\n        cellType: this.cellType,\n        timeline: { ...this.legalTimeline },\n        complexity: this.caseComplexity,\n        isDeathPenalty: this.isDeathPenalty,\n        eventCounters: { ...this.eventCounters },\n        eventHistory: [...this.eventHistory],\n        lastStageChangeDay: this.lastStageChangeDay,\n      };\n    },\n\n    importTimeline(data: any) {\n      if (!data) return false;\n\n      try {\n        this.currentDay = data.currentDay || 0;\n        this.currentStage = (data.currentStage as Stage) || 'detention';\n        this.cellType = data.cellType || 'transition';\n        this.legalTimeline = (data.timeline as Timeline) || ({} as Timeline);\n        this.caseComplexity = data.complexity || 'normal';\n        this.isDeathPenalty = Boolean(data.isDeathPenalty);\n        this.eventCounters = data.eventCounters || {};\n        this.eventHistory = data.eventHistory || [];\n        this.lastStageChangeDay = data.lastStageChangeDay || 0;\n\n        console.info('[] ');\n        return true;\n      } catch (error) {\n        console.error('[] :', error);\n        return false;\n      }\n    },\n\n    // \n    // advanceDay\"\"\n    // AIsaveStateToChatVars\n    saveEventInterruptSnapshot() {\n      try {\n        // ID saveChat \n        const currentChatId =\n          typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId ? SillyTavern.getCurrentChatId() : null;\n\n        if (!currentChatId) {\n          console.debug('[] ');\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveEventInterruptSnapshot',\n              message: '',\n              data: {\n                hasChatId: false,\n                currentDay: this.currentDay,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-chat-error',\n              hypothesisId: 'NO_CHAT_SKIP',\n            }),\n          }).catch(() => {});\n          // #endregion\n          return;\n        }\n\n        // \n        try {\n          const testChatVars = getVariables({ type: 'chat' });\n          if (!testChatVars || typeof testChatVars !== 'object') {\n            console.debug('[] ');\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({\n                location: 'event_system.ts:saveEventInterruptSnapshot',\n                message: '',\n                data: {\n                  hasChatId: !!currentChatId,\n                  hasChatVars: !!testChatVars,\n                  chatVarsType: typeof testChatVars,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-chat-error',\n                hypothesisId: 'NO_CHAT_VARS',\n              }),\n            }).catch(() => {});\n            // #endregion\n            return;\n          }\n        } catch (testError) {\n          console.debug('[] :', testError);\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveEventInterruptSnapshot',\n              message: '',\n              data: {\n                hasChatId: !!currentChatId,\n                error: testError instanceof Error ? testError.message : String(testError),\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-chat-error',\n              hypothesisId: 'TEST_CHAT_VARS_ERROR',\n            }),\n          }).catch(() => {});\n          // #endregion\n          return;\n        }\n\n        // \n        // saveStateToChatVars\n        const snapshot = {\n          currentDay: this.currentDay,\n          currentStage: this.currentStage,\n          cellType: this.cellType,\n          legalTimeline: { ...this.legalTimeline },\n          caseComplexity: this.caseComplexity,\n          isDeathPenalty: this.isDeathPenalty,\n          eventCounters: { ...this.eventCounters },\n          eventHistory: [...this.eventHistory],\n          lastStageChangeDay: this.lastStageChangeDay,\n          snapshotTime: Date.now(),\n        };\n\n        //  updateVariablesWith  replaceVariables\n        try {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveEventInterruptSnapshot',\n              message: '',\n              data: {\n                snapshotSize: JSON.stringify(snapshot).length,\n                currentDay: this.currentDay,\n                currentChatId,\n                hasChatId: !!currentChatId,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-conflict',\n              hypothesisId: 'SAVE_SNAPSHOT_START',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          updateVariablesWith(\n            variables => {\n              return { ...variables, detentionSystemInterruptSnapshot: snapshot };\n            },\n            { type: 'chat' },\n          );\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveEventInterruptSnapshot',\n              message: ' (updateVariablesWith)',\n              data: {\n                success: true,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-conflict',\n              hypothesisId: 'SAVE_SNAPSHOT_SUCCESS',\n            }),\n          }).catch(() => {});\n          // #endregion\n        } catch (updateError) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'event_system.ts:saveEventInterruptSnapshot',\n              message: ' (updateVariablesWith)',\n              data: {\n                error: updateError instanceof Error ? updateError.message : String(updateError),\n                errorType: updateError instanceof Error ? updateError.constructor.name : typeof updateError,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-save-conflict',\n              hypothesisId: 'SAVE_SNAPSHOT_ERROR',\n            }),\n          }).catch(() => {});\n          // #endregion\n          //  updateVariablesWith  replaceVariables\n          console.warn('[]  (updateVariablesWith):', updateError);\n        }\n\n        console.debug('[] ');\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:saveEventInterruptSnapshot',\n            message: '',\n            data: {\n              currentDay: this.currentDay,\n              snapshotTime: snapshot.snapshotTime,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'add-rollback',\n            hypothesisId: 'SAVE_SNAPSHOT',\n          }),\n        }).catch(() => {});\n        // #endregion\n      } catch (error) {\n        console.warn('[] :', error);\n      }\n    },\n\n    // \n    // AI\n    confirmDayAdvancement(pendingDays: number): void {\n      if (pendingDays > 0) {\n        // \n        const oldDay = this.getCurrentDayInternal();\n        const newDay = oldDay + pendingDays;\n\n        // \n        this.currentDay = newDay;\n        this.lastEventDay = newDay;\n\n        //  statusPanel \n        try {\n          const statusPanel = DS.getModule('statusPanel') as {\n            getState?: () => { days?: number; day?: number };\n            modifyValue?: (key: string, delta: number, reason?: string) => void;\n          };\n\n          if (statusPanel && statusPanel.modifyValue) {\n            // \n            statusPanel.modifyValue('days', pendingDays, `${pendingDays}`);\n            console.info(`[]  : ${oldDay} -> ${newDay} (${pendingDays})`);\n          } else {\n            console.warn('[]  statusPanel ');\n          }\n        } catch (error) {\n          console.warn('[]  :', error);\n        }\n\n        console.info(`[]  : ${oldDay} -> ${newDay} (${pendingDays})`);\n\n        // \n        this.saveStateToChatVars();\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:confirmDayAdvancement',\n            message: '',\n            data: {\n              oldDay,\n              newDay,\n              pendingDays,\n              currentDayFromMemory: this.getCurrentDayInternal(),\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-day-calculation',\n            hypothesisId: 'CONFIRM_DAY',\n          }),\n        }).catch(() => {});\n        // #endregion\n      }\n    },\n\n    rollbackToInterruptSnapshot(): boolean {\n      try {\n        const chatVars = getVariables({ type: 'chat' });\n        const snapshot = (chatVars as Record<string, unknown>).detentionSystemInterruptSnapshot as\n          | {\n              currentDay?: number;\n              currentStage?: string;\n              cellType?: string;\n              legalTimeline?: Timeline;\n              caseComplexity?: string;\n              isDeathPenalty?: boolean;\n              eventCounters?: Record<string, number>;\n              eventHistory?: EventRecord[];\n              lastStageChangeDay?: number;\n            }\n          | undefined;\n\n        if (!snapshot || typeof snapshot !== 'object') {\n          console.warn('[] ');\n          return false;\n        }\n\n        console.info('[] ');\n\n        this.currentDay = snapshot.currentDay ?? this.currentDay;\n        this.currentStage = (snapshot.currentStage as Stage) ?? this.currentStage;\n        this.cellType = snapshot.cellType ?? this.cellType;\n        this.caseComplexity =\n          (snapshot.caseComplexity as 'simple' | 'normal' | 'complex' | 'very_complex') ?? this.caseComplexity;\n        this.isDeathPenalty = Boolean(snapshot.isDeathPenalty);\n        this.lastStageChangeDay = snapshot.lastStageChangeDay ?? this.lastStageChangeDay;\n\n        if (snapshot.legalTimeline && typeof snapshot.legalTimeline === 'object') {\n          this.legalTimeline = { ...this.legalTimeline, ...snapshot.legalTimeline };\n        }\n\n        if (snapshot.eventCounters && typeof snapshot.eventCounters === 'object') {\n          this.eventCounters = { ...this.eventCounters, ...snapshot.eventCounters };\n        }\n\n        if (Array.isArray(snapshot.eventHistory)) {\n          this.eventHistory = [...snapshot.eventHistory];\n        }\n\n        // \n        this.saveStateToChatVars();\n\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'event_system.ts:rollbackToInterruptSnapshot',\n            message: '',\n            data: {\n              currentDay: this.currentDay,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'add-rollback',\n            hypothesisId: 'ROLLBACK_SUCCESS',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        return true;\n      } catch (error) {\n        console.error('[] :', error);\n        return false;\n      }\n    },\n  };\n\n  // \n  DS.generateRandomEvent = (_context?: unknown) => EventSystem.generateRandomEvent();\n  DS.advanceDay = (days?: number) => {\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'event_system.ts:DS.advanceDay',\n        message: 'DS.advanceDay',\n        data: {\n          days,\n          hasEventSystem: !!EventSystem,\n          eventSystemType: typeof EventSystem,\n          advanceDayType: typeof EventSystem.advanceDay,\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'fix-undefined-return',\n        hypothesisId: 'A',\n      }),\n    }).catch(() => {});\n    // #endregion\n    const result = EventSystem.advanceDay(days);\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'event_system.ts:DS.advanceDay',\n        message: 'DS.advanceDay',\n        data: {\n          resultType: typeof result,\n          hasResult: !!result,\n          resultKeys: result ? Object.keys(result) : [],\n          interrupted: result?.interrupted,\n          currentDay: result?.currentDay,\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'fix-undefined-return',\n        hypothesisId: 'B',\n      }),\n    }).catch(() => {});\n    // #endregion\n    return result;\n  };\n  // \n  DS.getCurrentDay = () => getCurrentDayFromMemoryEnhancement(EventSystem.currentDay);\n  DS.getCurrentStage = () => EventSystem.getCurrentStageInfo();\n  DS.checkCellTransfer = () => EventSystem.checkCellTransfer();\n  DS.setCaseComplexity = (complexity: 'simple' | 'normal' | 'complex' | 'very_complex') =>\n    EventSystem.setCaseComplexity(complexity);\n  DS.rollbackToStage = (stage: Stage, reason?: string) => EventSystem.rollbackToStage(stage, reason);\n  DS.advanceToStage = (stage: Stage, reason?: string) => EventSystem.advanceToStage(stage, reason);\n  DS.setDeathPenalty = (isDeathPenalty: boolean) => EventSystem.setDeathPenalty(isDeathPenalty);\n  DS.getEventStatistics = () => EventSystem.getEventStatistics();\n  DS.exportTimeline = () => EventSystem.exportTimeline();\n  DS.importTimeline = (data: unknown) => EventSystem.importTimeline(data);\n  DS.rollbackToInterruptSnapshot = () => EventSystem.rollbackToInterruptSnapshot();\n\n  DS.registerModule('eventSystem', EventSystem);\n\n  // iframe \n  try {\n    if (window.parent && window.parent !== window) {\n      (window.parent as any).detentionSystem = DS;\n      console.info('[]  ');\n    }\n  } catch (e) {\n    // \n  }\n\n  // \n  DS.events.on('user_input', (data?: unknown) => {\n    const text =\n      typeof (data as { text?: unknown } | undefined)?.text === 'string' ? (data as { text?: string }).text : undefined;\n    if (text) {\n      EventSystem.handleUserRollback(text);\n    }\n  });\n\n  // \n  DS.events.on('initialized', () => {\n    try {\n      EventSystem.initialize(0);\n    } catch (error) {\n      console.error('[] :', error);\n    }\n  });\n\n  console.info('[]  v3.4.0');\n});\n","export {};\n\ntype JQueryStaticLike = typeof globalThis extends { $: infer T } ? T : (selector: any) => any;\ndeclare const $: JQueryStaticLike;\n\n/**\n * NPC  NPC////\n *  registerModule \n */\n\ntype NPCGender = 'female' | 'male';\ntype NPCStatus = 'active' | 'removed';\ntype NPCRelationship = {\n  toProtagonist: number;\n  faction: string | null;\n  allies: string[];\n  enemies: string[];\n  influence: number;\n};\ntype NPCTraits = {\n  aggression: number;\n  sociability: number;\n  intelligence: number;\n  emotional: number;\n  dominance: number;\n  kindness: number;\n};\ntype NPCPersonality = { traits: NPCTraits; tags: string[] };\ntype NPCAppearance = {\n  height: number;\n  weight: number;\n  hair: string;\n  eyes: string;\n  skin: string;\n  features: string;\n};\ntype NPCBackground = {\n  education: string;\n  maritalStatus: string;\n  hasChildren: boolean;\n  childrenCount: number;\n  hometown: string;\n  priorConvictions: number;\n};\n\ntype NPCBase = {\n  id: string;\n  name: string;\n  gender: NPCGender;\n  age: number;\n  crime: string;\n  sentence: number;\n  appearance: NPCAppearance;\n  personality: NPCPersonality;\n  background: NPCBackground;\n  relationship: NPCRelationship;\n  cellType: string;\n  daysInCustody: number;\n  status: NPCStatus;\n  createdAt: number;\n};\n\ntype NPCPolice = {\n  role: 'police';\n  rank: string;\n  attitude: number;\n};\n\ntype NPCLawyer = {\n  role: 'lawyer';\n  type: string;\n  experience: number;\n  successRate: number;\n};\n\ntype NPCDoctor = {\n  role: 'doctor';\n  specialty: string;\n  experience: number;\n};\n\ntype NPCFamily = {\n  role: 'family';\n  relation: string;\n  supportLevel: number;\n};\n\ntype NPCSpecial = NPCPolice | NPCLawyer | NPCDoctor | NPCFamily;\ntype NPC = NPCBase & Partial<NPCSpecial>;\n\ntype EventTriggeredPayload = { id?: string };\ntype CellTransferPayload = { to?: string };\n\ninterface EventSystemModule {\n  getCurrentStageInfo?: () => { cellType?: string };\n}\n\ninterface DetentionSystem {\n  events: { on(event: string, callback: (data?: unknown) => void): void; emit(event: string, data?: unknown): void };\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n}\n\ntype ProtagonistOptions = {\n  crimeType?: 'economic' | 'property' | 'violent' | 'drug' | 'social' | 'other' | string;\n  crimeName?: string; // \n  ageRange?: [number, number]; // [min, max]\n  education?: 'high' | 'medium' | 'low' | 'custom'; // high: , medium: /, low: \n  profession?: string[]; //  ['', '', '']\n  excludeCrimes?: string[]; //  ['']\n  background?: {\n    isIntellectual?: boolean; // \n    isAcademic?: boolean; // \n    isBusiness?: boolean; // \n  };\n};\n\ntype ProtagonistInfo = {\n  name: string;\n  age: number;\n  crime: string;\n  sentence: number;\n  appearance: {\n    height: number;\n    weight: number;\n    hair: string;\n    skin: string;\n    features: string;\n    eyes: string;\n  };\n  background: {\n    education: string;\n    profession?: string;\n    maritalStatus: string;\n    hasChildren: boolean;\n    childrenCount: number;\n    hometown: string;\n  };\n  personality?: {\n    traits: {\n      intelligence: number;\n      sociability: number;\n      emotional: number;\n    };\n    tags: string[];\n  };\n};\n\ntype DetentionSystemWithNPC = DetentionSystem & {\n  generateNPC?: (count?: number, context?: Record<string, unknown>) => NPC[];\n  generateNPCForEvent?: (eventType: string) => NPC | { police: NPC; witnesses: NPC[] };\n  generateProtagonist?: (options?: ProtagonistOptions) => ProtagonistInfo;\n  getCurrentCellNPCs?: () => NPC[];\n  setCurrentCellNPCs?: (npcs: NPC[]) => void;\n  addNPCToCell?: (npc: NPC) => void;\n  removeNPCFromCell?: (npcId: string) => NPC | null;\n  findNPC?: (npcId: string) => NPC | undefined;\n  updateNPCRelationship?: (npcId: string, delta: number) => void;\n  exportNPCData?: () => { database: NPC[]; currentCell: NPC[] };\n  importNPCData?: (data: { database?: NPC[]; currentCell?: NPC[] } | undefined) => boolean;\n};\n\ndeclare global {\n  interface DetentionSystem {\n    generateNPC?: (count?: number, context?: Record<string, unknown>) => NPC[];\n    generateNPCForEvent?: (eventType: string) => NPC | { police: NPC; witnesses: NPC[] };\n    generateProtagonist?: (options?: ProtagonistOptions) => ProtagonistInfo;\n    getCurrentCellNPCs?: () => NPC[];\n    setCurrentCellNPCs?: (npcs: NPC[]) => void;\n    addNPCToCell?: (npc: NPC) => void;\n    removeNPCFromCell?: (npcId: string) => NPC | null;\n    findNPC?: (npcId: string) => NPC | undefined;\n    updateNPCRelationship?: (npcId: string, delta: number) => void;\n    exportNPCData?: () => { database: NPC[]; currentCell: NPC[] };\n    importNPCData?: (data: { database?: NPC[]; currentCell?: NPC[] } | undefined) => boolean;\n  }\n}\n\n// #region agent log - HYP-A: \ntry {\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'npc_system.ts:',\n      message: 'NPC',\n      data: {\n        windowExists: typeof window !== 'undefined',\n        windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n        windowDetentionSystemType: typeof window.detentionSystem,\n        hasPing:\n          typeof window.detentionSystem !== 'undefined' && typeof (window.detentionSystem as any).ping === 'function',\n        pingResult:\n          typeof window.detentionSystem !== 'undefined' && typeof (window.detentionSystem as any).ping === 'function'\n            ? (window.detentionSystem as any).ping()\n            : 'N/A',\n        isIframe: typeof window !== 'undefined' && window.parent !== window,\n        currentUrl: typeof window !== 'undefined' && window.location ? window.location.href : 'N/A',\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'npc-load-debug',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n} catch (e) {\n  console.error('[NPC] :', e);\n}\n// #endregion\n\nconsole.info('[NPC] ...');\n\n// ========== DS==========\nconst NameGenerator = {\n  surnames: {\n    tier1: {\n      names: ['', '', '', '', '', '', '', '', '', ''],\n      weight: 35,\n    },\n    tier2: {\n      names: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      weight: 30,\n    },\n    tier3: {\n      names: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      weight: 20,\n    },\n    tier4: {\n      names: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      weight: 10,\n    },\n    tier5: {\n      names: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n      weight: 5,\n    },\n  },\n  givenNames: {\n    vintage: {\n      single: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n      double: [\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n      ],\n      weight: 25,\n    },\n    classic: {\n      single: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n      double: [\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n      ],\n      weight: 35,\n    },\n    modern: {\n      single: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      double: [\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n      ],\n      weight: 30,\n    },\n    contemporary: {\n      single: ['', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n      double: [\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n        ['', ''],\n      ],\n      weight: 10,\n    },\n  },\n  badNames: [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ],\n  badChars: ['', '', '', '', '', '', '', '', '', '', '', ''],\n\n  generate(birthYear: number): string {\n    let attempts = 0;\n    const maxAttempts = 50;\n    while (attempts < maxAttempts) {\n      attempts++;\n      const surname = this.selectSurname();\n      const givenName = this.selectGivenName(birthYear);\n      const fullName = surname + givenName;\n      if (this.isValidName(fullName)) return fullName;\n    }\n    return '' + this.givenNames.classic.single[0];\n  },\n\n  selectSurname(): string {\n    const tiers = Object.values(this.surnames);\n    const totalWeight = tiers.reduce((sum, tier) => sum + tier.weight, 0);\n    let random = Math.random() * totalWeight;\n    for (const tier of tiers) {\n      random -= tier.weight;\n      if (random <= 0) {\n        return tier.names[Math.floor(Math.random() * tier.names.length)];\n      }\n    }\n    return this.surnames.tier1.names[0];\n  },\n\n  selectGivenName(birthYear: number): string {\n    const currentYear = new Date().getFullYear();\n    const age = currentYear - birthYear;\n    const style = age >= 50 ? 'vintage' : age >= 35 ? 'classic' : age >= 20 ? 'modern' : 'contemporary';\n    const styleData = this.givenNames[style as keyof typeof this.givenNames];\n    const useDouble = Math.random() < 0.6;\n    if (useDouble && styleData.double.length > 0) {\n      const pair = styleData.double[Math.floor(Math.random() * styleData.double.length)];\n      return pair[0] + pair[1];\n    }\n    return styleData.single[Math.floor(Math.random() * styleData.single.length)];\n  },\n\n  isValidName(name: string): boolean {\n    if (this.badNames.includes(name)) return false;\n    return !this.badChars.some(char => name.includes(char));\n  },\n};\n\n// ========== DS==========\nconst CrimeGenerator = {\n  characterBookCrimes: [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ],\n  crimes: {\n    violent: {\n      names: ['', '', '', '', '', ''],\n      weight: 12,\n      sentenceRange: [3, 20] as [number, number],\n    },\n    property: {\n      names: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      weight: 35,\n      sentenceRange: [1, 15] as [number, number],\n    },\n    drug: {\n      names: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      weight: 20,\n      sentenceRange: [3, 15] as [number, number],\n    },\n    economic: {\n      names: ['', '', '', '', '', '', ''],\n      weight: 15,\n      sentenceRange: [2, 10] as [number, number],\n    },\n    social: {\n      names: [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ],\n      weight: 13,\n      sentenceRange: [1, 7] as [number, number],\n    },\n    other: {\n      names: ['', '', '', '', '', ''],\n      weight: 5,\n      sentenceRange: [1, 5] as [number, number],\n    },\n  },\n\n  generate(): { crime: string; sentence: number; category: { sentenceRange: [number, number] } } {\n    if (Math.random() < 0.3) {\n      const crime = this.characterBookCrimes[Math.floor(Math.random() * this.characterBookCrimes.length)];\n      const category = this.findCategoryByCrime(crime);\n      const sentence = this.generateSentence(category ? category.sentenceRange : [1, 10]);\n      return { crime, sentence, category: category || this.crimes.property };\n    }\n\n    const categories = Object.values(this.crimes);\n    const totalWeight = categories.reduce((sum, cat) => sum + cat.weight, 0);\n    let random = Math.random() * totalWeight;\n    for (const category of categories) {\n      random -= category.weight;\n      if (random <= 0) {\n        const crime = category.names[Math.floor(Math.random() * category.names.length)];\n        const sentence = this.generateSentence(category.sentenceRange);\n        return { crime, sentence, category };\n      }\n    }\n\n    return { crime: '', sentence: 3, category: this.crimes.property };\n  },\n\n  findCategoryByCrime(crimeName: string) {\n    for (const key of Object.keys(this.crimes)) {\n      const category = this.crimes[key as keyof typeof this.crimes];\n      if (category.names.includes(crimeName)) return category;\n    }\n    return null;\n  },\n\n  generateSentence(range: [number, number]): number {\n    const [min, max] = range;\n    return Math.floor(Math.random() * (max - min + 1)) + min;\n  },\n};\n\n//  jQuery ready \n$(() => {\n  const DS_RAW = window.detentionSystem as DetentionSystemWithNPC | undefined;\n\n  if (!DS_RAW) {\n    console.error(' [NPC] ');\n    console.error('[NPC] window.detentionSystem:', typeof window.detentionSystem);\n    console.error('[NPC] window.__DETENTION_SYSTEM_LOADED__:', (window as any).__DETENTION_SYSTEM_LOADED__);\n    console.error(\n      '[NPC] window.__DETENTION_SYSTEM_CORE_LOADED__:',\n      (window as any).__DETENTION_SYSTEM_CORE_LOADED__,\n    );\n    // #region agent log - HYP-B: \n    try {\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'npc_system.ts:',\n          message: 'NPC',\n          data: {\n            windowType: typeof window,\n            detentionSystemType: typeof window.detentionSystem,\n            modulesLoaded:\n              typeof window.detentionSystem !== 'undefined' && (window.detentionSystem as any).modules\n                ? Object.keys((window.detentionSystem as any).modules)\n                : [],\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'npc-load-debug',\n          hypothesisId: 'B',\n        }),\n      }).catch(() => {});\n    } catch (e) {\n      console.error('[NPC] :', e);\n    }\n    // #endregion\n    return;\n  }\n\n  // DS \n  const DS = DS_RAW as DetentionSystemWithNPC;\n\n  console.info(' [NPC] ...');\n  // \n  (window as any).__NPC_SYSTEM_LOADING__ = true;\n  // #region agent log - HYP-C: \n  try {\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'npc_system.ts:',\n        message: 'NPC',\n        data: {\n          hasGenerateNPC: typeof DS.generateNPC === 'function',\n          hasGenerateNPCForEvent: typeof DS.generateNPCForEvent === 'function',\n          hasGetCurrentCellNPCs: typeof DS.getCurrentCellNPCs === 'function',\n          hasModules: 'modules' in DS,\n          modulesCount: 'modules' in DS ? Object.keys(DS.modules).length : 0,\n          moduleNames: 'modules' in DS ? Object.keys(DS.modules) : [],\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'npc-load-debug',\n        hypothesisId: 'C',\n      }),\n    }).catch(() => {});\n  } catch (e) {\n    console.error('[NPC] :', e);\n  }\n  // #endregion\n\n  // ========== NPC ==========\n  const NPCGenerator = {\n    npcDatabase: [] as NPC[],\n    currentCellNPCs: [] as NPC[],\n\n    generate(count = 1, context: Record<string, unknown> = {}): NPC[] {\n      const npcs: NPC[] = [];\n      for (let i = 0; i < count; i++) {\n        const npc = this.generateSingle(context);\n        npcs.push(npc);\n        this.npcDatabase.push(npc);\n      }\n      return npcs;\n    },\n\n    generateSingle(context: Record<string, unknown> = {}): NPC {\n      const eventSystem = DS.getModule<EventSystemModule>('eventSystem');\n      const stageInfo = eventSystem?.getCurrentStageInfo ? eventSystem.getCurrentStageInfo() : {};\n\n      const age = this.generateAge();\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const crimeData = CrimeGenerator.generate();\n      const appearance = this.generateAppearance(age);\n      const personality = this.generatePersonality();\n      const background = this.generateBackground(age, crimeData);\n      const relationship = this.generateRelationship();\n\n      const cellType =\n        typeof stageInfo?.cellType === 'string' ? stageInfo.cellType : (context.cellType as string) || 'transition';\n      this.adjustByCellType(personality, relationship, cellType);\n\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: 'female',\n        age,\n        crime: crimeData.crime,\n        sentence: crimeData.sentence,\n        appearance,\n        personality,\n        background,\n        relationship,\n        cellType,\n        daysInCustody: Math.floor(Math.random() * 365) + 30,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateAge(): number {\n      const random = Math.random();\n      if (random < 0.05) return Math.floor(Math.random() * 3) + 18;\n      if (random < 0.25) return Math.floor(Math.random() * 10) + 21;\n      if (random < 0.55) return Math.floor(Math.random() * 10) + 31;\n      if (random < 0.8) return Math.floor(Math.random() * 10) + 41;\n      if (random < 0.95) return Math.floor(Math.random() * 10) + 51;\n      return Math.floor(Math.random() * 15) + 61;\n    },\n\n    generateAppearance(age: number): NPCAppearance {\n      const heights = [150, 155, 160, 165, 170, 175];\n      const weights = [45, 50, 55, 60, 65, 70, 75];\n      const height = heights[Math.floor(Math.random() * heights.length)];\n      const weight = weights[Math.floor(Math.random() * weights.length)];\n      const hairStyles =\n        age > 50\n          ? ['', '', '', '']\n          : ['', '', '', '', '', '', ''];\n      const skinTones = ['', '', '', '', ''];\n      const features = ['', '', '', '', '', '', ''];\n      return {\n        height,\n        weight,\n        hair: hairStyles[Math.floor(Math.random() * hairStyles.length)],\n        eyes: '',\n        skin: skinTones[Math.floor(Math.random() * skinTones.length)],\n        features: features[Math.floor(Math.random() * features.length)],\n      };\n    },\n\n    generatePersonality(): NPCPersonality {\n      const traits: NPCTraits = {\n        aggression: Math.floor(Math.random() * 100),\n        sociability: Math.floor(Math.random() * 100),\n        intelligence: Math.floor(Math.random() * 100),\n        emotional: Math.floor(Math.random() * 100),\n        dominance: Math.floor(Math.random() * 100),\n        kindness: Math.floor(Math.random() * 100),\n      };\n      const tags: string[] = [];\n      if (traits.aggression > 70) tags.push('');\n      if (traits.sociability > 70) tags.push('');\n      if (traits.intelligence > 70) tags.push('');\n      if (traits.emotional > 70) tags.push('');\n      if (traits.dominance > 70) tags.push('');\n      if (traits.kindness > 70) tags.push('');\n      if (traits.aggression < 30) tags.push('');\n      if (traits.sociability < 30) tags.push('');\n      if (traits.emotional < 30) tags.push('');\n      if (traits.dominance < 30) tags.push('');\n      return { traits, tags };\n    },\n\n    generateBackground(\n      age: number,\n      _crimeData: { crime: string; sentence: number; category: { sentenceRange: [number, number] } },\n    ): NPCBackground {\n      const educations = ['', '', '', '', '', '', ''];\n      const educationWeights = [10, 25, 30, 15, 10, 8, 2];\n      const educationIndex = this.weightedRandom(educations.length, educationWeights);\n      const maritalStatuses = ['', '', '', ''];\n      const maritalWeights = age < 25 ? [80, 15, 5, 0] : age < 40 ? [20, 60, 15, 5] : [10, 50, 30, 10];\n      const maritalIndex = this.weightedRandom(maritalStatuses.length, maritalWeights);\n      const hasChildren = maritalStatuses[maritalIndex] !== '' && Math.random() < 0.7;\n      const childrenCount = hasChildren ? Math.floor(Math.random() * 3) + 1 : 0;\n      return {\n        education: educations[educationIndex],\n        maritalStatus: maritalStatuses[maritalIndex],\n        hasChildren,\n        childrenCount,\n        hometown: this.generateHometown(),\n        priorConvictions: Math.random() < 0.3 ? Math.floor(Math.random() * 3) + 1 : 0,\n      };\n    },\n\n    generateHometown(): string {\n      const provinces = [\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n        '',\n      ];\n      return provinces[Math.floor(Math.random() * provinces.length)];\n    },\n\n    generateRelationship(): NPCRelationship {\n      return {\n        toProtagonist: 50,\n        faction: null,\n        allies: [],\n        enemies: [],\n        influence: Math.floor(Math.random() * 100),\n      };\n    },\n\n    adjustByCellType(personality: NPCPersonality, relationship: NPCRelationship, cellType: string) {\n      if (cellType === 'transition') {\n        personality.traits.emotional += 10;\n        relationship.influence -= 20;\n      } else if (cellType === 'pretrial') {\n        personality.traits.emotional += 15;\n        personality.traits.aggression += 5;\n      } else if (cellType === 'convicted') {\n        personality.traits.emotional -= 10;\n        personality.traits.aggression += 10;\n        relationship.influence += 10;\n      }\n      (Object.keys(personality.traits) as Array<keyof NPCTraits>).forEach(key => {\n        personality.traits[key] = Math.max(0, Math.min(100, personality.traits[key]));\n      });\n      relationship.influence = Math.max(0, Math.min(100, relationship.influence));\n    },\n\n    weightedRandom(count: number, weights: number[]): number {\n      const totalWeight = weights.reduce((sum, w) => sum + w, 0);\n      let random = Math.random() * totalWeight;\n      for (let i = 0; i < count; i++) {\n        random -= weights[i];\n        if (random <= 0) return i;\n      }\n      return count - 1;\n    },\n\n    generateId(): string {\n      return 'npc_' + Date.now() + '_' + Math.random().toString(36).slice(2, 11);\n    },\n\n    generateForEvent(eventType: string): NPC | { police: NPC; witnesses: NPC[] } {\n      if (eventType === 'interrogation') return this.generatePolice();\n      if (eventType === 'lawyer_visit') return this.generateLawyer();\n      if (eventType === 'family_visit') return this.generateFamily();\n      if (eventType === 'medical_visit') return this.generateDoctor();\n      if (eventType === 'scene_identification') {\n        return { police: this.generatePolice(), witnesses: this.generate(2, { type: 'witness' }) };\n      }\n      return this.generateSingle({ eventType });\n    },\n\n    generatePolice(): NPC {\n      const age = Math.floor(Math.random() * 20) + 25;\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const ranks = ['', '', '', ''];\n      const rank = ranks[Math.floor(Math.random() * ranks.length)];\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: 'female',\n        age,\n        role: 'police',\n        rank,\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 30) + 40,\n            sociability: Math.floor(Math.random() * 40) + 30,\n            intelligence: Math.floor(Math.random() * 30) + 50,\n            emotional: Math.floor(Math.random() * 40) + 20,\n            dominance: Math.floor(Math.random() * 30) + 60,\n            kindness: Math.floor(Math.random() * 60) + 20,\n          },\n          tags: ['', ''],\n        },\n        attitude: Math.floor(Math.random() * 40) + 30,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'staff',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateLawyer(): NPC {\n      const age = Math.floor(Math.random() * 25) + 28;\n      const birthYear = new Date().getFullYear() - age;\n      const isFemale = Math.random() < 0.8;\n      const name = NameGenerator.generate(birthYear);\n      const types = ['', '', ''];\n      const typeWeights = [50, 40, 10];\n      const typeIndex = this.weightedRandom(types.length, typeWeights);\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: isFemale ? 'female' : 'male',\n        age,\n        role: 'lawyer',\n        type: types[typeIndex],\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 20) + 20,\n            sociability: Math.floor(Math.random() * 30) + 60,\n            intelligence: Math.floor(Math.random() * 20) + 70,\n            emotional: Math.floor(Math.random() * 40) + 30,\n            dominance: Math.floor(Math.random() * 40) + 40,\n            kindness: Math.floor(Math.random() * 40) + 40,\n          },\n          tags: ['', ''],\n        },\n        experience: Math.floor(Math.random() * 20) + 5,\n        successRate: Math.floor(Math.random() * 40) + 40,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'external',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateFamily(): NPC {\n      const relationships = ['', '', '', '', '', '', '', ''];\n      const weights = [30, 20, 15, 10, 10, 10, 3, 2];\n      const relationIndex = this.weightedRandom(relationships.length, weights);\n      const relation = relationships[relationIndex];\n      let age = 40;\n      let isFemale = true;\n      if (relation === '') {\n        age = Math.floor(Math.random() * 20) + 45;\n        isFemale = true;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 20) + 45;\n        isFemale = false;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 30) + 25;\n        isFemale = false;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 30) + 25;\n        isFemale = true;\n      } else if (relation === '' || relation === '') {\n        age = Math.floor(Math.random() * 30) + 20;\n        isFemale = true;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 15) + 5;\n        isFemale = true;\n      } else if (relation === '') {\n        age = Math.floor(Math.random() * 15) + 5;\n        isFemale = false;\n      }\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: isFemale ? 'female' : 'male',\n        age,\n        role: 'family',\n        relation,\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 30) + 10,\n            sociability: Math.floor(Math.random() * 50) + 30,\n            intelligence: Math.floor(Math.random() * 60) + 30,\n            emotional: Math.floor(Math.random() * 50) + 40,\n            dominance: Math.floor(Math.random() * 50) + 20,\n            kindness: Math.floor(Math.random() * 30) + 60,\n          },\n          tags: ['', ''],\n        },\n        supportLevel: Math.floor(Math.random() * 40) + 60,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'external',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    generateDoctor(): NPC {\n      const age = Math.floor(Math.random() * 25) + 30;\n      const birthYear = new Date().getFullYear() - age;\n      const name = NameGenerator.generate(birthYear);\n      const specialties = ['', '', '', '', ''];\n      const specialty = specialties[Math.floor(Math.random() * specialties.length)];\n      const npc: NPC = {\n        id: this.generateId(),\n        name,\n        gender: 'female',\n        age,\n        role: 'doctor',\n        specialty,\n        appearance: this.generateAppearance(age),\n        personality: {\n          traits: {\n            aggression: Math.floor(Math.random() * 20) + 10,\n            sociability: Math.floor(Math.random() * 40) + 40,\n            intelligence: Math.floor(Math.random() * 20) + 70,\n            emotional: Math.floor(Math.random() * 40) + 30,\n            dominance: Math.floor(Math.random() * 40) + 40,\n            kindness: Math.floor(Math.random() * 30) + 60,\n          },\n          tags: ['', ''],\n        },\n        experience: Math.floor(Math.random() * 25) + 5,\n        crime: '',\n        sentence: 0,\n        background: this.generateBackground(age, { crime: '', sentence: 0, category: { sentenceRange: [0, 0] } }),\n        relationship: this.generateRelationship(),\n        cellType: 'external',\n        daysInCustody: 0,\n        status: 'active',\n        createdAt: Date.now(),\n      };\n      return npc;\n    },\n\n    /**\n     * \n     * @param options \n     * @returns \n     */\n    generateProtagonist(options: ProtagonistOptions = {}): ProtagonistInfo {\n      // #region agent log - HYP-PROTAGONIST: \n      try {\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'npc_system.ts:generateProtagonist',\n            message: '',\n            data: {\n              options: options,\n              hasOptions: !!options,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'protagonist-generation',\n            hypothesisId: 'PROTAGONIST_START',\n          }),\n        }).catch(() => {});\n      } catch (e) {}\n      // #endregion\n\n      // 1. \n      let age: number;\n      if (options.ageRange && options.ageRange.length === 2) {\n        const [min, max] = options.ageRange;\n        age = Math.floor(Math.random() * (max - min + 1)) + min;\n      } else if (options.background?.isIntellectual || options.background?.isBusiness) {\n        // 35-45\n        age = Math.floor(Math.random() * 11) + 35;\n      } else {\n        // 28-42\n        age = Math.floor(Math.random() * 15) + 28;\n      }\n      const birthYear = new Date().getFullYear() - age;\n\n      // 2. \n      const name = NameGenerator.generate(birthYear);\n\n      // 3. \n      let crimeData: { crime: string; sentence: number; category: { sentenceRange: [number, number] } };\n      if (options.crimeName) {\n        // \n        const category = CrimeGenerator.findCategoryByCrime(options.crimeName);\n        const sentenceRange = category ? category.sentenceRange : [2, 10];\n        crimeData = {\n          crime: options.crimeName,\n          sentence: CrimeGenerator.generateSentence(sentenceRange),\n          category: category || CrimeGenerator.crimes.economic,\n        };\n      } else if (options.crimeType) {\n        // \n        const categoryKey = options.crimeType as keyof typeof CrimeGenerator.crimes;\n        if (CrimeGenerator.crimes[categoryKey]) {\n          const category = CrimeGenerator.crimes[categoryKey];\n          const crime = category.names[Math.floor(Math.random() * category.names.length)];\n          // \n          let filteredCrimes = category.names;\n          if (options.excludeCrimes && options.excludeCrimes.length > 0) {\n            filteredCrimes = category.names.filter(c => !options.excludeCrimes!.includes(c));\n          }\n          if (filteredCrimes.length === 0) {\n            filteredCrimes = category.names; // \n          }\n          const selectedCrime = filteredCrimes[Math.floor(Math.random() * filteredCrimes.length)];\n          crimeData = {\n            crime: selectedCrime,\n            sentence: CrimeGenerator.generateSentence(category.sentenceRange),\n            category: category,\n          };\n        } else {\n          // \n          const category = CrimeGenerator.crimes.economic;\n          const filteredCrimes = options.excludeCrimes\n            ? category.names.filter(c => !options.excludeCrimes!.includes(c))\n            : category.names;\n          const selectedCrime =\n            filteredCrimes.length > 0\n              ? filteredCrimes[Math.floor(Math.random() * filteredCrimes.length)]\n              : category.names[0];\n          crimeData = {\n            crime: selectedCrime,\n            sentence: CrimeGenerator.generateSentence(category.sentenceRange),\n            category: category,\n          };\n        }\n      } else if (options.background?.isIntellectual || options.background?.isBusiness) {\n        // \n        const category = CrimeGenerator.crimes.economic;\n        const filteredCrimes = options.excludeCrimes\n          ? category.names.filter(c => !options.excludeCrimes!.includes(c))\n          : category.names;\n        const selectedCrime =\n          filteredCrimes.length > 0\n            ? filteredCrimes[Math.floor(Math.random() * filteredCrimes.length)]\n            : category.names[0];\n        crimeData = {\n          crime: selectedCrime,\n          sentence: CrimeGenerator.generateSentence(category.sentenceRange),\n          category: category,\n        };\n      } else {\n        // \n        crimeData = CrimeGenerator.generate();\n        // \n        if (options.excludeCrimes && options.excludeCrimes.includes(crimeData.crime)) {\n          // \n          let attempts = 0;\n          while (attempts < 10 && options.excludeCrimes.includes(crimeData.crime)) {\n            crimeData = CrimeGenerator.generate();\n            attempts++;\n          }\n        }\n      }\n\n      // 4. \n      const appearance = this.generateAppearance(age);\n\n      // 5. \n      let education: string;\n      if (options.education === 'high') {\n        const highEducations = ['', '', '', ''];\n        education = highEducations[Math.floor(Math.random() * highEducations.length)];\n      } else if (options.education === 'medium') {\n        const mediumEducations = ['', '', ''];\n        education = mediumEducations[Math.floor(Math.random() * mediumEducations.length)];\n      } else if (options.education === 'low') {\n        const lowEducations = ['', '', ''];\n        education = lowEducations[Math.floor(Math.random() * lowEducations.length)];\n      } else if (options.background?.isIntellectual) {\n        // \n        const highEducations = ['', '', '', ''];\n        education = highEducations[Math.floor(Math.random() * highEducations.length)];\n      } else if (options.background?.isBusiness) {\n        // \n        const businessEducations = ['', '', '', 'MBA'];\n        education = businessEducations[Math.floor(Math.random() * businessEducations.length)];\n      } else {\n        // \n        if (age < 30) {\n          const educations = ['', '', '', ''];\n          const weights = [20, 30, 40, 10];\n          education = educations[this.weightedRandom(educations.length, weights)];\n        } else {\n          const educations = ['', '', '', '', '', ''];\n          const weights = [15, 25, 35, 10, 10, 5];\n          education = educations[this.weightedRandom(educations.length, weights)];\n        }\n      }\n\n      // 6. \n      let profession: string | undefined;\n      if (options.profession && options.profession.length > 0) {\n        profession = options.profession[Math.floor(Math.random() * options.profession.length)];\n      } else if (options.background?.isBusiness) {\n        const businessProfessions = ['', '', '', '', ''];\n        profession = businessProfessions[Math.floor(Math.random() * businessProfessions.length)];\n      } else if (options.background?.isIntellectual && !options.background?.isAcademic) {\n        // \n        const intellectualProfessions = ['', '', '', '', ''];\n        profession = intellectualProfessions[Math.floor(Math.random() * intellectualProfessions.length)];\n      } else if (options.background?.isAcademic) {\n        const academicProfessions = ['', '', '', '', ''];\n        profession = academicProfessions[Math.floor(Math.random() * academicProfessions.length)];\n      }\n\n      // 7. \n      const maritalStatuses = age < 30 ? ['', ''] : age < 40 ? ['', '', ''] : ['', ''];\n      const maritalWeights =\n        age < 30\n          ? [40, 60]\n          : age < 40\n            ? [60, 25, 15]\n            : education === '' || education === ''\n              ? [70, 30]\n              : [65, 35];\n      const maritalIndex = this.weightedRandom(maritalStatuses.length, maritalWeights);\n      const maritalStatus = maritalStatuses[maritalIndex];\n\n      // 8. \n      const hasChildren = maritalStatus !== '' && age > 28 && Math.random() < 0.7;\n      const childrenCount = hasChildren ? (age < 35 ? 1 : Math.floor(Math.random() * 2) + 1) : 0;\n\n      // 9. \n      const hometown = this.generateHometown();\n\n      // 10. \n      const personality: ProtagonistInfo['personality'] = {\n        traits: {\n          intelligence: options.background?.isIntellectual\n            ? Math.floor(Math.random() * 15) + 80\n            : options.background?.isBusiness\n              ? Math.floor(Math.random() * 20) + 70\n              : Math.floor(Math.random() * 30) + 60,\n          sociability: options.background?.isBusiness\n            ? Math.floor(Math.random() * 25) + 60\n            : Math.floor(Math.random() * 40) + 40,\n          emotional: Math.floor(Math.random() * 40) + 30,\n        },\n        tags: [],\n      };\n\n      // \n      if (options.background?.isIntellectual) {\n        personality.tags.push('', '');\n        if (!options.background.isAcademic) {\n          personality.tags.push('');\n        }\n      }\n      if (options.background?.isBusiness) {\n        personality.tags.push('', '');\n      }\n      if (personality.traits.intelligence >= 75) {\n        personality.tags.push('');\n      }\n      if (personality.traits.sociability >= 60) {\n        personality.tags.push('');\n      }\n\n      // #region agent log - HYP-PROTAGONIST: \n      try {\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'npc_system.ts:generateProtagonist',\n            message: '',\n            data: {\n              name: name,\n              age: age,\n              crime: crimeData.crime,\n              sentence: crimeData.sentence,\n              education: education,\n              profession: profession,\n              personalityTags: personality.tags,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'protagonist-generation',\n            hypothesisId: 'PROTAGONIST_COMPLETE',\n          }),\n        }).catch(() => {});\n      } catch (e) {}\n      // #endregion\n\n      return {\n        name,\n        age,\n        crime: crimeData.crime,\n        sentence: crimeData.sentence,\n        appearance: {\n          height: appearance.height,\n          weight: appearance.weight,\n          hair: appearance.hair,\n          skin: appearance.skin,\n          features: appearance.features,\n          eyes: appearance.eyes,\n        },\n        background: {\n          education,\n          profession,\n          maritalStatus,\n          hasChildren,\n          childrenCount,\n          hometown,\n        },\n        personality,\n      };\n    },\n\n    getCurrentCellNPCs(): NPC[] {\n      return this.currentCellNPCs;\n    },\n\n    setCurrentCellNPCs(npcs: NPC[]) {\n      this.currentCellNPCs = npcs;\n      DS.events.emit('cell_npcs_changed', { npcs });\n    },\n\n    addNPCToCell(npc: NPC) {\n      this.currentCellNPCs.push(npc);\n      DS.events.emit('npc_joined_cell', { npc });\n    },\n\n    removeNPCFromCell(npcId: string): NPC | null {\n      const index = this.currentCellNPCs.findIndex(n => n.id === npcId);\n      if (index !== -1) {\n        const npc = this.currentCellNPCs.splice(index, 1)[0];\n        DS.events.emit('npc_left_cell', { npc });\n        return npc;\n      }\n      return null;\n    },\n\n    findNPCById(npcId: string): NPC | undefined {\n      return this.npcDatabase.find(n => n.id === npcId) || this.currentCellNPCs.find(n => n.id === npcId);\n    },\n\n    updateRelationship(npcId: string, delta: number) {\n      const npc = this.findNPCById(npcId);\n      if (npc && npc.relationship) {\n        npc.relationship.toProtagonist = Math.max(0, Math.min(100, npc.relationship.toProtagonist + delta));\n        DS.events.emit('relationship_changed', {\n          npcId,\n          npcName: npc.name,\n          value: npc.relationship.toProtagonist,\n          delta,\n        });\n      }\n    },\n\n    exportData() {\n      return {\n        database: this.npcDatabase,\n        currentCell: this.currentCellNPCs,\n      };\n    },\n\n    importData(data: { database?: NPC[]; currentCell?: NPC[] } | undefined): boolean {\n      if (!data) return false;\n      try {\n        this.npcDatabase = data.database || [];\n        this.currentCellNPCs = data.currentCell || [];\n        console.info('[NPC] ');\n        return true;\n      } catch (error) {\n        console.error('[NPC] :', error);\n        return false;\n      }\n    },\n\n    clearData() {\n      this.npcDatabase = [];\n      this.currentCellNPCs = [];\n      console.info('[NPC] ');\n    },\n  };\n\n  // ==========  ==========\n  DS.generateNPC = (count?: number, context?: Record<string, unknown>) => NPCGenerator.generate(count, context ?? {});\n  DS.generateNPCForEvent = (eventType: string) => NPCGenerator.generateForEvent(eventType);\n  DS.generateProtagonist = (options?: ProtagonistOptions) => NPCGenerator.generateProtagonist(options);\n  DS.getCurrentCellNPCs = () => NPCGenerator.getCurrentCellNPCs();\n  DS.setCurrentCellNPCs = (npcs: NPC[]) => NPCGenerator.setCurrentCellNPCs(npcs);\n  DS.addNPCToCell = (npc: NPC) => NPCGenerator.addNPCToCell(npc);\n  DS.removeNPCFromCell = (npcId: string) => NPCGenerator.removeNPCFromCell(npcId);\n  DS.findNPC = (npcId: string) => NPCGenerator.findNPCById(npcId);\n  DS.updateNPCRelationship = (npcId: string, delta: number) => NPCGenerator.updateRelationship(npcId, delta);\n  DS.exportNPCData = () => NPCGenerator.exportData();\n  DS.importNPCData = (data?: { database?: NPC[]; currentCell?: NPC[] }) => NPCGenerator.importData(data);\n\n  DS.registerModule('npcSystem', NPCGenerator);\n\n  // #region agent log - HYP-D: \n  try {\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'npc_system.ts:',\n        message: 'NPC',\n        data: {\n          registeredModule: DS.getModule('npcSystem') ? '' : '',\n          hasGenerateNPC: typeof DS.generateNPC === 'function',\n          hasGenerateNPCForEvent: typeof DS.generateNPCForEvent === 'function',\n          hasGetCurrentCellNPCs: typeof DS.getCurrentCellNPCs === 'function',\n          modulesCount: Object.keys(DS.modules).length,\n          moduleNames: Object.keys(DS.modules),\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'npc-load-debug',\n        hypothesisId: 'D',\n      }),\n    }).catch(() => {});\n  } catch (e) {\n    console.error('[NPC] :', e);\n  }\n  // #endregion\n\n  // iframe \n  try {\n    if (window.parent && window.parent !== window) {\n      // #region agent log - HYP-E: \n      try {\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'npc_system.ts:',\n            message: 'NPC',\n            data: {\n              parentExists: !!window.parent,\n              parentIsDifferent: window.parent !== window,\n              parentHasDetentionSystem: typeof (window.parent as any).detentionSystem !== 'undefined',\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'npc-load-debug',\n            hypothesisId: 'E',\n          }),\n        }).catch(() => {});\n      } catch (e) {\n        console.error('[NPC] :', e);\n      }\n      // #endregion\n\n      //  DS \n      const parentWindow = window.parent as typeof window.parent & { detentionSystem?: DetentionSystem };\n      parentWindow.detentionSystem = DS;\n      //  DS \n      if (parentWindow.detentionSystem) {\n        parentWindow.detentionSystem.generateNPC = DS.generateNPC;\n        parentWindow.detentionSystem.generateNPCForEvent = DS.generateNPCForEvent;\n        parentWindow.detentionSystem.generateProtagonist = DS.generateProtagonist;\n        parentWindow.detentionSystem.getCurrentCellNPCs = DS.getCurrentCellNPCs;\n        parentWindow.detentionSystem.setCurrentCellNPCs = DS.setCurrentCellNPCs;\n        parentWindow.detentionSystem.addNPCToCell = DS.addNPCToCell;\n        parentWindow.detentionSystem.removeNPCFromCell = DS.removeNPCFromCell;\n        parentWindow.detentionSystem.findNPC = DS.findNPC;\n        parentWindow.detentionSystem.updateNPCRelationship = DS.updateNPCRelationship;\n        parentWindow.detentionSystem.exportNPCData = DS.exportNPCData;\n        parentWindow.detentionSystem.importNPCData = DS.importNPCData;\n        parentWindow.detentionSystem.generateProtagonist = DS.generateProtagonist;\n      }\n      console.info('[NPC]  NPC');\n\n      // \n      const parentDS = (window.parent as any).detentionSystem;\n      if (parentDS) {\n        const verification = {\n          hasGenerateNPC: typeof parentDS.generateNPC === 'function',\n          hasGenerateNPCForEvent: typeof parentDS.generateNPCForEvent === 'function',\n          hasGenerateProtagonist: typeof parentDS.generateProtagonist === 'function',\n          hasGetCurrentCellNPCs: typeof parentDS.getCurrentCellNPCs === 'function',\n          hasSetCurrentCellNPCs: typeof parentDS.setCurrentCellNPCs === 'function',\n          modulesCount: parentDS.modules ? Object.keys(parentDS.modules).length : 0,\n          hasNPCSystemModule: !!(\n            parentDS.getModule &&\n            typeof parentDS.getModule === 'function' &&\n            parentDS.getModule('npcSystem')\n          ),\n        };\n        //  info error\n        if (verification.hasGenerateNPC && verification.hasNPCSystemModule) {\n          console.info('[NPC]  :', verification);\n        } else {\n          console.error('[NPC]  ', verification);\n        }\n      } else {\n        console.error('[NPC]   detentionSystem ');\n      }\n\n      // #region agent log - HYP-F: \n      try {\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'npc_system.ts:',\n            message: 'NPC',\n            data: {\n              parentHasDetentionSystem: typeof (window.parent as any).detentionSystem !== 'undefined',\n              parentHasGenerateNPC: typeof (window.parent as any).detentionSystem?.generateNPC === 'function',\n              parentHasGenerateProtagonist:\n                typeof (window.parent as any).detentionSystem?.generateProtagonist === 'function',\n              parentHasGenerateNPCForEvent:\n                typeof (window.parent as any).detentionSystem?.generateNPCForEvent === 'function',\n              iframeHasGenerateProtagonist: typeof DS.generateProtagonist === 'function',\n              parentModulesCount: (window.parent as any).detentionSystem?.modules\n                ? Object.keys((window.parent as any).detentionSystem.modules).length\n                : 0,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'npc-load-debug',\n            hypothesisId: 'F',\n          }),\n        }).catch(() => {});\n      } catch (e) {\n        console.error('[NPC] :', e);\n      }\n      // #endregion\n    }\n  } catch (e) {\n    // #region agent log - HYP-G: \n    try {\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'npc_system.ts:',\n          message: 'NPC',\n          data: {\n            error: e instanceof Error ? e.message : String(e),\n            errorType: typeof e,\n          },\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'npc-load-debug',\n          hypothesisId: 'G',\n        }),\n      }).catch(() => {});\n    } catch (logError) {\n      console.error('[NPC] :', logError);\n    }\n    // #endregion\n    console.warn('[NPC] :', e);\n  }\n\n  // ==========  ==========\n  DS.events.on('event_triggered', (event?: unknown) => {\n    const eventId =\n      typeof (event as EventTriggeredPayload | undefined)?.id === 'string'\n        ? (event as EventTriggeredPayload).id\n        : undefined;\n    if (!eventId) return;\n    if (['interrogation', 'lawyer_visit', 'family_visit', 'medical_visit', 'scene_identification'].includes(eventId)) {\n      const npc = NPCGenerator.generateForEvent(eventId);\n      DS.events.emit('event_npc_generated', { event, npc });\n    }\n  });\n\n  // ==========  ==========\n  DS.events.on('cell_transfer', (data?: unknown) => {\n    const to = (data as CellTransferPayload | undefined)?.to;\n    const newCellType = typeof to === 'string' ? to : 'transition';\n    const npcCount = Math.floor(Math.random() * 5) + 3;\n    const newNPCs = NPCGenerator.generate(npcCount, { cellType: newCellType });\n    NPCGenerator.setCurrentCellNPCs(newNPCs);\n    console.info(`[NPC] ${npcCount}NPC`);\n  });\n\n  console.info(' [NPC]  - ');\n  (window as any).__NPC_SYSTEM_LOADED__ = true;\n  (window as any).__NPC_SYSTEM_LOADED_TIMESTAMP__ = Date.now();\n});\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","/**\n *  - \n * HTML\n * : 3.5.6 ()\n */\n// ==========  ==========\nconst CONFIG = {\n    updateInterval: 500,\n    animationDuration: 300,\n    trendWindow: 5,\n    slowChangeThreshold: 1.0,\n    regressionRate: 0.005,\n    healthBaseline: 70,\n    mentalBaseline: 65,\n    parseRetryAttempts: 3,\n    parseRetryDelay: 100,\n    debugMode: true,\n};\nconst TREND_SYMBOLS = {\n    up: '',\n    down: '',\n    stable: '',\n};\nlet state = {\n    name: '',\n    age: 0,\n    crime: '',\n    health: 75,\n    mental: 70,\n    strength: 65,\n    intelligence: 70,\n    appearance: {\n        height: 0,\n        weight: 0,\n        hair: '',\n        condition: '',\n    },\n    clothing: {\n        top: '',\n        bottom: '',\n        underwear: '',\n        underpants: '',\n        socks: '',\n        shoes: '',\n        restraints: '',\n        cleanliness: '',\n    },\n    currentTask: '',\n    currentThought: '',\n    biggestWorry: '',\n    days: 0,\n    stage: '',\n    cellType: '',\n    changes: {\n        health: [],\n        mental: [],\n        strength: [],\n        intelligence: [],\n    },\n    accumulated: {\n        health: 0,\n        mental: 0,\n        strength: 0,\n        intelligence: 0,\n    },\n    lastUpdate: Date.now(),\n    stats: {\n        totalUpdates: 0,\n        successfulParses: 0,\n        failedParses: 0,\n        lastParseTime: 0,\n    },\n};\nconst skipDisplayUpdate = false;\nlet isUpdating = false;\nlet mutationObserver = null;\nlet updateLoopInterval = null;\n// ==========  ==========\nfunction debugLog(...args) {\n    if (CONFIG.debugMode) {\n        console.log('[]', ...args);\n    }\n}\nfunction formatDuration(ms) {\n    const seconds = Math.floor(ms / 1000);\n    const minutes = Math.floor(seconds / 60);\n    const hours = Math.floor(minutes / 60);\n    const days = Math.floor(hours / 24);\n    if (days > 0)\n        return `${days}${hours % 24}`;\n    if (hours > 0)\n        return `${hours}${minutes % 60}`;\n    if (minutes > 0)\n        return `${minutes}${seconds % 60}`;\n    return `${seconds}`;\n}\n// ==========  ==========\nfunction recordChange(key, delta) {\n    if (!state.changes[key]) {\n        state.changes[key] = [];\n    }\n    state.changes[key].push({\n        value: delta,\n        timestamp: Date.now(),\n    });\n    if (state.changes[key].length > CONFIG.trendWindow) {\n        state.changes[key].shift();\n    }\n    debugLog(`: ${key} ${delta > 0 ? '+' : ''}${delta}`);\n}\nfunction calculateTrend(key) {\n    if (!state.changes[key] || state.changes[key].length === 0) {\n        return 'stable';\n    }\n    const sum = state.changes[key].reduce((acc, change) => acc + change.value, 0);\n    if (sum > 2)\n        return 'up';\n    if (sum < -2)\n        return 'down';\n    return 'stable';\n}\nfunction applyRegression() {\n    const healthDelta = (CONFIG.healthBaseline - state.health) * CONFIG.regressionRate;\n    if (Math.abs(healthDelta) > 0.01) {\n        state.accumulated.health += healthDelta;\n        if (Math.abs(state.accumulated.health) >= CONFIG.slowChangeThreshold) {\n            const change = Math.floor(state.accumulated.health);\n            state.health += change;\n            state.accumulated.health -= change;\n            recordChange('health', change);\n            debugLog(`: ${change}`);\n        }\n    }\n    const mentalDelta = (CONFIG.mentalBaseline - state.mental) * CONFIG.regressionRate;\n    if (Math.abs(mentalDelta) > 0.01) {\n        state.accumulated.mental += mentalDelta;\n        if (Math.abs(state.accumulated.mental) >= CONFIG.slowChangeThreshold) {\n            const change = Math.floor(state.accumulated.mental);\n            state.mental += change;\n            state.accumulated.mental -= change;\n            recordChange('mental', change);\n            debugLog(`: ${change}`);\n        }\n    }\n}\n// ==========  ==========\n/**\n * \n * @param stateData \n */\nfunction syncStateToMemoryEnhancement(stateData) {\n    // \n    try {\n        const currentChatId = typeof SillyTavern !== 'undefined' && SillyTavern.getCurrentChatId ? SillyTavern.getCurrentChatId() : null;\n        if (!currentChatId) {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:syncStateToMemoryEnhancement',\n                    message: '',\n                    data: {\n                        hasChatId: false,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-save-chat-error',\n                    hypothesisId: 'NO_CHAT_SKIP_SYNC',\n                }),\n            }).catch(() => { });\n            // #endregion\n            console.debug('[] ');\n            return;\n        }\n        // \n        try {\n            const testChatVars = getVariables({ type: 'chat' });\n            if (!testChatVars || typeof testChatVars !== 'object') {\n                // #region agent log\n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        location: 'status_panel.ts:syncStateToMemoryEnhancement',\n                        message: '',\n                        data: {\n                            hasChatId: !!currentChatId,\n                            hasChatVars: !!testChatVars,\n                        },\n                        timestamp: Date.now(),\n                        sessionId: 'debug-session',\n                        runId: 'fix-save-chat-error',\n                        hypothesisId: 'NO_CHAT_VARS_SKIP_SYNC',\n                    }),\n                }).catch(() => { });\n                // #endregion\n                console.debug('[] ');\n                return;\n            }\n        }\n        catch (testError) {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:syncStateToMemoryEnhancement',\n                    message: '',\n                    data: {\n                        hasChatId: !!currentChatId,\n                        error: testError instanceof Error ? testError.message : String(testError),\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'fix-save-chat-error',\n                    hypothesisId: 'TEST_CHAT_VARS_ERROR_SKIP_SYNC',\n                }),\n            }).catch(() => { });\n            // #endregion\n            console.debug('[] :', testError);\n            return;\n        }\n    }\n    catch (checkError) {\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                location: 'status_panel.ts:syncStateToMemoryEnhancement',\n                message: '',\n                data: {\n                    error: checkError instanceof Error ? checkError.message : String(checkError),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-chat-error',\n                hypothesisId: 'CHECK_CHAT_ERROR_SKIP_SYNC',\n            }),\n        }).catch(() => { });\n        // #endregion\n        console.debug('[] :', checkError);\n        return;\n    }\n    const plugin = detectMemoryEnhancementPlugin();\n    if (!plugin) {\n        return;\n    }\n    try {\n        //  updateState \n        if (typeof plugin.updateState === 'function') {\n            plugin.updateState(stateData);\n        }\n        //  setState \n        else if (typeof plugin.setState === 'function') {\n            plugin.setState(stateData);\n        }\n        // HTML\n    }\n    catch (error) {\n        console.warn('[] :', error);\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                location: 'status_panel.ts:syncStateToMemoryEnhancement',\n                message: '',\n                data: {\n                    error: error instanceof Error ? error.message : String(error),\n                    errorType: error instanceof Error ? error.constructor.name : typeof error,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'fix-save-chat-error',\n                hypothesisId: 'SYNC_TO_PLUGIN_ERROR',\n            }),\n        }).catch(() => { });\n        // #endregion\n    }\n}\nfunction updateState(data) {\n    if (isUpdating) {\n        console.warn('[] ');\n        return;\n    }\n    isUpdating = true;\n    try {\n        debugLog(':', data);\n        state.stats.totalUpdates++;\n        if (data.name !== undefined)\n            state.name = data.name;\n        if (data.age !== undefined)\n            state.age = data.age;\n        if (data.crime !== undefined)\n            state.crime = data.crime;\n        if (data.health !== undefined) {\n            const delta = data.health - state.health;\n            if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n                state.health = data.health;\n                recordChange('health', delta);\n                debugLog(`: ${state.health} (: ${delta})`);\n            }\n            else {\n                state.accumulated.health += delta;\n                debugLog(`: ${state.accumulated.health}`);\n                if (Math.abs(state.accumulated.health) >= CONFIG.slowChangeThreshold) {\n                    const change = Math.floor(state.accumulated.health);\n                    state.health += change;\n                    state.accumulated.health -= change;\n                    recordChange('health', change);\n                    debugLog(`: ${state.health} (: ${change})`);\n                }\n            }\n        }\n        if (data.mental !== undefined) {\n            const delta = data.mental - state.mental;\n            if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n                state.mental = data.mental;\n                recordChange('mental', delta);\n                debugLog(`: ${state.mental} (: ${delta})`);\n            }\n            else {\n                state.accumulated.mental += delta;\n                debugLog(`: ${state.accumulated.mental}`);\n                if (Math.abs(state.accumulated.mental) >= CONFIG.slowChangeThreshold) {\n                    const change = Math.floor(state.accumulated.mental);\n                    state.mental += change;\n                    state.accumulated.mental -= change;\n                    recordChange('mental', change);\n                    debugLog(`: ${state.mental} (: ${change})`);\n                }\n            }\n        }\n        if (data.strength !== undefined) {\n            const delta = data.strength - state.strength;\n            if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n                state.strength = data.strength;\n                recordChange('strength', delta);\n                debugLog(`: ${state.strength} (: ${delta})`);\n            }\n            else {\n                state.accumulated.strength += delta;\n                debugLog(`: ${state.accumulated.strength}`);\n                if (Math.abs(state.accumulated.strength) >= CONFIG.slowChangeThreshold) {\n                    const change = Math.floor(state.accumulated.strength);\n                    state.strength += change;\n                    state.accumulated.strength -= change;\n                    recordChange('strength', change);\n                    debugLog(`: ${state.strength} (: ${change})`);\n                }\n            }\n        }\n        if (data.intelligence !== undefined) {\n            const delta = data.intelligence - state.intelligence;\n            if (Math.abs(delta) >= CONFIG.slowChangeThreshold) {\n                state.intelligence = data.intelligence;\n                recordChange('intelligence', delta);\n                debugLog(`: ${state.intelligence} (: ${delta})`);\n            }\n            else {\n                state.accumulated.intelligence += delta;\n                debugLog(`: ${state.accumulated.intelligence}`);\n                if (Math.abs(state.accumulated.intelligence) >= CONFIG.slowChangeThreshold) {\n                    const change = Math.floor(state.accumulated.intelligence);\n                    state.intelligence += change;\n                    state.accumulated.intelligence -= change;\n                    recordChange('intelligence', change);\n                    debugLog(`: ${state.intelligence} (: ${change})`);\n                }\n            }\n        }\n        if (data.appearance) {\n            if (data.appearance.height !== undefined)\n                state.appearance.height = data.appearance.height;\n            if (data.appearance.weight !== undefined)\n                state.appearance.weight = data.appearance.weight;\n            if (data.appearance.hair !== undefined)\n                state.appearance.hair = data.appearance.hair;\n            if (data.appearance.condition !== undefined)\n                state.appearance.condition = data.appearance.condition;\n        }\n        if (data.clothing) {\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:407',\n                    message: 'updateStateclothing',\n                    data: {\n                        top: data.clothing.top || 'null',\n                        bottom: data.clothing.bottom || 'null',\n                        topLength: data.clothing.top?.length || 0,\n                        bottomLength: data.clothing.bottom?.length || 0,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'run1',\n                    hypothesisId: 'A',\n                }),\n            }).catch(() => { });\n            // #endregion\n            if (data.clothing.top !== undefined)\n                state.clothing.top = data.clothing.top;\n            if (data.clothing.bottom !== undefined)\n                state.clothing.bottom = data.clothing.bottom;\n            if (data.clothing.underwear !== undefined)\n                state.clothing.underwear = data.clothing.underwear;\n            if (data.clothing.underpants !== undefined)\n                state.clothing.underpants = data.clothing.underpants;\n            if (data.clothing.socks !== undefined)\n                state.clothing.socks = data.clothing.socks;\n            if (data.clothing.shoes !== undefined)\n                state.clothing.shoes = data.clothing.shoes;\n            if (data.clothing.restraints !== undefined)\n                state.clothing.restraints = data.clothing.restraints;\n            if (data.clothing.cleanliness !== undefined)\n                state.clothing.cleanliness = data.clothing.cleanliness;\n            // #region agent log\n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:416',\n                    message: 'updateStateclothing',\n                    data: {\n                        top: state.clothing.top || 'null',\n                        bottom: state.clothing.bottom || 'null',\n                        topLength: state.clothing.top?.length || 0,\n                        bottomLength: state.clothing.bottom?.length || 0,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-session',\n                    runId: 'run1',\n                    hypothesisId: 'E',\n                }),\n            }).catch(() => { });\n            // #endregion\n        }\n        if (data.currentTask !== undefined)\n            state.currentTask = data.currentTask;\n        if (data.currentThought !== undefined)\n            state.currentThought = data.currentThought;\n        if (data.biggestWorry !== undefined)\n            state.biggestWorry = data.biggestWorry;\n        if (data.days !== undefined)\n            state.days = data.days;\n        if (data.stage !== undefined)\n            state.stage = data.stage;\n        if (data.cellType !== undefined)\n            state.cellType = data.cellType;\n        state.lastUpdate = Date.now();\n        debugLog('');\n        // \n        const currentState = {\n            name: state.name,\n            age: state.age,\n            crime: state.crime,\n            health: state.health,\n            mental: state.mental,\n            strength: state.strength,\n            intelligence: state.intelligence,\n            appearance: { ...state.appearance },\n            clothing: { ...state.clothing },\n            currentTask: state.currentTask,\n            currentThought: state.currentThought,\n            biggestWorry: state.biggestWorry,\n            days: state.days,\n            stage: state.stage,\n            cellType: state.cellType,\n        };\n        syncStateToMemoryEnhancement(currentState);\n        updateDisplay();\n    }\n    catch (error) {\n        console.error('[] :', error);\n    }\n    finally {\n        isUpdating = false;\n    }\n}\n// ========== HTML ==========\nfunction parseCommentNode(node) {\n    if (!node || node.nodeType !== Node.COMMENT_NODE) {\n        return;\n    }\n    try {\n        let content = node.nodeValue || node.textContent || '';\n        content = content.trim();\n        if (!content) {\n            return;\n        }\n        debugLog(':', content.substring(0, 100) + (content.length > 100 ? '...' : ''));\n        if (content.startsWith('STATUS_UPDATE:')) {\n            const jsonStr = content.substring('STATUS_UPDATE:'.length).trim();\n            debugLog('JSON:', jsonStr.substring(0, 100) + (jsonStr.length > 100 ? '...' : ''));\n            parseStatusUpdate(jsonStr);\n        }\n    }\n    catch (error) {\n        console.error('[] :', error);\n    }\n}\nfunction parseStatusUpdate(jsonStr, attempt = 1) {\n    try {\n        jsonStr = jsonStr.trim();\n        jsonStr = jsonStr.replace(/,(\\s*[}\\]])/g, '$1');\n        jsonStr = jsonStr.replace(/[\\n\\r\\t]/g, '');\n        debugLog(`JSON (${attempt}):`, jsonStr.substring(0, 200) + (jsonStr.length > 200 ? '...' : ''));\n        const data = JSON.parse(jsonStr);\n        console.log('[]  :', data);\n        state.stats.successfulParses++;\n        state.stats.lastParseTime = Date.now();\n        updateState(data);\n        const DS = window.detentionSystem;\n        if (DS && DS.events) {\n            DS.events.emit('statusUpdated', data);\n        }\n        return true;\n    }\n    catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        console.error(`[]   ( ${attempt}/${CONFIG.parseRetryAttempts}):`, errorMessage);\n        console.error('[] JSON:', jsonStr);\n        state.stats.failedParses++;\n        if (attempt < CONFIG.parseRetryAttempts) {\n            console.log(`[]  ${CONFIG.parseRetryDelay}ms ...`);\n            setTimeout(() => {\n                parseStatusUpdate(jsonStr, attempt + 1);\n            }, CONFIG.parseRetryDelay);\n            return false;\n        }\n        else {\n            console.error('[]  ');\n            const DS = window.detentionSystem;\n            if (DS && DS.events) {\n                DS.events.emit('parseError', {\n                    jsonStr,\n                    error: errorMessage,\n                    attempts: attempt,\n                });\n            }\n            return false;\n        }\n    }\n}\nfunction checkForStatusUpdate(element) {\n    if (!element || element.nodeType !== Node.ELEMENT_NODE) {\n        return;\n    }\n    try {\n        const walker = document.createTreeWalker(element, NodeFilter.SHOW_COMMENT);\n        let node;\n        let count = 0;\n        while ((node = walker.nextNode())) {\n            count++;\n            parseCommentNode(node);\n        }\n        if (count > 0) {\n            debugLog(`TreeWalker  ${count} `);\n        }\n    }\n    catch (error) {\n        console.error('[] TreeWalker :', error);\n    }\n}\n// ========== UI ==========\nfunction updateElement(id, value) {\n    const element = document.getElementById(id);\n    if (element && element.textContent !== value) {\n        element.textContent = value;\n        element.classList.remove('updated');\n        setTimeout(() => {\n            element.classList.add('updated');\n        }, 10);\n        setTimeout(() => {\n            element.classList.remove('updated');\n        }, 500);\n    }\n}\nfunction updateStat(key, value) {\n    value = Math.max(0, Math.min(100, value));\n    const valueElement = document.getElementById(`${key}-value`);\n    if (valueElement) {\n        valueElement.textContent = Math.round(value).toString();\n    }\n    const barElement = document.getElementById(`${key}-bar`);\n    if (barElement) {\n        barElement.style.width = `${value}%`;\n        const statBar = barElement.closest('.stat-bar');\n        if (statBar) {\n            statBar.classList.remove('changed');\n            setTimeout(() => {\n                statBar.classList.add('changed');\n            }, 10);\n            setTimeout(() => {\n                statBar.classList.remove('changed');\n            }, 500);\n        }\n    }\n    const trend = calculateTrend(key);\n    const trendElement = document.getElementById(`${key}-trend`);\n    if (trendElement) {\n        trendElement.textContent = TREND_SYMBOLS[trend];\n        trendElement.style.color = trend === 'up' ? '#43e97b' : trend === 'down' ? '#f5576c' : '#999';\n    }\n}\nfunction updateDisplay() {\n    // \n    // \n    if (skipDisplayUpdate)\n        return;\n    // UI\n    try {\n        const memoryState = getStateFromMemoryEnhancement();\n        if (memoryState) {\n            debugLog('[] ');\n        }\n    }\n    catch (error) {\n        console.error('[] :', error);\n    }\n}\nfunction addStyles() {\n    if (document.getElementById('detention-status-styles')) {\n        return;\n    }\n    const style = document.createElement('style');\n    style.id = 'detention-status-styles';\n    style.textContent = `\n    #detention-status-panel {\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      width: 320px;\n      max-height: 90vh;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      border-radius: 12px;\n      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);\n      z-index: 10000;\n      font-family: 'Microsoft YaHei', 'SimHei', sans-serif;\n      overflow: hidden;\n      backdrop-filter: blur(10px);\n    }\n\n    .status-header {\n      background: rgba(0, 0, 0, 0.2);\n      padding: 12px 16px;\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    }\n\n    .status-header h3 {\n      margin: 0;\n      color: #fff;\n      font-size: 16px;\n      font-weight: 600;\n    }\n\n    .status-header-buttons {\n      display: flex;\n      gap: 8px;\n    }\n\n    .status-toggle, .status-debug-btn {\n      background: rgba(255, 255, 255, 0.2);\n      border: none;\n      color: #fff;\n      width: 28px;\n      height: 28px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 16px;\n      line-height: 1;\n      transition: all 0.3s;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    }\n\n    .status-toggle:hover, .status-debug-btn:hover {\n      background: rgba(255, 255, 255, 0.3);\n      transform: scale(1.1);\n    }\n\n    .status-content {\n      max-height: calc(90vh - 60px);\n      overflow-y: auto;\n      padding: 16px;\n    }\n\n    .status-content::-webkit-scrollbar {\n      width: 6px;\n    }\n\n    .status-content::-webkit-scrollbar-track {\n      background: rgba(0, 0, 0, 0.1);\n      border-radius: 3px;\n    }\n\n    .status-content::-webkit-scrollbar-thumb {\n      background: rgba(255, 255, 255, 0.3);\n      border-radius: 3px;\n    }\n\n    .status-content::-webkit-scrollbar-thumb:hover {\n      background: rgba(255, 255, 255, 0.5);\n    }\n\n    .status-section {\n      background: rgba(255, 255, 255, 0.95);\n      border-radius: 8px;\n      padding: 12px;\n      margin-bottom: 12px;\n    }\n\n    .status-section:last-child {\n      margin-bottom: 0;\n    }\n\n    .status-section h4 {\n      margin: 0 0 10px 0;\n      color: #667eea;\n      font-size: 14px;\n      font-weight: 600;\n      border-bottom: 2px solid #667eea;\n      padding-bottom: 6px;\n    }\n\n    .status-item {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      padding: 6px 0;\n      border-bottom: 1px solid rgba(0, 0, 0, 0.05);\n    }\n\n    .status-item:last-child {\n      border-bottom: none;\n    }\n\n    .status-item.full-width {\n      flex-direction: column;\n      align-items: flex-start;\n    }\n\n    .status-item.full-width .value {\n      width: 100%;\n      margin-top: 4px;\n      padding: 6px;\n      background: rgba(102, 126, 234, 0.1);\n      border-radius: 4px;\n    }\n\n    .status-item .label {\n      color: #666;\n      font-size: 13px;\n      font-weight: 500;\n    }\n\n    .status-item .value {\n      color: #333;\n      font-size: 13px;\n      font-weight: 600;\n      text-align: right;\n    }\n\n    .stat-bar {\n      margin-bottom: 12px;\n    }\n\n    .stat-bar:last-child {\n      margin-bottom: 0;\n    }\n\n    .stat-label {\n      display: flex;\n      justify-content: space-between;\n      align-items: center;\n      margin-bottom: 6px;\n      font-size: 13px;\n      font-weight: 600;\n      color: #333;\n    }\n\n    .stat-value {\n      color: #667eea;\n      font-size: 14px;\n    }\n\n    .stat-trend {\n      font-size: 16px;\n      margin-left: 4px;\n    }\n\n    .stat-progress {\n      height: 8px;\n      background: rgba(0, 0, 0, 0.1);\n      border-radius: 4px;\n      overflow: hidden;\n    }\n\n    .stat-fill {\n      height: 100%;\n      transition: width 0.3s ease, background-color 0.3s ease;\n      border-radius: 4px;\n    }\n\n    .stat-fill.health {\n      background: linear-gradient(90deg, #f093fb 0%, #f5576c 100%);\n    }\n\n    .stat-fill.mental {\n      background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);\n    }\n\n    .stat-fill.strength {\n      background: linear-gradient(90deg, #43e97b 0%, #38f9d7 100%);\n    }\n\n    .stat-fill.intelligence {\n      background: linear-gradient(90deg, #fa709a 0%, #fee140 100%);\n    }\n\n    .debug-buttons {\n      display: flex;\n      flex-direction: column;\n      gap: 8px;\n      margin-top: 12px;\n    }\n\n    .debug-btn {\n      background: #667eea;\n      color: white;\n      border: none;\n      padding: 8px 12px;\n      border-radius: 6px;\n      cursor: pointer;\n      font-size: 12px;\n      font-weight: 600;\n      transition: all 0.3s;\n    }\n\n    .debug-btn:hover {\n      background: #764ba2;\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n    }\n\n    @keyframes pulse {\n      0%, 100% { transform: scale(1); }\n      50% { transform: scale(1.05); }\n    }\n\n    .stat-bar.changed {\n      animation: pulse 0.5s ease;\n    }\n\n    @keyframes fadeIn {\n      from { opacity: 0; transform: translateY(-10px); }\n      to { opacity: 1; transform: translateY(0); }\n    }\n\n    .status-item.updated {\n      animation: fadeIn 0.3s ease;\n    }\n\n    @media (max-width: 768px) {\n      #detention-status-panel {\n        width: 280px;\n        top: 10px;\n        right: 10px;\n      }\n    }\n  `;\n    document.head.appendChild(style);\n}\nfunction createStatusPanel() {\n    // \n    // UI\n    const memoryEnhancement = detectMemoryEnhancementPlugin();\n    if (memoryEnhancement) {\n        console.log('[] ');\n    }\n    else {\n        console.log('[] ');\n    }\n}\nfunction updateDebugInfo() {\n    updateElement('debug-total-updates', state.stats.totalUpdates.toString());\n    updateElement('debug-success-parses', state.stats.successfulParses.toString());\n    updateElement('debug-failed-parses', state.stats.failedParses.toString());\n    const lastUpdate = state.stats.lastParseTime > 0 ? new Date(state.stats.lastParseTime).toLocaleTimeString('zh-CN') : '';\n    updateElement('debug-last-update', lastUpdate);\n    const observerStatus = mutationObserver ? '' : '';\n    updateElement('debug-observer-status', observerStatus);\n}\n// ==========  ==========\nfunction startCommentListener() {\n    if (mutationObserver) {\n        mutationObserver.disconnect();\n    }\n    console.log('[] HTML...');\n    mutationObserver = new MutationObserver(mutations => {\n        for (const mutation of mutations) {\n            if (mutation.type === 'childList') {\n                for (const node of mutation.addedNodes) {\n                    if (node.nodeType === Node.COMMENT_NODE) {\n                        parseCommentNode(node);\n                    }\n                    else if (node.nodeType === Node.ELEMENT_NODE) {\n                        checkForStatusUpdate(node);\n                    }\n                }\n            }\n            if (mutation.type === 'characterData') {\n                if (mutation.target.nodeType === Node.COMMENT_NODE) {\n                    parseCommentNode(mutation.target);\n                }\n            }\n        }\n    });\n    mutationObserver.observe(document.body, {\n        childList: true,\n        subtree: true,\n        characterData: true,\n        characterDataOldValue: false,\n    });\n    console.log('[] ...');\n    setTimeout(() => {\n        checkForStatusUpdate(document.body);\n    }, 1000);\n    console.log('[] HTML');\n}\nfunction stopCommentListener() {\n    if (mutationObserver) {\n        mutationObserver.disconnect();\n        mutationObserver = null;\n        console.log('[] HTML');\n    }\n}\nfunction startUpdateLoop() {\n    // \n    // \n    debugLog('');\n}\nfunction stopUpdateLoop() {\n    // \n    if (updateLoopInterval) {\n        clearInterval(updateLoopInterval);\n        updateLoopInterval = null;\n    }\n}\n// ==========  ==========\n/**\n * \n * @returns  null\n */\nfunction detectMemoryEnhancementPlugin() {\n    // #region agent log - HYP-E: \n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n            location: 'status_panel.ts:1225',\n            message: '',\n            data: {\n                hasWindow: typeof window !== 'undefined',\n                hasStMemoryEnhancement: !!window.stMemoryEnhancement,\n                hasMemoryEnhancement: !!window.MemoryEnhancement,\n                hasMemoryEnhancementLower: !!window.memoryEnhancement,\n                hasMemoryEnhancementPlugin: !!window.MemoryEnhancementPlugin,\n                hasMemoryEnhancementPluginLower: !!window.memoryEnhancementPlugin,\n                stMemoryEnhancementType: typeof window.stMemoryEnhancement,\n                memoryEnhancementType: typeof window.MemoryEnhancement,\n                memoryEnhancementLowerType: typeof window.memoryEnhancement,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-status-panel',\n            runId: 'run1',\n            hypothesisId: 'E',\n        }),\n    }).catch(() => { });\n    // #endregion\n    try {\n        //  stMemoryEnhancement\n        const memoryEnhancement = window.stMemoryEnhancement ||\n            window.MemoryEnhancement ||\n            window.memoryEnhancement ||\n            window.MemoryEnhancementPlugin ||\n            window.memoryEnhancementPlugin;\n        // #region agent log - HYP-E: \n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                location: 'status_panel.ts:1234',\n                message: '',\n                data: {\n                    hasPlugin: !!memoryEnhancement,\n                    pluginType: typeof memoryEnhancement,\n                    pluginKeys: memoryEnhancement ? Object.keys(memoryEnhancement).slice(0, 10) : [],\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-status-panel',\n                runId: 'run1',\n                hypothesisId: 'E',\n            }),\n        }).catch(() => { });\n        // #endregion\n        //  ext_getAllTables  ext_exportAllTablesAsJson\n        if (memoryEnhancement &&\n            (typeof memoryEnhancement.ext_getAllTables === 'function' ||\n                typeof memoryEnhancement.ext_exportAllTablesAsJson === 'function')) {\n            // #region agent log - HYP-E: \n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:1235',\n                    message: '',\n                    data: {\n                        success: true,\n                        hasExtGetAllTables: typeof memoryEnhancement.ext_getAllTables === 'function',\n                        hasExtExportAllTablesAsJson: typeof memoryEnhancement.ext_exportAllTablesAsJson === 'function',\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-status-panel',\n                    runId: 'run1',\n                    hypothesisId: 'E',\n                }),\n            }).catch(() => { });\n            // #endregion\n            return memoryEnhancement;\n        }\n        // #region agent log - HYP-E: \n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                location: 'status_panel.ts:1237',\n                message: '',\n                data: {\n                    hasPlugin: !!memoryEnhancement,\n                    hasExtGetAllTables: !!(memoryEnhancement && typeof memoryEnhancement.ext_getAllTables === 'function'),\n                    hasExtExportAllTablesAsJson: !!(memoryEnhancement && typeof memoryEnhancement.ext_exportAllTablesAsJson === 'function'),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-status-panel',\n                runId: 'run1',\n                hypothesisId: 'E',\n            }),\n        }).catch(() => { });\n        // #endregion\n        return null;\n    }\n    catch (error) {\n        console.warn('[] :', error);\n        // #region agent log - HYP-E: \n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                location: 'status_panel.ts:1239',\n                message: '',\n                data: {\n                    error: error instanceof Error ? error.message : String(error),\n                    errorStack: error instanceof Error ? error.stack : undefined,\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-status-panel',\n                runId: 'run1',\n                hypothesisId: 'E',\n            }),\n        }).catch(() => { });\n        // #endregion\n        return null;\n    }\n}\n/**\n * \n * @returns  null\n */\nfunction getStateFromMemoryEnhancement() {\n    const plugin = detectMemoryEnhancementPlugin();\n    if (!plugin) {\n        return null;\n    }\n    try {\n        // \n        let memoryState = null;\n        //  getState \n        //  ext_exportAllTablesAsJson\n        if (!memoryState) {\n            // #region agent log - HYP-E: \n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                    message: '',\n                    data: {\n                        hasExtGetAllTables: typeof plugin.ext_getAllTables === 'function',\n                        hasExtExportAllTablesAsJson: typeof plugin.ext_exportAllTablesAsJson === 'function',\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-status-panel',\n                    runId: 'run1',\n                    hypothesisId: 'E',\n                }),\n            }).catch(() => { });\n            // #endregion\n            // \n            // \n            try {\n                const chatVars = getVariables({ type: 'chat' });\n                const messageVars = getVariables({ type: 'message', message_id: 'latest' });\n                // \n                const possiblePaths = [\n                    'state',\n                    'status',\n                    'character',\n                    'protagonist',\n                    'player',\n                    'main',\n                    'current',\n                    'stat_data',\n                    'memory',\n                    'memoryEnhancement',\n                    'stMemoryEnhancement',\n                ];\n                for (const path of possiblePaths) {\n                    // \n                    if (chatVars && typeof chatVars === 'object' && path in chatVars) {\n                        const candidate = chatVars[path];\n                        if (candidate && typeof candidate === 'object' && ('health' in candidate || 'mental' in candidate)) {\n                            memoryState = candidate;\n                            // #region agent log - HYP-E: \n                            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify({\n                                    location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                    message: '',\n                                    data: {\n                                        path: `chat.${path}`,\n                                        hasHealth: 'health' in candidate,\n                                        hasMental: 'mental' in candidate,\n                                    },\n                                    timestamp: Date.now(),\n                                    sessionId: 'debug-status-panel',\n                                    runId: 'run1',\n                                    hypothesisId: 'E',\n                                }),\n                            }).catch(() => { });\n                            // #endregion\n                            break;\n                        }\n                    }\n                    // \n                    if (messageVars && typeof messageVars === 'object' && path in messageVars) {\n                        const candidate = messageVars[path];\n                        if (candidate && typeof candidate === 'object' && ('health' in candidate || 'mental' in candidate)) {\n                            memoryState = candidate;\n                            // #region agent log - HYP-E: \n                            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify({\n                                    location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                    message: '',\n                                    data: {\n                                        path: `message.${path}`,\n                                        hasHealth: 'health' in candidate,\n                                        hasMental: 'mental' in candidate,\n                                    },\n                                    timestamp: Date.now(),\n                                    sessionId: 'debug-status-panel',\n                                    runId: 'run1',\n                                    hypothesisId: 'E',\n                                }),\n                            }).catch(() => { });\n                            // #endregion\n                            break;\n                        }\n                    }\n                }\n                // \n                if (!memoryState) {\n                    const searchInVars = (vars, prefix = '') => {\n                        if (!vars || typeof vars !== 'object')\n                            return null;\n                        if (Array.isArray(vars)) {\n                            for (let i = 0; i < vars.length; i++) {\n                                const result = searchInVars(vars[i], `${prefix}[${i}]`);\n                                if (result)\n                                    return result;\n                            }\n                            return null;\n                        }\n                        if ('health' in vars && 'mental' in vars) {\n                            return vars;\n                        }\n                        for (const [key, value] of Object.entries(vars)) {\n                            const result = searchInVars(value, prefix ? `${prefix}.${key}` : key);\n                            if (result)\n                                return result;\n                        }\n                        return null;\n                    };\n                    const foundInChat = searchInVars(chatVars);\n                    if (foundInChat) {\n                        memoryState = foundInChat;\n                        // #region agent log - HYP-E: \n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: '',\n                                data: {\n                                    hasHealth: 'health' in foundInChat,\n                                    hasMental: 'mental' in foundInChat,\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                    }\n                    else {\n                        const foundInMessage = searchInVars(messageVars);\n                        if (foundInMessage) {\n                            memoryState = foundInMessage;\n                            // #region agent log - HYP-E: \n                            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                                method: 'POST',\n                                headers: { 'Content-Type': 'application/json' },\n                                body: JSON.stringify({\n                                    location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                    message: '',\n                                    data: {\n                                        hasHealth: 'health' in foundInMessage,\n                                        hasMental: 'mental' in foundInMessage,\n                                    },\n                                    timestamp: Date.now(),\n                                    sessionId: 'debug-status-panel',\n                                    runId: 'run1',\n                                    hypothesisId: 'E',\n                                }),\n                            }).catch(() => { });\n                            // #endregion\n                        }\n                    }\n                }\n            }\n            catch (error) {\n                console.warn('[] :', error);\n                // #region agent log - HYP-E: \n                fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                        message: '',\n                        data: {\n                            error: error instanceof Error ? error.message : String(error),\n                        },\n                        timestamp: Date.now(),\n                        sessionId: 'debug-status-panel',\n                        runId: 'run1',\n                        hypothesisId: 'E',\n                    }),\n                }).catch(() => { });\n                // #endregion\n            }\n            //  ext_exportAllTablesAsJson\n            //  ext_exportAllTablesAsJson  ext_getAllTables\n            if (!memoryState) {\n                //  ext_exportAllTablesAsJson\n                if (typeof plugin.ext_exportAllTablesAsJson === 'function') {\n                    try {\n                        // #region agent log - HYP-E:  ext_exportAllTablesAsJson \n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: ' ext_exportAllTablesAsJson ',\n                                data: {\n                                    hasExtExportAllTablesAsJson: true,\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                        const jsonData = plugin.ext_exportAllTablesAsJson();\n                        // #region agent log - HYP-E: ext_exportAllTablesAsJson \n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: 'ext_exportAllTablesAsJson ',\n                                data: {\n                                    isObject: typeof jsonData === 'object' && jsonData !== null,\n                                    tableCount: typeof jsonData === 'object' && jsonData !== null ? Object.keys(jsonData).length : 0,\n                                    tableUids: typeof jsonData === 'object' && jsonData !== null ? Object.keys(jsonData).slice(0, 5) : [],\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                        // ext_exportAllTablesAsJson : {uid: {uid, name, content: Array<Array<string>>}, ...}\n                        if (jsonData && typeof jsonData === 'object' && !Array.isArray(jsonData)) {\n                            const tables = Object.values(jsonData);\n                            // \n                            const possibleTableNames = [\n                                'state',\n                                'status',\n                                'character',\n                                'protagonist',\n                                'player',\n                                'main',\n                                'current',\n                                '',\n                                '',\n                                '',\n                                '',\n                            ];\n                            let targetTable = null;\n                            for (const table of tables) {\n                                if (table &&\n                                    typeof table === 'object' &&\n                                    'name' in table &&\n                                    typeof table.name === 'string' &&\n                                    possibleTableNames.some(name => table.name.toLowerCase().includes(name.toLowerCase()))) {\n                                    targetTable = table;\n                                    break;\n                                }\n                            }\n                            //  health  mental \n                            if (!targetTable) {\n                                for (const table of tables) {\n                                    if (table &&\n                                        typeof table === 'object' &&\n                                        'content' in table &&\n                                        Array.isArray(table.content) &&\n                                        table.content.length >= 2) {\n                                        const header = table.content[0];\n                                        if (Array.isArray(header) &&\n                                            (header.some((h) => h && h.toLowerCase().includes('health')) ||\n                                                header.some((h) => h && h.toLowerCase().includes('mental')) ||\n                                                header.some((h) => h && h.toLowerCase().includes('')) ||\n                                                header.some((h) => h && h.toLowerCase().includes('')))) {\n                                            targetTable = table;\n                                            break;\n                                        }\n                                    }\n                                }\n                            }\n                            // \n                            if (targetTable && Array.isArray(targetTable.content) && targetTable.content.length >= 2) {\n                                const header = targetTable.content[0];\n                                const firstDataRow = targetTable.content[1];\n                                if (Array.isArray(header) && Array.isArray(firstDataRow)) {\n                                    const stateObj = {};\n                                    header.forEach((colName, index) => {\n                                        if (colName && firstDataRow[index] !== undefined) {\n                                            const normalizedName = colName.toLowerCase().trim();\n                                            const value = firstDataRow[index];\n                                            const numValue = typeof value === 'string' ? parseFloat(value) : value;\n                                            const finalValue = !isNaN(numValue) && numValue !== null ? numValue : value;\n                                            if (normalizedName.includes('health') || normalizedName.includes('')) {\n                                                stateObj.health = finalValue;\n                                            }\n                                            else if (normalizedName.includes('mental') || normalizedName.includes('')) {\n                                                stateObj.mental = finalValue;\n                                            }\n                                            else if (normalizedName.includes('strength') || normalizedName.includes('')) {\n                                                stateObj.strength = finalValue;\n                                            }\n                                            else if (normalizedName.includes('intelligence') || normalizedName.includes('')) {\n                                                stateObj.intelligence = finalValue;\n                                            }\n                                            stateObj[colName] = finalValue;\n                                        }\n                                    });\n                                    if ('health' in stateObj || 'mental' in stateObj) {\n                                        memoryState = stateObj;\n                                        // #region agent log - HYP-E:  JSON \n                                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                                            method: 'POST',\n                                            headers: { 'Content-Type': 'application/json' },\n                                            body: JSON.stringify({\n                                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                                message: ' JSON ',\n                                                data: {\n                                                    tableName: targetTable.name || 'unknown',\n                                                    hasHealth: 'health' in stateObj,\n                                                    hasMental: 'mental' in stateObj,\n                                                },\n                                                timestamp: Date.now(),\n                                                sessionId: 'debug-status-panel',\n                                                runId: 'run1',\n                                                hypothesisId: 'E',\n                                            }),\n                                        }).catch(() => { });\n                                        // #endregion\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    catch (jsonError) {\n                        console.warn('[] ext_exportAllTablesAsJson  ext_getAllTables:', jsonError);\n                        // #region agent log - HYP-E: ext_exportAllTablesAsJson  ext_getAllTables\n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: 'ext_exportAllTablesAsJson  ext_getAllTables',\n                                data: {\n                                    error: jsonError instanceof Error ? jsonError.message : String(jsonError),\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                    }\n                }\n                //  ext_exportAllTablesAsJson  ext_getAllTables\n                if (!memoryState && typeof plugin.ext_getAllTables === 'function') {\n                    try {\n                        // #region agent log - HYP-E:  ext_getAllTables \n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: ' ext_getAllTables ',\n                                data: {\n                                    hasExtGetAllTables: true,\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                        const allTables = plugin.ext_getAllTables();\n                        // #region agent log - HYP-E: ext_getAllTables \n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: 'ext_getAllTables ',\n                                data: {\n                                    isArray: Array.isArray(allTables),\n                                    length: Array.isArray(allTables) ? allTables.length : 0,\n                                    tableNames: Array.isArray(allTables) ? allTables.map((t) => t?.name).filter(Boolean) : [],\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                        // ext_getAllTables : [{name: string, data: Array<Array<string>>}, ...]\n                        // data \n                        if (Array.isArray(allTables) && allTables.length > 0) {\n                            // \n                            const possibleTableNames = [\n                                'state',\n                                'status',\n                                'character',\n                                'protagonist',\n                                'player',\n                                'main',\n                                'current',\n                                '',\n                                '',\n                                '',\n                                '',\n                            ];\n                            let targetTable = null;\n                            for (const table of allTables) {\n                                if (table &&\n                                    table.name &&\n                                    possibleTableNames.some(name => table.name.toLowerCase().includes(name.toLowerCase()))) {\n                                    targetTable = table;\n                                    break;\n                                }\n                            }\n                            //  health  mental \n                            if (!targetTable) {\n                                for (const table of allTables) {\n                                    if (!table || !Array.isArray(table.data) || table.data.length < 2)\n                                        continue;\n                                    const header = table.data[0]; // \n                                    if (Array.isArray(header) &&\n                                        (header.some((h) => h && h.toLowerCase().includes('health')) ||\n                                            header.some((h) => h && h.toLowerCase().includes('mental')) ||\n                                            header.some((h) => h && h.toLowerCase().includes('')) ||\n                                            header.some((h) => h && h.toLowerCase().includes('')))) {\n                                        targetTable = table;\n                                        break;\n                                    }\n                                }\n                            }\n                            // \n                            if (targetTable && Array.isArray(targetTable.data) && targetTable.data.length >= 2) {\n                                const header = targetTable.data[0];\n                                const firstDataRow = targetTable.data[1]; // \n                                if (Array.isArray(header) && Array.isArray(firstDataRow)) {\n                                    const stateObj = {};\n                                    header.forEach((colName, index) => {\n                                        if (colName && firstDataRow[index] !== undefined) {\n                                            // \n                                            const normalizedName = colName.toLowerCase().trim();\n                                            const value = firstDataRow[index];\n                                            // \n                                            const numValue = typeof value === 'string' ? parseFloat(value) : value;\n                                            const finalValue = !isNaN(numValue) && numValue !== null ? numValue : value;\n                                            // \n                                            if (normalizedName.includes('health') || normalizedName.includes('')) {\n                                                stateObj.health = finalValue;\n                                            }\n                                            else if (normalizedName.includes('mental') || normalizedName.includes('')) {\n                                                stateObj.mental = finalValue;\n                                            }\n                                            else if (normalizedName.includes('strength') || normalizedName.includes('')) {\n                                                stateObj.strength = finalValue;\n                                            }\n                                            else if (normalizedName.includes('intelligence') || normalizedName.includes('')) {\n                                                stateObj.intelligence = finalValue;\n                                            }\n                                            // \n                                            stateObj[colName] = finalValue;\n                                        }\n                                    });\n                                    //  health  mental\n                                    if ('health' in stateObj || 'mental' in stateObj) {\n                                        memoryState = stateObj;\n                                        // #region agent log - HYP-E: \n                                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                                            method: 'POST',\n                                            headers: { 'Content-Type': 'application/json' },\n                                            body: JSON.stringify({\n                                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                                message: '',\n                                                data: {\n                                                    tableName: targetTable.name,\n                                                    hasHealth: 'health' in stateObj,\n                                                    hasMental: 'mental' in stateObj,\n                                                    stateKeys: Object.keys(stateObj).slice(0, 10),\n                                                },\n                                                timestamp: Date.now(),\n                                                sessionId: 'debug-status-panel',\n                                                runId: 'run1',\n                                                hypothesisId: 'E',\n                                            }),\n                                        }).catch(() => { });\n                                        // #endregion\n                                    }\n                                }\n                            }\n                        }\n                    }\n                    catch (extError) {\n                        // ext_getAllTables  table.getBody is not a function\n                        console.warn('[] ext_getAllTables :', extError);\n                        // #region agent log - HYP-E: ext_getAllTables \n                        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                            method: 'POST',\n                            headers: { 'Content-Type': 'application/json' },\n                            body: JSON.stringify({\n                                location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                                message: 'ext_getAllTables ',\n                                data: {\n                                    error: extError instanceof Error ? extError.message : String(extError),\n                                },\n                                timestamp: Date.now(),\n                                sessionId: 'debug-status-panel',\n                                runId: 'run1',\n                                hypothesisId: 'E',\n                            }),\n                        }).catch(() => { });\n                        // #endregion\n                    }\n                }\n            }\n        } //  if (!memoryState) - \n        if (!memoryState || typeof memoryState !== 'object') {\n            // #region agent log - HYP-E: \n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                    message: '',\n                    data: {\n                        hasExtGetAllTables: typeof plugin.ext_getAllTables === 'function',\n                        hasExtExportAllTablesAsJson: typeof plugin.ext_exportAllTablesAsJson === 'function',\n                        memoryStateType: typeof memoryState,\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-status-panel',\n                    runId: 'run1',\n                    hypothesisId: 'E',\n                }),\n            }).catch(() => { });\n            // #endregion\n            return null;\n        }\n        // \n        if (memoryState.health === undefined && memoryState.mental === undefined) {\n            // #region agent log - HYP-E: \n            fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                    location: 'status_panel.ts:getStateFromMemoryEnhancement',\n                    message: ' health  mental',\n                    data: {\n                        memoryStateKeys: Object.keys(memoryState).slice(0, 20),\n                    },\n                    timestamp: Date.now(),\n                    sessionId: 'debug-status-panel',\n                    runId: 'run1',\n                    hypothesisId: 'E',\n                }),\n            }).catch(() => { });\n            // #endregion\n            return null;\n        }\n        // \n        const fullState = {\n            name: memoryState.name ?? state.name ?? undefined,\n            age: memoryState.age ?? state.age ?? undefined,\n            crime: memoryState.crime ?? state.crime ?? undefined,\n            health: memoryState.health ?? state.health ?? 70,\n            mental: memoryState.mental ?? state.mental ?? 65,\n            strength: memoryState.strength ?? state.strength ?? 50,\n            intelligence: memoryState.intelligence ?? state.intelligence ?? 55,\n            appearance: memoryState.appearance\n                ? {\n                    height: memoryState.appearance.height ?? state.appearance.height,\n                    weight: memoryState.appearance.weight ?? state.appearance.weight,\n                    hair: memoryState.appearance.hair ?? state.appearance.hair,\n                    condition: memoryState.appearance.condition ?? state.appearance.condition,\n                }\n                : { ...state.appearance },\n            clothing: memoryState.clothing\n                ? {\n                    top: memoryState.clothing.top ?? state.clothing.top,\n                    bottom: memoryState.clothing.bottom ?? state.clothing.bottom,\n                    underwear: memoryState.clothing.underwear ?? state.clothing.underwear,\n                    underpants: memoryState.clothing.underpants ?? state.clothing.underpants,\n                    socks: memoryState.clothing.socks ?? state.clothing.socks,\n                    shoes: memoryState.clothing.shoes ?? state.clothing.shoes,\n                    restraints: memoryState.clothing.restraints ?? state.clothing.restraints,\n                    cleanliness: memoryState.clothing.cleanliness ?? state.clothing.cleanliness,\n                }\n                : { ...state.clothing },\n            currentTask: memoryState.currentTask ?? state.currentTask ?? undefined,\n            currentThought: memoryState.currentThought ?? state.currentThought ?? undefined,\n            biggestWorry: memoryState.biggestWorry ?? state.biggestWorry ?? undefined,\n            days: memoryState.days ?? memoryState.day ?? state.days ?? 0,\n            stage: memoryState.stage ?? state.stage ?? undefined,\n            cellType: memoryState.cellType ?? memoryState.cell_type ?? state.cellType ?? undefined,\n        };\n        return fullState;\n    }\n    catch (error) {\n        console.warn('[] :', error);\n        return null;\n    }\n}\n// ========== API ==========\nconst StatusPanel = {\n    version: '3.5.6',\n    state,\n    initialize() {\n        console.log('[]  v3.5.6 ()');\n        // UI\n        createStatusPanel(); // UI\n        startCommentListener(); // HTML\n        const DS = window.detentionSystem;\n        if (DS && DS.events) {\n            DS.events.on('stateChanged', (data) => {\n                debugLog(':', data);\n                if (data && typeof data === 'object') {\n                    updateState(data);\n                }\n            });\n            DS.events.on('dayAdvanced', (data) => {\n                debugLog(':', data);\n                if (data && typeof data === 'object') {\n                    const d = data;\n                    if (d.days !== undefined)\n                        state.days = d.days;\n                    if (d.stage !== undefined)\n                        state.stage = d.stage;\n                    if (d.cellType !== undefined)\n                        state.cellType = d.cellType;\n                    updateDisplay();\n                }\n            });\n        }\n        console.log('[] ');\n        console.log('[] :', CONFIG.debugMode ? '' : '');\n    },\n    destroy() {\n        console.log('[] ...');\n        stopCommentListener();\n        stopUpdateLoop();\n        // UI\n        // \n        const DS = window.detentionSystem;\n        if (DS && DS.events) {\n            DS.events.off('stateChanged', () => { });\n            DS.events.off('dayAdvanced', () => { });\n        }\n        console.log('[] ');\n    },\n    getState() {\n        // \n        const memoryState = getStateFromMemoryEnhancement();\n        if (memoryState) {\n            debugLog('[] ');\n            return memoryState;\n        }\n        // \n        debugLog('[] ');\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n                location: 'status_panel.ts:1262',\n                message: 'getStateclothing',\n                data: {\n                    top: state.clothing.top || 'null',\n                    bottom: state.clothing.bottom || 'null',\n                    topLength: state.clothing.top?.length || 0,\n                    bottomLength: state.clothing.bottom?.length || 0,\n                    allClothing: JSON.stringify(state.clothing),\n                },\n                timestamp: Date.now(),\n                sessionId: 'debug-session',\n                runId: 'run1',\n                hypothesisId: 'E',\n            }),\n        }).catch(() => { });\n        // #endregion\n        const internalState = {\n            name: state.name,\n            age: state.age,\n            crime: state.crime,\n            health: state.health,\n            mental: state.mental,\n            strength: state.strength,\n            intelligence: state.intelligence,\n            appearance: { ...state.appearance },\n            clothing: { ...state.clothing },\n            currentTask: state.currentTask,\n            currentThought: state.currentThought,\n            biggestWorry: state.biggestWorry,\n            days: state.days,\n            stage: state.stage,\n            cellType: state.cellType,\n        };\n        return internalState;\n    },\n    modifyValue(key, delta, reason = '') {\n        if (state[key] === undefined) {\n            console.error(`[] : ${key}`);\n            return;\n        }\n        const oldValue = state[key];\n        const newValue = Math.max(0, Math.min(100, oldValue + delta));\n        if (newValue !== oldValue) {\n            state[key] = newValue;\n            recordChange(key, delta);\n            console.log(`[] ${key} : ${oldValue}  ${newValue} (${delta > 0 ? '+' : ''}${delta}) ${reason ? `: ${reason}` : ''}`);\n            const DS = window.detentionSystem;\n            if (DS && DS.events) {\n                DS.events.emit('valueChanged', {\n                    key,\n                    oldValue,\n                    newValue,\n                    delta,\n                    reason,\n                });\n            }\n            // \n            syncStateToMemoryEnhancement(StatusPanel.getState());\n            updateDisplay();\n        }\n    },\n    getTrendAnalysis() {\n        return {\n            health: {\n                value: state.health,\n                trend: calculateTrend('health'),\n                changes: state.changes.health || [],\n            },\n            mental: {\n                value: state.mental,\n                trend: calculateTrend('mental'),\n                changes: state.changes.mental || [],\n            },\n            strength: {\n                value: state.strength,\n                trend: calculateTrend('strength'),\n                changes: state.changes.strength || [],\n            },\n            intelligence: {\n                value: state.intelligence,\n                trend: calculateTrend('intelligence'),\n                changes: state.changes.intelligence || [],\n            },\n        };\n    },\n    getCurrentStage() {\n        return {\n            days: state.days,\n            stage: state.stage,\n            cellType: state.cellType,\n        };\n    },\n    parseStatusUpdate,\n    reset() {\n        state = {\n            name: '',\n            age: 0,\n            crime: '',\n            health: 75,\n            mental: 70,\n            strength: 65,\n            intelligence: 70,\n            appearance: {\n                height: 0,\n                weight: 0,\n                hair: '',\n                condition: '',\n            },\n            clothing: {\n                top: '',\n                bottom: '',\n                underwear: '',\n                underpants: '',\n                socks: '',\n                shoes: '',\n                restraints: '',\n                cleanliness: '',\n            },\n            currentTask: '',\n            currentThought: '',\n            biggestWorry: '',\n            days: 0,\n            stage: '',\n            cellType: '',\n            changes: {\n                health: [],\n                mental: [],\n                strength: [],\n                intelligence: [],\n            },\n            accumulated: {\n                health: 0,\n                mental: 0,\n                strength: 0,\n                intelligence: 0,\n            },\n            lastUpdate: Date.now(),\n            stats: {\n                totalUpdates: 0,\n                successfulParses: 0,\n                failedParses: 0,\n                lastParseTime: 0,\n            },\n        };\n        updateDisplay();\n        console.log('[] ');\n    },\n    exportData() {\n        return {\n            version: '3.5.6',\n            timestamp: Date.now(),\n            state: JSON.parse(JSON.stringify(state)),\n        };\n    },\n    importData(data) {\n        if (!data || !data.state) {\n            console.error('[] ');\n            return false;\n        }\n        try {\n            if (data.version && data.version !== '3.5.6') {\n                console.warn(`[] : ${data.version} vs 3.5.6`);\n            }\n            state = data.state;\n            if (!state.changes) {\n                state.changes = {\n                    health: [],\n                    mental: [],\n                    strength: [],\n                    intelligence: [],\n                };\n            }\n            if (!state.accumulated) {\n                state.accumulated = {\n                    health: 0,\n                    mental: 0,\n                    strength: 0,\n                    intelligence: 0,\n                };\n            }\n            if (!state.stats) {\n                state.stats = {\n                    totalUpdates: 0,\n                    successfulParses: 0,\n                    failedParses: 0,\n                    lastParseTime: 0,\n                };\n            }\n            state.lastUpdate = Date.now();\n            updateDisplay();\n            console.log('[] ');\n            return true;\n        }\n        catch (error) {\n            console.error('[] :', error);\n            return false;\n        }\n    },\n};\n// ==========  ==========\nfunction scanAllComments() {\n    console.log('[] ...');\n    const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_COMMENT);\n    const comments = [];\n    let node;\n    while ((node = walker.nextNode())) {\n        const content = (node.nodeValue || node.textContent || '').trim();\n        comments.push({\n            content: content.substring(0, 100) + (content.length > 100 ? '...' : ''),\n            fullContent: content,\n            isStatusUpdate: content.startsWith('STATUS_UPDATE:'),\n            length: content.length,\n        });\n        if (content.startsWith('STATUS_UPDATE:')) {\n            console.log('[]  :', content.substring(0, 100));\n            parseCommentNode(node);\n        }\n    }\n    console.log(`[]  ${comments.length} `);\n    console.log('[] :', comments.filter(c => c.isStatusUpdate).length);\n    console.table(comments);\n    return comments;\n}\nfunction getDiagnostics() {\n    const diagnostics = {\n        version: '3.5.6',\n        timestamp: new Date().toLocaleString('zh-CN'),\n        observer: {\n            active: mutationObserver !== null,\n            status: mutationObserver ? '' : '',\n        },\n        state: {\n            lastUpdate: new Date(state.lastUpdate).toLocaleString('zh-CN'),\n            timeSinceUpdate: Date.now() - state.lastUpdate,\n            timeSinceUpdateFormatted: formatDuration(Date.now() - state.lastUpdate),\n        },\n        stats: {\n            totalUpdates: state.stats.totalUpdates,\n            successfulParses: state.stats.successfulParses,\n            failedParses: state.stats.failedParses,\n            successRate: state.stats.totalUpdates > 0\n                ? `${((state.stats.successfulParses / state.stats.totalUpdates) * 100).toFixed(2)}%`\n                : 'N/A',\n            lastParseTime: state.stats.lastParseTime > 0 ? new Date(state.stats.lastParseTime).toLocaleString('zh-CN') : '',\n        },\n        currentState: StatusPanel.getState(),\n        config: CONFIG,\n    };\n    console.log('[] ');\n    console.log('[] :', diagnostics.version);\n    console.log('[] :', diagnostics.timestamp);\n    console.log('[] :', diagnostics.observer.status);\n    console.log('[] :', diagnostics.state.lastUpdate);\n    console.log('[] :', diagnostics.state.timeSinceUpdateFormatted);\n    console.log('[] :', diagnostics.stats);\n    console.log('[] :', diagnostics.currentState);\n    return diagnostics;\n}\n//  StatusPanel \nStatusPanel.debug = {\n    scanAllComments,\n    getDiagnostics,\n    parseCommentNode,\n    checkForStatusUpdate,\n};\n// ==========  ==========\n$(() => {\n    console.info('[]  v3.5.6 ()');\n    const DS = window.detentionSystem;\n    if (!DS) {\n        console.error('[] ');\n        return;\n    }\n    // \n    DS.getState = () => StatusPanel.getState();\n    DS.modifyValue = (key, delta, reason) => StatusPanel.modifyValue(key, delta, reason);\n    DS.getTrendAnalysis = () => StatusPanel.getTrendAnalysis();\n    DS.getCurrentStage = () => StatusPanel.getCurrentStage();\n    DS.parseStatusUpdate = (jsonStr) => StatusPanel.parseStatusUpdate(jsonStr);\n    // \n    DS.registerModule('statusPanel', StatusPanel);\n    //  window \n    window.detentionSystem.statusPanel = StatusPanel;\n    // iframe \n    try {\n        if (window.parent && window.parent !== window) {\n            window.parent.detentionSystem = DS;\n            console.info('[]  ');\n        }\n    }\n    catch (e) {\n        // \n    }\n    // \n    DS.events.on('initialized', () => {\n        console.info('[] ');\n        setTimeout(() => {\n            try {\n                StatusPanel.initialize();\n                console.info('[]  ');\n            }\n            catch (error) {\n                console.error('[]  :', error);\n            }\n        }, 500);\n    });\n    // \n    if (DS.initialized) {\n        setTimeout(() => {\n            try {\n                StatusPanel.initialize();\n                console.info('[]  ');\n            }\n            catch (error) {\n                console.error('[]  :', error);\n            }\n        }, 500);\n    }\n    console.info('[]  v3.5.6 ()');\n});\n// \n$(window).on('pagehide', () => {\n    console.log('[] ...');\n    stopCommentListener();\n    stopUpdateLoop();\n});\nexport {};\n","export {};\n\ntype JQueryStaticLike = typeof globalThis extends { $: infer T } ? T : (selector: any) => any;\ndeclare const $: JQueryStaticLike;\n\n/**\n * \n *  API name\n */\n\ninterface WorldbookConfig {\n  name: string; // \n  displayName: string; // \n  priority: number; // \n  keywords: string[]; // \n  autoLoad: boolean; // \n  description?: string; // \n  position?: 'before_char' | 'after_char'; // \n  depth?: number; // \n  fallbackEntries?: unknown[]; // \n}\n\ninterface LoadedWorldbook {\n  name: string;\n  displayName: string;\n  entries: unknown[];\n  fallback: boolean;\n  error?: string;\n  loadedAt: number;\n}\n\ninterface WorldbookStatus {\n  initialized: boolean;\n  fallbackMode: boolean;\n  characterWorldbook: string | null;\n  loaded: Array<{\n    name: string;\n    displayName: string;\n    entries: number;\n    fallback: boolean;\n    error?: string;\n    loadedAt: string;\n  }>;\n  loading: Array<{\n    name: string;\n    displayName: string;\n  }>;\n  available: Array<{\n    name: string;\n    displayName: string;\n    autoLoad: boolean;\n  }>;\n}\n\ninterface EventBus {\n  on(event: string, callback: (data?: unknown) => void): void;\n  emit(event: string, data?: unknown): void;\n}\n\ninterface DetentionSystem {\n  version: string;\n  initialized: boolean;\n  modules: Record<string, unknown>;\n  config: Record<string, unknown>;\n  state: Record<string, unknown>;\n  events: EventBus;\n  CacheManager: unknown;\n  EventEmitter: unknown;\n  ping(): boolean;\n  registerModule(name: string, module: unknown): void;\n  getModule<T = unknown>(name: string): T | undefined;\n  handleError(error: unknown, context?: string): void;\n}\n\n// \nconst WORLDBOOKS: Record<string, WorldbookConfig> = {\n  detention_rules: {\n    name: 'detention_rules',\n    displayName: '',\n    description: '',\n    priority: 10,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: true,\n    position: 'before_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  internal_basic_procedures: {\n    name: 'internal_basic_procedures',\n    displayName: '',\n    description: '',\n    priority: 9,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'after_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  internal_basic_legal: {\n    name: 'internal_basic_legal',\n    displayName: '',\n    description:\n      '//',\n    priority: 8,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'before_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  legal_knowledge: {\n    name: 'legal_knowledge',\n    displayName: '',\n    description: '',\n    priority: 7,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'after_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  environment_descriptions: {\n    name: 'environment_descriptions',\n    displayName: '',\n    description: '',\n    priority: 6,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'before_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n  narrative_enhancements: {\n    name: 'narrative_enhancements',\n    displayName: '',\n    description: '',\n    priority: 5,\n    keywords: [\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n      '',\n    ],\n    autoLoad: false,\n    position: 'after_char',\n    depth: 4,\n    fallbackEntries: [],\n  },\n};\n\ninterface WorldbookLoaderImpl {\n  loaded: Map<string, LoadedWorldbook>;\n  loading: Map<string, Promise<LoadedWorldbook>>;\n  initialized: boolean;\n  fallbackMode: boolean;\n  characterWorldbookId: string | null;\n  failedBooks?: Set<string>; // \n\n  findCharacterWorldbook(): Promise<string | null>;\n  loadWorldbook(bookName: string): Promise<LoadedWorldbook>;\n  _loadWorldbookInternal(bookName: string, config: WorldbookConfig): Promise<LoadedWorldbook>;\n  predictiveCache(context: string): Promise<void>;\n  getRelevantEntries(context: string, maxEntries?: number): unknown[];\n  dynamicLoad(userInput: string): Promise<void>;\n  getStatus(): WorldbookStatus;\n  unloadWorldbook(bookName: string): Promise<void>;\n  reloadWorldbook(bookName: string): Promise<LoadedWorldbook>;\n  initialize(): Promise<void>;\n  shutdown(): void;\n}\n\nconsole.info('[] v5.1.0 ...');\n\n/**\n * \n */\nfunction safeGetWorldbookNames(): string[] {\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'worldbook_loader.ts:safeGetWorldbookNames',\n      message: '',\n      data: {\n        hasGlobalFn: typeof (window as any).getWorldbookNames !== 'undefined',\n        hasTavernHelper: typeof window !== 'undefined' && !!(window as any).TavernHelper,\n        hasTavernHelperFn:\n          typeof window !== 'undefined' &&\n          !!(window as any).TavernHelper &&\n          typeof (window as any).TavernHelper.getWorldbookNames === 'function',\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'initial',\n      hypothesisId: 'A',\n    }),\n  }).catch(() => {});\n  // #endregion\n\n  // A: \n  if (typeof (window as any).getWorldbookNames !== 'undefined') {\n    // #region agent log\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'worldbook_loader.ts:safeGetWorldbookNames',\n        message: '',\n        data: {},\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'initial',\n        hypothesisId: 'A',\n      }),\n    }).catch(() => {});\n    // #endregion\n    return (window as any).getWorldbookNames();\n  }\n\n  // B:  window.TavernHelper \n  if (typeof window !== 'undefined' && (window as any).TavernHelper) {\n    const helper = (window as any).TavernHelper;\n    if (typeof helper.getWorldbookNames === 'function') {\n      // #region agent log\n      fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          location: 'worldbook_loader.ts:safeGetWorldbookNames',\n          message: 'TavernHelper',\n          data: {},\n          timestamp: Date.now(),\n          sessionId: 'debug-session',\n          runId: 'initial',\n          hypothesisId: 'B',\n        }),\n      }).catch(() => {});\n      // #endregion\n      return helper.getWorldbookNames();\n    }\n  }\n\n  // #region agent log\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'worldbook_loader.ts:safeGetWorldbookNames',\n      message: '',\n      data: {\n        windowType: typeof window,\n        tavernHelperType: typeof window !== 'undefined' ? typeof (window as any).TavernHelper : 'N/A',\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'initial',\n      hypothesisId: 'C',\n    }),\n  }).catch(() => {});\n  // #endregion\n\n  throw new Error(\n    'getWorldbookNames ' +\n      ' Tavern Helper ' +\n      ' getWorldbookNames  window.TavernHelper ',\n  );\n}\n\n//  jQuery ready \n$(() => {\n  const DS_RAW = window.detentionSystem as DetentionSystem | undefined;\n  if (!DS_RAW) {\n    console.error('[] ');\n    console.error('[]  core.ts ');\n    return;\n  }\n\n  // DS \n  const DS = DS_RAW as DetentionSystem;\n\n  // \n  (DS as DetentionSystem & { characterId?: string }).characterId = 'detention_center';\n  console.info('[]  ');\n\n  // ==========  ==========\n  const WorldbookLoader: WorldbookLoaderImpl = {\n    loaded: new Map(),\n    loading: new Map(),\n    initialized: false,\n    fallbackMode: false,\n    characterWorldbookId: null,\n    // \n    failedBooks: new Set<string>(),\n\n    /**\n     * \n     */\n    async findCharacterWorldbook(): Promise<string | null> {\n      console.info('[] ...');\n\n      try {\n        const charWorldbooks = getCharWorldbookNames('current');\n        if (charWorldbooks.primary) {\n          console.info(`[]  : ${charWorldbooks.primary}`);\n          this.characterWorldbookId = charWorldbooks.primary;\n          return charWorldbooks.primary;\n        }\n\n        if (charWorldbooks.additional.length > 0) {\n          console.info(`[]  : ${charWorldbooks.additional[0]}`);\n          this.characterWorldbookId = charWorldbooks.additional[0];\n          return charWorldbooks.additional[0];\n        }\n\n        console.warn('[]  ');\n        return null;\n      } catch (error) {\n        console.error('[] :', error);\n        return null;\n      }\n    },\n\n    /**\n     * \n     */\n    async loadWorldbook(bookName: string): Promise<LoadedWorldbook> {\n      const config = WORLDBOOKS[bookName];\n      if (!config) {\n        throw new Error(`: ${bookName}`);\n      }\n\n      // \n      if (this.failedBooks?.has(bookName)) {\n        console.warn(`[]  ${config.displayName} `);\n        throw new Error(` \"${bookName}\" `);\n      }\n\n      // \n      if (this.loaded.has(bookName)) {\n        console.info(`[] ${config.displayName} `);\n        return this.loaded.get(bookName)!;\n      }\n\n      // \n      if (this.loading.has(bookName)) {\n        console.info(`[] ${config.displayName} ...`);\n        return await this.loading.get(bookName)!;\n      }\n\n      //  Promise\n      const loadPromise = this._loadWorldbookInternal(bookName, config);\n      this.loading.set(bookName, loadPromise);\n\n      try {\n        const result = await loadPromise;\n        this.loaded.set(bookName, result);\n        // \n        if (this.failedBooks?.has(bookName)) {\n          this.failedBooks.delete(bookName);\n          console.info(`[]  ${config.displayName} `);\n        }\n        return result;\n      } catch (error) {\n        //  _loadWorldbookInternal \n        throw error;\n      } finally {\n        this.loading.delete(bookName);\n      }\n    },\n\n    /**\n     * \n     */\n    async _loadWorldbookInternal(bookName: string, config: WorldbookConfig): Promise<LoadedWorldbook> {\n      console.info(`[] : ${config.displayName} (${bookName})`);\n\n      try {\n        // \n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'worldbook_loader.ts:_loadWorldbookInternal',\n            message: 'safeGetWorldbookNames',\n            data: { bookName, displayName: config.displayName },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'initial',\n            hypothesisId: 'A',\n          }),\n        }).catch(() => {});\n        // #endregion\n        const allWorldbookNames = safeGetWorldbookNames();\n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'worldbook_loader.ts:_loadWorldbookInternal',\n            message: 'safeGetWorldbookNames',\n            data: { count: allWorldbookNames.length, names: allWorldbookNames.slice(0, 5) },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'initial',\n            hypothesisId: 'A',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        // displayName\n        let targetWorldbookName: string | null = null;\n\n        // 1.  displayName- \n        const exactDisplayMatch = allWorldbookNames.find(name => name === config.displayName);\n        if (exactDisplayMatch) {\n          targetWorldbookName = exactDisplayMatch;\n          console.info(`[]  : \"${config.displayName}\"`);\n        } else if (allWorldbookNames.includes(config.name)) {\n          // 2.  name\n          targetWorldbookName = config.name;\n          console.info(`[]  : \"${config.name}\"`);\n        } else {\n          // 3.  displayName  name\n          const fuzzyMatch = allWorldbookNames.find(\n            name =>\n              name.includes(config.displayName) ||\n              config.displayName.includes(name) ||\n              name.includes(config.name) ||\n              config.name.includes(name),\n          );\n          if (fuzzyMatch) {\n            targetWorldbookName = fuzzyMatch;\n            console.info(`[]  : \"${fuzzyMatch}\"`);\n          }\n        }\n\n        if (!targetWorldbookName) {\n          const availableBooks = allWorldbookNames.join(', ');\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:_loadWorldbookInternal',\n              message: '',\n              data: {\n                bookName,\n                displayName: config.displayName,\n                availableBooks: allWorldbookNames,\n                searchingFor: config.name,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-getworldbook',\n              hypothesisId: 'E',\n            }),\n          }).catch(() => {});\n          // #endregion\n          throw new Error(\n            `: ${config.displayName} (${bookName})\\n` +\n              `: ${availableBooks}\\n` +\n              `:  displayName  name `,\n          );\n        }\n\n        // \n        // #region agent log\n        fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify({\n            location: 'worldbook_loader.ts:_loadWorldbookInternal',\n            message: 'getWorldbook',\n            data: {\n              targetWorldbookName,\n              bookName,\n              displayName: config.displayName,\n              allAvailableBooks: allWorldbookNames,\n            },\n            timestamp: Date.now(),\n            sessionId: 'debug-session',\n            runId: 'fix-getworldbook',\n            hypothesisId: 'A',\n          }),\n        }).catch(() => {});\n        // #endregion\n\n        let entries;\n        let worldbookData: unknown;\n        try {\n          worldbookData = await getWorldbook(targetWorldbookName);\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:_loadWorldbookInternal',\n              message: 'getWorldbook - ',\n              data: {\n                worldbookDataType: typeof worldbookData,\n                worldbookDataIsArray: Array.isArray(worldbookData),\n                worldbookDataIsObject: worldbookData && typeof worldbookData === 'object',\n                worldbookDataKeys:\n                  worldbookData && typeof worldbookData === 'object' ? Object.keys(worldbookData as object) : null,\n                worldbookDataHasEntriesProperty:\n                  worldbookData &&\n                  typeof worldbookData === 'object' &&\n                  !Array.isArray(worldbookData) &&\n                  'entries' in (worldbookData as object),\n                worldbookDataEntriesType:\n                  worldbookData &&\n                  typeof worldbookData === 'object' &&\n                  !Array.isArray(worldbookData) &&\n                  'entries' in (worldbookData as object)\n                    ? typeof (worldbookData as { entries?: unknown }).entries\n                    : null,\n                worldbookDataEntriesIsArray:\n                  worldbookData &&\n                  typeof worldbookData === 'object' &&\n                  !Array.isArray(worldbookData) &&\n                  'entries' in (worldbookData as object)\n                    ? Array.isArray((worldbookData as { entries?: unknown }).entries)\n                    : null,\n                targetWorldbookName,\n                bookName,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-entries-undefined',\n              hypothesisId: 'A',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          // getWorldbook  entries \n          //   entries Array.prototype.entries \n          if (Array.isArray(worldbookData)) {\n            // getWorldbook \n            entries = worldbookData;\n          } else if (\n            worldbookData &&\n            typeof worldbookData === 'object' &&\n            !Array.isArray(worldbookData) &&\n            'entries' in worldbookData &&\n            Array.isArray((worldbookData as { entries?: unknown }).entries)\n          ) {\n            // getWorldbook  entries \n            entries = (worldbookData as { entries: unknown[] }).entries;\n          } else {\n            // \n            entries = Array.isArray(worldbookData) ? worldbookData : [];\n          }\n\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:_loadWorldbookInternal',\n              message: 'getWorldbook - ',\n              data: {\n                entriesType: typeof entries,\n                entriesIsArray: Array.isArray(entries),\n                entriesLength: entries?.length,\n                entriesIsUndefined: entries === undefined,\n                entriesIsNull: entries === null,\n                entriesValue:\n                  entries === undefined || entries === null\n                    ? null\n                    : Array.isArray(entries)\n                      ? `Array(${entries.length})`\n                      : String(entries),\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-entries-undefined',\n              hypothesisId: 'B',\n            }),\n          }).catch(() => {});\n          // #endregion\n        } catch (getWorldbookError) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:_loadWorldbookInternal',\n              message: 'getWorldbook',\n              data: {\n                error: getWorldbookError instanceof Error ? getWorldbookError.message : String(getWorldbookError),\n                errorStack: getWorldbookError instanceof Error ? getWorldbookError.stack : undefined,\n                targetWorldbookName,\n                bookName,\n                displayName: config.displayName,\n                allAvailableBooks: allWorldbookNames,\n                errorType: typeof getWorldbookError,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-getworldbook',\n              hypothesisId: 'B',\n            }),\n          }).catch(() => {});\n          // #endregion\n\n          // \n          const errorMessage =\n            getWorldbookError instanceof Error ? getWorldbookError.message : String(getWorldbookError);\n          console.warn(\n            `[]  ${config.displayName}  (: ${targetWorldbookName}):`,\n            errorMessage,\n          );\n\n          //  map \n          const isDataFormatError =\n            errorMessage.includes('map') ||\n            errorMessage.includes('undefined') ||\n            errorMessage.includes('Cannot read properties');\n\n          if (isDataFormatError) {\n            console.warn(\n              `[]   \"${targetWorldbookName}\" `,\n            );\n            console.warn(`[]  : ${errorMessage}`);\n            console.warn(\n              `[]  : 1)  \"${targetWorldbookName}\"  2)  3) `,\n            );\n\n            // \n            if (this.failedBooks) {\n              this.failedBooks.add(bookName);\n              console.warn(`[]   \"${bookName}\" `);\n              // #region agent log\n              fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({\n                  location: 'worldbook_loader.ts:_loadWorldbookInternal',\n                  message: '',\n                  data: {\n                    bookName,\n                    displayName: config.displayName,\n                    targetWorldbookName,\n                    errorMessage,\n                    isDataFormatError,\n                    failedBooksSize: this.failedBooks.size,\n                    failedBooksArray: Array.from(this.failedBooks),\n                  },\n                  timestamp: Date.now(),\n                  sessionId: 'debug-session',\n                  runId: 'fix-getworldbook',\n                  hypothesisId: 'E',\n                }),\n              }).catch(() => {});\n              // #endregion\n            }\n          }\n\n          // \n          const detailedError = new Error(\n            `: ${errorMessage}\\n` +\n              `: ${targetWorldbookName}\\n` +\n              `: ${bookName} (${config.displayName})\\n` +\n              `: ${isDataFormatError ? '' : ''}\\n` +\n              `: ${isDataFormatError ? '' : ''}`,\n          );\n          throw detailedError;\n        }\n\n        // \n        if (entries === undefined || entries === null) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:_loadWorldbookInternal',\n              message: 'entriesnullundefined',\n              data: {\n                entriesType: typeof entries,\n                entriesValue: entries,\n                worldbookDataType: typeof worldbookData,\n                worldbookDataValue: worldbookData,\n                targetWorldbookName,\n                bookName,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-entries-undefined',\n              hypothesisId: 'C',\n            }),\n          }).catch(() => {});\n          // #endregion\n          throw new Error(\n            ` \"${targetWorldbookName}\"  (undefined/null)\\n` +\n              `: ${typeof worldbookData}\\n` +\n              `:  entries `,\n          );\n        }\n\n        if (!Array.isArray(entries)) {\n          // #region agent log\n          fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({\n              location: 'worldbook_loader.ts:_loadWorldbookInternal',\n              message: 'entries',\n              data: {\n                entriesType: typeof entries,\n                entriesConstructor:\n                  entries && typeof entries === 'object' && 'constructor' in entries\n                    ? (entries as any).constructor?.name\n                    : undefined,\n                entriesValue: entries,\n                worldbookDataType: typeof worldbookData,\n                worldbookDataKeys:\n                  worldbookData && typeof worldbookData === 'object' ? Object.keys(worldbookData as object) : null,\n                targetWorldbookName,\n                bookName,\n              },\n              timestamp: Date.now(),\n              sessionId: 'debug-session',\n              runId: 'fix-entries-undefined',\n              hypothesisId: 'D',\n            }),\n          }).catch(() => {});\n          // #endregion\n          throw new Error(\n            ` \"${targetWorldbookName}\"  (: ${typeof entries})\\n` +\n              `: ${typeof worldbookData}\\n` +\n              `: getWorldbook  entries  entries `,\n          );\n        }\n\n        if (entries.length === 0) {\n          throw new Error('');\n        }\n\n        // \n        const charWorldbooks = getCharWorldbookNames('current');\n        if (!charWorldbooks.additional.includes(targetWorldbookName)) {\n          await rebindCharWorldbooks('current', {\n            primary: charWorldbooks.primary,\n            additional: [...charWorldbooks.additional, targetWorldbookName],\n          });\n          console.info(`[]  : ${targetWorldbookName}`);\n        }\n\n        console.info(`[]  ${config.displayName}  (${entries.length} )`);\n\n        return {\n          name: bookName,\n          displayName: config.displayName,\n          entries: entries,\n          fallback: false,\n          loadedAt: Date.now(),\n        };\n      } catch (error) {\n        const errorMessage = error instanceof Error ? error.message : String(error);\n        console.warn(`[]  ${config.displayName} :`, errorMessage);\n\n        // \n        if (config.fallbackEntries && config.fallbackEntries.length > 0) {\n          console.info(`[]  ${config.displayName}  (${config.fallbackEntries.length} )`);\n          this.fallbackMode = true;\n\n          return {\n            name: bookName,\n            displayName: config.displayName,\n            entries: config.fallbackEntries,\n            fallback: true,\n            error: errorMessage,\n            loadedAt: Date.now(),\n          };\n        }\n\n        throw error;\n      }\n    },\n\n    /**\n     * \n     */\n    async predictiveCache(context: string): Promise<void> {\n      if (!context || typeof context !== 'string') {\n        return;\n      }\n\n      console.info('[] ...');\n\n      const predictions: Array<{ bookName: string; score: number; priority: number; weightedScore: number }> = [];\n\n      for (const bookName in WORLDBOOKS) {\n        const config = WORLDBOOKS[bookName];\n\n        if (this.loaded.has(bookName)) {\n          continue;\n        }\n\n        let matchScore = 0;\n        let weightedScore = 0;\n\n        // \n        for (const keyword of config.keywords) {\n          if (context.includes(keyword)) {\n            matchScore++;\n            // \n            const keywordWeight = keyword.length >= 3 ? 2 : 1;\n            weightedScore += keywordWeight;\n\n            // \n            if (config.description && config.description.includes(keyword)) {\n              weightedScore += 1;\n            }\n          }\n        }\n\n        // \n        if (config.description) {\n          const descKeywords = config.description.match(/[\\u4e00-\\u9fa5]{2,}/g) || [];\n          for (const descKw of descKeywords) {\n            if (context.includes(descKw) && descKw.length >= 2) {\n              weightedScore += 0.5;\n            }\n          }\n        }\n\n        if (matchScore > 0) {\n          //  =  * 10 + \n          const finalScore = config.priority * 10 + weightedScore;\n\n          predictions.push({\n            bookName,\n            score: matchScore,\n            priority: config.priority,\n            weightedScore: finalScore,\n          });\n        }\n      }\n\n      // \n      predictions.sort((a, b) => {\n        if (Math.abs(b.weightedScore - a.weightedScore) > 1) {\n          return b.weightedScore - a.weightedScore;\n        }\n        if (b.priority !== a.priority) {\n          return b.priority - a.priority;\n        }\n        return b.score - a.score;\n      });\n\n      console.info(`[]  ${predictions.length} `);\n\n      // 1>10\n      const toLoad = predictions.filter(p => p.weightedScore > 10).slice(0, 3);\n\n      if (toLoad.length === 0) {\n        console.info('[] ');\n        return;\n      }\n\n      for (const pred of toLoad) {\n        // \n        if (this.failedBooks?.has(pred.bookName)) {\n          console.debug(`[] : ${WORLDBOOKS[pred.bookName].displayName}`);\n          continue;\n        }\n\n        console.info(\n          `[] : ${WORLDBOOKS[pred.bookName].displayName} ` +\n            `(: ${pred.score}, : ${pred.weightedScore.toFixed(1)})`,\n        );\n\n        try {\n          await this.loadWorldbook(pred.bookName);\n        } catch (error) {\n          const errorMessage = error instanceof Error ? error.message : String(error);\n          console.warn(`[] : ${pred.bookName}`, errorMessage);\n          //  loadWorldbook \n        }\n      }\n    },\n\n    /**\n     * \n     */\n    getRelevantEntries(context: string, maxEntries: number = 5): unknown[] {\n      if (!context || typeof context !== 'string') {\n        return [];\n      }\n\n      const allEntries: Array<{ entry: unknown; bookName: string; bookDisplayName: string; priority: number }> = [];\n\n      this.loaded.forEach((bookData, bookName) => {\n        if (bookData.entries && Array.isArray(bookData.entries)) {\n          for (const entry of bookData.entries) {\n            allEntries.push({\n              entry,\n              bookName: bookName,\n              bookDisplayName: bookData.displayName,\n              priority: WORLDBOOKS[bookName]?.priority || 0,\n            });\n          }\n        }\n      });\n\n      const scoredEntries = allEntries.map(item => {\n        let score = 0;\n        const entry = item.entry as {\n          keys?: string[];\n          key?: string[];\n          constant?: boolean;\n          name?: string;\n          content?: string;\n        };\n        const keys = entry.keys || entry.key || [];\n\n        // \n        for (const key of keys) {\n          if (context.includes(key)) {\n            const keyWeight = key.length >= 3 ? 15 : 10;\n            score += keyWeight;\n\n            // \n            if (entry.name && entry.name.includes(key)) {\n              score += 5;\n            }\n          }\n        }\n\n        // \n        if (entry.name && context.includes(entry.name)) {\n          score += 20;\n        }\n\n        // \n        if (entry.content) {\n          const contentMatch = entry.content.substring(0, 100);\n          if (context.includes(contentMatch.substring(0, 10))) {\n            score += 3;\n          }\n        }\n\n        // \n        score += item.priority || 0;\n\n        // \n        if (entry.constant) {\n          score += 30;\n        }\n\n        return {\n          entry: item.entry,\n          score,\n          bookName: item.bookName,\n          bookDisplayName: item.bookDisplayName,\n        };\n      });\n\n      // \n      scoredEntries.sort((a, b) => {\n        if (Math.abs(b.score - a.score) > 5) {\n          return b.score - a.score;\n        }\n        // \n        const aPriority = WORLDBOOKS[a.bookName]?.priority || 0;\n        const bPriority = WORLDBOOKS[b.bookName]?.priority || 0;\n        return bPriority - aPriority;\n      });\n\n      const relevant = scoredEntries\n        .filter(item => item.score > 0)\n        .slice(0, maxEntries)\n        .map(item => item.entry);\n\n      if (relevant.length > 0) {\n        console.info(\n          `[]  ${relevant.length}  ` +\n            `(: ${scoredEntries[0]?.score || 0}, : ${scoredEntries[0]?.bookDisplayName || ''})`,\n        );\n      }\n\n      return relevant;\n    },\n\n    /**\n     * \n     */\n    async dynamicLoad(userInput: string): Promise<void> {\n      if (!userInput || typeof userInput !== 'string' || userInput.length < 3) {\n        return;\n      }\n\n      console.info('[] ...');\n\n      const triggers: Array<{\n        bookName: string;\n        keyword: string;\n        priority: number;\n        matchCount: number;\n        score: number;\n      }> = [];\n\n      for (const bookName in WORLDBOOKS) {\n        const config = WORLDBOOKS[bookName];\n\n        if (this.loaded.has(bookName)) {\n          continue;\n        }\n\n        let matchCount = 0;\n        let bestKeyword = '';\n        let maxKeywordLength = 0;\n\n        // \n        for (const keyword of config.keywords) {\n          if (userInput.includes(keyword)) {\n            matchCount++;\n            if (keyword.length > maxKeywordLength) {\n              maxKeywordLength = keyword.length;\n              bestKeyword = keyword;\n            }\n          }\n        }\n\n        // \n        if (matchCount > 0) {\n          //  =  * 10 +  * 2 + \n          const score = config.priority * 10 + matchCount * 2 + maxKeywordLength;\n\n          triggers.push({\n            bookName,\n            keyword: bestKeyword,\n            priority: config.priority,\n            matchCount,\n            score,\n          });\n        }\n      }\n\n      if (triggers.length === 0) {\n        console.info('[] ');\n        return;\n      }\n\n      // \n      triggers.sort((a, b) => {\n        if (Math.abs(b.score - a.score) > 2) {\n          return b.score - a.score;\n        }\n        return b.priority - a.priority;\n      });\n\n      console.info(`[]  ${triggers.length} `);\n\n      // 3\n      const toLoad = triggers.slice(0, 3);\n\n      for (const trigger of toLoad) {\n        console.info(\n          `[] : ${WORLDBOOKS[trigger.bookName].displayName} ` +\n            `(: ${trigger.keyword}, : ${trigger.matchCount}, : ${trigger.score})`,\n        );\n\n        try {\n          await this.loadWorldbook(trigger.bookName);\n        } catch (error) {\n          console.warn(`[] : ${trigger.bookName}`, error);\n        }\n      }\n    },\n\n    /**\n     * \n     */\n    getStatus(): WorldbookStatus {\n      const status: WorldbookStatus = {\n        initialized: this.initialized,\n        fallbackMode: this.fallbackMode,\n        characterWorldbook: this.characterWorldbookId,\n        loaded: [],\n        loading: [],\n        available: [],\n      };\n\n      this.loaded.forEach((data, name) => {\n        status.loaded.push({\n          name: name,\n          displayName: data.displayName,\n          entries: data.entries.length,\n          fallback: data.fallback,\n          error: data.error,\n          loadedAt: new Date(data.loadedAt).toLocaleTimeString(),\n        });\n      });\n\n      this.loading.forEach((_promise, name) => {\n        status.loading.push({\n          name: name,\n          displayName: WORLDBOOKS[name]?.displayName || name,\n        });\n      });\n\n      for (const bookName in WORLDBOOKS) {\n        if (!this.loaded.has(bookName) && !this.loading.has(bookName)) {\n          status.available.push({\n            name: bookName,\n            displayName: WORLDBOOKS[bookName].displayName,\n            autoLoad: WORLDBOOKS[bookName].autoLoad,\n          });\n        }\n      }\n\n      return status;\n    },\n\n    /**\n     * \n     */\n    async unloadWorldbook(bookName: string): Promise<void> {\n      if (!this.loaded.has(bookName)) {\n        console.warn(`[] ${bookName} `);\n        return;\n      }\n\n      console.info(`[] : ${WORLDBOOKS[bookName]?.displayName || bookName}`);\n\n      // \n      const charWorldbooks = getCharWorldbookNames('current');\n      const loadedData = this.loaded.get(bookName);\n      if (loadedData) {\n        // \n        const allWorldbookNames = safeGetWorldbookNames();\n        const targetName = allWorldbookNames.find(name => name === bookName || name.includes(bookName));\n\n        if (targetName) {\n          const newAdditional = charWorldbooks.additional.filter(name => name !== targetName);\n          await rebindCharWorldbooks('current', {\n            primary: charWorldbooks.primary,\n            additional: newAdditional,\n          });\n        }\n      }\n\n      this.loaded.delete(bookName);\n    },\n\n    /**\n     * \n     */\n    async reloadWorldbook(bookName: string): Promise<LoadedWorldbook> {\n      console.info(`[] : ${WORLDBOOKS[bookName]?.displayName || bookName}`);\n      await this.unloadWorldbook(bookName);\n      return await this.loadWorldbook(bookName);\n    },\n\n    /**\n     * \n     */\n    async initialize(): Promise<void> {\n      if (this.initialized) {\n        console.info('[] ');\n        return;\n      }\n\n      console.info('[] ...');\n\n      await this.findCharacterWorldbook();\n\n      // \n      let retries = 0;\n      let availableWorldbooks: string[] = [];\n      while (retries < 40) {\n        try {\n          availableWorldbooks = safeGetWorldbookNames();\n          if (availableWorldbooks.length > 0) {\n            console.info(`[]   (${availableWorldbooks.length} )`);\n            console.info(`[] : ${availableWorldbooks.join(', ')}`);\n            break;\n          }\n        } catch (error) {\n          // \n        }\n\n        console.info(`[] ... (${retries + 1}/40)`);\n        await new Promise(resolve => setTimeout(resolve, 500));\n        retries++;\n      }\n\n      // \n      console.info('[] :');\n      for (const bookName in WORLDBOOKS) {\n        const config = WORLDBOOKS[bookName];\n        const isAvailable = availableWorldbooks.some(\n          name => name === config.displayName || name === config.name || name.includes(config.displayName),\n        );\n        console.info(\n          `  - ${config.displayName} (${bookName}): ` +\n            `=${config.priority}, ` +\n            `=${config.autoLoad ? '' : ''}, ` +\n            `=${isAvailable ? '' : ''}`,\n        );\n      }\n\n      // \n      const autoLoadBooks: string[] = [];\n      for (const bookName in WORLDBOOKS) {\n        if (WORLDBOOKS[bookName].autoLoad) {\n          autoLoadBooks.push(bookName);\n        }\n      }\n\n      console.info(`[]  ${autoLoadBooks.length} `);\n\n      for (const bookName of autoLoadBooks) {\n        try {\n          await this.loadWorldbook(bookName);\n        } catch (err) {\n          console.warn(`[] : ${bookName}`, err);\n        }\n      }\n\n      this.initialized = true;\n\n      const status = this.getStatus();\n      console.info('[]  ');\n      console.table(status.loaded);\n\n      // \n      if (this.fallbackMode) {\n        console.warn('[]  ');\n        console.warn('[]  ');\n        console.warn('[]  ');\n\n        const fallbackBooks = status.loaded.filter(b => b.fallback);\n        console.table(fallbackBooks);\n\n        // 3\n        setTimeout(() => {\n          console.info('[] ...');\n          this.shutdown();\n        }, 3000);\n      } else {\n        console.info('[]  ');\n      }\n    },\n\n    /**\n     * \n     */\n    shutdown(): void {\n      console.info('[] ...');\n\n      // \n      this.loaded.clear();\n      this.loading.clear();\n\n      // \n      delete (DS as DetentionSystem & { loadWorldbook?: unknown }).loadWorldbook;\n      delete (DS as DetentionSystem & { unloadWorldbook?: unknown }).unloadWorldbook;\n      delete (DS as DetentionSystem & { reloadWorldbook?: unknown }).reloadWorldbook;\n      delete (DS as DetentionSystem & { predictiveCache?: unknown }).predictiveCache;\n      delete (DS as DetentionSystem & { getRelevantEntries?: unknown }).getRelevantEntries;\n      delete (DS as DetentionSystem & { getWorldbookStatus?: unknown }).getWorldbookStatus;\n      delete (DS as DetentionSystem & { dynamicLoad?: unknown }).dynamicLoad;\n\n      this.initialized = false;\n      this.fallbackMode = false;\n\n      console.info('[]  ');\n      console.info('[] ');\n    },\n  };\n\n  // ==========  ==========\n  (\n    DS as DetentionSystem & {\n      loadWorldbook?: (bookName: string) => Promise<LoadedWorldbook>;\n      unloadWorldbook?: (bookName: string) => Promise<void>;\n      reloadWorldbook?: (bookName: string) => Promise<LoadedWorldbook>;\n      predictiveCache?: (context: string) => Promise<void>;\n      dynamicLoad?: (userInput: string) => Promise<void>;\n      getRelevantEntries?: (context: string, max?: number) => unknown[];\n      getWorldbookStatus?: () => WorldbookStatus;\n    }\n  ).loadWorldbook = (bookName: string) => WorldbookLoader.loadWorldbook(bookName);\n  (DS as DetentionSystem & { unloadWorldbook?: (bookName: string) => Promise<void> }).unloadWorldbook = (\n    bookName: string,\n  ) => WorldbookLoader.unloadWorldbook(bookName);\n  (DS as DetentionSystem & { reloadWorldbook?: (bookName: string) => Promise<LoadedWorldbook> }).reloadWorldbook = (\n    bookName: string,\n  ) => WorldbookLoader.reloadWorldbook(bookName);\n  (DS as DetentionSystem & { predictiveCache?: (context: string) => Promise<void> }).predictiveCache = (\n    context: string,\n  ) => WorldbookLoader.predictiveCache(context);\n  (DS as DetentionSystem & { dynamicLoad?: (userInput: string) => Promise<void> }).dynamicLoad = (userInput: string) =>\n    WorldbookLoader.dynamicLoad(userInput);\n  (DS as DetentionSystem & { getRelevantEntries?: (context: string, max?: number) => unknown[] }).getRelevantEntries = (\n    context: string,\n    max?: number,\n  ) => WorldbookLoader.getRelevantEntries(context, max);\n  (DS as DetentionSystem & { getWorldbookStatus?: () => WorldbookStatus }).getWorldbookStatus = () =>\n    WorldbookLoader.getStatus();\n\n  DS.registerModule('worldbook', WorldbookLoader);\n\n  // iframe \n  try {\n    if (window.parent && window.parent !== window) {\n      (window.parent as any).detentionSystem = DS;\n      console.info('[]  ');\n    }\n  } catch (e) {\n    // \n  }\n\n  console.info('[]  ');\n\n  // ==========  ==========\n  DS.events.on('event_triggered', (eventData?: unknown) => {\n    const event = eventData as { id?: string; description?: string } | undefined;\n    if (event?.description) {\n      WorldbookLoader.predictiveCache(event.description).catch(err => {\n        console.warn('[] :', err);\n      });\n    }\n  });\n\n  // ==========  ==========\n  DS.events.on('user_input', (data?: unknown) => {\n    const input = data as { text?: string } | undefined;\n    if (input?.text && input.text.length > 5) {\n      WorldbookLoader.dynamicLoad(input.text).catch(err => {\n        console.warn('[] :', err);\n      });\n    }\n  });\n\n  // ==========  ==========\n  $(() => {\n    console.info('[] ...');\n\n    // 2\n    setTimeout(async () => {\n      console.info('[] ...');\n\n      try {\n        await WorldbookLoader.initialize();\n        console.info('[]  ');\n      } catch (error) {\n        console.error('[]  :', error);\n        console.info('[]  : window.initWorldbookLoader()');\n      }\n    }, 2000);\n  });\n\n  // ==========  ==========\n  (window as typeof window & { initWorldbookLoader?: () => Promise<WorldbookStatus> }).initWorldbookLoader =\n    async function () {\n      console.info('[] ...');\n\n      if (WorldbookLoader.initialized) {\n        console.info('[] ');\n        return WorldbookLoader.getStatus();\n      }\n\n      try {\n        await WorldbookLoader.initialize();\n        console.info('[]  ');\n        return WorldbookLoader.getStatus();\n      } catch (error) {\n        console.error('[]  :', error);\n        throw error;\n      }\n    };\n\n  console.info('[]  ');\n  console.info('[]  : window.initWorldbookLoader()');\n});\n","/**\n *  - \n * NPC\n *\n * \n * 1.  (core.ts) - \n * 2.  (status_panel.ts) - HTML\n * 3.  (event_system.ts) - \n * 4. NPC (npc_system.ts) - NPC\n * 5.  (worldbook_loader.ts) - \n */\n\n// #region agent log - HYP-A: \ntry {\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'index.ts:',\n      message: '',\n      data: {\n        windowExists: typeof window !== 'undefined',\n        windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n        windowDetentionSystemType: typeof window.detentionSystem,\n        userAgent: typeof navigator !== 'undefined' ? navigator.userAgent : 'N/A',\n        isIframe: typeof window !== 'undefined' && window.parent !== window,\n        currentUrl: typeof window !== 'undefined' && window.location ? window.location.href : 'N/A',\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'script-load-debug',\n      hypothesisId: 'A',\n    }),\n  }).catch(e => {\n    console.error('[] :', e);\n  });\n} catch (e) {\n  console.error('[] :', e);\n}\n// #endregion\n\n// \nconsole.info(' [] ');\n// \n(window as any).__DETENTION_SYSTEM_LOADED__ = true;\n(window as any).__DETENTION_SYSTEM_LOADED_TIMESTAMP__ = Date.now();\nconsole.log('[DEBUG-HYP-A] index.ts:13 - ', {\n  timestamp: Date.now(),\n  windowExists: typeof window !== 'undefined',\n  windowDetentionSystem: typeof window.detentionSystem,\n  location: 'index.ts:13',\n  hypothesisId: 'A',\n});\nconsole.info('[] ...');\nconsole.info('[] ');\n\n// #region agent log - HYP-B: \ntry {\n  fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({\n      location: 'index.ts:',\n      message: '',\n      data: {\n        windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n      },\n      timestamp: Date.now(),\n      sessionId: 'debug-session',\n      runId: 'script-load-debug',\n      hypothesisId: 'B',\n    }),\n  }).catch(() => {});\n} catch (e) {\n  console.error('[] :', e);\n}\n// #endregion\n\n// \nimport './core';\nimport './event_system';\nimport './npc_system';\nimport './status_panel';\nimport './worldbook_loader';\n\n// #region agent log - HYP-C: \nsetTimeout(() => {\n  try {\n    fetch('http://127.0.0.1:7242/ingest/55a7313b-5b61-43ef-bdc3-1a322b93db66', {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        location: 'index.ts:',\n        message: 'window.detentionSystem',\n        data: {\n          windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n          windowDetentionSystemType: typeof window.detentionSystem,\n          hasPing:\n            typeof window.detentionSystem !== 'undefined' && typeof (window.detentionSystem as any).ping === 'function',\n          pingResult:\n            typeof window.detentionSystem !== 'undefined' && typeof (window.detentionSystem as any).ping === 'function'\n              ? (window.detentionSystem as any).ping()\n              : 'N/A',\n          version:\n            typeof window.detentionSystem !== 'undefined' && (window.detentionSystem as any).version\n              ? (window.detentionSystem as any).version\n              : 'N/A',\n        },\n        timestamp: Date.now(),\n        sessionId: 'debug-session',\n        runId: 'script-load-debug',\n        hypothesisId: 'C',\n      }),\n    }).catch(() => {});\n  } catch (e) {\n    console.error('[] :', e);\n  }\n}, 100);\n// #endregion\n\nconsole.log('[DEBUG-HYP-A] index.ts:22 - ', {\n  timestamp: Date.now(),\n  windowDetentionSystemExists: typeof window.detentionSystem !== 'undefined',\n  windowDetentionSystemType: typeof window.detentionSystem,\n  windowDetentionSystemValue: window.detentionSystem ? 'object' : 'undefined',\n  location: 'index.ts:22',\n  hypothesisId: 'A',\n});\nconsole.info('[] ');\nconsole.log(' [] ');\nconsole.log(' window.detentionSystem:', typeof window.detentionSystem !== 'undefined' ? ' ' : ' ');\n"],"names":["console","info","EventEmitter","events","Map","on","event","callback","this","has","set","get","push","off","callbacks","index","indexOf","splice","emit","data","forEach","cb","error","once","wrapper","cacheStore","cacheCleanupTimer","bootstrapDetentionSystem","log","timestamp","Date","now","location","hypothesisId","CacheManager","key","value","ttl","expiry","item","delete","clear","cleanup","entries","eventsType","cacheManagerType","system","version","initialized","modules","config","tokenBudget","fallbackBudget","compressionQuality","cacheExpiry","healthCheckInterval","healthCheckTimeout","state","mode","tokenUsed","lastHealthCheck","errors","ping","checkTokenBudget","total","used","percentage","status","toFixed","remaining","updateTokenUsage","tokens","budget","warn","compressContent","content","quality","text","JSON","stringify","actualQuality","compressed","replace","trim","originalSize","length","compressedSize","ratio","registerModule","name","module","window","parent","detentionSystem","DS","e","getModule","handleError","context","normalized","Error","normalizeError","errorInfo","message","stack","shift","detectEnvironment","env","isSillyTavern","hasHelper","helperVersion","hasDataTable","SillyTavern","$","getTavernVersion","getTavernHelperVersion","windowWithTable","insertRow","updateRow","initialize","initializeState","systemType","systemExists","hasVersion","hasModules","hasEvents","systemVersion","windowExists","windowDetentionSystemExists","existingType","fetch","method","headers","body","windowType","isIframe","parentExists","sessionId","runId","catch","hasWindowDetentionSystem","hasPing","pingResult","hasInitializeState","resultType","resultExists","__DETENTION_SYSTEM_CORE_LOADED__","__DETENTION_SYSTEM_VERSION__","hasParent","parentIsDifferent","parentHasDetentionSystem","parentHasDS","String","errorType","constructor","debug","errorStack","undefined","jQueryExists","jQueryType","exists","setInterval","ensureCacheCleanup","setTimeout","modulesCount","Object","keys","moduleNames","clearInterval","skipMessageId","skipCommandMessages","Set","eventMakeFirst","tavern_events","USER_MESSAGE_RENDERED","async","message_id","userMessage","getChatMessages","role","userInput","messageData","isSystemEventMessage","isSystemByContent","startsWith","includes","substring","waitingForEventResponse","duringGenerating","builtin","stopAllGeneration","afterStopDuringGenerating","skipDayPattern","match","setChatMessages","is_hidden","refresh","add","eventOn","GENERATE_BEFORE_COMBINE_PROMPTS","size","messages","lastUserMessage","lastTriggerTime","lastTriggerEventName","generationTracking","iframe_events","GENERATION_STARTED","generation_id","type","triggerTime","eventName","source","timeSinceLastTrigger","trackingCount","stopGenerationById","then","success","options","dry_run","aiMessageTracking","CHARACTER_MESSAGE_RENDERED","aiMessage","messageText","some","m","messageLength","messagePreview","allMessageIds","map","allMessages","id","totalCharacters","reduce","sum","recentMessages","filter","Math","abs","timeDiff","relatedMessages","timeGaps","sort","a","b","i","arr","gap","messageIds","lengths","totalLength","messageCount","timeSinceTrigger","timeSincePrevious","preview","averageLength","potentialSplit","MESSAGE_SENT","messageIdType","find","Number","matchedByData","matchedByContent","messagesCount","foundMessage","hasMessage","matchedPattern","currentMessageId","isSystemMessage","protagonistPattern","protagonistMatch","DS_PROTAGONIST","npcSystem","generateProtagonist","crimeType","excludeCrimes","background","isIntellectual","isAcademic","isBusiness","ageRange","education","hasGenerateProtagonist","protagonistData","hasProtagonistData","protagonistName","protagonistAge","age","protagonistCrime","crime","chatId","getCurrentChatId","protagonistInfo","appearance","height","weight","hair","skin","features","personality","replaceVariables","protagonist","protagonist_name","protagonist_age","protagonist_crime","skipDayMatch","DS_CHECK","advanceDay","daysToSkip","numStr","parsed","parseInt","isNaN","chineseDigits","result","rest","slice","endsWith","prefix","shiIndex","before","after","parseNumber","originalInput","waitForGenerationToStop","Promise","resolve","resolved","eventReturn","stop","eventOnce","GENERATION_ENDED","clearTimeout","timeout","finalCheckCount","forcedStop","stopError","existingMessage","hideError","worldbookLoader","loadWorldbook","all","err","loadError","interrupted","eventDay","day","tempCurrentDay","currentDay","eventPriority","priority","willWaitForEventTriggered","pendingDays","eventSystem","confirmDayAdvancement","finalDay","createChatMessages","createError","DS_EMIT","DS_EVENT","eventData","hasEvent","eventId","eventText","description","npcInfoText","hasGenerateNPCForEvent","generateNPCForEvent","hasGetCurrentCellNPCs","getCurrentCellNPCs","eventNPC","npcType","Array","isArray","npcName","npc","rank","relation","sceneData","policeDesc","police","witnesses","w","join","npcError","eventSystemModule","targetCellType","to","cellType","hasGenerateNPC","generateNPC","hasSetCurrentCellNPCs","setCurrentCellNPCs","npcCount","floor","random","newNPCs","npcNames","Boolean","cellBoss","max","relationship","influence","otherNPCs","cellBossName","cellNPCError","eventCategory","category","cellNPCs","initialNPCCount","initialNPCs","min","hasNPCInfo","npcInfoLength","finalUserInput","userInputLength","beforeCreateChatMessages","createPromise","createPromisePending","afterCreateChatMessages","afterDelay","eventMessageId","getLastMessageId","generationStartedReturn","generationEndedReceived","generationStartedCount","waitForGenerationToComplete","timeoutHandle","forceStopAttempts","beforeTriggerDuringGenerating","messagesBeforeTrigger","lastAssistantMessage","assistantMessages","lastAssistant","lastAssistantMessageId","lastAssistantMessageLength","lastAssistantMessagePreview","potentiallyIncompleteMessage","messageIdsBeforeTrigger","warning","triggerSlash","afterTriggerTime","messagesAfterTrigger","newMessages","generationsTriggered","afterTriggerDuringGenerating","messagesBeforeCount","messagesAfterCount","newMessagesCount","newMessageIds","newAssistantMessages","immediatelyCreatedAssistantMessages","generationEndHandler","endTime","messageIdMatched","messageEndContent","messageEndLength","messageEnd","message5Content","message5Length","message5Preview","message5","message5ContainsEventContent","message5ContainsSystemEvent","contentUpdatedToMessage5","allAssistantMessages","msg","tracked","t","generationEndMessageId","generationsTracked","generationIds","g","relatedMessagesCount","relatedMessageIds","totalCharactersInRelatedMessages","messageEndExists","messageEndPreview","message5Exists","allAssistantMessagesCount","allAssistantMessageIds","assistantMessagesAfterTriggerTime","potentialMessageSplit","allTrackedMessages","nearbyMessages","actualMessageId","expectedMessageId","trackedMessageIds","rootCause","optimization","eventWithPending","pendingDayAdvancement","saveStateToChatVars","saveEventInterruptSnapshot","generationStoppedHandler","GENERATION_STOPPED","rollbackToInterruptSnapshot","toLocaleTimeString","systemCheck","DS_RAW","saveStateTimer","getCurrentDayFromMemoryEnhancement","fallback","statusPanel","getState","days","dayFromMemory","hasStatusPanel","stateHasDays","stateHasDay","hasGetState","EventSystem","getCurrentDayInternal","lastEventDay","eventHistory","legalTimeline","arrestDay","approvalDay","prosecutionDay","firstTrialDay","firstVerdictDay","secondTrialDay","finalVerdictDay","transferDay","executionDay","currentStage","caseComplexity","complexityMultiplier","eventCounters","interrogation","prosecutor_interrogation","lawyer_visit","family_visit","medical_visit","scene_identification","isDeathPenalty","lastStageChangeDay","assignedOfficers","prosecutor","PRIORITY","LEGAL","PROCEDURAL","CONDITION","RANDOM","DAILY","legalEvents","approval","minDay","maxDay","stage","nextStage","investigation","duration","prosecution","firstTrial","firstVerdict","appeal","secondTrial","finalVerdict","transfer","deathReview","execution","conditionEvents","condition","mental","checkAlways","health","_state","stageChangeOnly","daysInCustody","minDays","maxDays","remainingDays","requiredTriggers","interrogationCount","forcedProbability","shouldTrigger","daysSinceApproval","baseProbability","finalProbability","pow","daysToTrial","daysToTrial2","lastVisit","probability","lastMedical","recentContext","getRecentContext","kw","aiControlled","randomEvents","violence","medical","emotional","accident","innerMonologues","startDay","hasChatId","chatVars","getVariables","getVarsError","savedData","detentionSystemState","savedPolice","policeArray","currentChatId","stateData","stateDataSize","eventHistoryLength","stateDataStr","truncatedStateData","truncatedSize","originalHistoryLength","truncatedHistoryLength","testChatVars","hasChatVars","chatVarsType","testError","updateVariablesWith","variables","setCaseComplexity","complexity","validComplexities","simple","normal","complex","very_complex","multiplier","checkComplexityAdjustment","rollbackToStage","targetStage","reason","stageOrder","targetIndex","currentIndex","timelineKeys","trial1","trial2","from","advanceToStage","handleUserRollback","input","rollbackPatterns","pattern","rule","daysType","daysToAdvance","dayIndex","daysRemaining","willCheckDay0","originalCurrentDay","currentDayBeforeCheck","willSkipDay0","dayEvent","checkDayEvents","isDay0Event","prototype","hasOwnProperty","call","shouldInterrupt","PRIORITY_RANDOM","accumulatedEventsCount","daysSkipped","daysAdvanced","eventsCount","hasInterruptedEvent","interruptedEvent","shouldSkipDay0","currentDate","month","getMonth","getDate","checkCellTransfer","cellTypeNames","transition","pretrial","convicted","legalEvent","checkLegalEvent","conditionEvent","checkConditionEvent","isProcedural","policeNames","prosecutorNames","usedNames","availableNames","selectedName","hasApproval","beforeFirstTrial","isInvestigationOrProsecution","assignedPolice","assignedProsecutor","randomEvent","generateRandomEvent","monologue","generateInnerMonologue","stageBefore","daysSinceProsecution","daysSinceTrial","daysSinceAppeal","daysSinceVerdict","isEnding","endingType","getProtagonistState","stateHealth","stateMental","stateStrength","strength","stateIntelligence","intelligence","conditionEventsCount","conditionResult","eventWeight","dependsOnStatusPanel","randomCheck","randomValue","willTrigger","types","eventType","weightedRandom","eventList","eventWeights","weights","count","totalWeight","hasDS","hasGetModule","codeVersion","statusPanelType","willUseFallback","fallbackState","chat","mes","setDeathPenalty","getCurrentStageInfo","cellTypeChinese","cellTypeRaw","timeline","getEventStatistics","stats","totalEvents","byType","byPriority","recentEvents","exportTimeline","importTimeline","snapshot","snapshotTime","snapshotSize","detentionSystemInterruptSnapshot","updateError","oldDay","newDay","modifyValue","currentDayFromMemory","_context","hasEventSystem","eventSystemType","advanceDayType","hasResult","resultKeys","getCurrentDay","getCurrentStage","windowDetentionSystemType","currentUrl","href","NameGenerator","surnames","tier1","names","tier2","tier3","tier4","tier5","givenNames","vintage","single","double","classic","modern","contemporary","badNames","badChars","generate","birthYear","attempts","fullName","selectSurname","selectGivenName","isValidName","tiers","values","tier","getFullYear","style","styleData","pair","char","CrimeGenerator","characterBookCrimes","crimes","violent","sentenceRange","property","drug","economic","social","other","findCategoryByCrime","sentence","generateSentence","categories","cat","crimeName","range","__DETENTION_SYSTEM_LOADED__","detentionSystemType","modulesLoaded","__NPC_SYSTEM_LOADING__","NPCGenerator","npcDatabase","currentCellNPCs","npcs","generateSingle","stageInfo","generateAge","crimeData","generateAppearance","generatePersonality","generateBackground","generateRelationship","adjustByCellType","generateId","gender","createdAt","heights","hairStyles","skinTones","eyes","traits","aggression","sociability","dominance","kindness","tags","_crimeData","educations","educationIndex","maritalStatuses","maritalWeights","maritalIndex","hasChildren","childrenCount","maritalStatus","hometown","generateHometown","priorConvictions","provinces","toProtagonist","faction","allies","enemies","toString","generateForEvent","generatePolice","generateLawyer","generateFamily","generateDoctor","ranks","attitude","isFemale","typeIndex","experience","successRate","relationships","supportLevel","specialties","specialty","hasOptions","categoryKey","filteredCrimes","c","profession","highEducations","mediumEducations","lowEducations","businessEducations","businessProfessions","intellectualProfessions","academicProfessions","personalityTags","addNPCToCell","removeNPCFromCell","npcId","findIndex","n","findNPCById","updateRelationship","delta","exportData","database","currentCell","importData","clearData","findNPC","updateNPCRelationship","exportNPCData","importNPCData","registeredModule","parentWindow","parentDS","verification","hasNPCSystemModule","parentHasGenerateNPC","parentHasGenerateProtagonist","parentHasGenerateNPCForEvent","iframeHasGenerateProtagonist","parentModulesCount","logError","newCellType","__NPC_SYSTEM_LOADED__","__NPC_SYSTEM_LOADED_TIMESTAMP__","Vue","CONFIG","updateInterval","animationDuration","trendWindow","slowChangeThreshold","regressionRate","healthBaseline","mentalBaseline","parseRetryAttempts","parseRetryDelay","debugMode","clothing","top","bottom","underwear","underpants","socks","shoes","restraints","cleanliness","currentTask","currentThought","biggestWorry","changes","accumulated","lastUpdate","totalUpdates","successfulParses","failedParses","lastParseTime","isUpdating","mutationObserver","updateLoopInterval","debugLog","args","formatDuration","ms","seconds","minutes","hours","recordChange","calculateTrend","acc","change","syncStateToMemoryEnhancement","checkError","plugin","detectMemoryEnhancementPlugin","updateState","setState","topLength","bottomLength","updateDisplay","parseCommentNode","node","nodeType","Node","COMMENT_NODE","nodeValue","textContent","jsonStr","parseStatusUpdate","attempt","parse","errorMessage","checkForStatusUpdate","element","ELEMENT_NODE","walker","document","createTreeWalker","NodeFilter","SHOW_COMMENT","nextNode","getStateFromMemoryEnhancement","stopCommentListener","disconnect","stopUpdateLoop","hasWindow","hasStMemoryEnhancement","stMemoryEnhancement","hasMemoryEnhancement","MemoryEnhancement","hasMemoryEnhancementLower","memoryEnhancement","hasMemoryEnhancementPlugin","MemoryEnhancementPlugin","hasMemoryEnhancementPluginLower","memoryEnhancementPlugin","stMemoryEnhancementType","memoryEnhancementType","memoryEnhancementLowerType","hasPlugin","pluginType","pluginKeys","ext_getAllTables","ext_exportAllTablesAsJson","hasExtGetAllTables","hasExtExportAllTablesAsJson","memoryState","messageVars","possiblePaths","path","candidate","hasHealth","hasMental","searchInVars","vars","foundInChat","foundInMessage","jsonData","isObject","tableCount","tableUids","tables","possibleTableNames","targetTable","table","toLowerCase","header","h","firstDataRow","stateObj","colName","normalizedName","numValue","parseFloat","finalValue","tableName","jsonError","allTables","tableNames","stateKeys","extError","memoryStateType","memoryStateKeys","cell_type","StatusPanel","MutationObserver","mutations","mutation","addedNodes","target","observe","childList","subtree","characterData","characterDataOldValue","d","destroy","allClothing","oldValue","newValue","getTrendAnalysis","trend","reset","scanAllComments","comments","fullContent","isStatusUpdate","getDiagnostics","diagnostics","toLocaleString","observer","active","timeSinceUpdate","timeSinceUpdateFormatted","currentState","WORLDBOOKS","detention_rules","displayName","keywords","autoLoad","position","depth","fallbackEntries","internal_basic_procedures","internal_basic_legal","legal_knowledge","environment_descriptions","narrative_enhancements","safeGetWorldbookNames","hasGlobalFn","getWorldbookNames","hasTavernHelper","TavernHelper","hasTavernHelperFn","helper","tavernHelperType","characterId","WorldbookLoader","loaded","loading","fallbackMode","characterWorldbookId","failedBooks","findCharacterWorldbook","charWorldbooks","getCharWorldbookNames","primary","additional","bookName","loadPromise","_loadWorldbookInternal","allWorldbookNames","targetWorldbookName","exactDisplayMatch","fuzzyMatch","availableBooks","searchingFor","worldbookData","allAvailableBooks","getWorldbook","worldbookDataType","worldbookDataIsArray","worldbookDataIsObject","worldbookDataKeys","worldbookDataHasEntriesProperty","worldbookDataEntriesType","worldbookDataEntriesIsArray","entriesType","entriesIsArray","entriesLength","entriesIsUndefined","entriesIsNull","entriesValue","getWorldbookError","isDataFormatError","failedBooksSize","failedBooksArray","worldbookDataValue","entriesConstructor","rebindCharWorldbooks","loadedAt","predictiveCache","predictions","matchScore","weightedScore","keyword","descKeywords","descKw","finalScore","score","toLoad","p","pred","getRelevantEntries","maxEntries","allEntries","bookData","entry","bookDisplayName","scoredEntries","contentMatch","constant","aPriority","relevant","dynamicLoad","triggers","matchCount","bestKeyword","maxKeywordLength","trigger","getStatus","characterWorldbook","available","_promise","unloadWorldbook","targetName","newAdditional","reloadWorldbook","retries","availableWorldbooks","isAvailable","autoLoadBooks","fallbackBooks","shutdown","getWorldbookStatus","initWorldbookLoader","userAgent","navigator","__DETENTION_SYSTEM_LOADED_TIMESTAMP__","windowDetentionSystem","windowDetentionSystemValue"],"ignoreList":[],"sourceRoot":""}