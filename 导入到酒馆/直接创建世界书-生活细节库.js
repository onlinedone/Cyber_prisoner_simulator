/**
 * 方案2：使用酒馆助手 API 直接创建世界书
 * 
 * 使用方法：
 * 1. 在浏览器中打开酒馆页面
 * 2. 按 F12 打开开发者工具
 * 3. 切换到 Console 标签
 * 4. 将下面的代码复制粘贴到控制台并执行
 * 
 * 注意：执行前请确保：
 * - 酒馆助手已正确安装并运行
 * - 如果世界书 "生活细节库" 已存在，此脚本会替换它
 */

(async function createWorldbookFromJSON() {
  try {
    console.log('[世界书创建脚本] 开始创建 "生活细节库"...');

    // 检查酒馆助手 API 是否可用
    if (typeof getWorldbookNames === 'undefined') {
      throw new Error('酒馆助手 API 不可用。请确保酒馆助手已正确安装并运行。');
    }

    // 定义世界书条目数据（从 internal_basic_procedures.json 提取的 entries 数组）
    const entries = [
      {
        uid: 0,
        name: "入所搜身流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["入所", "搜身", "入监", "刚进来"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `入所搜身流程

到达看守所
警车停在看守所大门前,被押解下车,双手戴手铐,由法警或管教押解进入。

初步登记
在接待大厅,管教核对身份信息、案号、逮捕证/拘留证等法律文书,填写入所登记表。

搜身检查
地点:专门的搜身室
执行人员:女管教(对女性在押人员)

流程:
1. 脱去外衣:脱下外套、鞋袜,只穿内衣内裤
2. 全身检查:
 - 头发:检查是否藏匿物品,可能要求散开头发、摇头
 - 口腔:张嘴检查,可能要求吐出口香糖等
 - 耳朵:检查耳道
 - 腋下:抬起手臂检查
 - 胸部:可能要求抬起乳房检查下方(女性)
 - 腰腹:检查腰带、裤腰
 - 私处:可能要求脱下内裤,蹲下检查(极其羞辱)
 - 臀部:检查臀缝
 - 腿部:检查大腿内侧、膝盖后方
 - 脚部:检查脚底、脚趾缝
3. 衣物检查:翻查所有衣物口袋、缝隙、鞋底等
4. 随身物品检查:检查包、钱包等所有随身物品

没收物品
违禁品:手机、刀具、打火机、药品、现金(超过规定数额)等全部没收
贵重物品:手表、首饰、钥匙等登记后暂存,出所时归还

换装
脱下自己的衣服,换上看守所统一的囚服(蓝色或灰色马甲、裤子)
发放:薄褥子、脸盆、牙刷、牙膏、毛巾等基本生活用品

体检
简单体检:测量身高、体重、血压,检查是否有传染病、皮肤病、精神病等
目的:确保身体状况适合关押,防止传染病传播

拍照录入
正面照、侧面照,录入指纹、虹膜等生物信息

分配监室
根据案情、年龄、身体状况等分配到相应监室
由管教押解至监室,交给监室管教和牢头

心理感受
极度羞辱、恐惧、不安,尤其是搜身过程中的隐私暴露
对未知生活的恐惧和对自由的渴望

AI创作指导
- 必须详细描写搜身过程的羞辱感和隐私暴露
- 可描写被迫脱衣、蹲下检查的屈辱
- 可描写管教的冷漠或严厉态度
- 可描写换上囚服后的身份转变
- 可描写初次进入监室时的恐惧和不安
- 鼓励通过入所流程展现自由的彻底丧失`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 1,
        name: "吃饭流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["吃饭", "打饭", "饭菜", "伙食"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `吃饭流程

用餐时间
早餐:07:00-07:30
午餐:12:00-12:30
晚餐:19:30-20:00

打饭流程

集合:
- 管教吹哨或喊话,全体在监室门口集合
- 按顺序排队,不得插队或喧哗
- 牢头或指定人员负责维持秩序

领取餐具:
- 每人一个不锈钢饭盆、一个勺子
- 餐具由监室统一保管,用后清洗归还

排队打饭:
- 按顺序排成一列,走到送饭口
- 管教或炊事员从送饭口递出饭菜
- 伸出饭盆接饭,不得挑拣或要求多打
- 打完饭后迅速回到座位,不得逗留

饭菜种类

早餐:
- 主食:稀饭(大米粥或小米粥,很稀)
- 配菜:咸菜(榨菜、萝卜干、腌菜)、偶尔有咸鸭蛋或煮鸡蛋
- 量:稀饭管够,咸菜很少

午餐和晚餐:
- 主食:馒头(2-3个,白面馒头)或米饭(一大勺,管够)
- 菜:大锅菜(一勺,菜汤很多,菜很少)

大锅菜种类(十几种难吃的菜):
1. 水煮白菜(只有白菜帮,几乎没油)
2. 土豆炖萝卜(土豆和萝卜都煮得很烂)
3. 冬瓜汤(冬瓜块+清水,几乎没味道)
4. 豆腐白菜(豆腐很少,白菜很多)
5. 茄子炖土豆(茄子软烂,土豆发黑)
6. 西红柿鸡蛋汤(西红柿很酸,鸡蛋很少)
7. 炖大头菜(大头菜切大块,煮得很烂)
8. 豆角炖土豆(豆角很老,土豆很面)
9. 白菜粉条(粉条很少,白菜很多)
10. 萝卜炖豆腐(萝卜很辣,豆腐很碎)
11. 炖南瓜(南瓜煮得稀烂,甜得发腻)
12. 青椒土豆丝(青椒很辣,土豆丝很软)
13. 炖茄子(茄子黑乎乎,油很少)
14. 黄瓜炒鸡蛋(黄瓜很多,鸡蛋很少)
15. 炖白萝卜(白萝卜很辣,汤很清)

有肉的菜(每周2-3次):
- 红烧肉炖土豆(肥肉很多,瘦肉很少,一人能分到2-3小块)
- 炖鸡块(鸡骨头多,肉很少)
- 炖排骨(排骨很小,啃不出多少肉)
- 肉末豆腐(肉末很少,豆腐很多)

用餐规定
- 必须在30分钟内吃完
- 不得浪费粮食,必须吃光
- 不得交换饭菜或给他人
- 不得喧哗吵闹
- 吃完后自己清洗餐具

主食量
主食(馒头/米饭)管够,可以添加,但菜只有一勺,不能添加
很多人吃不饱菜,只能多吃主食填饱肚子

饭菜质量
- 味道:很淡,几乎没油水,菜汤很多但菜很少
- 卫生:一般,偶尔有菜虫或杂质
- 温度:经常是温的或凉的,很少有热的

心理感受
- 初期:难以下咽,想念家里的饭菜
- 适应后:习惯了难吃,只求填饱肚子
- 有肉的日子:全监室都很兴奋,精神状态+5

AI创作指导
- 可详细描写排队打饭的场景和秩序
- 可描写饭菜的难吃和对家乡菜的思念
- 可描写有肉日子的兴奋和争抢
- 可描写主食管够但菜很少的矛盾
- 可描写吃不饱菜只能猛吃馒头的无奈
- 鼓励通过饮食展现监所生活的艰苦`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 2,
        name: "洗澡流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["洗澡", "洗浴", "冲凉", "洗头"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `洗澡流程

洗澡时间
夏季:每周2次(周三、周六)
冬季:每周1次(周六)
时间:通常在下午放风后或晚饭前
每次限时:15-20分钟

准备阶段
管教通知洗澡,全体准备
脱下外衣,只穿内衣内裤
拿好换洗衣物、毛巾、肥皂等洗浴用品
按顺序排队等候

押解至浴室
由管教押解至浴室
浴室位置:通常在监区内部,距离监室不远
路上保持安静,不得喧哗

浴室环境
设施:大通间,10-15个花洒头
地面:水泥地面,有排水沟,经常湿滑
隐私:几乎没有隐私,所有人在同一空间
温度:水温不稳定,经常忽冷忽热
水压:水压较小,出水量有限

洗澡过程

进入浴室:
- 脱光所有衣物,放在指定位置
- 初次洗澡极其羞耻,不敢看其他人
- 老人习以为常,新人备受煎熬

冲洗身体:
- 先用冷水冲洗,适应水温
- 用肥皂(质量很差,不起泡沫)清洗身体
- 重点清洗头发、腋下、私处、脚部
- 时间紧迫,动作要快

洗头发:
- 用洗发水(很少,需要节约使用)
- 头发长的女性洗头困难,时间不够
- 可能需要其他人帮忙冲洗后背或头发

清洗私处:
- 女性需要特别注意清洁
- 月经期间可能有血迹,需要仔细清洗
- 极其缺乏隐私,心理压力很大

洗澡限制
时间限制:15-20分钟,时间到必须出来
用品限制:肥皂、洗发水等需要自己购买或家属送来
隐私缺失:所有人在同一空间,无法遮挡
水温不稳:经常突然变冷或变热
排队等候:人多时需要排队,可能洗不上

洗澡后
用毛巾擦干身体
穿上干净衣物(如果有的话)
没有干净衣物的只能穿回脏衣服
整理洗浴用品
按顺序离开浴室

特殊情况

月经期:
- 可以正常洗澡,但需要特别注意清洁
- 洗澡前后需要更换卫生巾
- 可能因为缺少卫生巾而不敢洗澡

生病时:
- 轻微感冒可以洗澡
- 发烧或严重疾病可能被禁止洗澡
- 皮肤病患者可能被要求单独洗澡

新人适应:
- 初次洗澡极其羞耻和不适应
- 可能因为害羞而洗不干净
- 逐渐适应集体洗澡的环境

心理感受
初期:极度羞耻、不适应、恐惧
适应后:习惯了没有隐私,只求洗干净
洗澡日:全监室都很期待,精神状态+3
洗完后:感觉清爽,心情稍好

卫生问题
浴室卫生:一般,地面湿滑,容易滑倒
传染风险:皮肤病、脚气等容易传播
清洁效果:由于时间短、用品差,清洁效果有限

AI创作指导
- 必须详细描写初次集体洗澡的羞耻感
- 可描写在众人面前脱光衣服的屈辱
- 可描写水温不稳定带来的不适
- 可描写时间紧迫匆忙洗澡的狼狈
- 可描写月经期洗澡的特殊困难
- 可描写洗澡后的清爽感和短暂的心情好转
- 鼓励通过洗澡流程展现隐私的彻底丧失和人格尊严的践踏`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 3,
        name: "睡觉流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["睡觉", "就寝", "睡眠", "夜间"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `睡觉流程

就寝时间
夏季:21:30就寝
冬季:21:00就寝
起床时间:06:00(全年统一)

睡前准备
21:00-21:30 洗漱时间
整理床铺,准备睡觉
换上睡衣(如果有的话)
上厕所,准备夜间

床铺安排
通铺:水泥台上铺褥子,每人约60cm宽
位置分配:按监室地位分配,牢头占最好位置
床上用品:薄褥子、薄被子、枕头(或用衣服代替)

睡眠环境
照明:24小时不熄灯,影响睡眠质量
噪音:其他人的鼾声、翻身声、说梦话
温度:夏季闷热,冬季寒冷,很难舒适
空间:人多拥挤,翻身困难

夜间管理
值班制度:每人轮流值班2小时
值班职责:监督其他人,防止意外,保持安静
管教巡查:管教不定时巡查,透过观察窗查看
紧急情况:如有人生病、自杀倾向等,立即报告

睡眠质量
入睡困难:环境嘈杂、心理压力大、灯光刺眼
睡眠浅:容易被惊醒,难以进入深度睡眠
做噩梦:经常梦到案件、家人、法庭等
早醒:可能因为焦虑而早醒,难以再次入睡

夜间如厕
申请:需要向值班人员申请
陪同:可能需要值班人员陪同
时间限制:不得长时间占用厕所
次数限制:频繁如厕可能被怀疑有问题

特殊情况

生病:
- 发烧、腹泻等影响睡眠
- 可能需要特殊照顾或就医
- 其他人担心传染,可能被孤立

月经期:
- 需要频繁更换卫生巾
- 可能因为疼痛而难以入睡
- 担心侧漏而不敢翻身

情绪问题:
- 思念家人而哭泣
- 担心案件进展而失眠
- 可能有自杀倾向,需要特别监控

新人适应:
- 初期完全无法入睡
- 对环境恐惧和不适应
- 可能整夜失眠或噩梦连连

睡眠障碍
失眠:长期失眠,精神状态恶化
噩梦:反复做关于案件或家人的噩梦
早醒:凌晨3-4点醒来,无法再睡
嗜睡:白天精神不振,想睡觉

心理感受
恐惧:对黑暗、噪音、未知的恐惧
思念:夜深人静时特别想念家人
绝望:感觉看不到希望,前途渺茫
焦虑:担心案件、家庭、未来
孤独:即使身边有人,仍感到孤独

梦境内容
家人:梦到家人的关怀或责备
自由:梦到重获自由,醒来后更加痛苦
案件:重复梦到犯罪过程或法庭审判
恐怖:各种恐怖的噩梦,惊醒后冷汗直流

AI创作指导
- 可详细描写初夜的恐惧和不适应
- 可描写24小时照明对睡眠的影响
- 可描写夜间的各种噪音和干扰
- 可描写思念家人时的哭泣和痛苦
- 可描写噩梦的具体内容和惊醒后的恐惧
- 可描写值班时的孤独和责任
- 鼓励通过睡眠描写展现心理压力和精神折磨`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 4,
        name: "如厕流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["如厕", "上厕所", "大小便", "卫生间"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `如厕流程

卫生间设施
位置:监室内部,用透明隔断分隔
设备:2个蹲便器,1个洗手池
隐私:几乎没有隐私,其他人可以看到
卫生:需要自己清洁,卫生状况一般

如厕时间
自由时间:吃饭前后、自由活动时间可以自由如厕
限制时间:坐板、劳动、学习期间需要申请
夜间:需要向值班人员申请,可能需要陪同

申请程序
举手报告:向管教或值班人员举手申请
等待批准:等待管教同意后方可离开座位
时间限制:一般限制在5-10分钟内
紧急情况:腹泻等紧急情况可以优先处理

如厕过程

小便:
- 相对简单快速
- 但缺乏隐私,心理压力大
- 新人可能因为害羞而憋尿

大便:
- 需要更多时间和隐私
- 其他人可能催促或抱怨
- 便秘问题较常见(饮食、压力、环境因素)
- 腹泻时更加痛苦和尴尬

女性特殊需求:
- 月经期需要更换卫生巾
- 清洁要求更高
- 隐私需求更强烈

清洁卫生
手纸:需要自己购买或家属送来,经常不够用
清洁:便后需要自己冲洗便器
洗手:用冷水和肥皂洗手(如果有的话)
消毒:定期用消毒水清洁卫生间

卫生问题
传染病:容易传播肠道传染病
异味:通风不良,异味较重
清洁不彻底:清洁用品有限,清洁效果差
隐私缺失:心理压力影响正常排便

特殊情况

便秘:
- 饮食单调、缺乏纤维导致便秘
- 心理压力和环境因素加重便秘
- 可能需要申请就医或用药

腹泻:
- 可能因为饮食不洁或情绪紧张
- 需要频繁如厕,影响正常作息
- 其他人可能抱怨或嫌弃

月经期:
- 需要频繁更换卫生巾
- 清洁要求更高,但条件有限
- 可能因为缺少卫生巾而焦虑

尿路感染:
- 女性较常见
- 可能因为清洁不够或憋尿导致
- 需要申请就医治疗

心理压力
隐私缺失:在众人面前如厕的羞耻感
时间压力:担心被催促或超时
卫生担忧:担心感染疾病
依赖感:需要申请才能如厕的屈辱

管理规定
申请制:非自由时间必须申请
时间限制:不得长时间占用卫生间
清洁义务:使用后必须清洁
节约用纸:手纸有限,需要节约使用

违规后果
超时:可能被批评或处罚
不清洁:被要求重新清洁或处罚
频繁申请:可能被怀疑有其他问题
浪费用品:可能被限制使用

AI创作指导
- 可详细描写缺乏隐私的羞耻感
- 可描写便秘或腹泻带来的痛苦
- 可描写月经期的特殊困难
- 可描写手纸不够用的尴尬
- 可描写申请如厕被拒绝的憋屈
- 可描写卫生间异味和不洁的恶心
- 鼓励通过如厕描写展现基本人格尊严的丧失`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 5,
        name: "审讯流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["审讯", "提审", "讯问"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `审讯流程

通知提审
管教进入监室,叫出被提审人员的名字,通知准备提审

准备
- 整理衣着,不得披头散发
- 必须要戴手铐,通过门上的小洞让管教戴手铐
- 可能会被反铐或额外加戴脚镣(视案情和表现)
- 由管教押解出监室

押解至审讯室
- 通过专用通道(被羁押人通道)
- 到达审讯室门口,等待进入

进入审讯室
- 管教打开门,被押解进入
- 坐在讯问椅上(固定座椅,可能带有固定手脚的装置)
- 管教可能会将手铐固定在讯问椅上

审讯开始

核实身份:
- 侦查人员核对姓名、年龄、住址等基本信息
- 告知案由和审讯目的

权利告知:
- 告知有权保持沉默(但实践中很少真正沉默)
- 告知有权申请回避
- 告知如实供述可以从宽处理

询问过程:
- 侦查人员提问,被审讯人回答
- 可能反复询问同一问题,核对前后供述是否一致
- 可能出示证据、证人证言等,要求解释或承认
- 全程录音录像

审讯时长
- 一般:1-3小时
- 复杂案件:可能更长,甚至连续数小时
- 法律规定:不得连续审讯超过12小时,但实践中可能有例外

审讯态度
- 温和型:侦查人员态度较好,耐心询问,鼓励坦白
- 严厉型:侦查人员态度严厉,语气强硬,施加心理压力
- 疲劳战术:长时间审讯,消耗体力和意志

笔录签字
- 审讯结束后,侦查人员整理笔录
- 被审讯人阅读或听读笔录
- 确认无误后签字、按手印
- 如有异议,可以要求修改或补充

审讯结束
- 管教押解回监室,在监室门口解除脚镣(如有)
- 先进入监室,再通过门上的小洞解除手铐
- 回到监室,其他狱友可能询问审讯情况

心理感受
- 紧张、恐惧、疲惫
- 担心说错话或被套话
- 希望早点结束审讯
- 对案件进展的焦虑

AI创作指导
- 可详细描写被押解至审讯室的紧张
- 可描写坐在讯问椅上被固定的无助
- 可描写审讯过程中的心理博弈
- 可描写侦查人员的不同态度和策略
- 可描写长时间审讯的疲惫和崩溃
- 鼓励通过审讯展现案件进展和心理压力`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 6,
        name: "律师会见流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["律师会见", "见律师", "会见律师"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `律师会见流程

通知会见
管教通知有律师会见,准备出监室

准备
- 整理衣着
- 可能需要戴手铐(视情况)
- 由管教押解出监室

押解至律师会见室
- 通过被羁押人专用通道
- 到达律师会见室门口,等待进入

进入会见室
- 管教打开门,被押解进入
- 坐在被羁押人区域的固定座椅上
- 与律师之间隔着金属防护栅栏

会见开始

身份核实:
- 律师出示律师证、委托书等
- 管教核实身份后离开(但可能在外监控)

律师介绍:
- 律师自我介绍,说明受谁委托
- 告知会见目的和时间限制

案情沟通:
- 律师询问案件经过、侦查情况、供述内容等
- 被羁押人陈述自己的情况和疑问
- 律师解答法律问题,提供法律建议
- 讨论辩护策略

证据讨论:
- 律师可能出示或讨论证据材料
- 被羁押人提供线索或证据来源

家属情况:
- 律师可能转达家属的问候和关心
- 被羁押人可能托律师转告家人

会见时长
- 一般:30分钟-1小时
- 可以申请延长,但需管教批准

会见限制
- 全程录音录像(但律师会见内容受保密保护)
- 不得传递违禁物品
- 不得讨论与案件无关的内容

会见结束
- 律师收拾材料,告别
- 管教押解被羁押人回监室
- 解除手铐(如有)

心理感受
- 见到律师时的希望和依赖
- 对案件进展的焦虑和期待
- 对律师能力的信任或怀疑
- 会见结束时的不舍和失落

AI创作指导
- 可详细描写与律师会见时的复杂心情
- 可描写透过栅栏交流的隔离感
- 可描写律师带来的案件进展和法律建议
- 可描写对律师的信任、怀疑或失望
- 可描写律师转达家属问候时的情绪波动
- 鼓励通过律师会见展现案件进展和心理变化`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 7,
        name: "家属探视流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["家属探视", "探视", "会见家属", "见家人"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `家属探视流程

探视申请
家属向看守所提出探视申请,提交身份证明、与被羁押人的关系证明等
看守所审核批准后,通知探视时间

通知探视
管教提前通知被羁押人有家属探视,准备出监室

准备
- 整理衣着,尽量整洁
- 可能需要戴手铐(视情况)
- 由管教押解出监室

押解至家属会见室
- 通过被羁押人专用通道
- 到达家属会见室门口,等待进入

进入会见室
- 管教打开门,被押解进入
- 坐在被羁押人区域的固定座椅上
- 与家属之间隔着安全玻璃和金属防护栅栏
- 通过对讲器交流

探视开始

见面瞬间:
- 透过玻璃看到家人,情绪激动
- 可能哭泣、呼喊、拍打玻璃
- 家属也可能情绪失控

交流内容:
- 家属询问身体状况、生活情况
- 被羁押人报平安,安慰家人
- 讨论案件进展、律师情况
- 家属可能带来外界消息、家庭情况
- 被羁押人可能嘱托家人照顾好自己、孩子等

情感表达:
- 道歉、忏悔、哭泣
- 思念、牵挂、不舍
- 鼓励、安慰、承诺

探视时长
- 未决犯:每月1次,每次30分钟-1小时
- 已决犯:根据表现,可能增加次数和时长

探视限制
- 全程录音录像
- 不得传递违禁物品
- 不得讨论串供、逃跑等违法内容
- 管教全程监督,可随时中止探视

探视结束
- 时间到,管教通知结束
- 被羁押人和家属依依不舍,可能再次哭泣
- 管教押解被羁押人回监室
- 解除手铐(如有)

心理感受
- 见到家人时的激动和喜悦
- 隔着玻璃无法触碰的痛苦
- 对家人的愧疚和思念
- 探视结束时的失落和绝望
- 回到监室后可能情绪崩溃,精神状态-10

AI创作指导
- 必须详细描写与家人隔着玻璃相见的场景
- 可描写想触碰家人却被阻隔的痛苦
- 可描写通过对讲器交流的不便和失真
- 可描写家人的哭泣、劝慰、失望或支持
- 可描写探视结束时被强行分开的场景
- 可描写回到监室后的情绪崩溃
- 鼓励通过家属探视展现亲情的珍贵和失去自由的痛苦`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 8,
        name: "出所体检/就医流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["去医院体检", "去医院就医", "去医院看病"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `出所体检/就医流程

触发条件
- 身体不适,监室内无法处理
- 健康状态<30,需要专业医疗
- 突发疾病或意外受伤
- 定期体检(较少)

申请就医
- 被羁押人向管教报告身体不适
- 管教初步判断是否需要就医
- 严重情况立即安排,一般情况需等待批准

准备出所
- 换上便装或保持囚服
- 戴上手铐脚镣(必须)
- 可能还有腰链、防暴头盔(视情况)
- 由2-4名武警或管教押解

押解过程
- 乘坐囚车或警车
- 全程戴戒具,不得解除
- 武警/管教严密监控

到达医院
- 通常去指定的医院或看守所医务室
- 从专门通道进入,避开普通患者
- 可能有专门的诊室或隔离区域

就医过程

挂号登记:
- 武警/管教代为办理
- 使用特殊身份登记

候诊:
- 在隔离区域或专门房间等待
- 全程戴戒具,武警/管教监控
- 可能引来其他患者或医护人员的侧目

诊疗:
- 医生询问病情,检查身体
- 可能需要解除部分戒具(如检查手臂需解手铐)
- 武警/管教在旁监督,防止逃跑或伤人
- 进行必要的检查(抽血、拍片、B超等)

开药/治疗:
- 医生开具处方或进行治疗
- 武警/管教代为取药
- 如需住院,安排在隔离病房,24小时看守

返回看守所
- 就医结束后,立即押解返回
- 重新戴好所有戒具
- 乘坐囚车/警车返回

回到监室
- 管教检查带回的药品,登记
- 解除戒具
- 按医嘱服药或治疗

心理感受
- 短暂离开看守所的新鲜感
- 看到外面世界的渴望和失落
- 戴戒具就医的羞耻和屈辱
- 被人侧目的尴尬和自卑
- 对健康的担忧和对自由的渴望

AI创作指导
- 可详细描写戴戒具出所的场景
- 可描写在医院被人侧目的羞耻
- 可描写短暂看到外面世界的复杂心情
- 可描写就医过程中的不便和屈辱
- 可描写对健康的担忧和对自由的渴望
- 鼓励通过出所就医展现自由的珍贵`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 9,
        name: "指认现场流程",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["指认现场", "现场指认", "带去现场"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `指认现场流程

触发条件
侦查阶段,需要被羁押人指认犯罪现场、寻找抛尸地点、藏匿赃物地点等,或核实供述真实性

通知
管教通知准备指认现场,不告知具体时间和地点

准备
- 换上便装或保持囚服(通常穿便装,避免引起围观)
- 戴上手铐脚镣(必须)
- 可能戴上头套或墨镜(避免被认出)
- 由多名武警或侦查人员押解

押解过程
- 乘坐囚车或警车
- 全程戴戒具,不得解除
- 车窗可能贴黑膜,看不到外面
- 路程可能较长,数小时甚至一天

到达现场
车辆停在现场附近,侦查人员先下车勘察周围情况,确认安全后押解被羁押人下车

指认过程

现场勘察:
- 侦查人员要求被羁押人指认具体位置
- 被羁押人带领侦查人员到达犯罪地点
- 可能需要指认多个地点(如作案路线、抛尸地点、藏匿赃物地点等)

详细描述:
- 侦查人员要求被羁押人详细描述作案过程
- 演示作案动作和路线
- 指认关键物证位置

拍照录像:
- 全程拍照录像记录
- 可能要求被羁押人在现场拍照留证

寻找物证:
- 如果是寻找抛尸地点或赃物,可能需要挖掘或搜寻
- 被羁押人指引方向和位置

围观与媒体
- 可能引起群众围观
- 可能有媒体拍摄(重大案件)
- 被羁押人可能被认出,遭受指责或辱骂

指认结束
- 侦查人员确认指认完毕
- 押解被羁押人上车返回看守所
- 重新戴好所有戒具

心理感受
- 重回案发现场的恐惧和愧疚
- 回忆作案过程的痛苦
- 被围观和指责的羞耻
- 戴戒具在公共场合的屈辱
- 对受害人的愧疚和悔恨
- 短暂看到外面世界的复杂心情

AI创作指导
- 可详细描写戴戒具在公共场合的羞耻
- 可描写重回案发现场的心理冲击
- 可描写被围观群众指责的场景
- 可描写回忆作案过程的痛苦和愧疚
- 可描写对受害人的悔恨和自责
- 可描写短暂看到外面世界的渴望和失落
- 鼓励通过指认现场展现犯罪的后果和对自由的渴望`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 10,
        name: "地下商品流通",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["购物", "超市", "地下交易", "违禁品", "卫生巾"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `地下商品流通

正规购物
额度:每月200元
方式:填写申请单,1-2天送货,价格为市场价3-5倍
可购买:方便面、饼干、卫生巾、卫生纸、肥皂、牙膏等

女子监区硬通货:卫生巾
地位:最硬的硬通货,远超其他物品
原因:每月必需,看守所提供的质量差数量少
价值:1包卫生巾≈5包方便面≈帮忙洗衣服1周≈帮忙值班2次
特殊:牢头囤积大量卫生巾控制底层人员,月经期女性不惜一切代价换取

地下交易
场所:监室内、放风时、劳动时
方式:以物易物、赊账(利息高)、服务交换
风险:被发现没收、加戒具、关禁闭、影响减刑

违禁品渠道
香烟:
- 来源:腐败管教、探视夹带、劳动偷藏
- 价值:对烟民极高(10包卫生巾换1包烟),对其他人一文不值
- 风险:被发现严厉处罚,抽烟的人很少,难以出手

手机:最珍贵,可联系外界,被发现可能加刑,夜间偷偷使用,牢头控制

药品:安眠药、止痛药等,出所就医偷藏、管教带入、家属夹带

其他:刀具、打火机、酒精、化妆品等

监室经济
贫富分化:有钱人囤积物品和卫生巾成为富人,穷人靠交易或出卖劳动换取必需品
权力与经济:牢头通过囤积卫生巾等硬通货控制底层人员

AI创作指导
- 必须强调卫生巾在女子监区的核心地位
- 可详细描写为获得卫生巾而发生的交易、冲突、求助
- 可描写月经期女性因缺少卫生巾的绝望和屈辱
- 可描写香烟的稀缺性和抽烟者的渴望,以及大多数人的冷漠
- 可描写地下交易的隐秘性和紧张感
- 可描写违禁品带来的短暂快乐和巨大风险
- 鼓励通过地下交易展现人性的复杂和生存智慧`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      },
      {
        uid: 11,
        name: "整理内务",
        enabled: true,
        strategy: {
          type: "selective",
          keys: ["整理内务", "内务", "打扫", "卫生"],
          keys_secondary: { logic: "and_any", keys: [] },
          scan_depth: "same_as_global"
        },
        position: {
          type: "after_character_definition",
          role: "system",
          depth: 4,
          order: 100
        },
        content: `整理内务

时间
每日06:00起床后立即开始,06:30前必须完成。晚上自由活动期间也会打扫。

标准要求

床铺:
- 被子叠成豆腐块(四四方方,棱角分明)
- 褥子铺平整,无褶皱
- 枕头摆放整齐,统一朝向
- 个人物品放在床铺指定位置

地面:
- 拖洗干净,无污渍、无积水
- 角落无灰尘、无杂物
- 每日至少拖洗3次(早、中、晚)

卫生间:
- 便器刷洗干净,无污垢、无异味
- 地面拖洗干净,无积水
- 洗手池擦拭干净,无水渍
- 每日消毒2次

物品摆放:
- 脸盆、水杯等统一摆放
- 毛巾统一晾晒
- 垃圾及时清理

不平等分工

牢头和核心成员:
- 基本不参与劳动
- 只负责监督和指挥
- 偶尔象征性地叠一下自己的被子

中层成员:
- 负责相对轻松的工作(如叠被子、摆放物品)
- 可以指使底层人员

底层成员和新人:
- 承担所有脏活累活
- 扫厕所、刷便器、拖地、倒垃圾
- 帮牢头和核心成员叠被子、洗衣服
- 干得不好会被责骂、欺凌甚至殴打

新人待遇
第一天:被指派最脏最累的活(刷便器、清理卫生间)
适应期:持续承担重活,直到有更新的新人进来
反抗后果:被孤立、欺凌、暴力,生活更加艰难

检查与处罚

管教检查:
- 不定期检查内务
- 不合格:全监室受罚(罚站、取消自由活动、扣分)
- 严重不合格:关禁闭、加戒具

内部处罚:
- 牢头检查不合格:责骂、罚做更多活、扣减物品分配
- 连累全监室:被其他人孤立、报复

AI创作指导
- 可详细描写新人被指派刷便器的屈辱和恶心
- 可描写底层人员承担重活的辛苦和不公
- 可描写牢头和核心成员的颐指气使
- 可描写内务不合格后的集体处罚和内部矛盾
- 可描写新人试图反抗后的悲惨遭遇
- 鼓励通过整理内务展现监室内的权力结构和不平等`,
        probability: 100,
        recursion: { prevent_incoming: false, prevent_outgoing: false, delay_until: null },
        effect: { sticky: null, cooldown: null, delay: null }
      }
    ];

    const worldbookName = '生活细节库';

    // 检查世界书是否已存在
    const existingWorldbooks = getWorldbookNames();
    const worldbookExists = existingWorldbooks.includes(worldbookName);

    if (worldbookExists) {
      console.log(`[世界书创建脚本] 世界书 "${worldbookName}" 已存在，将替换它...`);
      
      // 使用 replaceWorldbook 替换现有世界书
      await replaceWorldbook(worldbookName, entries, { render: 'immediate' });
      console.log(`[世界书创建脚本] ✓ 已替换世界书 "${worldbookName}" (${entries.length} 个条目)`);
    } else {
      console.log(`[世界书创建脚本] 创建新世界书 "${worldbookName}"...`);
      
      // 使用 createOrReplaceWorldbook 创建新世界书
      const created = await createOrReplaceWorldbook(worldbookName, entries, { render: 'immediate' });
      console.log(`[世界书创建脚本] ✓ 已创建世界书 "${worldbookName}" (${entries.length} 个条目)`);
      console.log(`[世界书创建脚本] 创建结果: ${created ? '新建' : '替换'}`);
    }

    // 验证创建结果
    try {
      const createdWorldbook = await getWorldbook(worldbookName);
      console.log(`[世界书创建脚本] ✓ 验证成功: 世界书包含 ${createdWorldbook.length} 个条目`);
      console.log(`[世界书创建脚本] ✓ 条目列表:`, createdWorldbook.map(e => e.name));
    } catch (error) {
      console.error(`[世界书创建脚本] ⚠ 验证失败:`, error);
    }

    console.log(`[世界书创建脚本] ✓ 完成！`);
    return { success: true, worldbookName, entriesCount: entries.length };

  } catch (error) {
    console.error('[世界书创建脚本] ✗ 执行失败:', error);
    console.error('[世界书创建脚本] 错误详情:', error.message);
    console.error('[世界书创建脚本] 错误堆栈:', error.stack);
    return { success: false, error: error.message };
  }
})();
