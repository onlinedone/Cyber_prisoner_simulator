# 云服务器部署说明

## 脚本加载方式

脚本通过 **jsdelivr CDN** 从 GitHub 加载，**不需要配置云服务器地址**。

### 工作原理

1. **脚本存储**：脚本文件存储在 GitHub 仓库中
2. **CDN 分发**：jsdelivr CDN 从 GitHub 获取文件并分发
3. **浏览器加载**：SillyTavern 在浏览器中通过 `import` 语句加载脚本
4. **执行环境**：脚本在**浏览器**中执行，不是在服务器上执行

### 流程图

```
GitHub 仓库
    ↓
jsdelivr CDN
    ↓
用户浏览器（访问 SillyTavern）
    ↓
脚本在浏览器中执行
```

## 云服务器的作用

云服务器只负责：
- ✅ 运行 SillyTavern 后端服务
- ✅ 提供 Web 界面（http://38.244.14.36:8000/）
- ✅ 处理 API 请求

**不负责**：
- ❌ 存储脚本文件（脚本在 GitHub）
- ❌ 分发脚本文件（由 jsdelivr CDN 负责）
- ❌ 执行脚本（脚本在浏览器中执行）

## 配置步骤

### 1. 在 SillyTavern 中导入脚本

使用以下链接（无需配置服务器地址）：

```javascript
import 'https://cdn.jsdelivr.net/gh/onlinedone/Cyber_prisoner_simulator@4847b8bcdf40cabfd5dea063e9ca76d47c0e62fa/dist/赛博坐牢模拟器增强脚本/index.js'
```

### 2. 验证脚本加载

在浏览器控制台（F12）中检查：

```javascript
// 检查核心系统
window.detentionSystem

// 应该返回一个对象，包含：
// - version: "3.2.0"
// - initialized: true/false
// - modules: {...}
// - events: EventEmitter
```

### 3. 查看日志

在浏览器控制台中应该看到：

```
[核心系统] 核心系统对象已创建
[事件系统] 核心系统已找到
[NPC系统] 核心系统已找到
[知识库加载器] 核心系统已找到
[核心系统] 酒馆页面已加载
[核心系统] 开始初始化...
[核心系统] 初始化完成
```

## 网络要求

### 必须能够访问

1. **GitHub**：用于存储脚本文件
2. **jsdelivr CDN**：用于分发脚本文件
   - 主站：`cdn.jsdelivr.net`
   - 备选：`fastly.jsdelivr.net` 或 `gcore.jsdelivr.net`

### 如果无法访问 CDN

如果在中国大陆无法访问 jsdelivr，可以：

1. **使用 GitHub Raw**（但会有 MIME 类型问题，不推荐）
2. **使用自建服务器**：
   - 将 `dist/赛博坐牢模拟器增强脚本/index.js` 上传到服务器
   - 配置服务器正确设置 MIME 类型
   - 使用服务器地址：`http://38.244.14.36:8000/scripts/index.js`

## 自建服务器部署（可选）

如果必须使用自己的服务器，可以：

### 步骤 1：上传文件

将编译后的文件上传到服务器：
```
/var/www/sillytavern/scripts/index.js
```

### 步骤 2：配置 Web 服务器

**Nginx 配置示例**：
```nginx
location /scripts/ {
    alias /var/www/sillytavern/scripts/;
    add_header Content-Type application/javascript;
    add_header Access-Control-Allow-Origin *;
}
```

**Apache 配置示例**：
```apache
<Directory "/var/www/sillytavern/scripts">
    AddType application/javascript .js
    Header set Access-Control-Allow-Origin "*"
</Directory>
```

### 步骤 3：更新脚本链接

```javascript
import 'http://38.244.14.36:8000/scripts/index.js'
```

## 安全建议

⚠️ **重要**：不要公开分享服务器地址和密码！

1. **修改默认密码**：如果使用默认密码，请立即修改
2. **使用 HTTPS**：配置 SSL 证书，使用 HTTPS 访问
3. **防火墙配置**：限制访问 IP，只允许信任的 IP 访问
4. **定期更新**：保持 SillyTavern 和系统软件更新

## 常见问题

### Q: 脚本无法加载，提示网络错误

**A**: 检查：
1. 浏览器能否访问 GitHub
2. 浏览器能否访问 jsdelivr CDN
3. 如果在中国大陆，尝试使用不同的 CDN 镜像

### Q: 脚本加载成功但功能不工作

**A**: 检查：
1. 浏览器控制台是否有错误
2. `window.detentionSystem` 是否存在
3. 角色卡是否正确配置

### Q: 是否需要配置服务器地址？

**A**: **不需要**。脚本通过 CDN 加载，与服务器地址无关。

## 总结

- ✅ 脚本通过 CDN 加载，**无需配置服务器地址**
- ✅ 脚本在浏览器中执行，不在服务器上执行
- ✅ 云服务器只负责运行 SillyTavern 后端
- ⚠️ 注意保护服务器安全，不要公开分享敏感信息
