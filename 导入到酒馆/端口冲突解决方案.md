# 端口冲突解决方案

## 问题
运行 `pnpm watch` 时出现错误：
```
Error: listen EADDRINUSE: address already in use :::6621
```

## 原因
端口 6621 已经被其他进程占用（通常是之前运行的 `pnpm watch` 进程没有正常关闭）

## 解决方案

### 方法 1：关闭占用端口的进程（推荐）

#### Windows PowerShell：
```powershell
# 1. 查找占用端口的进程
netstat -ano | findstr :6621

# 2. 关闭进程（将 PID 替换为实际进程号）
taskkill /F /PID <进程号>
```

#### 或者一键关闭：
```powershell
# 查找并关闭所有占用 6621 端口的进程
Get-NetTCPConnection -LocalPort 6621 -ErrorAction SilentlyContinue | ForEach-Object { Stop-Process -Id $_.OwningProcess -Force }
```

### 方法 2：修改端口（如果方法 1 不行）

如果端口被其他重要程序占用，可以修改 webpack 配置使用其他端口：

**修改 `webpack.config.ts`**：
```typescript
const config: Config = {
  port: 6622,  // 改为其他端口，如 6622
  entries: glob_script_files().map(parse_entry),
};
```

然后确保酒馆助手也使用新端口连接。

### 方法 3：使用任务管理器

1. 按 `Ctrl + Shift + Esc` 打开任务管理器
2. 在"详细信息"标签页中找到 Node.js 相关进程
3. 右键点击 → 结束任务

## 预防措施

### 正常关闭 pnpm watch

- 使用 `Ctrl + C` 正常停止
- 不要直接关闭终端窗口
- 如果强制关闭，记得手动清理进程

### 快速清理脚本

创建一个批处理文件 `clean-port.ps1`：
```powershell
# 清理端口 6621
Get-NetTCPConnection -LocalPort 6621 -ErrorAction SilentlyContinue | ForEach-Object { 
    Stop-Process -Id $_.OwningProcess -Force 
    Write-Host "已关闭进程 $($_.OwningProcess)"
}
```

## 验证

关闭进程后，再次运行：
```powershell
pnpm watch
```

如果成功，应该看到：
```
[tavern_helper] 已启动酒馆监听服务
```

而不应该有端口冲突错误。
