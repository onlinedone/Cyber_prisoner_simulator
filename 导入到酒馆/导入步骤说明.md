# 看守所模拟器脚本导入指南

## 方法一：直接导入 JSON 文件（推荐）

### 步骤 1：打开酒馆助手设置

1. 在 SillyTavern 中，点击右上角的 **设置** 图标
2. 找到 **酒馆助手 (Tavern Helper)** 设置
3. 进入 **脚本管理** 或 **Scripts** 页面

### 步骤 2：导入 JSON 文件

1. 点击 **导入脚本** 或 **Import Script** 按钮
2. 选择文件：`导入到酒馆/看守所模拟器-完整系统.json`
3. 确认导入

### 步骤 3：启用脚本

1. 在脚本列表中找到 **看守所模拟器-完整系统**
2. 确保脚本已启用（开关打开）
3. 刷新页面或重新加载角色卡

---

## 方法二：手动创建脚本

### 步骤 1：打开脚本管理

1. 在 SillyTavern 中，点击右上角的 **设置** 图标
2. 找到 **酒馆助手 (Tavern Helper)** 设置
3. 进入 **脚本管理** 或 **Scripts** 页面
4. 点击 **新建脚本** 或 **New Script**

### 步骤 2：填写脚本信息

复制以下内容到脚本编辑器：

**ID**: `detention-system-complete`

**名称**: `看守所模拟器-完整系统`

**内容**（推荐使用提交哈希，更可靠）:
```javascript
import 'https://cdn.jsdelivr.net/gh/onlinedone/Cyber_prisoner_simulator@e5c84654a91e1c7793ff221e3b21d92a0a60b317/dist/赛博坐牢模拟器增强脚本/index.js'
```

**备选方案**（如果上面的链接无法访问，使用 GitHub Raw）:
```javascript
import 'https://raw.githubusercontent.com/onlinedone/Cyber_prisoner_simulator/main/dist/赛博坐牢模拟器增强脚本/index.js'
```

**信息**:
```
完整系统：核心系统、状态栏、事件系统、NPC系统、知识库加载器

功能说明：
- 核心系统：提供基础功能和模块管理
- 状态栏系统：状态追踪、HTML注释解析、缓慢变化机制
- 事件系统：按日推进、法律流程、随机事件
- NPC系统：NPC生成和管理
- 知识库加载器：动态加载知识库
```

### 步骤 3：保存并启用

1. 点击 **保存** 按钮
2. 确保脚本已启用（开关打开）
3. 刷新页面或重新加载角色卡

---

## 验证脚本是否加载成功

### 方法 1：查看浏览器控制台

1. 按 `F12` 打开开发者工具
2. 切换到 **Console** 标签
3. 查找以下日志信息：
   - `[核心系统] 酒馆页面已加载`
   - `[状态栏] 脚本加载完成 v3.5.2`
   - `[事件系统] 脚本加载完成 v3.4.0`
   - `[NPC系统] NPC生成器已加载`
   - `[知识库加载器] 知识库加载器已初始化`
   - `[看守所模拟器] 所有模块已加载完成`

### 方法 2：检查全局对象

在浏览器控制台中输入：
```javascript
window.detentionSystem
```

如果返回一个对象（不是 `undefined`），说明脚本已成功加载。

---

## 更新脚本版本

如果需要更新到新版本，只需修改脚本内容中的版本号：

```javascript
// 旧版本
import 'https://cdn.jsdelivr.net/gh/onlinedone/Cyber_prisoner_simulator@v1.0.0/dist/赛博坐牢模拟器增强脚本/index.js'

// 新版本（例如 v1.0.1）
import 'https://cdn.jsdelivr.net/gh/onlinedone/Cyber_prisoner_simulator@v1.0.1/dist/赛博坐牢模拟器增强脚本/index.js'
```

---

## 常见问题

### Q1: jsdelivr 提示 "Failed to fetch version info"

**原因**: jsdelivr 需要 GitHub Release 才能识别版本标签，仅创建标签是不够的。

**解决方法**（按推荐顺序）:

1. **使用提交哈希链接**（已更新到 JSON 文件中）:
   ```javascript
   import 'https://cdn.jsdelivr.net/gh/onlinedone/Cyber_prisoner_simulator@e5c84654a91e1c7793ff221e3b21d92a0a60b317/dist/赛博坐牢模拟器增强脚本/index.js'
   ```

2. **使用 GitHub Raw 链接**（最可靠）:
   ```javascript
   import 'https://raw.githubusercontent.com/onlinedone/Cyber_prisoner_simulator/main/dist/赛博坐牢模拟器增强脚本/index.js'
   ```

3. **创建 GitHub Release**（最佳长期方案）:
   - 访问：https://github.com/onlinedone/Cyber_prisoner_simulator
   - 点击 "Releases" → "Create a new release"
   - 选择标签 `v1.0.0`，填写信息后发布
   - 等待 5-10 分钟后即可使用版本标签链接

详细说明请查看：`导入到酒馆/链接方案说明.md`

### Q2: 脚本加载失败，提示 404 错误

**原因**: jsdelivr CDN 可能需要几分钟时间同步 GitHub 上的新文件。

**解决方法**:
1. 等待 5-10 分钟后重试
2. 或者直接使用 GitHub 的 raw 链接：
   ```javascript
   import 'https://raw.githubusercontent.com/onlinedone/Cyber_prisoner_simulator/v1.0.0/dist/赛博坐牢模拟器增强脚本/index.js'
   ```

### Q2: 控制台显示 "核心系统未加载"

**原因**: 脚本加载顺序问题或网络问题。

**解决方法**:
1. 检查网络连接
2. 清除浏览器缓存后重试
3. 确保脚本已启用

### Q3: 如何查看脚本的详细日志？

**方法**: 打开浏览器控制台（F12），所有模块都会输出详细的日志信息，包括：
- 初始化状态
- 错误信息
- 事件触发
- 模块加载状态

---

## 技术支持

如果遇到问题，请检查：
1. 浏览器控制台的错误信息
2. 网络连接是否正常
3. 脚本是否已启用
4. 角色卡是否已正确加载
