# 角色卡JSON修改清单

## ✅ 检查结果

根据您提供的角色卡JSON，需要修改以下位置以完全移除MVU状态栏，改为只使用记忆增强插件：

---

## 📝 需要修改的位置

### 1. **description 字段**（第5行）

**当前内容**：
```json
"description": "...**使用内置状态栏（MVU状态栏或记忆增强插件），不再依赖外置状态栏模块。**..."
```

**应修改为**：
```json
"description": "...**使用记忆增强插件，由角色卡读取并显示状态栏，不再依赖外置状态栏模块和MVU功能。**..."
```

---

### 2. **system_prompt 字段**（第7行开始）

#### 2.1 模块检测机制说明

**当前内容**（约第71行）：
```
**注意**：状态栏功能已改为使用内置状态栏（MVU状态栏或记忆增强插件），不再依赖外置脚本的状态栏模块。
```

**应修改为**：
```
**注意**：状态栏功能已改为使用记忆增强插件，由角色卡读取并显示状态栏，不再依赖外置脚本的状态栏模块和MVU功能。
```

#### 2.2 状态获取优先级说明

**检查点**：确保所有提到"MVU状态栏"的地方都已移除，只保留"记忆增强插件"。

---

### 3. **post_history_prompt 字段**（第8行开始）

#### 3.1 状态更新说明

**当前内容**（约第196行）：
```
**注意**：状态更新会通过HTML注释格式输出，内置状态栏（MVU状态栏或记忆增强插件）会自动读取。
```

**应修改为**：
```
**注意**：状态更新会通过HTML注释格式输出，记忆增强插件会自动读取，角色卡会读取插件状态并显示。
```

---

### 4. **character_book.entries[0] - "系统状态"条目**

**当前内容**（content字段中）：
```
### 状态栏功能说明 ⭐更新v3.5.6⭐
注意：状态栏功能已改为使用内置状态栏（MVU状态栏或记忆增强插件），不再依赖外置脚本的status_panel.js模块。内置状态栏会自动读取HTML注释中的状态更新。
```

**应修改为**：
```
### 状态栏功能说明 ⭐更新v3.5.6⭐
注意：状态栏功能已改为使用记忆增强插件，由角色卡读取并显示状态栏，不再依赖外置脚本的status_panel.js模块和MVU功能。记忆增强插件会自动读取HTML注释中的状态更新。
```

---

### 5. **character_book.entries[1] - "状态系统"条目**

#### 5.1 状态获取优先级部分

**当前内容**：
```
1. 记忆增强插件 (最高优先级)
   - 检测: window.MemoryEnhancement.getState()
   - 优势: 实时同步、精确追踪
   - 状态来源标识: "记忆增强插件"

2. 聊天记录解析 (降级方案)
   - 方法: 解析HTML注释
   - 优势: 无需外部依赖
   - 状态来源标识: "聊天记录解析"

3. 默认值 (最后方案)
   - 健康: 70, 精神: 65
   - 状态来源标识: "默认值"
```

**应修改为**（移除"聊天记录解析"，因为现在只使用记忆增强插件）：
```
1. 记忆增强插件 (唯一数据源)
   - 检测: window.MemoryEnhancement.getState()
   - 优势: 实时同步、精确追踪、自动解析HTML注释
   - 状态来源标识: "记忆增强插件"
   - 角色卡读取: 角色卡会自动读取插件状态并显示

2. 默认值 (降级方案)
   - 健康: 70, 精神: 65
   - 状态来源标识: "默认值"
   - 使用场景: 记忆增强插件不可用时
```

#### 5.2 状态栏模式差异部分

**当前内容**：
```
## 状态栏模式差异 ⭐更新v3.5.6⭐

### 记忆增强插件模式（最优）
- 实时状态栏显示
- 自动状态同步
- 精确的状态追踪
- 完整的趋势分析
- 自动HTML注释解析

### 内置状态栏模式（次优）
- 实时状态栏显示（MVU状态栏）
- 基础的状态追踪
- 自动HTML注释解析

### 降级模式（基础）
- 文本描述状态
- 简化的变化计算
- 基础的回归机制
- 手动趋势判断
```

**应修改为**：
```
## 状态栏模式差异 ⭐更新v3.5.6⭐

### 记忆增强插件模式（最优）
- 实时状态栏显示（由角色卡读取并显示）
- 自动状态同步
- 精确的状态追踪
- 完整的趋势分析
- 自动HTML注释解析

### 降级模式（基础）
- 文本描述状态
- 简化的变化计算
- 基础的回归机制
- 手动趋势判断
- 使用默认值
```

---

### 6. **character_book.entries[7] - "降级模式"条目**

#### 6.1 状态系统部分

**当前内容**：
```
### 状态系统

**记忆增强插件模式（最优）**：
- 实时状态栏显示
- 自动状态同步
- 精确的状态追踪
- 完整的趋势分析
- 自动HTML注释解析

**内置状态栏模式（次优）**：
- 实时状态栏显示（MVU状态栏）
- 基础的状态追踪
- 自动HTML注释解析

**降级模式（基础）**：
- 文本描述状态
- 简化的变化计算
- 基础的回归机制
- 手动趋势判断
```

**应修改为**：
```
### 状态系统

**记忆增强插件模式（最优）**：
- 实时状态栏显示（由角色卡读取并显示）
- 自动状态同步
- 精确的状态追踪
- 完整的趋势分析
- 自动HTML注释解析

**降级模式（基础）**：
- 文本描述状态
- 简化的变化计算
- 基础的回归机制
- 手动趋势判断
- 使用默认值
```

---

## ✅ 修改后的架构说明

### 当前架构
1. **记忆增强插件**：作为唯一的状态数据源
2. **角色卡**：读取记忆增强插件的状态并显示状态栏
3. **status_panel.ts脚本**：解析HTML注释并同步到记忆增强插件
4. **不再使用MVU功能**：完全移除MVU状态栏界面

### 工作流程
```
AI输出HTML注释 
  ↓
status_panel.ts解析 
  ↓
同步到记忆增强插件 
  ↓
角色卡读取插件状态 
  ↓
角色卡显示状态栏
```

### 状态来源标识
- **记忆增强插件**：插件可用且正常工作
- **默认值**：插件不可用时使用默认值

---

## 🔍 验证清单

修改完成后，请验证：

- [ ] description字段已移除"MVU状态栏"
- [ ] system_prompt中所有"MVU状态栏"引用已移除
- [ ] post_history_prompt中所有"MVU状态栏"引用已移除
- [ ] character_book中所有"MVU状态栏"引用已移除
- [ ] 所有说明都改为"由角色卡读取并显示"
- [ ] 移除了"内置状态栏模式（次优）"的说明
- [ ] 状态来源只保留"记忆增强插件"和"默认值"

---

## 📌 重要提示

1. **不再使用MVU功能**：所有MVU相关的代码和界面都已禁用
2. **角色卡负责显示**：状态栏由角色卡通过读取记忆增强插件来显示
3. **保持兼容性**：继续使用`<!--STATUS_UPDATE:...-->`格式，记忆增强插件会自动读取
4. **降级方案**：如果记忆增强插件不可用，使用默认值
